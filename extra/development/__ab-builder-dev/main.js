/**
 Провайдер AnyBalance (http://any-balance-providers.googlecode.com)
 */

var g_headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Charset': 'windows-1251,utf-8;q=0.7,*;q=0.3',
    'Accept-Language': 'ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4',
    'Connection': 'keep-alive',
    'User-Agent': 'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.76 Safari/537.36',
};

var _html = '<!DOCTYPE html><html class="i-ua_js_no i-ua_css_standart i-ua_browser_chrome" lang="ru"><head xmlns:og="http://ogp.me/ns#"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Яндекс</title><meta http-equiv=Content-Type content="text/html;charset=UTF-8"><link rel="apple-touch-icon" href="//yastatic.net/morda-logo/i/apple-touch-icon/ru-76x76.png" sizes="76x76"><link rel="apple-touch-icon" href="//yastatic.net/morda-logo/i/apple-touch-icon/ru-120x120.png" sizes="120x120"><link rel="apple-touch-icon" href="//yastatic.net/morda-logo/i/apple-touch-icon/ru-152x152.png" sizes="152x152"><link rel="apple-touch-icon" href="//yastatic.net/morda-logo/i/apple-touch-icon/ru-180x180.png" sizes="180x180"><link rel="alternate" type="application/rss+xml" title="Новости Яндекса" href="//company.yandex.ru/news/news.rss"><link rel="alternate" type="application/rss+xml" title="Блог Яндекса" href="//company.yandex.ru/blog/index.rss"><link rel="search" href="//yandex.ru/opensearch.xml" title="Яндекс" type="application/opensearchdescription+xml"><link rel="shortcut icon" href="//yastatic.net/morda-logo/i/favicon_islands.ico"><link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/cdlgdffkkjdoglbioephbahjkkmmpdhi"><meta property="og:title" content="Яндекс"><meta property="og:type" content="website"><meta property="og:image" content="//yastatic.net/morda-logo/i/share-logo-ru.png"><meta property="og:site_name" content="Яндекс"><meta property="og:locale" content="ru_RU"><meta property="og:description" content="Найдётся всё"><script>function Detector(){"use strict";var e="detector",t=document.documentElement;return{isPlaceholderSupported:function(){return"placeholder"in document.createElement("input")},getCSS3TransformProperty:function(){for(var e=document.documentElement.style,t=["transform","MozTransform","MsTransform","msTransform","WebkitTransform","OTransform"],n="",i=0,r=t.length;r>i;++i)if(void 0!==e[t[i]]){n=t[i];break}return this.getCSS3TransformProperty=function(){return n},n},checkDataURLSupport:function(e){var t=new Image;t.onload=t.onerror=function(){e(1===this.width&&1===this.height)},t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="},isActivexEnabled:function(){var e=!1;try{e=!!new window.ActiveXObject("htmlfile")}catch(t){e=!1}return e},isWin64:function(){return window.navigator&&"Win64"===window.navigator.platform},isFullScreen:function(){return window.innerWidth&&window.screen&&window.screen.width&&window.screen.height&&window.innerHeight&&window.innerWidth===screen.width&&window.innerHeight===screen.height},isIEMetroMode:function(){return this.isFullScreen()&&this.isWin64()&&!this.isActivexEnabled()},isSVGSupported:function(){if("opera"in window)return!1;var e=document.createElement("svg");return e.innerHTML="<svg/>",e.firstChild&&"http://www.w3.org/2000/svg"===e.firstChild.namespaceURI},injectElementWithStyles:function(n,i,r,o){var a,d,s,u,l=document.createElement("div"),c=document.body,m=c||document.createElement("body");if(parseInt(r,10))for(;r--;)s=document.createElement("div"),s.id=o?o[r]:e+(r+1),l.appendChild(s);return a=["&#173;",\'<style id="s\',e,\'">\',n,"</style>"].join(""),l.id=e,(c?l:m).innerHTML+=a,m.appendChild(l),c||(m.style.background="",m.style.overflow="hidden",u=t.style.overflow,t.style.overflow="hidden",t.appendChild(m)),d=i(l,n),c?l.parentNode.removeChild(l):(m.parentNode.removeChild(m),t.style.overflow=u),!!d},isMQuerySupported:function(t){var n=window.matchMedia||window.msMatchMedia,i=!1;return n?i=n(t).matches:this.injectElementWithStyles("@media "+t+" { #"+e+" { position: absolute; } }",function(e){i="absolute"===(window.getComputedStyle?getComputedStyle(e,null):e.currentStyle).position}),i},isInlineBlockSupported:function(){var e,t=$(\'<span style="display:none"><div style="width:100px;display:inline-block"></div><div style="width:100px;display:inline-block"></div></span>\');return $("body").append(t),e=t.width()>100,t.remove(),e},isTransparentPNGSupported:function(){var e=navigator.userAgent.match(/MSIE (\d+)/);return e&&e[1]?(e=parseFloat(e[1]),"Microsoft Internet Explorer"!==navigator.appName||e>6):!0},isAnimationSupported:function(){if("opera"in window)return!1;for(var e=document.documentElement.style,t=["animationName","webkitAnimationName"],n=0,i=t.length;i>n;n++)if(void 0!==e[t[n]])return!0}}}function MyMap(){this.rules={},this.rulesData=[]}MyMap.prototype={add:function(e){return e=e||null,e&&!this.rules[e]&&(this.rulesData.push(e),this.rules[e]=this.rulesData.length-1),this},get:function(e){var t=this.rules[e];return t&&this.rulesData[t]||null},getAll:function(){return this.rulesData.join(" ")}};var detector=new Detector;!function(){var e,t=new MyMap;t.add("js").add("i-ua_placeholder_"+(detector.isPlaceholderSupported()?"yes":"no")).add(detector.isIEMetroMode()&&"m-ie10-metro").add(detector.isSVGSupported()?"i-ua_inlinesvg_yes m-svg":"i-ua_inlinesvg_no no-data-url").add(detector.isAnimationSupported()&&"i-ua_animation_yes").add(this.device&&"m-touch"),detector.checkDataURLSupport(function(e){e||(document.documentElement.className+=" no-data-url")}),this.document&&this.document.documentElement&&(e=this.document.documentElement,e.className=e.className.replace("i-ua_js_no","i-ua_js_yes")+" "+t.getAll())}();</script><link rel="stylesheet" href="//yastatic.net/www/_/d/R/Eqvn-S9WbWOk89mfCH5S5qYkQ.css"></head><body class="b-page css3-transition-off"><table class="b-table layout__table"><tr class="b-table__row layout__header"><td class="b-table__cell layout__header-cell"><div class="b-sethome b-sethome_type_chrome i-bem" data-bem="{&quot;b-sethome&quot;:{&quot;inlinelink&quot;:&quot;https://chrome.google.com/webstore/detail/cdlgdffkkjdoglbioephbahjkkmmpdhi&quot;}}"><a href="http://home.yandex.ru/?from=prov_yaru" class="link b-sethome__link" title="Сделать стартовой">Сделать стартовой</a></div><div class="personal i-bem" data-bem="{&quot;personal&quot;:{&quot;authUrl&quot;:&quot;https://www.yandex.ru/data/mail.js?yaru=y&quot;,&quot;retpath&quot;:&quot;https%3A%2F%2Fya.ru&quot;,&quot;stat&quot;:0}}"><a href="https://mail.yandex.ru" class="link_black_novisit link b-inline link_logout" tabindex="3"><div class="b-inline">Войти&nbsp;в&nbsp;почту</div></a></div></td></tr><tr class="b-table__row layout__search"><td class="b-table__cell"><form class="search2 suggest2-form suggest2-counter i-bem" action="https://yandex.ru/search/" role="search" aria-label="Поиск в интернете" onclick="return {&quot;suggest2-form&quot;:{},&quot;suggest2-counter&quot;:{&quot;service&quot;:&quot;morda_yaru&quot;,&quot;host&quot;:&quot;//yandex.ru/clck&quot;,&quot;path&quot;:&quot;jclck&quot;,&quot;submitBySelect&quot;:true,&quot;preventSubmit&quot;:true,&quot;suggestReqID&quot;:true,&quot;params&quot;:{&quot;dtype&quot;:&quot;stred&quot;,&quot;pid&quot;:&quot;0&quot;,&quot;cid&quot;:&quot;2873&quot;}},&quot;search2&quot;:{&quot;cleanOnSubmit&quot;:false,&quot;nl&quot;:true}}"><div class="suggest2-form__node"><div class="search2__button"><button class="button suggest2-form__button button_theme_websearch button_size_xl i-bem" data-bem="{&quot;button&quot;:{}}" tabindex="-1" role="button" type="submit"><span class="button__text">Найти</span></button></div><div class="search2__input"><span class="input suggest2-form__input input_size_xl input_theme_websearch input_search2-clear-hide_yes input_ahead_yes input_autofocus_capture input_clear_yes input_count_yes i-bem" data-bem="{&quot;input&quot;:{&quot;live&quot;:false,&quot;autoFocus&quot;:true}}"><span class="input__box"><input class="input__control input__input" tabindex="2" autocomplete="off" aria-label="Запрос" id="text" maxlength="400" name="text"/><span class="input__clear" unselectable="on">&nbsp;</span></span></span></div><div class="i-bem popup suggest2 suggest2_theme_transparent suggest2_size_m suggest2_adaptive_yes popup_adaptive_yes popup_animate_no popup_autoclosable_yes popup_theme_ffffff" data-bem="{&quot;popup&quot;:{&quot;directions&quot;:&quot;bottom-left&quot;},&quot;suggest2&quot;:{&quot;url&quot;:&quot;//suggest.yandex.ru/suggest-ya.cgi&quot;,&quot;data&quot;:{&quot;srv&quot;:&quot;morda_yaru&quot;,&quot;wiz&quot;:&quot;TrWth&quot;,&quot;lr&quot;:&quot;213&quot;,&quot;uil&quot;:&quot;ru&quot;,&quot;fact&quot;:1,&quot;v&quot;:4,&quot;icon&quot;:1,&quot;hl&quot;:1,&quot;html&quot;:1,&quot;n&quot;:5,&quot;yu&quot;:&quot;2861626941445944332&quot;},&quot;onFocus&quot;:&quot;show&quot;,&quot;aheadFromServer&quot;:true,&quot;submitBySelect&quot;:true,&quot;requestOnEmptyInput&quot;:false},&quot;suggest2-detect&quot;:{}}"><div class="popup__under"></div><div class="popup__content"> </div></div></div></form></td></tr><tr class="b-table__row layout__footer"><td class="b-table__cell"><a href="//www.yandex.ru" class="link layout__footer-logo" 0=" " 1="t" 2="a" 3="b" 4="i" 5="n" 6="d" 7="e" 8="x" 9="=" 10="&quot;" 11="6" 12="&quot;" title="Яндекс"></a></td></tr></table><script src="//yastatic.net/jquery/1.8.3/jquery.min.js"></script><script src="//yastatic.net/www/2.634/white/pages/yaru/_yaru.ru.js"></script><span data-xapp="statlogger" data-showid="22882.27185.1450945884.78607" data-enabled="false" data-statroot="" data-redirhost="https://yandex.ru/clck/" data-clckhost="https://yandex.ru/clck/"></span><script>BEM.DOM.scope=$(\'body\');Lego.init({"locale":"ru","msid":"22882.27185.1450945884.78607","jsMdaUrl":"","click-host":"yandex.ru/clck","retpath":"https://mail.yandex.ru"});BEM.DOM.init();</script><script>window.home=window.home||{};window.home[\'export\']={"i-mda-auth":{"url":""}};</script><script>Lego.init({\'statRoot\': \'\',\'statEnabled\': false,\'msid\': \'22882.27185.1450945884.78607\',\'click-host\': \'yandex.ru/clck\'});</script><script>BEM.DOM.init();</script><script>BEM && BEM.blocks[\'i-mda-auth\'] && BEM.blocks[\'i-mda-auth\'].authenticate(function(){});</script><script>!function(){"use strict";x.amd.require("statlog",function(e){BEM.DOM.decl({name:"b-sethome",modName:"type",modVal:"chrome"},{_onLinkClick:function(){var o=this.params.inlinelink,t=this;if(o){try{window.chrome.webstore.install(o,function(){t.domElem.addClass("i-hidden"),e.log("sethome.chrome_ext.yes","click")},function(){e.log("sethome.chrome_ext.no","click")}),e.log("sethome.chrome_ext.yes"),e.log("sethome.chrome_ext.no")}catch(i){e.log("sethome.chrome_ext.error","click")}return!1}}},{live:function(){return this.liveBindTo("link","leftclick",function(){return this._onLinkClick()}),!0}})})}();</script><script src="https://mc.yandex.ru/metrika/watch.js" type="text/javascript"></script><script type="text/javascript">(function(w){try{w[\'yaCounter723233\']=new Ya.Metrika({"id":723233,"trackLinks":true});if (!w[\'defaultMetrikaCounter\']) {w[\'defaultMetrikaCounter\']=w[\'yaCounter723233\']}}catch(e){}})(window)</script><noscript><div><img src="https://mc.yandex.ru/watch/723233" style="position:absolute; left:-9999px;" alt=""/></div></noscript><noscript class="i-flashcookie i-flashcookie_type_inline i-bem" data-bem="{&quot;i-flashcookie&quot;:{}}"><span style="background:url(//kiks.yandex.ru/fu/) no-repeat;"></span></noscript><i class="b-counter" style="background: url(//www.tns-counter.ru/V13a****yandex_ru/ru/CP1251/tmsec=yandex_ya/0);"></i><!--n24.wfront.yandex.net--></body></html>';

function main() {
    //для теста http://support.anybalance.ru/scp/tickets.php?id=4648
    //для теста http://bananawars.ru/index.php 


	function ResultContainer(result) {
		return function(param) {
			return function (resultFunc) {
				if (AnyBalance.isAvailable(param))
					result[param] = resultFunc();
			}
		}.bind(this, result);
	}
	var rc = new ResultContainer(result)
//	function rc(param) {
//		return function (resultFunc) {
//			if (AnyBalance.isAvailable(param))
//				result[param] = resultFunc();
//		}
//	}
	
    var result = {success: true};
	
	//получаем ошибки: 
    AB(html)
        //.find("table td:has(img[src$=error.gif]) + td")
        .find(/\berror\.gif\b[\s\S]*?<td>([\s\S]*?)<\/td>/, 1)
        .toText() //htmlToText(); htmlEntityDecode(); выполняем trim(); делаем приведение типа данных к строке.

    AB(html)
        .find("table td:has(img[src$=error.gif]) + td")
        .toText() //htmlToText(); htmlEntityDecode(); выполняем trim(); делаем приведение типа данных к строке.


    /*
	//счётчики, вариант 1

    html = AB(html).find("h3:contains(Характеристики) + table").htmlToText().toString();
    AB(html).find(/Уровень:\s+(\d+)/i).toNumeric(rc("level1"))		//получаем последний нумерованный карман (если карманов нет, то получаем всё совпадение); делаем приведение типа данных к целому числу
    AB(html).find(/(Уровень):\s+(\d+)/i, 2).toNumeric(result, 'level2')	//получаем и указываем нумерованный карман явно; делаем приведение типа данных к числу с плавающей запятой

    //toTimeInterval(), toTime(), toHtml()
    var json = {'k': 'v'};
    AB(json).find('');

    //счётчики, вариант 2
    AB(html).find("span:contains(Уровень) + span").htmlToText().toNumeric(result, 'level');
    AB(html).find("span:contains(Деньги) + span").htmlToText().find(/\$(\d+)/).toNumeric(result, 'money');
	*/

    AnyBalance.setResult(result);
}