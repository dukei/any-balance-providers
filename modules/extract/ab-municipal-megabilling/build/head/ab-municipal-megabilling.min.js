var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (BlackBerry; U; BlackBerry 9900; en-US) AppleWebKit/534.11+ (KHTML, like Gecko) Version/7.0.0.187 Mobile Safari/534.11+"};
function doMegabilling(b){var g=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");var a=AnyBalance.requestGet(b,g_headers),a=createFormParams(a,function(a,b,c,d){return"username"==c?g.login:"password"==c?g.password:d}),a=AnyBalance.requestPost(b+"login",a,g_headers);if(!/\/Logout/i.test(a)){if(b=getParam(a,null,null,/class="page-error"[^>]*>([^<]*)/i,replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/парол/i.test(b));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");
}b=AnyBalance.getLastUrl();var c=getParam(a,null,null,/<meta[^>]+name="csrf-token"[^>]+content="([^"]*)/i,replaceHtmlEntities);if(/\/accounts\/\d+$/i.test(b)){AnyBalance.trace("Ожидаем подключения");var e=1;do{a=AnyBalance.requestGet(b,addHeaders({"X-Requested-With":"XMLHttpRequest",Referer:b,"X-CSRF-Token":c,Accept:"*/*;q=0.5, text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}));if(/подключение успешно|Успішно підключено/i.test(a)){b=getParam(a,null,null,
/window.location.href\s*=\s*'([^']*)/);a=AnyBalance.requestGet(b,g_headers);break}if(5<++e)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось подключиться за 5 попыток. Сайт изменен?");AnyBalance.sleep(3E3);AnyBalance.trace("Попытка "+e)}while(1)}else throw AnyBalance.trace(b+"\n"+a),new AnyBalance.Error("Не удалось войти в личный кабинет. Сайт изменен?");c=getParam(a,null,null,/<meta[^>]+name="csrf-token"[^>]+content="([^"]*)/i,replaceHtmlEntities);a=AnyBalance.requestGet(b,addHeaders({"X-Requested-With":"XMLHttpRequest",
Referer:b,"X-CSRF-Token":c,Accept:"*/*;q=0.5, text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"}));b=getParam(a,null,null,/'#account_summary_details'\)\.html\('((?:[^\\']+|\\.)*)/i,[/^(.*)/,"return '$1'"],safeEval);c=getParam(a,null,null,/'#account_summary'\)\.html\('((?:[^\\']+|\\.)*)/i,[/^(.*)/,"return '$1'"],safeEval);e=getParam(a,null,null,/'#saldo'\)\.html\('((?:[^\\']+|\\.)*)/i,[/^(.*)/,"return '$1'"],safeEval);AnyBalance.trace(b);AnyBalance.trace(c);
AnyBalance.trace(e);var d={success:!0},f=getParam(e,null,null,/<span[^>]+"saldo-value"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);isset(f)&&(/debit/i.test(e)?getParam(f,d,"balance"):getParam(-1*f,d,"balance"));getParam(a,d,"acc",/(?:Лицевой счет|Особовий рахунок)\s*№\s*(\d+)/i,replaceTagsAndSpaces);getParam(b,d,"fio",/(?:Потребитель|Споживач)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,d,"lastpay",/(?:Последняя оплата|Остання оплата)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces);getParam(c,d,"lastcounter",/(?:Последние показания счетчика|Останні показання лічильника)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,[/<a[^>]*>([\s\S]*?)<\/a>/ig," ",replaceTagsAndSpaces]);getParam(c,d,"tarif",/(?:Действующий тариф|Діючий тариф)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.setResult(d)};
