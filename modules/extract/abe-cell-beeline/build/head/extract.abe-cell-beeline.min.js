var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.64 Safari/537.31"},g_currencys={"руб":"₽",RUB:"₽",RUR:"₽","тенге":"₸",undefined:""};
function getBlock(b,a,c){b=getBlockInner(b,a,c);if("string"==typeof b){a=c.replace(/^\^/,"");var d=a!=c;/bonusesForm/i.test(c)&&(a=getParam(a,null,null,/([^\s]+)/i));return extractFromUpdate(b,a,d)}return b}
function getBlockInner(b,a,c){var d=c.replace(/^\^/,""),e=d!=c,f=a;isArray(a)&&(f=a[1],a=a[0]);a=getParam(a,null,null,new RegExp("PrimeFaces\\.\\w+\\s*\\(\\s*\\{[^}]*u:\\s*'"+(e?"":"[^']*")+d));if(!a)return AnyBalance.trace("Блок "+c+" не найден!"),"";d=getParam(a,null,null,/f:\s*'([^']*)/,replaceSlashes);if(!d)return AnyBalance.trace("Не найден ID формы для блока "+c+"!"),"";f=getParam(f,null,null,new RegExp('<form[^>]+name="'+d+'"[\\s\\S]*?</form>',"i"));if(!f)return AnyBalance.trace("Не найдена форма "+
d+" для блока "+c+"!"),"";c=createFormParams(f);f=getParam(a,null,null,/s:\s*'([^']*)/,replaceSlashes);a=getParam(a,null,null,/u:\s*'([^']*)/,replaceSlashes);c["javax.faces.partial.ajax"]=!0;c["javax.faces.source"]=f;c["javax.faces.partial.execute"]="@all";c["javax.faces.partial.render"]=a;c[f]=f;return b?a=AnyBalance.requestPost(b,c,addHeaders({Referer:b,"Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"})):c}
function extractFromUpdate(b,a,c){c=getParam(b,null,null,new RegExp('<update[^>]*id="'+(c?"":'[^"]*')+a+'"[^>]*>\\s*<!\\[CDATA\\[([\\s\\S]*?)\\]\\]></update>',"i"));return c?c:(AnyBalance.trace("Неверный ответ для блока "+a+": "+b),"")}
function refreshBalance(b,a,c){var d=getParam(a,null,null,/PrimeFaces\.\w+\s*[^}]*(?:header|home)Balance/i);if(!d)return AnyBalance.trace("Блок headerBalance не найден!"),"";var e=getParam(a,null,null,/<form[^>]*action="(?:[^>]*>){3}\s*loadingBalance[\s\S]*?<\/form>/i);if(!e)return AnyBalance.trace("Не найдена форма для блока (?:header|home)Balance!"),"";c=getParam(e,null,null,/s:\s*["']([^"']+)/i,replaceSlashes);d=getParam(d,null,null,/(?:u|block):\s*["']([^"']+)/i,replaceSlashes);a=getParam(a,null,
null,/<input[^>]+name="javax.faces.ViewState"[^>]*value="([^"]+)/i,replaceHtmlEntities);e=createFormParams(e);e["javax.faces.partial.ajax"]=!0;e["javax.faces.source"]=c;e["javax.faces.partial.execute"]="@all";e["javax.faces.partial.render"]=d;e[c]=c;e["javax.faces.ViewState"]=a;a=AnyBalance.requestPost(b,e,addHeaders({Referer:b,"Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"}));return extractFromUpdate(a,d,!0)}
function getBonusesBlock(b,a,c,d,e){var f=a;isArray(a)&&(f=a[1],a=a[0]);var g=new RegExp("(?:loadingbonusesloaderDetails|loadingAccumulators)\\s*=\\s*function\\(\\) \\{PrimeFaces\\.\\w+\\s*\\(\\s*\\{[^}]*u:\\s*'"+(d?"":"[^']*")+c);g=getParam(a,null,null,g);if(!g)return AnyBalance.trace("Блок "+c+" не найден!"),"";a=getParam(g,null,null,/f:\s*'([^']*)/,replaceSlashes);if(!a)return AnyBalance.trace("Не найден ID формы для блока "+c+"!"),"";f=getParam(f,null,null,new RegExp('<form[^>]+name="'+a+'"[\\s\\S]*?</form>',
"i"));if(!f)return AnyBalance.trace("Не найдена форма "+a+" для блока "+c+"!"),"";f=createFormParams(f);a=getParam(g,null,null,/s:\s*'([^']*)/,replaceSlashes);g=getParam(g,null,null,/u:\s*'([^']*)/,replaceSlashes);f["javax.faces.partial.ajax"]=!0;f["javax.faces.source"]=a;f["javax.faces.partial.execute"]="@all";f["javax.faces.partial.render"]=g;f[a]=a;if(e)return f;a=AnyBalance.requestPost(b,f,addHeaders({Referer:b,"Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"}));/bonusesForm/i.test(c)&&
(c=getParam(c,null,null,/([^\s]+)/i));g=new RegExp('<update[^>]*id="'+(d?"":'[^"]*')+c+'"[^>]*>\\s*<!\\[CDATA\\[([\\s\\S]*?)\\]\\]></update>',"i");g=getParam(a,null,null,g);return g?g:(AnyBalance.trace("Неверный ответ для блока "+c+": "+a),"")}function myParseCurrency(b){var a=b.replace(/\s+/g,"").replace(/[\-\d\.,]+/g,"");a=g_currencys[a]||a;AnyBalance.trace("Parsing currency ("+a+") from: "+b);return a}
function checkCorrectNumberLogin(b,a){var c=AnyBalance.getPreferences();a=getParam(a,null,null,[/"sso-number"[^>]*>([^<]*)/i,/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i],[/\D/g,""]);if(!a)throw new AnyBalance.Error("Не удалось выяснить на какой номер мы залогинились, сайт изменен?");AnyBalance.trace("Судя по всему, мы уже залогинены на номер "+a);c=c.phone||c.login;if(!endsWith(a,c))return AnyBalance.trace("Залогинены на неправильный номер "+a+" т.к. в настройках указано, что номер должен заканчиваться на "+
c+". Надо перелогиниться."),AnyBalance.requestGet(b+"c/logout.xhtml",addHeaders({Referer:AnyBalance.getLastUrl()})),AnyBalance.requestGet(b+"oam_logout_success",g_headers),!1;AnyBalance.trace("Залогинены на правильный номер "+a);return!0}
function loginProc(b,a,c){var d=AnyBalance.getPreferences();try{var e=AnyBalance.requestPost(b+(a||"login.xhtml"),c,addHeaders({Referer:b+"login.xhtml"}))}catch(f){if(d.__debug)e="b2b"==d.__debug?AnyBalance.requestGet(b+"b/index.xhtml"):AnyBalance.requestGet(b+"c/"+d.__debug+"/index.html");else throw f;}return e}function isMultinumbersCabinet(b){return 1<sumParam(b,null,null,/selectAccount\('\d+'\);/ig).length}
function canUseMobileApp(b){return(!b.phone||b.phone==b.login)&&/^\d{10}$/.test(b.login)}function login(b){AnyBalance.setDefaultCharset("utf-8");return AnyBalance.getPreferences().password?loginWithPassword(b):loginWithoutPassword(b)}function isLoggedIn(b){return/logOutLink|Загрузка баланса\.\.\.|b\/logout.xhtml/i.test(b)}
function getLKType(b){if(/b\/logout.xhtml/i.test(b))return __setLoginSuccessful(),{type:"B2B",html:b};if(!isLoggedIn(b)){var a=getParam(b,null,null,[/<div[^>]+class="error-page[\s|"][^>]*>([\s\S]*?)<\/div>/i,/<span[^>]+class="ui-messages-error-summary"[^>]*>([\s\S]*?)<\/span>/i],replaceTagsAndSpaces);if(a)throw new AnyBalance.Error(a,null,/Неправильные логин и\s*(?:\(или\)\s*)?пароль|Пользователь не найден/i.test(a));if(400<AnyBalance.getLastStatusCode())throw AnyBalance.trace("Beeline returned: "+
AnyBalance.getLastStatusString()),new AnyBalance.Error("Личный кабинет Билайн временно не работает. Пожалуйста, попробуйте позднее.");if(a=getParam(b,null,null,/<h1>\s*(Личный кабинет временно недоступен\s*<\/h1>[\s\S]*?)<\//i,replaceTagsAndSpaces))throw new AnyBalance.Error(a);AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");}__setLoginSuccessful();return/postpaid/i.test(b)?{type:"POSTPAID",html:b}:{type:"PREPAID",html:b}}
function doLogin(b,a,c){var d=AnyBalance.requestGet(b,g_headers),e=getParam(d,null,null,/<form[^>]+name="loginFormB2C:loginForm"[^>]*>[\s\S]*?<\/form>/i);isLoggedIn(d)&&(AnyBalance.trace("Похоже, что мы запустились через мобильный интернет."),checkCorrectNumberLogin(b,d)||(d=AnyBalance.requestGet(b+"login.xhtml",g_headers),e=getParam(d,null,null,/<form[^>]+name="loginFormB2C:loginForm"[^>]*>[\s\S]*?<\/form>/i)));if(e){AnyBalance.trace("Похоже, что форма авторизации присутствует.");var f=createFormParams(e);
f["loginFormB2C:loginForm:login"]=a;f["loginFormB2C:loginForm:password"]=c;f["loginFormB2C:loginForm:passwordVisible"]=c;f["loginFormB2C:loginForm:loginButton"]="";a=getParam(e,null,null,/<form[^>]+action="\/([^"]*)/i,replaceHtmlEntities);for(c=1;6>c;c++)if(d=loginProc(b,a,f),/Вход в личный кабинет/i.test(d)&&!/<span[^>]+class="ui-messages-error-summary"/i.test(d))AnyBalance.trace("Войти не удалось, сайт не сообщает ни о каких ошибках, попытка №"+c);else{AnyBalance.trace("Выполнили "+c+" попыток входа..");
break}}else if(!isLoggedIn(d)){AnyBalance.trace("Похоже, форма авторизации отсутствует.");if(400<AnyBalance.getLastStatusCode())throw AnyBalance.trace("Beeline returned: "+AnyBalance.getLastStatusString()),new AnyBalance.Error("Личный кабинет Билайн временно не работает. Пожалуйста, попробуйте позднее.");AnyBalance.trace(d);throw new AnyBalance.Error("Не удаётся найти форму входа. Сайт изменен?");}return d}
function loginWithPassword(b){var a=AnyBalance.getPreferences();checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");a=doLogin(b,a.login,a.password);/Ваш пароль временный\.\s*Необходимо изменить его на постоянный/i.test(a)&&(AnyBalance.trace("Билайн считает наш пароль временным, но это может быть и не так, попробуем еще раз войти..."),a=AnyBalance.requestPost(b+(action||"login.html"),params,addHeaders({Referer:b+"login.html"})));if(/<form[^>]+name="(?:chPassForm)"|Ваш пароль временный\.\s*Необходимо изменить его на постоянный/i.test(a))throw new AnyBalance.Error("Вы зашли по временному паролю, требуется сменить пароль. Для этого войдите в ваш кабинет "+
b+" через браузер и смените там пароль. Новый пароль введите в настройки данного провайдера.",null,!0);if(/<form[^>]+action="\/(?:changePass|changePassB2C).html"/i.test(a))throw new AnyBalance.Error("Билайн требует сменить пароль. Зайдите в кабинет "+b+" через браузер и поменяйте пароль на постоянный.",null,!0);return getLKType(a)}
function proceedWithSite(b,a,c,d){getParam(a,d,"type");switch(a){case "B2B":fetchB2B(b,c,d);break;case "PREPAID":fetchPre(b,c,d);break;case "POSTPAID":fetchPost(b,c,d);break;default:throw new AnyBalance.Error("Неизвестный тип кабинета: "+a);}}function parseBalanceNegative(b){b=parseBalance(b);if(isset(b))return-b}
function fetchB2B(b,a,c){var d=AnyBalance.getPreferences();AnyBalance.trace("Мы в кабинете для юр. лиц...");getParam(a,c,"fio",/"user-name"([^>]*>){2}/i,replaceTagsAndSpaces,capitalFirstLetters);if(AnyBalance.isAvailable("balance","agreement","currency","overpay")){var e=sumParam(a,null,null,/b\/info\/contractDetail\.xhtml\?objId=\d+[^>]*>\d{5,10}/ig);if(!e||1>e.length)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти ни одного договора, сайт изменен, либо проблемы на сайте.");AnyBalance.trace("Договоров: "+
e.length);e=e[0];a=getParam(e,null,null,/>(\d+)/);getParam(e,null,null,/b\/info\/contractDetail\.xhtml\?objId=(\d+)/i);e=getParam(e,null,null,/b\/info\/contractDetail\.xhtml\?objId=\d+/i);AnyBalance.trace("Получим информацию по договору: "+a);a=AnyBalance.requestGet(b+e,g_headers);getParam(a,c,"agreement",/Договор №([\s\d]+)/i,replaceTagsAndSpaces);getParam(a,c,"balance",/class="balance"[^>]*>([\s\S]*?)<\/div>/i,[replaceTagsAndSpaces,/Сумма неоплаченных счетов[^\d]+/i,"-"],parseBalance);getParam(a,
c,"overpay",/class="[^>]*balance"[^>]*>([\s\S]*?)<\/div>/i,[replaceTagsAndSpaces,/Сумма неоплаченных счетов[^\d]+/i,"-"],parseBalance);getParam(a,c,["currency","balance"],/class="balance"[^>]*>([\s\S]*?)<\/div>/i,[replaceTagsAndSpaces,/все счета оплачены/,"",/[.,]/g,""],myParseCurrency)}a=AnyBalance.requestGet(b+"b/info/abonents/catalog.xhtml",g_headers);d.phone&&(a=AnyBalance.requestGet(b+"b/search/result.xhtml?q="+encodeURIComponent(d.phone),{Referer:b+"b/index.xhtml"}));a=getParam(a,/\/([^"]*subscriberDetail.xhtml[^"]*)/i,
replaceHtmlEntities);checkEmpty(a,"Не удалось найти "+(d.phone?"номер с последними цифрами "+d.phone:"ни одного номера!"),!0);a=AnyBalance.requestGet(b+a,{Referer:AnyBalance.getLastUrl()});c.info||(c.info={});getParam(a,c.info,"info.phone",/subheader\s*"([^>]*>){3}/i,replaceTagsAndSpaces);getParam(a,c,"tariff",/Тариф:([^>]*>){5}/i,replaceTagsAndSpaces);isAvailable("balance")&&getParam(a,null,null,/<form id="reportDetailUnbilledButtonsForm"[\s\S]*?<\/form>/i);b=sumParam(a,null,null,/class="accumulator"[^>]*>([\s\S]*?)<\/div/ig);
AnyBalance.trace("Найдено бонусов и пакетов: "+b.length);c.remainders||(c.remainders={});for(d=0;d<b.length;d++){e=b[d];var f=getParam(e,/([^<]*)</i),g=getParam(e,/израсходовано[^>]*>([\s\d.,]+мин)/i,replaceTagsAndSpaces,parseMinutes),k=getParam(e,/из доступных[^>]*>([\s\d.,]+мин)/i,replaceTagsAndSpaces,parseMinutes),h=getParam(e,/израсходовано[^>]*>([\s\d.,]+штук)/i,replaceTagsAndSpaces,parseBalance),l=getParam(e,/из доступных[^>]*>([\s\d.,]+штук)/i,replaceTagsAndSpaces,parseBalance);/Ноль на Билайн/i.test(f)&&
isset(g)&&isset(k)?sumParam(k-g,c.remainders,"remainders.min_bi",null,null,null,aggregate_sum):isset(g)&&isset(k)?isset(c.remainders.min_left_1)||isset(c.remainders.min_left_2)?isset(c.remainders.min_left_1)&&!isset(c.remainders.min_left_2)?sumParam(k-g,c.remainders,"remainders.min_left_2",null,null,null,aggregate_sum):sumParam(k-g,c.remainders,"remainders.min_local",null,null,null,aggregate_sum):sumParam(k-g,c.remainders,"remainders.min_left_1",null,null,null,aggregate_sum):isset(h)&&isset(l)?sumParam(l-
h,c.remainders,"remainders.sms_left",null,null,null,aggregate_sum):AnyBalance.trace("Неизвестная опция, либо неизвестные единицы измерений: "+e)}0==b.length&&getBonuses(a,c)}
function processInfo_basic(b,a,c){getParam(a,c.info,"info.more3",/Вы с нами больше трёх лет!/i,null,function(d){return!!d});getParam(a,c.info,"info.phone",/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces);getParam(a,c.info,"info.region",/<div[^>]+region[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}
function processInfoPost_basic(b,a,c){if(AnyBalance.isAvailable("info.fio","info.email","info.phone")){c.info||(c.info={});getParam(a,c.info,"info.fio",/<div[^>]+class="ban-param name"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("info.email")){var d=a;/<div[^>]+class="email-fixed-width"[^>]*>/i.test(a)||(d=getBlock(b+"c/post/index.xhtml",a,"benAddressLoaderDetails"));getParam(d,c.info,"info.email",/<div[^>]+class="email-fixed-width"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}processInfo_basic(b,
a,c)}}
function switchNumberPost(b,a){var c=AnyBalance.getPreferences();if(!/^\d{4,10}$/.test(c.phone))throw new AnyBalance.Error("Введите от 4 до 10 последних цифр номера дополнительного телефона без пробелов и разделителей или не вводите ничего, чтобы получить информацию по первому номеру!",null,!0);var d=1,e=c.phone.replace(/(\d)/g,"$1[\\s\\-()]*");e=new RegExp("(?:<a[^>]*>\\s*)?<span[^>]*>\\+7[0-9\\s\\-()]*"+e+"</span>","i");e=getParam(a,null,null,e);if(!isset(e)&&(d=2,e=new RegExp('div[^>]*(?:>)[^>]*onclick="\\s*selectAccount\\([\'\\"]\\d*'+c.phone+
"['\\\"][^>]*","i"),e=getParam(a,null,null,e),!e))throw new AnyBalance.Error("Не найден присоединенный к договору номер телефона, оканчивающийся на "+c.phone);c=getParam(e,null,null,/selectAccount\('([^']*)/,replaceSlashes);isset(c)||(c=getParam(e,null,null,null,replaceTagsAndSpaces));checkEmpty(c,"Не удалось найти номер на который необходимо переключиться, сайт изменен?",!0);if(/sso-account-current|class="selected"/i.test(e))AnyBalance.trace("Дополнительный номер "+c+" уже выбран");else{AnyBalance.trace("Переключаемся на номер "+
c);if(1==d)var f=getParam(e,null,null,/addSubmitParam\('([^']*)/,replaceSlashes),g=getParam(e,null,null,/addSubmitParam\('[^']*',(\{.*?\})\)/,null,getJsonEval);else{f=getParam(a,null,null,/changeUser\s*=[^<]*?(?:f|formId):["']([^"']+)/i,replaceSlashes);var k=getParam(a,null,null,/changeUser\s*=[^<]*?(?:s|source):["']([^"']+)/i,replaceSlashes)}a=getParam(a,null,null,new RegExp('<form[^>]+id="'+f+'"[^>]*>([\\s\\S]*?)</form>',"i"));if(!a)throw AnyBalance.trace(e),new AnyBalance.Error("Дополнительный номер "+
c+" найден, но переключиться на него не удалось. Возможны изменения в личном кабинете...");1==d?(d=createFormParams(a),g=joinObjects(d,g)):(d=createFormParams(a),g=joinObjects(d,{"javax.faces.partial.ajax":"true","javax.faces.source":k,"javax.faces.partial.execute":"@all",newSsoLogin:c}),g[k]=k);try{AnyBalance.requestPost(b+"c/post/index.xhtml",g,addHeaders({Referer:b+"c/post/index.xhtml"}))}catch(h){}a=AnyBalance.requestGet(b+"c",g_headers)}return a}
function fetchPost(b,a,c){var d=AnyBalance.getPreferences();AnyBalance.trace("Мы в постоплатном кабинете");var e=/onclick\s*=\s*"\s*selectAccount\('\d{10}|<span[^>]+class="selected"[^>]*>/i.test(a),f=[replaceTagsAndSpaces,/информация[^<]*недоступна|недоступна|(?:баланс)?\s*временно недоступен/ig,""];getParam(a,c,"agreement",/<h2[^>]*>\s*Договор №([\s\S]*?)<\/h2>/i,replaceTagsAndSpaces);getParam(a,c,"tariff",/<h2[^>]*>(?:[\s\S](?!<\/h2>))*?Текущий тариф[^>]*>(?:&laquo;)?([\s\S]*?)(?:&raquo;)?(?:\s*?)?<\/h2>/i,
replaceTagsAndSpaces);if(e){AnyBalance.trace("Похоже на кабинет с несколькими номерами.");if(d.phone){a=switchNumberPost(b,a);if(/c\/pre\/index\.xhtml/i.test(a)){AnyBalance.trace("Дополнительный номер "+g+" предоплатный, но привязан к постоплатному кабинету...");a=AnyBalance.requestGet(b+"c/pre/index.xhtml",g_headers);fetchPre(b,a,c);return}a=AnyBalance.requestGet(b+"c/post/index.xhtml",g_headers)}if(AnyBalance.isAvailable("balance","currency")){var g=refreshBalance(b+"c/post/index.xhtml",a);getParam(g+
a,c,"balance",/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,f,parseBalance);getParam(g+a,c,["currency","prebal","overpay","balance"],/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,f,myParseCurrency)}}else if(AnyBalance.trace("Похоже на кабинет с одним номером."),d.phone)throw new AnyBalance.Error("Указан дополнительный номер телефона, но в кабинете нет прикрепленных номеров!");
var k=getParam(a,null,null,/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces);getParam("POSTPAID",c,"type");processInfoPost_basic(b,a,c);isAvailableBonuses()&&(AnyBalance.trace("Запросим бонусы..."),g=a,0===getFoundBonuses(g).length&&(g=getBlock(b+"c/post/index.xhtml",a,"bonusesloaderDetails")),getBonuses(g,c));AnyBalance.isAvailable("overpay","prebal","currency","bills")&&(AnyBalance.trace("Получаем информацию статусе оплаты"),g=a,/<div[^>]+id="[^"]*:bills-info"/i.test(a)||
(g=getBlock(b+"c/post/index.xhtml",a,"callDetailsDetails")),getParam(g,c,"overpay",/<h4[^>]*>Переплата[\s\S]*?<span[^>]+class="price[^>]*>([\s\S]*?)<\/span>/i,f,parseBalance),getParam(g,c,"overpay",/<h4[^>]*>Осталось к оплате[\s\S]*?<span[^>]+class="price[^>]*>([\s\S]*?)<\/span>/i,f,parseBalanceNegative),getParam(g,c,"prebal",/Расходы по договору за текущий период:[\S\s]*?<div[^<]+class="balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,f,parseBalance),getParam(g,c,["currency","prebal","overpay","balance"],
/Расходы по договору за текущий период:[\S\s]*?<div[^<]+class="balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,f,myParseCurrency),sumParam(g,c,"bills",/<div[^>]+class="unpaid-bill-item"[\s\S]*?<span[^>]+class="price[^>]*>([\s\S]*?)<\/span>/ig,[/У вас нет неоплаченных счетов/i,"0",f],parseBalance,aggregate_sum),AnyBalance.trace(g),/информация[^<]*недоступна/i.test(g)&&AnyBalance.trace("Информация временно недоступна на сайте Билайн, попробуйте позже"));!e&&AnyBalance.isAvailable("balance","currency")&&(g=
refreshBalance(b+"c/post/index.xhtml",a),getParam(g+a,c,"balance",/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,f,parseBalance),getParam(g+a,c,["currency","balance"],/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,f,myParseCurrency));d.__debug&&(a=AnyBalance.requestGet(b+"c/operations/operationsHistory.xhtml"),a=getParam(a,null,null,/<span[^>]+class="date"[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces),AnyBalance.trace("Последняя заявка: "+a));d=isAvailable("remainders.traffic_used")&&(!isset(c.remainders)||!isset(c.remainders.traffic_used));k&&(d||isAvailable("detalization"))&&(g=getParam(k,null,null,null,[/\+\s*7([\s\d\-]{10,})/i,"$1",/\D/g,""]),AnyBalance.trace("Пробуем получить данные по трафику из детализации по номеру: "+g),a=AnyBalance.requestGet(b+"c/post/fininfo/report/detailUnbilledCalls.xhtml?ctn="+g,g_headers),a=getBlockInner(b+"c/post/fininfo/report/detailUnbilledCalls.xhtml",
a,"retrieveSubCurPeriodDataDetails"),g=extractFromUpdate(a,"retrieveSubCurPeriodDataDetails"),/unbilledLoader:form:notifEmail/i.test(g)?AnyBalance.trace("Отчет получился слишком большой показа онлайн. Посылаем на почту"):d&&(c.remainders=c.remainders||{},getParam(g,c.remainders,"remainders.traffic_used",/Итоговый объем данных \(MB\):([^>]*>){3}/i,[replaceTagsAndSpaces,/([\s\S]*?)/,"$1 мб"],parseTraffic)),AnyBalance.isAvailable("detalization")&&processDetalizationPost(b,a,c));isAvailable(["expenses",
"payments"])&&(a=AnyBalance.requestGet(b+"c/post/fininfo/index.xhtml",g_headers),AnyBalance.isAvailable("expenses")&&processExpensesPost(b,a,c),AnyBalance.isAvailable("payments")&&processPaymentsPost(b,a,c));isAvailable(["total_balance"])&&(AnyBalance.trace("Пробуем получить данные по сумме всех номеров..."),a=AnyBalance.requestGet(b+"c/post/fininfo/index.xhtml",g_headers),getParam(a,c,"total_balance",/Сумма по всем номерам(?:[\s\S]*?<th[^>]*>){11}([\s\S]*?)<\/span/i,null,parseBalance));processInfo_settings(b,
c)}function processInfoPre_basic(b,a,c){AnyBalance.isAvailable("info.fio","info.region","info.phone","info.more3")&&(c.info||(c.info={}),getParam(a,c.info,"info.fio",/<p[^>]*>([^<,]*),(?:\s|&nbsp;|<[^>]*>)*Мы стремимся сделать/i,replaceTagsAndSpaces),processInfo_basic(b,a,c))}
function processInfo_settings(b,a){if(AnyBalance.isAvailable("info.email","info.address","info.birthday","info.fio")){b=AnyBalance.requestGet(b+"c/settings/enrichment/enrichment.xhtml",g_headers);a.info||(a.info={});a=a.info;getParam(b,a,"info.email",/Электронная почта[\s\S]*?<div[^>]+value-cell[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(b,a,"info.address",/<div[^>]+class="[^"]*address[^>]*>([\s\S]*?)<\/div>/i,[/Адрес проживания/i,"",replaceTagsAndSpaces]);var c=getElement(b,/<select[^>]+birthDay[^>]*>/i),
d=getElement(b,/<select[^>]+birthMonth[^>]*>/i),e=getElement(b,/<select[^>]+yearPeriods[^>]*>/i),f=create_aggregate_join(" ");sumParam(c,a,"info.birthday",/<option[^>]*selected[^>]*>([\s\S]*?)<\/option>/i,[/день/i,"",replaceTagsAndSpaces],null,f);sumParam(d,a,"info.birthday",/<option[^>]*selected[^>]*>([\s\S]*?)<\/option>/i,[/месяц/i,"",replaceTagsAndSpaces],null,f);sumParam(e,a,"info.birthday",/<option[^>]*selected[^>]*>([\s\S]*?)<\/option>/i,[/год/i,"",replaceTagsAndSpaces],null,f);isset(a.fio)&&
!/^[\s\-\d\+]*$/.test(a.fio)||getParam(b,a,"info.fio",/<div[^>]+class="name"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}}
function switchNumberPre(b,a){var c=AnyBalance.getPreferences();if(!/^\d{4,10}$/.test(c.phone))throw new AnyBalance.Error("Введите от 4 до 10 последних цифр номера дополнительного телефона без пробелов и разделителей или не вводите ничего, чтобы получить информацию по первому номеру!",null,!0);var d=getParam(a,null,null,new RegExp('div[^>]*(?:>)[^>]*onclick="\\s*selectAccount\\([\'\\"]\\d*'+c.phone+"['\\\"][^>]*","i"));if(!d)throw new AnyBalance.Error("Не найден присоединенный к договору номер телефона, оканчивающийся на "+
c.phone);c=getParam(d,null,null,/selectAccount\('([^']*)/,replaceSlashes);if(/sso-account-current/i.test(d))AnyBalance.trace("Дополнительный номер "+c+" уже выбран");else{AnyBalance.trace("Переключаемся на номер "+c);var e=getParam(a,null,null,/changeUser\s*=[^<]*?f:'([^']+)/,replaceSlashes),f=getParam(a,null,null,/changeUser\s*=[^<]*?s:'([^']+)/,replaceSlashes);e=getParam(a,null,null,new RegExp('<form[^>]+id="'+e+'"[^>]*>([\\s\\S]*?)</form>',"i"));if(!e)throw AnyBalance.trace(d),new AnyBalance.Error("Дополнительный номер "+
c+" найден, но переключиться на него не удалось. Возможны изменения в личном кабинете...");d=createFormParams(e);params=joinObjects(d,{"javax.faces.partial.ajax":"true","javax.faces.source":f,"javax.faces.partial.execute":"@all",newSsoLogin:c});params[f]=f;d=AnyBalance.requestPost(b+"c/pre/index.xhtml",params,addHeaders({Referer:b+"c/pre/index.xhtml"}));(c=getParam(d,null,null,/<redirect[^>]+url="([^"]+)/i,replaceHtmlEntities))?a=AnyBalance.requestGet(c,addHeaders({Referer:b+"c/pre/index.xhtml"})):
AnyBalance.trace("Не удалось переключить номер: "+d)}return a}
function fetchPre(b,a,c){var d=AnyBalance.getPreferences();AnyBalance.trace("Мы в предоплатном кабинете");d.phone&&(a=switchNumberPre(b,a));getParam("PREPAID",c,"type");d=getParam(a,null,null,/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces);processInfoPre_basic(b,a,c);getParam(a,c,"tariff",/Текущий тариф[^>]*>(?:&laquo;)?([\s\S]*?)(?:&raquo;)?(?:\s*?)?<\/h2>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("balance","currency","limit")){var e=function(){isset(c.balance)&&
null!=c.balance&&getParam(a+k,c,["currency","balance"],f,replaceTagsAndSpaces,myParseCurrency)},f=/<h3[^>]*>[^>]*class="price[^>]*>((?:[\s\S]*?span[^>]*>){3})/i;getParam(a,c,"balance",f,replaceTagsAndSpaces,parseBalance);var g=getElement(a,/<div[^>]+class="balance-credit"[^>]*>/i);getParam(g,c,"credit",/<h3[^>]*>([\s\S]*?)<\/h3>/i,replaceTagsAndSpaces,parseBalance);e();if(!isset(c.balance)||null==c.balance){var k=refreshBalance(b+"c/pre/index.xhtml",a);getParam(k,c,"balance",f,replaceTagsAndSpaces,
parseBalance);e()}}isAvailableBonuses()&&(k=getBonusesBlock(b+"c/pre/index.xhtml",a,"bonusesForm"),AnyBalance.trace(k),getBonuses(k,c));AnyBalance.isAvailable("detalization","payments","info.date_start")&&processDetailsAndPaymentsPre(b,d,c);processInfo_settings(b,c)}function isAvailableBonuses(){return AnyBalance.isAvailable("remainders")}
function getFoundBonuses(b){return(b=getElement(b,/<div[^>]+class="bonuses-accums[^>]*>/i))?getElements(b,/<div[^>]+class="(?:grouped-bonuses|item)[^>]*>/ig):[]}
function getBonuses(b,a,c){var d=getFoundBonuses(b);c?c="":(a=a.remainders=a.remainders||{},c="remainders.");AnyBalance.trace("Found "+d.length+" aggregated bonuses");c=c||"";0==d.length&&(AnyBalance.trace("Can`t find bonuses, tying to know why..."),AnyBalance.trace(getParam(b,null,null,/loading-failed"[^>]*>([^<]+)/i)));for(b=0;b<d.length;++b){var e=d[b];if(/^<div[^>]*item/i.test(e)){e=sumParam(e,null,null,/<div[^>]+class="\s*(?:(?:item\s*)?(?:accumulator|accumulator|bonus|item)?)[^"]*"(?:[\s\S](?!$|<div[^>]+class="(?:accumulator|accumulator|bonus|item)"))*[\s\S]/ig);
AnyBalance.trace("Found "+e.length+" bonuses");for(var f=/<div[^>]+class="[^>]*column2[^"]*"[^>]*>/i,g=[replaceTagsAndSpaces,/из.*/i,""],k=0;k<e.length;++k){var h=""+getParam(e[k],null,null,/<div[^>]+class="[^"]*column1[^"]*"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),l=getElement(e[k],f,replaceTagsAndSpaces),m=getParam(e[k],null,null,/class="[^>]*rest"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);AnyBalance.trace("Найдена опция "+h+": "+l+", rest: "+m);if(/Internet|Интернет|трафика|\d+\s+[гм]б/i.test(h))if(/(?:x|х)айвей|Интернет-трафик(?:а)?(?:\sна полной скорости)? по (?:услуге|тарифу)|Мобильного интернета|Мобильный интернет|Интернет\s*-?\s*трафик|\d+\s+[гм]б/i.test(h)){h=
function(p){return parseTraffic(p,n)};AnyBalance.trace("Пробуем разобрать новый трафик...");AnyBalance.trace("services[i] = "+e[k]);AnyBalance.trace("values = "+l);AnyBalance.trace("rest = "+m);var n=getParam(l,null,null,/((?:K|К|G|Г|M|М)?(?:B|Б))/i);n||(AnyBalance.trace("!units..."),n="mb");m?sumParam(m,a,c+"traffic_left",null,replaceTagsAndSpaces,h,aggregate_sum):(sumParam(l,a,[c+"traffic_left",c+"traffic_used"],/([^<]*)из/i,replaceTagsAndSpaces,h,aggregate_sum),sumParam(l,a,[c+"traffic_total",
c+"traffic_used"],/из([^<]*)/i,replaceTagsAndSpaces,h,aggregate_sum),isset(a.traffic_left)&&isset(a.traffic_total)&&sumParam(a.traffic_total-a.traffic_left,a,c+"traffic_used",null,null,null,aggregate_sum))}else sumParam(l,a,c+"traffic_left"+(/ноч/i.test(h)?"_night":""),null,replaceTagsAndSpaces,parseTraffic,aggregate_sum);else/SMS|СМС|штук/i.test(h)?sumParam(l,a,c+"sms_left",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):/MMS/i.test(h)?sumParam(l,a,c+"mms_left",null,replaceTagsAndSpaces,parseBalance,
aggregate_sum):/Рублей БОНУС|бонус-баланс|Дополнительный баланс/i.test(h)?sumParam(l,a,c+"rub_bonus",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):/Денежный бонус/i.test(h)?(getParam(l,a,c+"rub_bonus2",null,replaceTagsAndSpaces,parseBalance),getParam(e[k],a,c+"rub_bonus2_till",/<div[^>]+class="column3[^"]*"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDateWord)):/Рублей за участие в опросе|Счастливое время|Бонусы по программе|Счастливого времени/i.test(h)?sumParam(l,a,c+"rub_opros",
null,replaceTagsAndSpaces,parseBalance,aggregate_sum):/Минут[^<]+на\s*(?:все\s*)?номера вашего региона|Времени общения|Включенные минуты|Пакет минут|Минут общения на номера вашего региона|минут в месяц|мин\.|Голосовой трафик|Разговор.*вне сети/i.test(h)?(sumParam(l,a,c+"min_local",null,g,parseMinutes,aggregate_sum),sumParam(e[k],a,c+"min_local_till",/Доступно до([^<]{10,20})/i,replaceTagsAndSpaces,parseDateWord,aggregate_min)):/Секунд БОНУС\s*\+|Баланс бонус-секунд/i.test(h)?sumParam(l,a,c+"min_bi",
null,g,parseMinutes,aggregate_sum):/Секунд БОНУС-2|Баланс бесплатных секунд-промо/i.test(h)?(sumParam(l,a,c+"min_left_1",null,g,parseMinutes,aggregate_sum),sumParam(e[k],a,c+"min_local_till",/Доступно до([^<]{10,20})/i,replaceTagsAndSpaces,parseDateWord,aggregate_min)):/Минут общения|вызовы|на местные номера|Остаток разговоров|Разговоры/i.test(h)?/местные.*вызовы|любые номера Вашего региона|^Минут общения по тарифу$|(?:всех|других|любых)\s*(?:сотовых|мобильных)?\s*операторов|все номера|На номера домашнего региона|Минут общения по тарифу Все для бизнеса Бронза|кроме номеров .?Билайн.?|на местные номера других операторов|любые местные|другие мобильные/i.test(h)?
sumParam(l,a,c+"min_local",null,g,parseMinutes,aggregate_sum):sumParam(l,a,c+"min_bi",null,g,parseMinutes,aggregate_sum):/Баланс для оплаты дополнительных услуг/i.test(h)||AnyBalance.trace("Неизвестная опция: "+h+" "+e[k])}}else AnyBalance.trace("Пропускаем grouped-bonuses: "+e)}}
function getTempPasswordSMS(b,a){var c=AnyBalance.getPreferences(),d=b+"s/recoveryPassSSO.xhtml";do{var e=getParam(a,null,null,/<form[^>]+id="form"[^>]*>[\s\S]*?<\/form>/i);if(!e)throw AnyBalance.trace(a),new AnyBalance.Error("Не удаётся найти форму регистрации. Проблемы на сайте или сайт изменен");var f;a=createFormParams(e,function(h,l,m,n){/login/i.test(m)?n=c.login:"kaptchaId"==m?(h=AnyBalance.requestPost(b+"captcha.jpg","",addHeaders({"X-Requested-With":"XMLHttpRequest",Referer:d})),h=getJson(h),
f=h.url,n=h.id):/kaptchaInput/i.test(m)&&(h=getParam(e,null,null,/<div[^>]+ui-message-error[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),l=AnyBalance.requestGet(b+f,g_headers),n=AnyBalance.retrieveCode((h||"")+"\nВведите, пожалуйста, символы с картинки.",l,{time:3E5}));return n});var g=getParam(e,null,null,/<button[^>]+loginInnerBlock[^>]*>/i);if(!g)throw AnyBalance.trace(e),new AnyBalance.Error("Не удаётся найти кнопку подтверждения регистрации. Проблемы на сайте или сайт изменен");g=getParam(g,
null,null,/name="([^"]*)/i,replaceHtmlEntities);a["javax.faces.partial.ajax"]="true";a["javax.faces.source"]=g;a["javax.faces.partial.execute"]="@all";a["javax.faces.partial.render"]="loginInnerBlock";a[g]=g;k&&(a["javax.faces.ViewState"]=k);g=AnyBalance.requestPost(d,a,addHeaders({"X-Requested-With":"XMLHttpRequest"}));var k=extractFromUpdate(g,"ViewState:0");a=extractFromUpdate(g,"loginInnerBlock",!0)}while(/kaptchaInput/i.test(a));return g}
function createNewPassword(b){return createNewPasswordApi()}function loginWithoutPassword(b){var a=createNewPassword(b);b=AnyBalance.requestGet(b,g_headers);b=getLKType(b);b.password=a;return b}
function turnOffSMSNotification(b){b+="c/settings/notifications/notifications.xhtml";var a=AnyBalance.requestGet(b,g_headers),c=getParam(a,null,null,/<form[^>]+name="notificationEventsForm"[^>]*>[\s\S]*?<\/form>/i);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму управления уведомлениями.");a=getParam(c,null,null,/(<input[^>]+id="notificationEventsForm:[^>]*Вход в личный кабинет[^>]*>)/i,replaceHtmlEntities);if(!a)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось найти галочку отключения уведомления.");
var d=getParam(a,null,null,/name="([^"]*)/i,replaceHtmlEntities);if(getParam(a,null,null,/\s+checked=/i,replaceHtmlEntities)){a=createFormParams(c,function(f,g,k,h){k==d&&(h=void 0);return h});var e=getParam(c,null,null,/<button[^>]*u:'notificationEventsForm'[^>]*>/i);if(!e)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось найти кнопку сохранения уведомлений.");c=getParam(e,null,null,/s:'([^']*)/,replaceHtmlEntities);a["javax.faces.partial.ajax"]="true";a["javax.faces.source"]=c;a["javax.faces.partial.execute"]=
"@all";a["javax.faces.partial.render"]="notificationEventsForm";a[c]=c;a=AnyBalance.requestPost(b,a,g_headers);a=extractFromUpdate(a,"notificationEventsForm",!0);if(!/Настройки уведомлений успешно сохранены/i.test(a))throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось сохранить уведомления");AnyBalance.trace("Уведомление о входе отменено успешно!")}else AnyBalance.trace("Уведомление о входе уже выключено. Отлично :)")}
function generatePassword(){var b=String.fromCharCode("A".charCodeAt()+Math.floor(26*Math.random()));b+=String.fromCharCode("0".charCodeAt()+Math.floor(10*Math.random()));for(var a=0;4>a;++a)b+=String.fromCharCode("a".charCodeAt()+Math.floor(26*Math.random()));return b}
function sheet_to_array(b){var a=[];if(null==b||null==b["!ref"])return a;var c=XLS.utils.decode_range(b["!ref"]),d=[],e,f;for(f=c.s.c;f<=c.e.c;++f)d[f]=XLS.utils.encode_col(f);for(e=c.s.r;e<=c.e.r;++e){var g=[];var k=XLS.utils.encode_row(e);for(f=c.s.c;f<=c.e.c;++f){var h=b[d[f]+k];h=void 0!==h?""+XLS.utils.format_cell(h):"";g[f]=h}a.push(g)}return a};var g_baseurlApi="https://my.beeline.ru/api/",g_baseurlApiNew="https://api.beeline.ru/",g_apiHeaders={"User-Agent":"MyBeeline/4.72.0-3913",Connection:"Keep-Alive","Client-Type":"MobbApp2","X-AppVersion":"4.72.0","X-AndroidVersion":"26","X-Device":"PHONE","X-Theme":"Light"};
function callAPIProc(b,a,c,d){b=/mw\/auth|mobile\/api/i.test(b)?g_baseurlApiNew+b:g_baseurlApi+b;var e={AUTH_ERROR:" Ошибка авторизации! Проверьте логин-пароль!","for.existent.users.only":"Неправильный логин"};if(a){var f=0>b.indexOf("?")?"?":"&",g;for(g in a)b+=f+encodeURIComponent(g)+"="+encodeURIComponent(a[g]),f="&"}f=0;do if(a=d||c?AnyBalance.requestPost(b,c&&JSON.stringify(c),addHeaders({"Content-Type":c?"application/json; charset=UTF-8":void 0},g_apiHeaders),{HTTP_METHOD:d||"POST"}):AnyBalance.requestGet(b,
g_apiHeaders),/Too Many Requests/i.test(a)||429==AnyBalance.getLastStatusCode())if(5>f)++f,AnyBalance.sleep(1E3);else{AnyBalance.trace("Достигнуто максимальное количество одновременных запросов к серверу");break}else break;while(1);f=getJson(a);f.offerUrl&&(AnyBalance.trace("Требуется принять условия соглашения. Принимаем..."),a=f.offerUrl,g_apiHeaders["X-Offer-Token"]=f.token,a=AnyBalance.requestGet(a,g_apiHeaders),delete g_apiHeaders["X-Offer-Token"],f=getJson(a));if(f.meta&&"OK"!=f.meta.status)throw e=
e[f.meta.message]||f.meta.message||"",c&&c.password&&(c.password="**********"),AnyBalance.trace("Request ("+d+"): "+b+", "+JSON.stringify(c)+"\nResponse: "+a),new AnyBalance.Error("Ошибка вызова API! "+e,null,/парол|логин/i.test(e));return f}function generateUUID(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}
function apiLogin(b){b&&(g_baseurlApi=b+"api/");b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");var a=AnyBalance.getData("myBee"+b.login),c=AnyBalance.getData("adId"+b.login);try{AnyBalance.restoreCookies();g_apiHeaders["X-Auth-Token"]=AnyBalance.getData("authToken"+b.login);g_apiHeaders["X-AdID"]=AnyBalance.getData("adId"+b.login);getApiAssocNumbers();AnyBalance.trace("Сессия сохранена. Входим автоматически...");return}catch(f){AnyBalance.trace("Сессия новая. Будем логиниться заново..."),
clearAllCookies(),delete g_apiHeaders["X-Auth-Token"],delete g_apiHeaders["X-AdID"]}if(!b.password){AnyBalance.trace("Пароль не задан, получаем его по смс");var d=createNewPasswordApi()}a||(a=generateUUID());c||(c=generateUUID());g_apiHeaders["X-AdID"]=c;var e=callAPIProc("mw/auth/1/auth",{client_id:"mybee;"+a+";android_26;4.72.0_3913",login:b.login,password:b.password||d});g_apiHeaders["X-Auth-Token"]=e.token;AnyBalance.setData("authToken"+b.login,e.token);AnyBalance.setData("myBee"+b.login,a);AnyBalance.setData("adId"+
b.login,c);AnyBalance.setCookie(getParam(g_baseurlApi,null,null,/:\/\/([^\/]*)/),"token",e.token);AnyBalance.saveCookies();AnyBalance.saveData();__setLoginSuccessful();return d}function getApiAssocNumbers(){if(getApiAssocNumbers.json)return getApiAssocNumbers.json;var b=AnyBalance.getPreferences();b=callAPIProc("1.0/sso/list",{login:b.login});AnyBalance.trace("Присоединенных номеров: "+b.ssoAccountList.length);return getApiAssocNumbers.json=b}
function getApiSubscribers(b){getApiSubscribers.json||(getApiSubscribers.json={});if(getApiSubscribers.json[b])return getApiSubscribers.json[b];var a=callAPIProc("1.0/sso/subscribers",{login:b});AnyBalance.trace("CTN на логине: "+a.subscribers.length);return getApiSubscribers.json[b]=a}
function switchToAssocNumber(b){for(var a=AnyBalance.getPreferences(),c=getApiAssocNumbers(),d=0;d<c.ssoAccountList.length;++d){var e=c.ssoAccountList[d];a:{var f=e.name;var g=getApiSubscribers(f).subscribers;if(g&&g.length){for(var k=0;k<g.length;++k){var h=g[k];if(b&&endsWith(h.ctn,b)){AnyBalance.trace("В качестве CTN берем "+h.ctn+" по заданным последним цифрам");a.__login=f;g_apiHeaders["X-CTN"]=h.ctn;g_apiHeaders["X-Login"]=f;f=a.phone=h.ctn;break a}if(!b&&h.ctnDefault){AnyBalance.trace("В качестве CTN берем "+
h.ctn+" по умолчанию");a.__login=f;g_apiHeaders["X-CTN"]=h.ctn;g_apiHeaders["X-Login"]=f;f=a.phone=h.ctn;break a}}if(!b){AnyBalance.trace("В качестве CTN берем "+g[0].ctn);a.__login=f;g_apiHeaders["X-CTN"]=g[0].ctn;g_apiHeaders["X-Login"]=f;f=a.phone=g[0].ctn;break a}}f=void 0}if(f)return AnyBalance.trace("Используем присоединенный логин "+e.name+" и номер "+f),f}throw new AnyBalance.Error("Не удалось найти присоединенный номер, оканчивающийся на "+b);}
function processApi(b){var a=AnyBalance.getPreferences();processApi.payType||(processApi.payType={});if(!processApi.payType[a.phone]){var c=callAPIProc("1.0/info/payType",{ctn:a.phone});AnyBalance.trace("Тип кабинета: "+c.payType);processApi.payType[a.phone]=c.payType}getParam({PREPAID:"Предоплатный",POSTPAID:"Постоплатный"}[processApi.payType[a.phone]]||processApi.payType[a.phone],b,"type");processApiInfo(b);"function"==typeof processApiPayments&&processApiPayments(b);processApiServices(b);processApiTariff(b);
processApiStatus(b);"PREPAID"==processApi.payType[a.phone]?processApiPrepaid(b):processApiPostpaid(b)}
function processApiTariff(b){if(AnyBalance.isAvailable("tariff")){var a=AnyBalance.getPreferences(),c=callAPIProc("mobile/api/v1/profile/pricePlanLight");c.data&&c.data.entityName&&getParam(c.data.entityName,b,"tariff");c.data&&c.data.rcRate&&getParam(c.data.rcRate,b,"abon_tariff",null,null,apiParseBalanceRound);if(c.data&&c.data.name&&"up"==c.data.tariffType){var d=c.data.name;try{if(c=callAPIProc("mobile/api/v1/constructors/list?pricePlanSoc="+d+"&isOnlyConnected=true"),c.data&&c.data.additionalConstructorSocs&&
c.data.additionalConstructorSocs.length&&0<c.data.additionalConstructorSocs.length)for(d=0;d<c.data.additionalConstructorSocs.length;d++){var e=c.data.additionalConstructorSocs[d];if("SUPERPOWER"==e.additionalSocGroup&&!0===e.connectedInd){AnyBalance.trace("Успешно получили имя аппера: "+e.entityName);b.tariff+=" - "+e.entityName;break}}}catch(f){AnyBalance.trace("Не удалось получить имя аппера: "+f.message)}}b.tariff||(c=callAPIProc("1.0/info/pricePlan",{ctn:a.phone}),getParam(c.pricePlanInfo.entityName,
b,"tariff"),c.pricePlanInfo.rcRate&&getParam(c.pricePlanInfo.rcRate,b,"abon_tariff",null,null,apiParseBalanceRound))}}function processApiStatus(b){if(AnyBalance.isAvailable("statuslock")){var a=AnyBalance.getPreferences(),c=callAPIProc("mobile/api/v1/profile/userInfo");b.statuslock=c.blocking?"Номер заблокирован":"Номер не блокирован";b.statuslock||(c=callAPIProc("1.0/info/status",{ctn:a.phone}),b.statuslock=c.statusDesc?"Номер заблокирован":"Номер не блокирован")}}
function processApiUnifiedBalance(b){if(AnyBalance.isAvailable("unified_balance")){var a=callAPIProc("mobile/api/v1/ub/balance/unified");a.data&&a.data.data&&getParam(a.data.data.balance,b,"unified_balance",null,null,apiParseBalanceRound)}}function processApiAddonBalance(b){if(AnyBalance.isAvailable("addon_balance")){var a=callAPIProc("mobile/api/v1/profile/sasBalance");a.data&&getParam(a.data.sasBalanceValue,b,"addon_balance",null,null,apiParseBalanceRound)}}
function processApiHoneycomb(b){if(AnyBalance.isAvailable("honeycomb")){var a=callAPIProc("mobile/api/gaming/v1/progress/honeycomb/balance");a.data&&a.data.balance&&getParam(a.data.balance,b,"honeycomb",null,null,apiParseBalanceRound)}}
function processApiInfo(b){if(AnyBalance.isAvailable("info","agreement")){var a=AnyBalance.getPreferences(),c=callAPIProc("1.0/sso/contactData",{login:a.login});b.info||(b.info={});var d=b.info,e=create_aggregate_join(" ");c.lastName&&(getParam(c.lastName,d,"info.name_last"),sumParam(c.lastName,d,"info.fio",null,null,null,e));c.firstName&&c.firstName!=a.login&&(getParam(c.firstName,d,"info.name"),sumParam(c.firstName,d,"info.fio",null,null,null,e));getParam(c.invoiceAddr,d,"info.address");getParam(c.market,
d,"info.region");getParam(a.phone,d,"info.phone",/^\d{10}$/,[/(\d{3})(\d{3})(\d{2})(\d{2})/,"+7 $1 $2-$3-$4"]);getParam(""+c.ban,b,"agreement")}}
function processApiPrepaid(b){var a=AnyBalance.getPreferences(),c=callAPIProc("mobile/api/v1/profile/balance");c.data&&(c.data.balance&&(getParam(c.data.balance.value,b,"balance",null,null,apiParseBalanceRound),getParam(c.data.balance.currency,b,["currency_code","balance"]),getParam(g_currencys[c.data.balance.currency],b,["currency","balance"])),AnyBalance.isAvailable("next_billing_date")&&getParam(c.data.nextBillingDate,b,"next_billing_date",null,null,parseDateISO));b.balance&&b.currency&&!AnyBalance.isAvailable(!b.next_billing_date)||
(c=callAPIProc("1.0/info/prepaidBalance",{ctn:a.phone}),getParam(c.balance,b,"balance",null,null,apiParseBalanceRound),getParam(c.currency,b,["currency_code","balance"]),getParam(g_currencys[c.currency],b,["currency","balance"]),getParam(c.nextBillingDate||c.smartPricePlanParams&&c.smartPricePlanParams.nextBillingDate,b,"next_billing_date",null,null,parseDateISO));try{processApiUnifiedBalance(b)}catch(d){AnyBalance.trace("Не удалось получить общий баланс: "+d.message)}try{processApiAddonBalance(b)}catch(d){AnyBalance.trace("Не удалось получить баланс для доп. услуг: "+
d.message)}try{processApiHoneycomb(b)}catch(d){AnyBalance.trace("Не удалось получить баланс накопленных сот: "+d.message)}try{processApiRemaindersPrepaid(b)}catch(d){AnyBalance.trace("Не удалось получить остатки по пакетам: "+d.message)}try{processApiExpensesPrepaid(b)}catch(d){AnyBalance.trace("Не удалось получить детализацию расходов: "+d.message)}"function"==typeof processApiDetalizationPrepaid&&processApiDetalizationPrepaid(b)}
function processApiRemaindersPrepaid(b){if(AnyBalance.isAvailable("remainders")){var a=b.remainders={},c=AnyBalance.getPreferences();if(AnyBalance.isAvailable("remainders.traffic_rouming")){var d=callAPIProc("1.0/info/accumulators",{ctn:c.phone});if(d.accumulators&&d.accumulators.length&&0<d.accumulators.length)for(var e=0;e<d.accumulators.length;e++){var f=d.accumulators[e];"KBYTE"==f.unit&&/ROAMGPRS/i.test(f.soc)&&sumParam(f.rest+" "+f.unit,a,"remainders.traffic_rouming",null,replaceTagsAndSpaces,
parseTraffic,aggregate_sum)}b.remainders.traffic_rouming||AnyBalance.trace("Не удалось получить трафик в роуминге")}d=callAPIProc("mobile/api/v2/profile/accumulators");if(d.data&&d.data.list&&d.data.list.length&&0<d.data.list.length)for(e=0;e<d.data.list.length;e++)f=d.data.list[e],"SECONDS"==f.unit?/на междугородные номера|на междугородные звонки/i.test(f.description)?sumParam(f.rest+" "+f.unit,a,"remainders.min_left_2",null,replaceTagsAndSpaces,parseMinutes,aggregate_sum):isLocalMin(f.description)?
sumParam(f.rest+" "+f.unit,a,"remainders.min_local",null,replaceTagsAndSpaces,parseMinutes,aggregate_sum):sumParam(f.rest+" "+f.unit,a,"remainders.min_bi",null,replaceTagsAndSpaces,parseMinutes,aggregate_sum):"SMS"==f.unit?sumParam(f.rest+" "+f.unit,a,"remainders.sms_left",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):"MMS"==f.unit?sumParam(f.rest+" "+f.unit,a,"remainders.mms_left",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):"KBYTE"==f.unit?/ROAMGPRS/i.test(f.soc)&&!b.remainders.traffic_rouming?
sumParam(f.rest+" "+f.unit,a,"remainders.traffic_rouming",null,replaceTagsAndSpaces,parseTraffic,aggregate_sum):(sumParam(f.rest+" "+f.unit,a,["remainders.traffic_left","remainders.traffic_used"],null,replaceTagsAndSpaces,parseTraffic,aggregate_sum),sumParam(f.size+" "+f.unit,a,["remainders.traffic_total","remainders.traffic_used"],null,replaceTagsAndSpaces,parseTraffic,aggregate_sum),isset(a.traffic_total)&&isset(a.traffic_left)&&sumParam(Math.round(a.traffic_total-a.traffic_left,2),a,"remainders.traffic_used",
null,null,null,aggregate_sum)):AnyBalance.trace("Неизвестные единицы: "+JSON.stringify(f));else AnyBalance.trace("Не удалось получить остатки по пакетам");d=callAPIProc("1.0/info/prepaidAddBalance",{ctn:c.phone});for(var g in d)if(isArray(d[g]))for(b=0;b<d[g].length;b++)f=d[g][b],/shadow|name\.(?:seconds|internet|mms|sms)/i.test(f.name)?AnyBalance.trace("Пересекающийся пакет "+f.name+": "+f.value+" "+f.unit+". Пропускаем..."):/bonusopros/i.test(f.name)?sumParam(f.value+"",a,"remainders.rub_opros",
null,replaceTagsAndSpaces,apiParseBalanceRound,aggregate_sum):/bonusmoney/i.test(f.name)?sumParam(f.value+"",a,"remainders.rub_bonus",null,replaceTagsAndSpaces,apiParseBalanceRound,aggregate_sum):/bonusbalance17/i.test(f.name)?(getParam(f.value+"",a,"remainders.rub_bonus2",null,replaceTagsAndSpaces,apiParseBalanceRound),getParam(f.dueDate,a,"remainders.rub_bonus2_till",null,replaceTagsAndSpaces,parseDateISO)):/bonusseconds/i.test(f.name)?sumParam(f.value+"",a,"remainders.min_left_1",null,replaceTagsAndSpaces,
apiParseBalanceRound,aggregate_sum):/9seconds/i.test(f.name)?sumParam(f.value+"",a,"remainders.min_left_3",null,replaceTagsAndSpaces,apiParseBalanceRound,aggregate_sum):AnyBalance.trace("Неизвестная опция "+f.name+": "+JSON.stringify(f));AnyBalance.trace(JSON.stringify(a))}}
function getPostpaidBalanceApi(b){getPostpaidBalanceApi.json||(getPostpaidBalanceApi.json={});if(getPostpaidBalanceApi.json[b])return getPostpaidBalanceApi.json[b];AnyBalance.getPreferences();json=callAPIProc("1.0/info/postpaidBalance",{ctn:b});return getPostpaidBalanceApi.json[b]=json}
function processApiPostpaid(b){var a=AnyBalance.getPreferences();isAvailable(["balance","currency","currency_code"])&&(json=getPostpaidBalanceApi(a.phone),getParam(json.balance+"",b,"balance",null,replaceTagsAndSpaces,apiParseBalanceRound),getParam(json.currency,b,["currency_code","balance"],null,replaceTagsAndSpaces),getParam(g_currencys[json.currency],b,["currency","balance"],null,replaceTagsAndSpaces));if(AnyBalance.isAvailable("prebal")){for(var c=getApiSubscribers(a.__login).subscribers,d=0,
e=0;c&&e<c.length;++e)d+=getPostpaidBalanceApi(c[e].ctn).balance;getParam(d,b,"prebal")}if(isAvailable("overpay"))try{json=callAPIProc("1.0/info/postpaidDebt",{ctn:a.phone}),getParam(json.balance+"",b,"overpay",null,replaceTagsAndSpaces,function(f){return-1*(apiParseBalanceRound(f)||0)})}catch(f){AnyBalance.trace("Не удалось получить переплату: "+f.message)}try{processApiUnifiedBalance(b)}catch(f){AnyBalance.trace("Не удалось получить общий баланс: "+f.message)}try{processApiAddonBalance(b)}catch(f){AnyBalance.trace("Не удалось получить баланс для доп. услуг: "+
f.message)}try{processApiHoneycomb(b)}catch(f){AnyBalance.trace("Не удалось получить баланс накопленных сот: "+f.message)}try{processApiRemaindersPostpaid(b)}catch(f){AnyBalance.trace("Не удалось получить остатки по пакетам: "+f.message)}try{processApiExpensesPostpaid(b)}catch(f){AnyBalance.trace("Не удалось получить детализацию расходов: "+f.message)}}
function isLocalMin(b){return/Минут(?:\D+)? общения|номера других|на других|на все номера|др(?:угих|\.) операторов|всех|любых|местные.*вызовы|любые местные|кроме номеров .?Билайн.?/i.test(b)}
function processApiRemaindersPostpaid(b){if(AnyBalance.isAvailable("remainders")){b=b.remainders={};var a=AnyBalance.getPreferences();a=callAPIProc("1.0/info/rests",{ctn:a.phone});for(var c=0;c<a.rests.length;c++){var d=a.rests[c];"VOICE"==d.unitType?isLocalMin(d.restName||d.accName)?sumParam(d.currValue+" ",b,"remainders.min_local",null,replaceTagsAndSpaces,parseMinutes,aggregate_sum):sumParam(d.currValue+" ",b,"remainders.min_bi",null,replaceTagsAndSpaces,parseMinutes,aggregate_sum):"SMS_MMS"==
d.unitType?sumParam(d.currValue+" "+d.unit,b,"remainders.sms_left",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):"MMS"==d.unitType?sumParam(d.currValue+" "+d.unit,b,"remainders.mms_left",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):"INTERNET"==d.unitType?(sumParam(d.currValue+" mb",b,["remainders.traffic_left","remainders.traffic_used"],null,replaceTagsAndSpaces,parseTraffic,aggregate_sum),sumParam(d.initialSize+" mb",b,["remainders.traffic_total","remainders.traffic_used"],null,
replaceTagsAndSpaces,parseTraffic,aggregate_sum),isset(b.traffic_total)&&isset(b.traffic_left)&&sumParam(b.traffic_total-b.traffic_left,b,"remainders.traffic_used",null,null,null,aggregate_sum)):AnyBalance.trace("Неизвестные единицы: "+JSON.stringify(d))}AnyBalance.trace(JSON.stringify(b))}}function apiParseBalanceRound(b){b=parseBalance(b+"");return isset(b)?Math.round(100*b)/100:null}
function processApiServices(b){if(AnyBalance.isAvailable("services_paid","services_free","services_count","services_abon","services_abon_day")){var a=AnyBalance.getPreferences();a=callAPIProc("1.0/info/serviceList",{ctn:a.phone});getParam(0,b,"services_paid");getParam(0,b,"services_free");getParam(0,b,"services_count");getParam(0,b,"services_abon");getParam(0,b,"services_abon_day");for(var c=0;c<a.services.length;++c){var d=a.services[c];"N"!=d.viewInd&&(sumParam(1,b,"services_count",null,null,null,
aggregate_sum),d.rcRate||!/Пакет|автопродление|Переадресация/i.test(d.entityName)&&!/\d+[.,\d+]*? (?:руб|₽)/i.test(d.entityDesk)?d.rcRate?(AnyBalance.trace("Платная услуга "+d.entityName+": "+d.rcRate+" ₽"+(d.rcRatePeriodText?" "+d.rcRatePeriodText:"")),/сутки/i.test(d.rcRatePeriodText)?sumParam(d.rcRate,b,"services_abon_day",null,null,null,aggregate_sum):sumParam(d.rcRate,b,"services_abon",null,null,null,aggregate_sum),sumParam(1,b,"services_paid",null,null,null,aggregate_sum)):(AnyBalance.trace("Бесплатная услуга "+
d.entityName),sumParam(1,b,"services_free",null,null,null,aggregate_sum)):(AnyBalance.trace("Платная услуга "+d.entityName+": "+d.rcRate+" ₽"+(d.rcRatePeriodText?" "+d.rcRatePeriodText:"")),sumParam(1,b,"services_paid",null,null,null,aggregate_sum)))}}}
function processApiExpensesPrepaid(b){if(AnyBalance.isAvailable(["month_refill","debet","traffic_used_4g","traffic_used_total"])){AnyBalance.getPreferences();var a=new Date,c=a.getFullYear()+"-"+n2(a.getMonth()+1)+"-",d=c+"01";a=c+n2(a.getDate());d=callAPIProc("mobile/api/v1/billing/details",{startDate:d,endDate:a,combinedSessions:!0});AnyBalance.isAvailable("month_refill","debet")&&(a=d.data.balanceAndBonuses.filter(function(e){return e.title&&/Личный баланс/i.test(e.title)}),0<a.length&&(getParam(aggregate_max([0,
a[0].addedBonuses.value,AnyBalance.getData("addedBonuses"+c)]),b,"month_refill",null,null,apiParseBalanceRound),AnyBalance.setData("addedBonuses"+c,b.month_refill),getParam(aggregate_max([0,a[0].spentBonuses.value,AnyBalance.getData("spentBonuses"+c)]),b,"debet",null,null,apiParseBalanceRound),AnyBalance.setData("spentBonuses"+c,b.debet),AnyBalance.saveData()),b.month_refill||(b.month_refill=0),b.debet||(b.debet=0));AnyBalance.isAvailable("traffic_used_4g","traffic_used_total")&&(c=d.data.transactions.filter(function(e){return e.expence&&
e.expence.type&&"mobileInternet"==e.expence.type&&e.expence&&e.expence.operation&&/Безлимит в 4G/i.test(e.expence.operation)}),d=d.data.transactions.filter(function(e){return e.expence&&e.expence.type&&"mobileInternet"==e.expence.type||e.expence&&e.expence.operation&&/интернет/i.test(e.expence.operation)}),0<c.length&&c.forEach(function(e){sumParam(e.expence.volume+" "+e.expence.unit,b,"traffic_used_4g",null,replaceTagsAndSpaces,parseTraffic,aggregate_sum)}),0<d.length&&d.forEach(function(e){sumParam(e.expence.volume+
" "+e.expence.unit,b,"traffic_used_total",null,replaceTagsAndSpaces,parseTraffic,aggregate_sum)}),b.traffic_used_4g||(b.traffic_used_4g=0),b.traffic_used_total||(b.traffic_used_total=0))}}
function processApiExpensesPostpaid(b){if(AnyBalance.isAvailable("month_refill","debet")){var a=AnyBalance.getPreferences(),c=new Date,d=c.getFullYear()+"-"+n2(c.getMonth()+1)+"-";n2(c.getDate());a=callAPIProc("mobile/api/v1/billing/details",{startDate:"",endDate:"",ctnFor:a.phone,combinedSessions:!0}).data.balanceAndBonuses.filter(function(e){return e.title&&/Личный баланс/i.test(e.title)});0<a.length&&(getParam(aggregate_max([0,a[0].addedBonuses.value,AnyBalance.getData("addedBonuses"+d)]),b,"month_refill",
null,null,apiParseBalanceRound),AnyBalance.setData("addedBonuses"+d,b.month_refill),getParam(aggregate_max([0,a[0].spentBonuses.value,AnyBalance.getData("spentBonuses"+d)]),b,"debet",null,null,apiParseBalanceRound),AnyBalance.setData("spentBonuses"+d,b.debet),AnyBalance.saveData());b.month_refill||(b.month_refill=0);b.debet||(b.debet=0)}}
function createNewPasswordApi(){var b=AnyBalance.getPreferences();checkEmpty(b.login,"Введите 10 цифр вашего номера телефона в формате 9031234567");checkEmpty(!b.password||6<=b.password.length,"Введите не менее 6 символов желаемого пароля. Или оставьте поле пустым, чтобы автоматически сгенерировать пароль.");var a=callAPIProc("1.0/passReset",{login:b.login,channelType:"CTN"}),c=a=AnyBalance.retrieveCode("Пожалуйста, введите временный пароль, который направлен вам по "+a.channel,null,{inputType:"number"});
a=callAPIProc("2.0/auth/auth",{userType:"Mobile",login:b.login},{password:a},"PUT");AnyBalance.setCookie(getParam(g_baseurlApi,null,null,/:\/\/([^\/]*)/),"token",a.token);a.tempPassInd&&(c=b.password||generatePassword(),callAPIProc("1.0/setting/changePassword",{login:b.login,newPassword:c},"","PUT"));createNewPasswordApi.password=c;b.password=c;AnyBalance.trace("Generated new password: "+c);return c}
function processPaymentsPost(b,a,c){var d=getElements(a,[/<a[^>]*payments_form[^>]*>/ig,/Выгрузить в Excel/i])[0];d=getParam(d,null,null,/mojarra.jsfcljs[^"]*'([^']*:payments_form:[^'\\]*)/i);var e=getParam(d,null,null,/.*payments_form/i);if(e=getElement(a,new RegExp('<form[^>]+name="'+e+'"[^>]*>',"i"))){var f=new Date,g=new Date(f.getFullYear(),f.getMonth(),f.getDate()-90);a=createFormParams(e,function(h,l,m,n){return/DateFrom/.test(m)?fmtDate(g).replace(/\d\d(\d\d)/,"$1"):/DateTo/.test(m)?fmtDate(f).replace(/\d\d(\d\d)/,
"$1"):n});a[d]=d;b=AnyBalance.requestPost(b+"c/post/fininfo/index.xhtml",a,addHeaders({Referer:b}),{options:{FORCE_CHARSET:"base64"}});b=XLS.read(b,{type:"base64"});b=sheet_to_array(b.Sheets[b.SheetNames[0]]);AnyBalance.trace("Найдено "+b.length+" строк платежей");c=c.payments=[];a={date:{re:/Дата/i,result_func:parseDate},type:{re:/Тип/i,result_func:null},sum:{re:/Сумма/i}};d=initCols(a,b[0]);for(e=1;e<b.length;e++){var k={};fillColsResult(a,d,b[e],k,"payments.");c.push(k)}}else AnyBalance.trace(a),
AnyBalance.trace("Не найдена форма получения платежей, сайт изменен?")}
function processDetailsAndPaymentsPre(b,a,c){var d=new Date,e=new Date(d.getFullYear(),d.getMonth()-1,d.getDate());d=d.getFullYear()+"-"+n2(d.getMonth()+1)+"-"+n2(d.getDate());e=e.getFullYear()+"-"+n2(e.getMonth()+1)+"-"+n2(e.getDate());a=replaceAll(a,[/\+\s*7/,"",/\D/g,""]);AnyBalance.isAvailable("payments")&&processPaymentsPre(b,a,e,d,c);AnyBalance.isAvailable("detalization","info.date_start")&&processDetalizationPre(b,a,e,d,c)}
function processPaymentsPre(b,a,c,d,e){b=callSiteApi(b,"info/payments/history?ctn="+a+"&periodStart="+c+"&periodEnd="+d);processApiPayments0(b,e)}function processApiPayments(b){if(AnyBalance.isAvailable("payments"))try{var a=AnyBalance.getPreferences(),c=callAPIProc("1.0/info/payments/history",{ctn:a.phone});processApiPayments0(c,b)}catch(d){AnyBalance.trace("Не удалось получить историю платежей: "+d.message)}}
function processApiPayments0(b,a){a.payments=[];AnyBalance.trace("Найдено платежей: "+b.paymentsHistory.length);for(var c=0;c<b.paymentsHistory.length;++c){var d=b.paymentsHistory[c],e={};getParam(d.dateStart,e,"payments.date",null,null,parseDateISO);getParam(d.value,e,"payments.sum",null,null,parseBalance);getParam(d.paymentType,e,"payments.type_code");getParam(d.paymentStatus,e,"payments.status_code");getParam(d.payTypeName,e,"payments.type");!d.payPoint||d.payPoint&&/Проверить баланс в приложении/i.test(d.payPoint)?
getParam(d.payTypeName,e,"payments.place"):getParam(d.payPoint,e,"payments.place");a.payments.push(e)}};
