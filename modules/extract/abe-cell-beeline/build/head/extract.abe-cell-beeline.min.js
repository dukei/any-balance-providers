var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.64 Safari/537.31"},g_currencys={"руб":"р",RUR:"р","тенге":"₸",undefined:""};
function getBlock(c,a,b){c=getBlockInner(c,a,b);if("string"==typeof c){a=b.replace(/^\^/,"");var e=a!=b;/bonusesForm/i.test(b)&&(a=getParam(a,null,null,/([^\s]+)/i));return extractFromUpdate(c,a,e)}return c}
function getBlockInner(c,a,b){var e=b.replace(/^\^/,""),d=e!=b,f=a;isArray(a)&&(f=a[1],a=a[0]);a=getParam(a,null,null,new RegExp("PrimeFaces\\.\\w+\\s*\\(\\s*\\{[^}]*u:\\s*'"+(d?"":"[^']*")+e));if(!a)return AnyBalance.trace("Блок "+b+" не найден!"),"";e=getParam(a,null,null,/f:\s*'([^']*)/,replaceSlashes);if(!e)return AnyBalance.trace("Не найден ID формы для блока "+b+"!"),"";f=getParam(f,null,null,new RegExp('<form[^>]+name="'+e+'"[\\s\\S]*?</form>',"i"));if(!f)return AnyBalance.trace("Не найдена форма "+
e+" для блока "+b+"!"),"";b=createFormParams(f);f=getParam(a,null,null,/s:\s*'([^']*)/,replaceSlashes);a=getParam(a,null,null,/u:\s*'([^']*)/,replaceSlashes);b["javax.faces.partial.ajax"]=!0;b["javax.faces.source"]=f;b["javax.faces.partial.execute"]="@all";b["javax.faces.partial.render"]=a;b[f]=f;return c?a=AnyBalance.requestPost(c,b,addHeaders({Referer:c,"Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"})):b}
function extractFromUpdate(c,a,b){b=getParam(c,null,null,new RegExp('<update[^>]*id="'+(b?"":'[^"]*')+a+'"[^>]*>\\s*<!\\[CDATA\\[([\\s\\S]*?)\\]\\]></update>',"i"));return b?b:(AnyBalance.trace("Неверный ответ для блока "+a+": "+c),"")}
function refreshBalance(c,a,b){var e=getParam(a,null,null,/PrimeFaces\.\w+\s*[^}]*(?:header|home)Balance/i);if(!e)return AnyBalance.trace("Блок headerBalance не найден!"),"";var d=getParam(a,null,null,/<form[^>]*action="(?:[^>]*>){3}\s*loadingBalance[\s\S]*?<\/form>/i);if(!d)return AnyBalance.trace("Не найдена форма для блока (?:header|home)Balance!"),"";b=getParam(d,null,null,/s:\s*["']([^"']+)/i,replaceSlashes);e=getParam(e,null,null,/(?:u|block):\s*["']([^"']+)/i,replaceSlashes);a=getParam(a,null,
null,/<input[^>]+name="javax.faces.ViewState"[^>]*value="([^"]+)/i,replaceHtmlEntities);d=createFormParams(d);d["javax.faces.partial.ajax"]=!0;d["javax.faces.source"]=b;d["javax.faces.partial.execute"]="@all";d["javax.faces.partial.render"]=e;d[b]=b;d["javax.faces.ViewState"]=a;a=AnyBalance.requestPost(c,d,addHeaders({Referer:c,"Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"}));return extractFromUpdate(a,e,!0)}
function getBonusesBlock(c,a,b,e,d){var f=a;isArray(a)&&(f=a[1],a=a[0]);var g=new RegExp("(?:loadingbonusesloaderDetails|loadingAccumulators)\\s*=\\s*function\\(\\) \\{PrimeFaces\\.\\w+\\s*\\(\\s*\\{[^}]*u:\\s*'"+(e?"":"[^']*")+b),g=getParam(a,null,null,g);if(!g)return AnyBalance.trace("Блок "+b+" не найден!"),"";a=getParam(g,null,null,/f:\s*'([^']*)/,replaceSlashes);if(!a)return AnyBalance.trace("Не найден ID формы для блока "+b+"!"),"";f=getParam(f,null,null,new RegExp('<form[^>]+name="'+a+'"[\\s\\S]*?</form>',
"i"));if(!f)return AnyBalance.trace("Не найдена форма "+a+" для блока "+b+"!"),"";f=createFormParams(f);a=getParam(g,null,null,/s:\s*'([^']*)/,replaceSlashes);g=getParam(g,null,null,/u:\s*'([^']*)/,replaceSlashes);f["javax.faces.partial.ajax"]=!0;f["javax.faces.source"]=a;f["javax.faces.partial.execute"]="@all";f["javax.faces.partial.render"]=g;f[a]=a;if(d)return f;a=AnyBalance.requestPost(c,f,addHeaders({Referer:c,"Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"}));/bonusesForm/i.test(b)&&
(b=getParam(b,null,null,/([^\s]+)/i));g=new RegExp('<update[^>]*id="'+(e?"":'[^"]*')+b+'"[^>]*>\\s*<!\\[CDATA\\[([\\s\\S]*?)\\]\\]></update>',"i");g=getParam(a,null,null,g);return g?g:(AnyBalance.trace("Неверный ответ для блока "+b+": "+a),"")}function myParseCurrency(c){var a=c.replace(/\s+/g,"").replace(/[\-\d\.,]+/g,""),a=g_currencys[a]||a;AnyBalance.trace("Parsing currency ("+a+") from: "+c);return a}
function checkCorrectNumberLogin(c,a){var b=AnyBalance.getPreferences(),e=getParam(a,null,null,[/"sso-number"[^>]*>([^<]*)/i,/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i],[/\D/g,""]);if(!e)throw new AnyBalance.Error("Не удалось выяснить на какой номер мы залогинились, сайт изменен?");AnyBalance.trace("Судя по всему, мы уже залогинены на номер "+e);b=b.phone||b.login;if(!endsWith(e,b))return AnyBalance.trace("Залогинены на неправильный номер "+e+" т.к. в настройках указано, что номер должен заканчиваться на "+
b+". Надо перелогиниться."),AnyBalance.requestGet(c+"c/logout.xhtml",addHeaders({Referer:AnyBalance.getLastUrl()})),AnyBalance.requestGet(c+"oam_logout_success",g_headers),!1;AnyBalance.trace("Залогинены на правильный номер "+e);return!0}
function loginProc(c,a,b){var e,d=AnyBalance.getPreferences();try{e=AnyBalance.requestPost(c+(a||"login.xhtml"),b,addHeaders({Referer:c+"login.xhtml"}))}catch(f){if(d.__debug)e="b2b"==d.__debug?AnyBalance.requestGet(c+"b/index.xhtml"):AnyBalance.requestGet(c+"c/"+d.__debug+"/index.html");else throw f;}return e}function isMultinumbersCabinet(c){return 1<sumParam(c,null,null,/selectAccount\('\d+'\);/ig).length}
function canUseMobileApp(c){return(!c.phone||c.phone==c.login)&&/^\d{10}$/.test(c.login)}function login(c){AnyBalance.setDefaultCharset("utf-8");return AnyBalance.getPreferences().password?loginWithPassword(c):loginWithoutPassword(c)}function isLoggedIn(c){return/logOutLink|Загрузка баланса\.\.\.|b\/logout.xhtml/i.test(c)}
function getLKType(c){if(/b\/logout.xhtml/i.test(c))return __setLoginSuccessful(),{type:"B2B",html:c};if(!isLoggedIn(c)){var a=getParam(c,null,null,[/<div[^>]+class="error-page[\s|"][^>]*>([\s\S]*?)<\/div>/i,/<span[^>]+class="ui-messages-error-summary"[^>]*>([\s\S]*?)<\/span>/i],replaceTagsAndSpaces);if(a)throw new AnyBalance.Error(a,null,/Неправильные логин и\s*(?:\(или\)\s*)?пароль|Пользователь не найден/i.test(a));if(400<AnyBalance.getLastStatusCode())throw AnyBalance.trace("Beeline returned: "+
AnyBalance.getLastStatusString()),new AnyBalance.Error("Личный кабинет Билайн временно не работает. Пожалуйста, попробуйте позднее.");if(a=getParam(c,null,null,/<h1>\s*(Личный кабинет временно недоступен\s*<\/h1>[\s\S]*?)<\//i,replaceTagsAndSpaces))throw new AnyBalance.Error(a);AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");}__setLoginSuccessful();return/postpaid/i.test(c)?{type:"POSTPAID",html:c}:{type:"PREPAID",html:c}}
function doLogin(c,a,b){var e=AnyBalance.requestGet(c,g_headers),d=getParam(e,null,null,/<form[^>]+name="loginFormB2C:loginForm"[^>]*>[\s\S]*?<\/form>/i);isLoggedIn(e)&&(AnyBalance.trace("Похоже, что мы запустились через мобильный интернет."),checkCorrectNumberLogin(c,e)||(e=AnyBalance.requestGet(c+"login.xhtml",g_headers),d=getParam(e,null,null,/<form[^>]+name="loginFormB2C:loginForm"[^>]*>[\s\S]*?<\/form>/i)));if(d){AnyBalance.trace("Похоже, что форма авторизации присутствует.");var f=createFormParams(d);
f["loginFormB2C:loginForm:login"]=a;f["loginFormB2C:loginForm:password"]=b;f["loginFormB2C:loginForm:passwordVisible"]=b;f["loginFormB2C:loginForm:loginButton"]="";a=getParam(d,null,null,/<form[^>]+action="\/([^"]*)/i,replaceHtmlEntities);for(b=1;6>b;b++)if(e=loginProc(c,a,f),/Вход в личный кабинет/i.test(e)&&!/<span[^>]+class="ui-messages-error-summary"/i.test(e))AnyBalance.trace("Войти не удалось, сайт не сообщает ни о каких ошибках, попытка №"+b);else{AnyBalance.trace("Выполнили "+b+" попыток входа..");
break}}else if(!isLoggedIn(e)){AnyBalance.trace("Похоже, форма авторизации отсутствует.");if(400<AnyBalance.getLastStatusCode())throw AnyBalance.trace("Beeline returned: "+AnyBalance.getLastStatusString()),new AnyBalance.Error("Личный кабинет Билайн временно не работает. Пожалуйста, попробуйте позднее.");AnyBalance.trace(e);throw new AnyBalance.Error("Не удаётся найти форму входа. Сайт изменен?");}return e}
function loginWithPassword(c){var a=AnyBalance.getPreferences();checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");a=doLogin(c,a.login,a.password);/Ваш пароль временный\.\s*Необходимо изменить его на постоянный/i.test(a)&&(AnyBalance.trace("Билайн считает наш пароль временным, но это может быть и не так, попробуем еще раз войти..."),a=AnyBalance.requestPost(c+(action||"login.html"),params,addHeaders({Referer:c+"login.html"})));if(/<form[^>]+name="(?:chPassForm)"|Ваш пароль временный\.\s*Необходимо изменить его на постоянный/i.test(a))throw new AnyBalance.Error("Вы зашли по временному паролю, требуется сменить пароль. Для этого войдите в ваш кабинет "+
c+" через браузер и смените там пароль. Новый пароль введите в настройки данного провайдера.",null,!0);if(/<form[^>]+action="\/(?:changePass|changePassB2C).html"/i.test(a))throw new AnyBalance.Error("Билайн требует сменить пароль. Зайдите в кабинет "+c+" через браузер и поменяйте пароль на постоянный.",null,!0);return getLKType(a)}
function proceedWithSite(c,a,b,e){getParam(a,e,"type");switch(a){case "B2B":fetchB2B(c,b,e);break;case "PREPAID":fetchPre(c,b,e);break;case "POSTPAID":fetchPost(c,b,e);break;default:throw new AnyBalance.Error("Неизвестный тип кабинета: "+a);}}function parseBalanceNegative(c){c=parseBalance(c);if(isset(c))return-c}
function fetchB2B(c,a,b){var e=AnyBalance.getPreferences();AnyBalance.trace("Мы в кабинете для юр. лиц...");getParam(a,b,"fio",/"user-name"([^>]*>){2}/i,replaceTagsAndSpaces,capitalFirstLetters);if(AnyBalance.isAvailable("balance","agreement","currency","overpay")){var d=sumParam(a,null,null,/b\/info\/contractDetail\.xhtml\?objId=\d+[^>]*>\d{5,10}/ig);if(!d||1>d.length)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти ни одного договора, сайт изменен, либо проблемы на сайте.");AnyBalance.trace("Договоров: "+
d.length);d=d[0];a=getParam(d,null,null,/>(\d+)/);getParam(d,null,null,/b\/info\/contractDetail\.xhtml\?objId=(\d+)/i);d=getParam(d,null,null,/b\/info\/contractDetail\.xhtml\?objId=\d+/i);AnyBalance.trace("Получим информацию по договору: "+a);a=AnyBalance.requestGet(c+d,g_headers);getParam(a,b,"agreement",/Договор №([\s\d]+)/i,replaceTagsAndSpaces);getParam(a,b,"balance",/class="balance"[^>]*>([\s\S]*?)<\/div>/i,[replaceTagsAndSpaces,/Сумма неоплаченных счетов[^\d]+/i,"-"],parseBalance);getParam(a,
b,"overpay",/class="[^>]*balance"[^>]*>([\s\S]*?)<\/div>/i,[replaceTagsAndSpaces,/Сумма неоплаченных счетов[^\d]+/i,"-"],parseBalance);getParam(a,b,["currency","balance"],/class="balance"[^>]*>([\s\S]*?)<\/div>/i,[replaceTagsAndSpaces,/все счета оплачены/,"",/[.,]/g,""],myParseCurrency)}a=AnyBalance.requestGet(c+"b/info/abonents/catalog.xhtml",g_headers);d=e.phone||"\\d{4}";if(e.phone){var f=getParam(a,null,null,/<form[^>]*id="mobileDataForm"[\s\S]*?<\/form>/i);checkEmpty(f,"Не удалось найти форму поиска номера, сайт изменен?",
!0);a=getBlock(null,a,"^mobileDataForm");a["mobileDataForm:abonents:telephoneNum"]=e.phone;a["javax.faces.partial.execute"]="mobileDataForm";a=AnyBalance.requestPost(c+"b/info/abonents/catalog.xhtml",a,addHeaders({Referer:c+"b/info/abonents/catalog.xhtml","Faces-Request":"partial/ajax","X-Requested-With":"XMLHttpRequest"}));(data=getParam(a,null,null,/<update[^>]*id="mobileDataForm"[^>]*>\s*<!\[CDATA\[([\s\S]*?)\]\]><\/update>/i))?a=data:(AnyBalance.trace("Неверный ответ для блока mobileDataForm: "+
a),a="")}a=getParam(a,null,null,new RegExp("(b/info/subscriberDetail\\.xhtml\\?objId=\\d+)(?:[^>]*>){4}\\d{4,6}"+d,"i"));checkEmpty(a,"Не удалось найти "+(e.phone?"номер с последними цифрами "+e.phone:"ни одного номера!"),!0);a=AnyBalance.requestGet(c+a,g_headers);getParam(a,b,"phone",/subheader\s*"([^>]*>){3}/i,replaceTagsAndSpaces);getParam(a,b,"__tariff",/Тариф:([^>]*>){5}/i,replaceTagsAndSpaces);isAvailable("balance")&&getParam(a,null,null,/<form id="reportDetailUnbilledButtonsForm"[\s\S]*?<\/form>/i);
c=sumParam(a,null,null,/class="accumulator"[^>]*>([\s\S]*?)<\/div/ig);AnyBalance.trace("Найдено бонусов и пакетов: "+c.length);for(e=0;e<c.length;e++){var d=c[e],f=getParam(d,null,null,/([^<]*)</i),g=getParam(d,null,null,/израсходовано[^>]*>([\s\d.,]+мин)/i,replaceTagsAndSpaces,parseMinutes),h=getParam(d,null,null,/из доступных[^>]*>([\s\d.,]+мин)/i,replaceTagsAndSpaces,parseMinutes),k=getParam(d,null,null,/израсходовано[^>]*>([\s\d.,]+штук)/i,replaceTagsAndSpaces,parseBalance),l=getParam(d,null,
null,/из доступных[^>]*>([\s\d.,]+штук)/i,replaceTagsAndSpaces,parseBalance);/Ноль на Билайн/i.test(f)&&isset(g)&&isset(h)?sumParam(h-g,b,"min_bi",null,null,null,aggregate_sum):isset(g)&&isset(h)?isset(b.min_left_1)||isset(b.min_left_2)?isset(b.min_left_1)&&!isset(b.min_left_2)?sumParam(h-g,b,"min_left_2",null,null,null,aggregate_sum):sumParam(h-g,b,"min_local",null,null,null,aggregate_sum):sumParam(h-g,b,"min_left_1",null,null,null,aggregate_sum):isset(k)&&isset(l)?sumParam(l-k,b,"sms_left",null,
null,null,aggregate_sum):AnyBalance.trace("Неизвестная опция, либо неизвестные единицы измерений: "+d)}0==c.length&&getBonuses(a,b)}function processInfo_basic(c,a,b){getParam(a,b.info,"info.more3",/Вы с нами больше трёх лет!/i,null,function(a){return!!a});getParam(a,b.info,"info.phone",/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces);getParam(a,b.info,"info.region",/<div[^>]+region[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}
function processInfoPost_basic(c,a,b){if(AnyBalance.isAvailable("info.fio","info.email","info.phone")){b.info||(b.info={});getParam(a,b.info,"info.fio",/<div[^>]+class="ban-param name"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("info.email")){var e=a;/<div[^>]+class="email-fixed-width"[^>]*>/i.test(a)||(e=getBlock(c+"c/post/index.xhtml",a,"benAddressLoaderDetails"));getParam(e,b.info,"info.email",/<div[^>]+class="email-fixed-width"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}processInfo_basic(c,
a,b)}}
function switchNumberPost(c,a){var b=AnyBalance.getPreferences();if(!/^\d{4,10}$/.test(b.phone))throw new AnyBalance.Error("Введите от 4 до 10 последних цифр номера дополнительного телефона без пробелов и разделителей или не вводите ничего, чтобы получить информацию по первому номеру!",null,!0);var e=1,d=b.phone.replace(/(\d)/g,"$1[\\s\\-()]*"),d=new RegExp("(?:<a[^>]*>\\s*)?<span[^>]*>\\+7[0-9\\s\\-()]*"+d+"</span>","i"),d=getParam(a,null,null,d);if(!isset(d)&&(e=2,d=new RegExp('div[^>]*(?:>)[^>]*onclick="\\s*selectAccount\\([\'\\"]\\d*'+b.phone+
"['\\\"][^>]*","i"),d=getParam(a,null,null,d),!d))throw new AnyBalance.Error("Не найден присоединенный к договору номер телефона, оканчивающийся на "+b.phone);b=getParam(d,null,null,/selectAccount\('([^']*)/,replaceSlashes);isset(b)||(b=getParam(d,null,null,null,replaceTagsAndSpaces));checkEmpty(b,"Не удалось найти номер на который необходимо переключиться, сайт изменен?",!0);if(/sso-account-current|class="selected"/i.test(d))AnyBalance.trace("Дополнительный номер "+b+" уже выбран");else{AnyBalance.trace("Переключаемся на номер "+
b);if(1==e)var f=getParam(d,null,null,/addSubmitParam\('([^']*)/,replaceSlashes),g=getParam(d,null,null,/addSubmitParam\('[^']*',(\{.*?\})\)/,null,getJsonEval);else var f=getParam(a,null,null,/changeUser\s*=[^<]*?(?:f|formId):["']([^"']+)/i,replaceSlashes),h=getParam(a,null,null,/changeUser\s*=[^<]*?(?:s|source):["']([^"']+)/i,replaceSlashes);f=getParam(a,null,null,new RegExp('<form[^>]+id="'+f+'"[^>]*>([\\s\\S]*?)</form>',"i"));if(!f)throw AnyBalance.trace(d),new AnyBalance.Error("Дополнительный номер "+
b+" найден, но переключиться на него не удалось. Возможны изменения в личном кабинете...");1==e?(e=createFormParams(f),g=joinObjects(e,g)):(e=createFormParams(f),g=joinObjects(e,{"javax.faces.partial.ajax":"true","javax.faces.source":h,"javax.faces.partial.execute":"@all",newSsoLogin:b}),g[h]=h);try{AnyBalance.requestPost(c+"c/post/index.xhtml",g,addHeaders({Referer:c+"c/post/index.xhtml"}))}catch(k){}a=AnyBalance.requestGet(c+"c",g_headers)}return a}
function fetchPost(c,a,b){var e=AnyBalance.getPreferences();AnyBalance.trace("Мы в постоплатном кабинете");var d=/onclick\s*=\s*"\s*selectAccount\('\d{10}|<span[^>]+class="selected"[^>]*>/i.test(a),f="",g=[replaceTagsAndSpaces,/информация[^<]*недоступна|недоступна|(?:баланс)?\s*временно недоступен/ig,""];getParam(a,b,"agreement",/<h2[^>]*>\s*Договор №([\s\S]*?)<\/h2>/i,replaceTagsAndSpaces);getParam(a,b,"tariff",/<h2[^>]*>(?:[\s\S](?!<\/h2>))*?Текущий тариф[^>]*>&laquo;([\s\S]*?)&raquo;/i,replaceTagsAndSpaces);
if(d){AnyBalance.trace("Похоже на кабинет с несколькими номерами.");if(e.phone){a=switchNumberPost(c,a);if(/c\/pre\/index\.xhtml/i.test(a)){AnyBalance.trace("Дополнительный номер "+h+" предоплатный, но привязан к постоплатному кабинету...");a=AnyBalance.requestGet(c+"c/pre/index.xhtml",g_headers);fetchPre(c,a,b);return}a=AnyBalance.requestGet(c+"c/post/index.xhtml",g_headers)}AnyBalance.isAvailable("balance","currency")&&(f=refreshBalance(c+"c/post/index.xhtml",a),getParam(f+a,b,"balance",/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,
g,parseBalance),getParam(f+a,b,["currency","prebal","overpay","balance"],/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,g,myParseCurrency))}else if(AnyBalance.trace("Похоже на кабинет с одним номером."),e.phone)throw new AnyBalance.Error("Указан дополнительный номер телефона, но в кабинете нет прикрепленных номеров!");h=getParam(a,null,null,/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces);getParam("POSTPAID",
b,"type");processInfoPost_basic(c,a,b);isAvailableBonuses()&&(AnyBalance.trace("Запросим бонусы..."),f=a,0===getFoundBonuses(f).length&&(f=getBlock(c+"c/post/index.xhtml",a,"bonusesloaderDetails")),getBonuses(f,b));AnyBalance.isAvailable("overpay","prebal","currency","bills")&&(AnyBalance.trace("Получаем информацию статусе оплаты"),f=a,/<div[^>]+id="[^"]*:bills-info"/i.test(a)||(f=getBlock(c+"c/post/index.xhtml",a,"callDetailsDetails")),getParam(f,b,"overpay",/<h4[^>]*>Переплата[\s\S]*?<span[^>]+class="price[^>]*>([\s\S]*?)<\/span>/i,
g,parseBalance),getParam(f,b,"overpay",/<h4[^>]*>Осталось к оплате[\s\S]*?<span[^>]+class="price[^>]*>([\s\S]*?)<\/span>/i,g,parseBalanceNegative),getParam(f,b,"prebal",/Расходы по договору за текущий период:[\S\s]*?<div[^<]+class="balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,g,parseBalance),getParam(f,b,["currency","prebal","overpay","balance"],/Расходы по договору за текущий период:[\S\s]*?<div[^<]+class="balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,g,myParseCurrency),sumParam(f,b,"bills",/<div[^>]+class="unpaid-bill-item"[\s\S]*?<span[^>]+class="price[^>]*>([\s\S]*?)<\/span>/ig,
[/У вас нет неоплаченных счетов/i,"0",g],parseBalance,aggregate_sum),AnyBalance.trace(f),/информация[^<]*недоступна/i.test(f)&&AnyBalance.trace("Информация временно недоступна на сайте Билайн, попробуйте позже"));!d&&AnyBalance.isAvailable("balance","currency")&&(f=refreshBalance(c+"c/post/index.xhtml",a),getParam(f+a,b,"balance",/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,g,parseBalance),getParam(f+a,b,["currency","balance"],/Расходы по номеру за текущий период с НДС[\s\S]*?<div[^>]+class="[^>]*balan?ce-summ"[^>]*>([\s\S]*?)<\/div>/i,
g,myParseCurrency));e.__debug&&(a=AnyBalance.requestGet(c+"c/operations/operationsHistory.xhtml"),f=getParam(a,null,null,/<span[^>]+class="date"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),AnyBalance.trace("Последняя заявка: "+f));e=isAvailable("remainders.traffic_used")&&(!isset(b.remainders)||!isset(b.remainders.traffic_used));if(h&&(e||isAvailable("detalization"))){var h=getParam(h,null,null,null,[/\+\s*7([\s\d\-]{10,})/i,"$1",/\D/g,""]);AnyBalance.trace("Пробуем получить данные по трафику из детализации по номеру: "+
h);a=AnyBalance.requestGet(c+"c/post/fininfo/report/detailUnbilledCalls.xhtml?ctn="+h,g_headers);a=getBlockInner(c+"c/post/fininfo/report/detailUnbilledCalls.xhtml",a,"retrieveSubCurPeriodDataDetails");f=extractFromUpdate(a,"retrieveSubCurPeriodDataDetails");/unbilledLoader:form:notifEmail/i.test(f)?AnyBalance.trace("Отчет получился слишком большой показа онлайн. Посылаем на почту"):e&&(b.remainders=b.remainders||{},getParam(f,b.remainders,"remainders.traffic_used",/Итоговый объем данных \(MB\):([^>]*>){3}/i,
[replaceTagsAndSpaces,/([\s\S]*?)/,"$1 мб"],parseTraffic));AnyBalance.isAvailable("detalization")&&processDetalizationPost(c,a,b)}isAvailable(["expenses","payments"])&&(a=AnyBalance.requestGet(c+"c/post/fininfo/index.xhtml",g_headers),AnyBalance.isAvailable("expenses")&&processExpensesPost(c,a,b),AnyBalance.isAvailable("payments")&&processPaymentsPost(c,a,b));isAvailable(["total_balance"])&&(AnyBalance.trace("Пробуем получить данные по сумме всех номеров..."),a=AnyBalance.requestGet(c+"c/post/fininfo/index.xhtml",
g_headers),getParam(a,b,"total_balance",/Сумма по всем номерам(?:[\s\S]*?<th[^>]*>){11}([\s\S]*?)<\/span/i,null,parseBalance));processInfo_settings(c,b)}function processInfoPre_basic(c,a,b){AnyBalance.isAvailable("info.fio","info.region","info.phone","info.more3")&&(b.info||(b.info={}),getParam(a,b.info,"info.fio",/<p[^>]*>([^<,]*),(?:\s|&nbsp;|<[^>]*>)*Мы стремимся сделать/i,replaceTagsAndSpaces),processInfo_basic(c,a,b))}
function processInfo_settings(c,a){if(AnyBalance.isAvailable("info.email","info.address","info.birthday","info.fio")){var b=AnyBalance.requestGet(c+"c/settings/enrichment/enrichment.xhtml",g_headers);a.info||(a.info={});var e=a.info;getParam(b,e,"info.email",/Электронная почта[\s\S]*?<div[^>]+value-cell[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(b,e,"info.address",/<div[^>]+class="[^"]*address[^>]*>([\s\S]*?)<\/div>/i,[/Адрес проживания/i,"",replaceTagsAndSpaces]);var d=getElement(b,
/<select[^>]+birthDay[^>]*>/i),f=getElement(b,/<select[^>]+birthMonth[^>]*>/i),g=getElement(b,/<select[^>]+yearPeriods[^>]*>/i),h=create_aggregate_join(" ");sumParam(d,e,"info.birthday",/<option[^>]*selected[^>]*>([\s\S]*?)<\/option>/i,[/день/i,"",replaceTagsAndSpaces],null,h);sumParam(f,e,"info.birthday",/<option[^>]*selected[^>]*>([\s\S]*?)<\/option>/i,[/месяц/i,"",replaceTagsAndSpaces],null,h);sumParam(g,e,"info.birthday",/<option[^>]*selected[^>]*>([\s\S]*?)<\/option>/i,[/год/i,"",replaceTagsAndSpaces],
null,h);isset(e.fio)&&!/^[\s\-\d\+]*$/.test(e.fio)||getParam(b,e,"info.fio",/<div[^>]+class="name"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}}
function switchNumberPre(c,a){var b=AnyBalance.getPreferences();if(!/^\d{4,10}$/.test(b.phone))throw new AnyBalance.Error("Введите от 4 до 10 последних цифр номера дополнительного телефона без пробелов и разделителей или не вводите ничего, чтобы получить информацию по первому номеру!",null,!0);var e=getParam(a,null,null,new RegExp('div[^>]*(?:>)[^>]*onclick="\\s*selectAccount\\([\'\\"]\\d*'+b.phone+"['\\\"][^>]*","i"));if(!e)throw new AnyBalance.Error("Не найден присоединенный к договору номер телефона, оканчивающийся на "+
b.phone);b=getParam(e,null,null,/selectAccount\('([^']*)/,replaceSlashes);if(/sso-account-current/i.test(e))AnyBalance.trace("Дополнительный номер "+b+" уже выбран");else{AnyBalance.trace("Переключаемся на номер "+b);var d=getParam(a,null,null,/changeUser\s*=[^<]*?f:'([^']+)/,replaceSlashes),f=getParam(a,null,null,/changeUser\s*=[^<]*?s:'([^']+)/,replaceSlashes),d=getParam(a,null,null,new RegExp('<form[^>]+id="'+d+'"[^>]*>([\\s\\S]*?)</form>',"i"));if(!d)throw AnyBalance.trace(e),new AnyBalance.Error("Дополнительный номер "+
b+" найден, но переключиться на него не удалось. Возможны изменения в личном кабинете...");e=createFormParams(d);params=joinObjects(e,{"javax.faces.partial.ajax":"true","javax.faces.source":f,"javax.faces.partial.execute":"@all",newSsoLogin:b});params[f]=f;e=AnyBalance.requestPost(c+"c/pre/index.xhtml",params,addHeaders({Referer:c+"c/pre/index.xhtml"}));(b=getParam(e,null,null,/<redirect[^>]+url="([^"]+)/i,replaceHtmlEntities))?a=AnyBalance.requestGet(b,addHeaders({Referer:c+"c/pre/index.xhtml"})):
AnyBalance.trace("Не удалось переключить номер: "+e)}return a}
function fetchPre(c,a,b){var e=AnyBalance.getPreferences();AnyBalance.trace("Мы в предоплатном кабинете");e.phone&&(a=switchNumberPre(c,a));getParam("PREPAID",b,"type");var e=getParam(a,null,null,/<h1[^>]+class="phone-number"[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces),d;processInfoPre_basic(c,a,b);getParam(a,b,"tariff",/Текущий тариф[^>]*>&laquo;([\s\S]*?)&raquo;/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("balance","currency","limit")){var f=function(){isset(b.balance)&&null!=b.balance&&getParam(a+
d,b,["currency","balance"],g,replaceTagsAndSpaces,myParseCurrency)},g=/<h3[^>]*>[^>]*class="price[^>]*>((?:[\s\S]*?span[^>]*>){3})/i;getParam(a,b,"balance",g,replaceTagsAndSpaces,parseBalance);var h=getElement(a,/<div[^>]+class="balance-credit"[^>]*>/i);getParam(h,b,"credit",/<h3[^>]*>([\s\S]*?)<\/h3>/i,replaceTagsAndSpaces,parseBalance);f();isset(b.balance)&&null!=b.balance||(d=refreshBalance(c+"c/pre/index.xhtml",a),getParam(d,b,"balance",g,replaceTagsAndSpaces,parseBalance),f())}isAvailableBonuses()&&
(d=getBonusesBlock(c+"c/pre/index.xhtml",a,"bonusesForm"),AnyBalance.trace(d),getBonuses(d,b));AnyBalance.isAvailable("detalization","payments","info.date_start")&&processDetailsAndPaymentsPre(c,e,b);processInfo_settings(c,b)}function isAvailableBonuses(){return AnyBalance.isAvailable("remainders")}function getFoundBonuses(c){return(c=getElement(c,/<div[^>]+class="bonuses-accums[^>]*>/i))?getElements(c,/<div[^>]+class="(?:grouped-bonuses|item)[^>]*>/ig):[]}
function getBonuses(c,a,b){var e=getFoundBonuses(c);b?b="":(a=a.remainders=a.remainders||{},b="remainders.");AnyBalance.trace("Found "+e.length+" aggregated bonuses");b=b||"";0==e.length&&(AnyBalance.trace("Can`t find bonuses, tying to know why..."),AnyBalance.trace(getParam(c,null,null,/loading-failed"[^>]*>([^<]+)/i)));for(c=0;c<e.length;++c){var d=e[c];if(/^<div[^>]*item/i.test(d)){d=sumParam(d,null,null,/<div[^>]+class="\s*(?:(?:item\s*)?(?:accumulator|accumulator|bonus|item)?)[^"]*"(?:[\s\S](?!$|<div[^>]+class="(?:accumulator|accumulator|bonus|item)"))*[\s\S]/ig);
AnyBalance.trace("Found "+d.length+" bonuses");for(var f=/<div[^>]+class="[^>]*column2[^"]*"[^>]*>/i,g=[replaceTagsAndSpaces,/из.*/i,""],h=0;h<d.length;++h){var k=""+getParam(d[h],null,null,/<div[^>]+class="[^"]*column1[^"]*"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),l=getElement(d[h],f,replaceTagsAndSpaces),m=getParam(d[h],null,null,/class="[^>]*rest"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);AnyBalance.trace("Найдена опция "+k+": "+l+", rest: "+m);if(/Internet|Интернет|трафика|\d+\s+[гм]б/i.test(k))if(/(?:x|х)айвей|Интернет-трафик(?:а)?(?:\sна полной скорости)? по (?:услуге|тарифу)|Мобильного интернета|Мобильный интернет|Интернет\s*-?\s*трафик|\d+\s+[гм]б/i.test(k)){k=
function(a){return parseTraffic(a,n)};AnyBalance.trace("Пробуем разобрать новый трафик...");AnyBalance.trace("services[i] = "+d[h]);AnyBalance.trace("values = "+l);AnyBalance.trace("rest = "+m);var n=getParam(l,null,null,/((?:K|К|G|Г|M|М)?(?:B|Б))/i);n||(AnyBalance.trace("!units..."),n="mb");m?sumParam(m,a,b+"traffic_left",null,replaceTagsAndSpaces,k,aggregate_sum):(sumParam(l,a,[b+"traffic_left",b+"traffic_used"],/([^<]*)из/i,replaceTagsAndSpaces,k,aggregate_sum),sumParam(l,a,[b+"traffic_total",
b+"traffic_used"],/из([^<]*)/i,replaceTagsAndSpaces,k,aggregate_sum),isset(a.traffic_left)&&isset(a.traffic_total)&&sumParam(a.traffic_total-a.traffic_left,a,b+"traffic_used",null,null,null,aggregate_sum))}else sumParam(l,a,b+"traffic_left"+(/ноч/i.test(k)?"_night":""),null,replaceTagsAndSpaces,parseTraffic,aggregate_sum);else/SMS|СМС|штук/i.test(k)?sumParam(l,a,b+"sms_left",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):/MMS/i.test(k)?sumParam(l,a,b+"mms_left",null,replaceTagsAndSpaces,parseBalance,
aggregate_sum):/Рублей БОНУС|бонус-баланс|Дополнительный баланс/i.test(k)?sumParam(l,a,b+"rub_bonus",null,replaceTagsAndSpaces,parseBalance,aggregate_sum):/Денежный бонус/i.test(k)?(getParam(l,a,b+"rub_bonus2",null,replaceTagsAndSpaces,parseBalance),getParam(d[h],a,b+"rub_bonus2_till",/<div[^>]+class="column3[^"]*"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDateWord)):/Рублей за участие в опросе|Счастливое время|Бонусы по программе|Счастливого времени/i.test(k)?sumParam(l,a,b+"rub_opros",
null,replaceTagsAndSpaces,parseBalance,aggregate_sum):/Минут[^<]+на\s*(?:все\s*)номера вашего региона|Времени общения|Включенные минуты|Пакет минут|Минут общения на номера вашего региона|минут в месяц|мин\.|Голосовой трафик|Разговор.*вне сети/i.test(k)?(sumParam(l,a,b+"min_local",null,g,parseMinutes,aggregate_sum),sumParam(d[h],a,b+"min_local_till",/Доступно до([^<]{10,20})/i,replaceTagsAndSpaces,parseDateWord,aggregate_min)):/Секунд БОНУС\s*\+|Баланс бонус-секунд/i.test(k)?sumParam(l,a,b+"min_bi",null,g,parseMinutes,
aggregate_sum):/Секунд БОНУС-2|Баланс бесплатных секунд-промо/i.test(k)?(sumParam(l,a,b+"min_left_1",null,g,parseMinutes,aggregate_sum),sumParam(d[h],a,b+"min_local_till",/Доступно до([^<]{10,20})/i,replaceTagsAndSpaces,parseDateWord,aggregate_min)):/Минут общения|вызовы|на местные номера|Остаток разговоров/i.test(k)?/местные.*вызовы|любые номера Вашего региона|^Минут общения по тарифу$|(?:всех|других|любых)\s*(?:сотовых|мобильных)?\s*операторов|все номера|На номера домашнего региона|Минут общения по тарифу Все для бизнеса Бронза|кроме номеров .?Билайн.?|на местные номера других операторов|любые местные/i.test(k)?
sumParam(l,a,b+"min_local",null,g,parseMinutes,aggregate_sum):sumParam(l,a,b+"min_bi",null,g,parseMinutes,aggregate_sum):/Баланс для оплаты дополнительных услуг/i.test(k)||AnyBalance.trace("Неизвестная опция: "+k+" "+d[h])}}else AnyBalance.trace("Пропускаем grouped-bonuses: "+d)}}
function getTempPasswordSMS(c,a){var b=AnyBalance.getPreferences(),e=c+"s/recoveryPassSSO.xhtml",d;do{var f=getParam(a,null,null,/<form[^>]+id="form"[^>]*>[\s\S]*?<\/form>/i);if(!f)throw AnyBalance.trace(a),new AnyBalance.Error("Не удаётся найти форму регистрации. Проблемы на сайте или сайт изменен");var g,h=createFormParams(f,function(a,d,h,k){/login/i.test(h)?k=b.login:"kaptchaId"==h?(a=AnyBalance.requestPost(c+"captcha.jpg","",addHeaders({"X-Requested-With":"XMLHttpRequest",Referer:e})),a=getJson(a),
g=a.url,k=a.id):/kaptchaInput/i.test(h)&&(a=getParam(f,null,null,/<div[^>]+ui-message-error[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),d=AnyBalance.requestGet(c+g,g_headers),k=AnyBalance.retrieveCode((a||"")+"\nВведите, пожалуйста, символы с картинки.",d,{time:3E5}));return k}),k=getParam(f,null,null,/<button[^>]+loginInnerBlock[^>]*>/i);if(!k)throw AnyBalance.trace(f),new AnyBalance.Error("Не удаётся найти кнопку подтверждения регистрации. Проблемы на сайте или сайт изменен");k=getParam(k,null,
null,/name="([^"]*)/i,replaceHtmlEntities);h["javax.faces.partial.ajax"]="true";h["javax.faces.source"]=k;h["javax.faces.partial.execute"]="@all";h["javax.faces.partial.render"]="loginInnerBlock";h[k]=k;d&&(h["javax.faces.ViewState"]=d);h=AnyBalance.requestPost(e,h,addHeaders({"X-Requested-With":"XMLHttpRequest"}));d=extractFromUpdate(h,"ViewState:0");a=extractFromUpdate(h,"loginInnerBlock",!0)}while(/kaptchaInput/i.test(a));return h}
function createNewPassword(c){var a=AnyBalance.getPreferences();checkEmpty(a.login,"Введите 10 цифр вашего номера телефона в формате 9031234567");checkEmpty(!a.password||6<=a.password.length,"Введите не менее 6 символов желаемого пароля. Или оставьте поле пустым, чтобы автоматически сгенерировать пароль.");var b=c+"s/recoveryPassSSO.xhtml",e=c+"s/changePassSSO.xhtml",d=AnyBalance.requestGet(c+"s/recoveryPassSSO.xhtml",g_headers),d=getTempPasswordSMS(c,d),e=extractFromUpdate(d,"ViewState:0"),d=extractFromUpdate(d,
"loginInnerBlock",!0);if(/emailToken/i.test(d))AnyBalance.trace("Уже зарегистрированы, билайн выслал емейл..."),b=AnyBalance.retrieveCode("Вы уже были зарегистрированы в личном кабинете. Если вы помните пароль, нажмите Отмена и введите в настройки провайдера правильный пароль. Если нет, наберите на номере "+a.login+' команду *110*9# (вызов) и введите сюда временный пароль, который придет вам по SMS \x3c!--#instruction:{"sms":{"number_in":"My Beeline","regexp_in":"пароль:\\s*(\\w+)"}}#--\x3e',null,
{time:3E5}),d=doLogin(c,a.login,b);else{AnyBalance.trace("Похоже, отправили временный пароль в смс...");var f=getParam(d,null,null,/<form[^>]+id="tokenForm"[^>]*>[\s\S]*?<\/form>/i);if(!f){if(c=getParam(d,null,null,/<div[^>]*ui-message-error[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c);AnyBalance.trace(d);throw new AnyBalance.Error("Не удаётся найти форму ввода смс пароля. Проблемы на сайте или сайт изменен");}var g=createFormParams(f,function(b,c,d,e){/smsToken/i.test(d)&&
(e=AnyBalance.retrieveCode("Введите временный пароль, который пришел на номер "+a.login+' по SMS \x3c!--#instruction:{"sms":{"number_in":"My Beeline","regexp_in":"пароль:\\s*(\\w+)"}}#--\x3e',null,{time:3E5}));return e}),d=getParam(f,null,null,/<button[^>]+loginInnerBlock[^>]*>/i);if(!d)throw AnyBalance.trace(f),new AnyBalance.Error("Не удаётся найти кнопку подтверждения ввода SMS кода. Проблемы на сайте или сайт изменен");d=getParam(d,null,null,/name="([^"]*)/i,replaceHtmlEntities);g["javax.faces.partial.ajax"]=
"true";g["javax.faces.source"]=d;g["javax.faces.partial.execute"]="@all";g["javax.faces.partial.render"]="loginInnerBlock";g[d]=d;g["javax.faces.ViewState"]=e;d=AnyBalance.requestPost(b,g,addHeaders({"X-Requested-With":"XMLHttpRequest"}));g=getParam(d,null,null,/<redirect[^>]+url="([^"]*)/i,replaceHtmlEntities);if(!g){if(c=getElement(d,/<div[^>]+ui-messages-error[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c);AnyBalance.trace(d);throw new AnyBalance.Error("Не удаётся найти адрес входа в личный кабинет. Сайт изменен?");
}}var d=AnyBalance.requestGet(g,g_headers),h=a.password||generatePassword(),f=getParam(d,null,null,/<form[^>]+id="changePassWordForm"[^>]*>[\s\S]*?<\/form>/i);if(!f)throw AnyBalance.trace(d),new AnyBalance.Error("Не удаётся найти форму смены пароля. Проблемы на сайте или сайт изменен");g=createFormParams(f,function(a,b,c,d){/password$/i.test(c)&&(d=h);return d});e=AnyBalance.getLastUrl();d=AnyBalance.requestPost(e,g,addHeaders({}));f=getParam(d,null,null,/<form[^>]+id="confirmForm"[^>]*>[\s\S]*?<\/form>/i);
if(!f)throw AnyBalance.trace(d),new AnyBalance.Error("Не удаётся найти форму подтверждения инициализации. Проблемы на сайте или сайт изменен");g=createFormParams(f);b=AnyBalance.getLastUrl();d=AnyBalance.requestPost(b,g,addHeaders({}));try{turnOffSMSNotification(c)}catch(k){AnyBalance.trace("Проблема с отключением уведомления: "+k.message)}return h}function loginWithoutPassword(c){var a=createNewPassword(c);c=AnyBalance.requestGet(c,g_headers);c=getLKType(c);c.password=a;return c}
function turnOffSMSNotification(c){c+="c/settings/notifications/notifications.xhtml";var a=AnyBalance.requestGet(c,g_headers),b=getParam(a,null,null,/<form[^>]+name="notificationEventsForm"[^>]*>[\s\S]*?<\/form>/i);if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму управления уведомлениями.");a=getParam(b,null,null,/(<input[^>]+id="notificationEventsForm:[^>]*Вход в личный кабинет[^>]*>)/i,replaceHtmlEntities);if(!a)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось найти галочку отключения уведомления.");
var e=getParam(a,null,null,/name="([^"]*)/i,replaceHtmlEntities);if(getParam(a,null,null,/\s+checked=/i,replaceHtmlEntities)){var a=createFormParams(b,function(a,b,c,d){c==e&&(d=void 0);return d}),d=getParam(b,null,null,/<button[^>]*u:'notificationEventsForm'[^>]*>/i);if(!d)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось найти кнопку сохранения уведомлений.");b=getParam(d,null,null,/s:'([^']*)/,replaceHtmlEntities);a["javax.faces.partial.ajax"]="true";a["javax.faces.source"]=b;a["javax.faces.partial.execute"]=
"@all";a["javax.faces.partial.render"]="notificationEventsForm";a[b]=b;a=AnyBalance.requestPost(c,a,g_headers);a=extractFromUpdate(a,"notificationEventsForm",!0);if(!/Настройки уведомлений успешно сохранены/i.test(a))throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось сохранить уведомления");AnyBalance.trace("Уведомление о входе отменено успешно!")}else AnyBalance.trace("Уведомление о входе уже выключено. Отлично :)")}
function generatePassword(){for(var c=String.fromCharCode("A".charCodeAt()+Math.floor(26*Math.random())),c=c+String.fromCharCode("0".charCodeAt()+Math.floor(10*Math.random())),a=0;4>a;++a)c+=String.fromCharCode("a".charCodeAt()+Math.floor(26*Math.random()));return c}
function sheet_to_array(c){var a=[];if(null==c||null==c["!ref"])return a;for(var b=XLS.utils.decode_range(c["!ref"]),e,d="",f=[],g,h=0,k=0,k=b.s.c;k<=b.e.c;++k)f[k]=XLS.utils.encode_col(k);for(h=b.s.r;h<=b.e.r;++h){e=[];d=XLS.utils.encode_row(h);for(k=b.s.c;k<=b.e.c;++k)g=c[f[k]+d],g=void 0!==g?""+XLS.utils.format_cell(g):"",e[k]=g;a.push(e)}return a};
