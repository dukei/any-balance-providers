var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36","Accept-Language":"ru,en-US;q=0.8,en;q=0.6"},baseurl="https://online.absolutbank.ru/app/",g_Xml_Headers={Accept:"application/xml, text/xml, */*; q=0.01","X-Requested-With":"XMLHttpRequest","Wicket-Ajax":"true","Wicket-Ajax-BaseURL":"main?main=priv&amp;replace=main&amp;context=0&amp;payments=templates",
Origin:"https://online.absolutbank.ru",Referer:baseurl+"main?main=priv"};
function login(a,b){AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");b=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту провайдера! Попробуйте обновить данные позже.");if(!/logout/i.test(b)){var c=findWicketActions(b),d=[],e=getParam(b,null,null,/<input[^>]*name="password"[^>]*id="([^"]+)/i),f=getParam(b,
null,null,/<input[^>]*name="login"[^>]*id="([^"]+)/i),g=getParam(b,null,null,/<a[^>]*class="button[^>]*id="([^"]+)/i);c.forEach(function(a,b,c){a=getJson(a);b=(a.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");switch(a.c){case f:d[0]=b;break;case e:d[1]=b;break;case g:d[2]=b}});a=[{login:a.login},{password:a.password}];a[2]=joinObjects(a[0],a[1]);for(c=0;c<d.length;c++)b=AnyBalance.requestPost(baseurl+d[c],a[c],addHeaders(g_Xml_Headers));if(!/logout/i.test(b)){if(a=AB.getParam(b,
null,null,/"feedbackPanelERROR"[^>]*>([\s\S]*?)<\//i,AB.replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Неверно указан/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");}__setLoginSuccessful()}return b}
function processProfile(a,b){isAvailable("info")&&(a=AnyBalance.requestGet(baseurl+"main?main=priv&replace=profile_view&item=0",g_headers),b.info={},getParam(a,b.info,"info.fio",/ФИО((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces),getParam(a,b.info,"info.birthday",/Дата рождения((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces),getParam(a,b.info,"info.mphone",/Телефон((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces),getParam(a,b.info,"info.address",/Адрес регистрации((?:[\s\S]*?<\/div[^>]*>){2})/i,
replaceTagsAndSpaces),getParam(a,b.info,"info.addressHome",/Домашний адрес((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces))}function findWicketActions(a){a=sumParam(a,null,null,/Wicket.Ajax.ajax\((\{[\s\S]*?\})\);/ig)||[];AnyBalance.trace("Found "+a.length+" Wicket-ajax actions");return a}function findExactWickeAction(a,b){if(a)for(var c=0;c<a.length;c++){var d=getJson(a[c]),e=(d.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");if(d.c===b)return e}}
function requestGetWicketAction(a,b,c){var d=getParam(a,null,null,b);if(!d)throw AnyBalance.trace(a),new AnyBalance.Error("Не нашли wicketId "+b.source);a=findWicketActions(a);a=findExactWickeAction(a,d);if(!a)throw new AnyBalance.Error("Не удалось найти action: "+d);return c?AnyBalance.requestPost(baseurl+a,c,addHeaders({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},addHeaders(g_Xml_Headers))):AnyBalance.requestGet(baseurl+a+"&_="+(new Date).getTime(),addHeaders(g_Xml_Headers))}
function checkForRedirect(a){/<redirect>/i.test(a)&&((a=getParam(a,null,null,/main;[^\]]+/i))||AnyBalance.trace("Запрошен редиретк, но ссылка на него не найдена, сайт изменен?"),a=AnyBalance.requestGet(baseurl+a,g_headers));return a}
function processCards(a,b){if(isAvailable("cards")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/wicket.event.add\([^"]*?"load"[\s\S]*?"c":"([^"]*)/i);a=requestGetWicketAction(a,/<div[^>]+class="inner\b[^>]+id="(id[^"]+)"/i);var c=getElements(a,/<div[^>]+class=['"]card inner['"][^>]*>/ig);AnyBalance.trace("Найдено карт: "+c.length);b.cards=[];for(var d=0;d<c.length;++d){var e=getParam(c[d],null,null,/<small[^>]+class="gray"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces),
f=getParam(c[d],null,null,/"card-name"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces),e={__id:e,num:e,__name:f+" "+e};__shouldProcess("cards",e)&&processCard(c[d],e,a);b.cards.push(e)}}}
function processCard(a,b,c){getParam(a,b,"cards.balance",/class="amount"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["cards.currency","cards"],/class="amount"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);c=requestGetWicketAction(c,/<div[^>]+class="card inner"[^>]+id="(id[^"]+)"/i);a=getElement(c,/<h1[^>]+class="title"[^>]*>/i,replaceTagsAndSpaces);getParam(a,b,"cards.num",/[\d\*\s]{6,}/,replaceTagsAndSpaces);getParam(c,b,"cards.limit",/Кредитный лимит((?:[\s\S]*?<\/div[^>]*>){2})/i,
replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.debt",/Общая задолженность((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.ovedraft",/Текущий овердрафт((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.ovedraft_pcts",/Сумма начисленных процентов по овердрафту((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.ovedraft_overdue",/Просроченный овердрафт((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,
parseBalance);getParam(c,b,"cards.overlimit",/Сверхлимитная задолженность((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.commissions",/Cумма комиссий((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.penalty",/Сумма штрафов((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.billing_date",/Расчетная дата((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.minpay",
/Минимальный платеж((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.minpay_overdue",/в том числе просроченные минимальные платежи((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"cards.till",/Срок действия((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseDate);getParam(c,b,"cards.holder",/Имя владельца((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(c,b,"cards.status",/Статус карты((?:[\s\S]*?<\/div[^>]*>){2})/i,
replaceTagsAndSpaces);AnyBalance.isAvailable("cards.accnum")&&(a=requestGetWicketAction(c,/<small[^>]+id="([^"]*)[^>]*>\s*Реквизиты/i),getParam(a,b,"credits.accnum",/Номер[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces));AnyBalance.isAvailable("cards.contract","cards.date_start","cards.pct")&&(a=requestGetWicketAction(c,/<small[^>]+id="([^"]*)[^>]*>\s*Условия/i),getParam(a,b,"cards.contract",/Договор №\s*<span[^>]*>([^<]*)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"cards.date_start",
/Договор №[\s\S]*?от\s*<span[^>]*>([^<]*)<\/span>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"cards.pct",/Процентная ставка[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance));"undefined"!=typeof processCardTransactions&&processCardTransactions(c,b)}
function processAccounts(a,b){if(isAvailable("accounts")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/wicket.event.add\([^"]*?"load"[\s\S]*?"c":"([^"]*)/i);a=requestGetWicketAction(a,/<div[^>]+class="inner\b[^>]+id="(id[^"]+)"/i);var c=getElements(a,/<div[^>]+class=['"]account inner[^"]+single-account['"][^>]*>/ig);AnyBalance.trace("Найдено счетов: "+c.length);b.accounts=[];for(var d=0;d<c.length;++d){var e=requestGetWicketAction(c[d]+a,/id="(id[^"]+)"/i),
f=getParam(e,null,null,/№(?:\s|<[^>]*>)*(\d{20})/i,replaceTagsAndSpaces),g=getParam(e,null,null,/class="editable"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),h=g+" "+f.substr(-4),f={__id:f,__name:h,num:f,name:g};__shouldProcess("accounts",f)&&processAccount(e,f);b.accounts.push(f)}}}
function processAccount(a,b){getParam(a,b,"accounts.balance",/class="[^"]*amounts"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["accounts.currency","accounts"],/class="[^"]*amounts"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);"undefined"!=typeof processAccountTransactions&&processAccountTransactions(a,b);AnyBalance.isAvailable("accounts.date_start")&&(a=requestGetWicketAction(a,/<small[^>]+id="([^"]*)[^>]*>\s*Реквизиты/i),getParam(a,b,"accounts.date_start",
/Открыт[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate))}
function processCredits(a,b){if(isAvailable("credits")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/wicket.event.add\([^"]*?"load"[\s\S]*?"c":"([^"]*)/i);var c=[];try{a=requestGetWicketAction(a,/<div[^>]+class="inner\b[^>]+id="(id[^"]+)"(?:[^>]*>){3,7}\s*Кредиты/i),c=getElements(a,/<div[^>]+class=['"]account inner[^>]*>/ig),AnyBalance.trace("Найдено кредитов: "+c.length)}catch(f){/Заявка на кредит/i.test(a)?AnyBalance.trace("Кредитов нет: "+f.message):AnyBalance.trace("Не удалось найти ссылку на кредиты."+
f.message)}b.credits=[];for(var d=0;d<c.length;++d){var e=getParam(c[d],null,null,/<span[^>]*class=['"]index['"](?:[^>]*>){2}([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),e={__id:e,__name:e};__shouldProcess("credits",e)&&processCredit(c[d],e,a);b.credits.push(e)}}}
function processCredit(a,b,c){getParam(a,b,"credits.limit",/class="sum"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["credits.currency","credits.limit","credits.balance"],/class="sum"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"credits.minpay_till",/К оплате([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(a,b,"credits.minpay",/К оплате[\s\S]*?class="sum"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);c=requestGetWicketAction(c,
/<div[^>]+class="account inner[^>]+id="(id[^"]+)"/i);getParam(c,b,"credits.balance",/Общая задолженность(?:[^>]*>){3}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.principal_debt",/Сумма основного долга(?:[^>]*>){3}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.pct_sum",/Cумма начисленных процентов(?:[^>]*>){3}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.debt_expired",/Сумма просроченного основного долга(?:[^>]*>){3}([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.pct_expired",/Сумма просроченных процентов(?:[^>]*>){3}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.penalty",/Штрафы(?:[^>]*>){3}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.minpay_till",/К оплате([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate);getParam(c,b,"credits.minpay",/К оплате[\s\S]*?<div[^>]+total-amounts[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);
getParam(c,b,"credits.minpay_main_debt",/К оплате[\s\S]*?Сумма основного долга([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.minpay_pct",/К оплате[\s\S]*?Сумма процентов([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.minpay_others",/К оплате[\s\S]*?Другие комиссии([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.minpay_penalty",/К оплате[\s\S]*?Пеня за([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,
b,"credits.minpay_pct_expired",/К оплате[\s\S]*?Сумма просроченных процентов([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.minpay_debt_expried",/К оплате[\s\S]*?Сумма просроченного основного долга([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);a=requestGetWicketAction(c,/<small[^>]+id="([^"]*)[^>]*>\s*Условия договора/i);getParam(a,b,"credits.contract",/Договор №\s*<span[^>]*>([^<]*)<\/span>/i,replaceTagsAndSpaces);getParam(a,b,"credits.date_start",/Договор №[\s\S]*?от\s*<span[^>]*>([^<]*)<\/span>/i,
replaceTagsAndSpaces,parseDate);getParam(a,b,"credits.till",/Дата планового закрытия[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate);getParam(a,b,"credits.payment",/Размер ежемесячного платежа[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.pct",/Процентная ставка[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.accnum",/Счет для погашения[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);
getParam(a,b,"credits.pct_effective",/Полная стоимость кредита[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);"undefined"!=typeof processCreditSchedule&&processCreditSchedule(c,b)};
