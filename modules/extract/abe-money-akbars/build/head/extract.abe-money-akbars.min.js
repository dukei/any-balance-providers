var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive",Origin:"https://online.akbars.ru","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.73 Safari/537.36","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},baseurl="https://online.akbars.ru/wb/";
function login(a){AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl+"menu",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");b=AnyBalance.getLastUrl();/CARDS|ACCOUNTS/i.test(b)?(AnyBalance.trace("Уже залогинены, используем существующую сессию"),a=apiCall("GET:api/v2/session")):
a=apiCall("POST:api/v2/session",{login:a.login,password:a.password});if("confirmationRequired"==a._status)throw new AnyBalance.Error("Для входа потребовался одноразовый пароль. Такой вход пока не поддерживается. Пожалуйста, отключите требование подтверждения для входа в настройках интернет-банка.");__setLoginSuccessful();return a}
function apiCall(a,b){var c={ACCOUNT_BLOCKED:"Учетная запись заблокирована",INVALID_LOGIN_OR_PASSWORD:"Неправильный логин или пароль"},d=/^(.+?):(.+$)/i.exec(a);if(!d)throw new AnyBalance.Error("Неправильно сформирована команда для apiCall");var e=d[2],d="GET"==d[1]?AnyBalance.requestGet(baseurl+e,g_headers):AnyBalance.requestPost(baseurl+e,JSON.stringify(b),addHeaders({Referer:baseurl})),e=getJson(d);if(e._error){if(c=c[e._error.code])throw new AnyBalance.Error(c,null,/Неправильный логин или пароль/i.test(c));
AnyBalance.trace(d);throw new AnyBalance.Error("Неизвестная ошибка вызова API. Сайт изменен?");}return e}var dataJson;function getCardsAccountDataJson(a){if(!dataJson)var b=dataJson=apiCall("GET:api/v2/contracts?system=W4C&filter=addData.CLASSIFICATION_FACTOR:DEBIT");if(isset(a))for(var b=[],c=0;c<dataJson.length;c++){var d=dataJson[c];d.type==a&&"active"==d[d.type].status&&b.push(d)}return b}
function getAllBalances(a,b,c){for(var d="available>balance cr_limit>limit blocked interests>pct minpay overdue overlimit total_due>debt".split(" "),e=0;e<d.length;e++){var f=d[e].split(/>/),g=f[0],f=f[1]||g;getParam(jspath1(a,"balances."+g+".value"),b,c+"."+f,null,null,parseBalance)}}
function processAccounts(a,b){if(isAvailable("accounts")){var c=getCardsAccountDataJson("cardAccount");AnyBalance.trace("Найдено счетов: "+c.length);b.accounts=[];for(var d=0;d<c.length;++d){var e=c[d],f={__id:e.id,__name:e.number,num:e.number};__shouldProcess("accounts",f)&&processAccount(e,f);b.accounts.push(f)}}}
function processAccount(a,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(jspath1(a,"currency"),b,["accounts.currency","accounts"]);getAllBalances(a,b,"accounts");isAvailable("accounts.transactions")&&processCardOrAccountTransactions(b,"accounts.transactions.")}
function processCards(a,b){if(isAvailable("cards")){var c=getCardsAccountDataJson("card");AnyBalance.trace("Найдено карт: "+c.length);b.cards=[];for(var d=0;d<c.length;++d){var e=c[d],f={__id:e.id,__name:e.number,num:e.number};__shouldProcess("cards",f)&&processCard(e,f);b.cards.push(f)}}}
function processCard(a,b,c){getParam(jspath1(a,"currency"),b,["cards.currency","cards"]);getAllBalances(a,b,"cards");getParam(jspath1(a,"addData.NICE_CARD_EXPIRE"),b,"cards.till",null,null,parseDate);getParam(jspath1(a,"addData.CARDHOLDER_NAME"),b,"cards.holder",null,replaceTagsAndSpaces);getParam(jspath1(a,"addData.PROD_NAME"),b,"cards.name");getParam(jspath1(a,"addData.CARD_ID"),b,"cards.id");isAvailable("cards.transactions")&&processCardOrAccountTransactions(b,"cards.transactions.")}
function processInfo(a,b){var c=b.info={};getParam(jspath1(a,"user.displayName"),c,"info.fio");getParam(jspath1(a,"user.login"),c,"info.login");getParam(jspath1(a,"user.id"),c,"info.id");getParam(jspath1(a,"user.w4cClientId"),c,"info.w4cClientId");getParam(jspath1(a,"user.w4cClientId.phoneNumbers.displayValue"),c,"info.mphone")};
