var g_baseurl="https://click.alfabank.kz/",g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},g_requestVerificationToken;
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");a.login=getParam(a.login,null,null,/^\+7\d{10}$/i,[/\+7(\d{3})(\d{3})(\d{2})(\d{2})/,"+7 ($1) $2-$3-$4"]);checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var b=AnyBalance.requestGet(g_baseurl+"/entrance",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");
g_requestVerificationToken=getParam(b,null,null,/<input[^>]+value\s*=\s*['"]?([^'">\s]*)[^>]*id="hiddenRequestVerificationToken"/i,replaceHtmlEntities);if(/logout/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else if(b=AnyBalance.requestPost(g_baseurl+"/Authorize/Login",JSON.stringify({captchaText:"",login:a.login,pass:a.password}),addHeaders({Referer:g_baseurl,REQUEST_VERIFICATION_TOKEN:g_requestVerificationToken,"X-Requested-With":"XMLHttpRequest",Accept:"application/json, text/javascript, */*; q=0.01",
"Content-Type":"application/json"})),a=getJson(b),"0"==a.Code)b=AnyBalance.requestGet(g_baseurl+"/main",g_headers);else{if("-10012"==a.Code)throw new AnyBalance.Error(a.CodeDescription);if(""!=a.CodeDescription&&null!=a.CodeDescription)throw new AnyBalance.Error(a.CodeDescription,null,-1!=a.CodeDescription.indexOf("Логин или пароль"));}__setLoginSuccessful();return b}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){a=AnyBalance.requestGet(g_baseurl+"/Home/AccountsList",addHeaders({REQUEST_VERIFICATION_TOKEN:g_requestVerificationToken}));var d=getElements(a,/<div[^>]+slidelist__item_cover-\d+[^>]*>/ig);if(d.length)for(AnyBalance.trace("Найдено карт: "+d.length),b.cards=[],a=0;a<d.length;++a){var e=d[a],c=getParam(e,null,null,/<a[^>]+href="\/card\/(\d+)"/i,replaceTagsAndSpaces),f=getParam(e,null,null,/<div[^>]+card__name_renameable[^>]+>(.+)<\/div/i,
replaceTagsAndSpaces),g=getParam(e,null,null,/cardnumber__hidden(?:[^>]*>){3}([^<]+)/i,replaceTagsAndSpaces),f=f+" *"+g.substr(-4),c={__id:c,num:g,__name:f};__shouldProcess("cards",c)&&processCard(e,c);b.cards.push(c)}else/У вас нет карт/i.test(a)?(AnyBalance.trace("У вас нет карт"),b.cards=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(a,b){AnyBalance.trace("Обработка карты "+b.__name);html=AnyBalance.requestGet(g_baseurl+"/card/"+b.__id,g_headers);getParam(html,b,"cards.balance",/Доступный остаток(?:[^>]*>){4}(.+)<\/span/i,replaceTagsAndSpaces,parseBalance);getParam(html,b,["cards.currency","cards.balance"],/Доступный остаток(?:[^>]*>){2}[^>]+money_([a-z]+)[^>]+>/i,[AB.replaceTagsAndSpaces,/(.*?)/i,"0$1"],parseCurrency);getParam(html,b,"cards.blocked",/Заблокировано(?:[^>]*>){4}(.+)<\/span/i,replaceTagsAndSpaces,
parseBalance);getParam(html,b,"cards.status",/Статус(?:[^>]*>){3}([^<]+)/i,replaceTagsAndSpaces);getParam(html,b,"cards.cardnum",/Номер карты(?:[^>]*>){3}([^<]+)/i,replaceTagsAndSpaces);getParam(html,b,"cards.till",/Действительна до(?:[^>]*>){3}([^<]+)/i,replaceTagsAndSpaces,parseDate);getParam(html,b,"cards.acc_num",/Номер счета(?:[^>]*>){3}([^<]+)/i,replaceTagsAndSpaces);getParam(html,b,"cards.type",/<a[^>]+backlink(?:[^>]*>){5}([^<]+)/i,replaceTagsAndSpaces);isAvailable("cards.transactions")&&
processCardTransactions(a,b)}
function processAccounts(a,b){if(isAvailable("accounts")){a=AnyBalance.requestGet(g_baseurl+"/Home/AccountsList",addHeaders({REQUEST_VERIFICATION_TOKEN:g_requestVerificationToken}));var d=getElements(a,/<div[^>]+slidelist__item_cover-account-\d+[^>]*>/ig);if(d.length)for(AnyBalance.trace("Найдено счетов: "+d.length),b.accounts=[],a=0;a<d.length;++a){var e=d[a],c=getParam(e,null,null,/<a[^>]+href="\/account\/(\d+)"/i,replaceTagsAndSpaces),f=getParam(e,null,null,/<div[^>]+card__name_renameable[^>]+>(.+)<\/div/i,replaceTagsAndSpaces),
g=getParam(e,null,null,/card__helper[^>]+>([^<]+)</i,replaceTagsAndSpaces),c={__id:c,num:g,type:f,__name:f};__shouldProcess("accounts",c)&&processAccount(e,c);b.accounts.push(c)}else/У вас нет счетов/i.test(a)?(AnyBalance.trace("У вас нет счетов"),b.accounts=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу со счетами."))}}
function processAccount(a,b){AnyBalance.trace("Обработка счета "+b.num);getParam(b.num,b,"accounts.acc_num");getParam(a,b,"accounts.balance",/slidelist__helper(?:[^>]*>){3}(.+)<\/span/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["accounts.currency","accounts.balance"],/slidelist__helper(?:[^>]*>){1}[^>]+money_([a-z]+)[^>]+>/i,[AB.replaceTagsAndSpaces,/(.*?)/i,"0$1"],parseCurrency);getParam(a,b,"accounts.date_start",/Дата открытия(?:[^>]*>){2}([^<]+)/i,replaceTagsAndSpaces,parseDate);getParam(a,
b,"accounts.type",/<a[^>]+backlink(?:[^>]*>){5}([^<]+)/i,replaceTagsAndSpaces);"undefined"!=typeof processAccountTransactions&&processAccountTransactions(a,b)}function processInfo(a,b){b=b.info={};getParam(a,b,"info.fio",/<div[^>]+class="client"(?:[^>]*>){1}([^<]*)/i,AB.replaceTagsAndSpaces)};
