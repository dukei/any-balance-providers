var g_baseurl="https://click.alfabank.ru",g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru,en-US;q=0.8,en;q=0.6",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36"},g_some_action='<m xmlns="http://oracle.com/richClient/comm"><k v="type"><s>action</s></k></m>',g_mainHtml,g_csrfToken,g_pageID;
function login(a){AnyBalance.setOptions({cookiePolicy:"rfc2109"});AnyBalance.setDefaultCharset("utf-8");var c=AnyBalance.getPreferences();if(g_mainHtml)return g_mainHtml;checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");return processClick(a)}var g_mainHtmlIs20;function isClick20(){isset(g_mainHtmlIs20)||(g_mainHtmlIs20=/\(C2skin\)/.test(g_mainHtml));return g_mainHtmlIs20}
function processClick(a){var c=AnyBalance.getPreferences(),b=AnyBalance.requestGet(g_baseurl+"/ALFAIBSR/",g_headers),b=getJsonObject(b,/window.initialState\s*=/).passport.authorization.requestId,b=AnyBalance.requestPost(g_baseurl+"/oam/server/auth_cred_submit",{username:c.login,password:c.password,request_id:b},g_headers);if(/<input[^>]+otp_param/i.test(b)){AnyBalance.trace("Затребован одноразовый пароль");c=getElement(b,/<form[^>]+approve-login/i);if(!c)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось получить форму ввода одноразового пароля. Сайт изменен?");
b=AB.createFormParams(c,function(a,b,c,e){return"otp_param"==c?AnyBalance.retrieveCode("Введите код подтверждения входа из СМС",null,{inputType:"number"}):e});b=AnyBalance.requestPost(g_baseurl+"/oam/server/auth_cred_submit",b,g_headers)}if(!/"_afrLoop",\s*"(\d+)"/i.test(b)){if(a=getElement(b,/<div[^>]+class="[^"]*\b(?:red|notification__message)\b/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/парол/i.test(a));if(a=getParam(b,null,null,/(Неверный логин или пароль)/i))throw new AnyBalance.Error(a,
null,!0);if(c=getParam(AnyBalance.getLastUrl(),null,null,/p_error_code=([^&]*)/i,null,decodeURIComponent)){var e=AnyBalance.requestGet(g_baseurl+"/SLAlfaSignFront10/errors?code="+c+"&type="+getParam(c,null,null,/[^\-]*/),g_headers),g=getJson(e);"SUCCESS"!=g.result?AnyBalance.trace("Не удалось получить ошибку: "+e):a=g.payload[c];if(a)throw new AnyBalance.Error(a,null,/логин или пароль/i.test(a));}AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}b=
clickGoToUrl(b,{isHtml:!0,sessionRequired:!0});AnyBalance.getLastUrl();if(/faces\/main\/changePassword|faces\/routeChangePwd\/changePassword/i.test(b))throw new AnyBalance.Error("Вам необходимо сменить старый пароль. Зайдите в Альфа-Клик через браузер, поменяйте пароль, затем введите новый пароль в настройки провайдера.",null,!0);if(!/images\/close.png/i.test(b)&&!/&#1042;&#1099;&#1093;&#1086;&#1076;/i.test(b))throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось войти в Альфа-Клик. Сайт изменен?");
g_mainHtml=b;if(isClick20())AnyBalance.trace("Определен Альфа-Клик 2.0"),turnOffLoginOtp();else if(AnyBalance.trace("Определен Альфа-Клик 1.0"),!a||!a.allowClick10)throw new AnyBalance.Error("К сожалению, Альфа-Клик 1.0 не поддерживается. Зайдите в Альфа-Клик через браузер и переключите ваш Альфа-Клик на версию 2.0");__setLoginSuccessful();return b}
function clickGoToUrl(a,c){c||(c={});a=c.isHtml?a:AnyBalance.requestGet(a,g_headers);var b=getParam(a,null,null,/"_afrLoop",\s*"(\d+)"/i);if(!b)throw new AnyBalance.Error("Не удаётся найти параметр для входа: _afrLoop. Сайт изменен?");a=getParam(a,null,null,/var\s+sess\s*=\s*"([^"]*)/i,replaceSlashes);if(c.sessionRequired&&!a)throw new AnyBalance.Error("Не удаётся найти параметр для входа: sess. Сайт изменен?");a=AnyBalance.requestGet(g_baseurl+"/ALFAIBSR/"+a+"?_afrLoop="+b+"&_afrWindowMode=0&_afrWindowId=null",
g_headers);c=getParam(a,null,null,/<div[^>]+id="ct"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);AnyBalance.trace("CSRF token found: "+c);g_csrfToken=c;c=getParam(a,null,null,/location\.href\s*=\s*'(\/ALFA[^']*)/,replaceSlashes);a=AnyBalance.requestGet(g_baseurl+c,g_headers);b=getParam(a,null,null,/"_afrLoop",\s*"(\d+)"/i);if(!b)throw new AnyBalance.Error("Не удаётся найти очередной параметр для входа: _afrLoop. Сайт изменен?");return a=AnyBalance.requestGet(g_baseurl+c+"&_afrLoop="+b+"&_afrWindowMode=0&_afrWindowId=null",
g_headers)}function paramToCookie(a){var c=AnyBalance.getLastUrl().match(new RegExp("[?&]"+a+"=([^&]*)"));c&&1<c.length&&AnyBalance.setCookie(g_baseurl.replace(/https?:\/\//i,""),a,c[1],{path:"/ALFAIBSR"})}
function clickFollowUrl(a){for(var c=5;--c;){var b=AnyBalance.requestGet(a,g_headers),e=getParam(b,null,null,/"_afrLoop",\s*"(\d+)"/i);if(!e)break;a=AnyBalance.getLastUrl();b=AnyBalance.requestGet(a+"&_afrLoop="+e+"&_afrWindowMode=0&_afrWindowId=null",g_headers);if(a=getParam(b,null,null,/<div[^>]+id="ct"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))AnyBalance.trace("CSRF token found: "+a),g_csrfToken=a;a=sumParam(b,null,null,/paramToCookie\s*\(\s*['"]([^'"]*)/ig);for(e=0;e<a.length;++e)paramToCookie(a[e]);
a=getParam(b,null,null,/location\.href\s*=\s*'(\/ALFA[^']*)/,replaceSlashes);if(!a)break;a=g_baseurl+a}if(0==c)throw AnyBalance.trace("Не удалось перейти на ссылку: "+b),new AnyBalance.Error("Не удалось перейти на ссылку");return b}
function processCards2(a,c){if(AnyBalance.isAvailable("cards")){AnyBalance.trace("Получаем информацию о картах");a=getMainPageOrModule2(a,"card");var b=getElements(a,/<table[^>]+card-list/ig);if(!b.length)if(/Удобство пластиковых карт:/i.test(a))AnyBalance.trace("Нет ни одной карты");else{AnyBalance.trace("Не удалось найти карты\n"+a);return}c.cards=[];AnyBalance.trace("Найдено карт: "+b.length);for(var e=0;e<b.length;++e){var g=b[e],d=getParam(g,/\*{4}([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),f=getParam(g,
/<a[^>]+style="[^"]*display:\s*inline;[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),d={__id:d,__name:f+" ("+d+")"};__shouldProcess("cards",d)&&processCard2(a,g,d);c.cards.push(d)}}}
function processCard2(a,c,b){c=getParam(c,/\*{4}[\s\S]*?<a[^>]+id="([^"]*)/i,replaceHtmlEntities);a=getNextPage(a,c,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]);getParam(a,b,"cards.balance",/&#1041;&#1072;&#1083;&#1072;&#1085;&#1089; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.currency cards.balance cards.topay cards.debt cards.minpay cards.penalty cards.late cards.overdraft cards.limit".split(" "),
/&#1041;&#1072;&#1083;&#1072;&#1085;&#1089; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"cards.till",/&#1057;&#1088;&#1086;&#1082; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(a,b,"cards.num",/&#1053;&#1086;&#1084;&#1077;&#1088;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,["cards.type","cards.credit"],
/&#1058;&#1080;&#1087;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("cards.credit")&&(b.credit=/кредитн/i.test(""+b.type));getParam(a,b,"cards.acctype",/&#1053;&#1072;&#1079;&#1074;&#1072;&#1085;&#1080;; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"cards.holder",/&#1056;&#1072;&#1076;&#1099; &#1042;&#1072;&#1089; &#1074;&#1080;&#1076;&#1077;&#1090;&#1100;,([^<(]*)/i,replaceTagsAndSpaces);getParam(a,
b,"cards.status",/&#1057;&#1090;&#1072;&#1090;&#1091;&#1089;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"cards.accnum",/&#1053;&#1086;&#1084;&#1077;&#1088; &#1089;&#1095;&#(?:1077|1105);&#1090;&#1072;<[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("cards.transactions")&&processCardTransactions(a,b)}
function processAccounts2(a,c){if(AnyBalance.isAvailable("accounts")){AnyBalance.trace("Получаем информацию о счетах");a=getMainPageOrModule2(a,"acc");var b=getElements(a,/<table[^>]+class="accounts_table"[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено счетов: "+b.length);c.accounts=[];for(var e=0;e<b.length;e++){var g=b[e],d=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),
d={__id:d,__name:f+" ("+d.substr(-4)+")"};__shouldProcess("accounts",d)&&processAccount2(a,g,d);c.accounts.push(d)}}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти ни одного счета")}}function n2(a){return 10>a?"0"+a:""+a}
function processAccount2(a,c,b){c=getElements(c,/<td[^>]*>/ig);getParam(c[4],b,["accounts.currency","accounts.balance"],null,replaceTagsAndSpaces);getParam(c[3],b,"accounts.balance",null,replaceTagsAndSpaces,parseBalance);getParam(c[0],b,"accounts.type",null,replaceTagsAndSpaces);getParam(c[1],b,"accounts.num",null,replaceTagsAndSpaces);AnyBalance.isAvailable("accounts.date_start","accounts.transactions","accounts.own","accounts.limit","accounts.blocked")&&(c=getParam(c[0],null,null,/<a[^>]+id="([^"]*)/i,
replaceTagsAndSpaces),a=getNextPage(a,c,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]),getParam(a,b,"accounts.own",/&#1058;&#1077;&#1082;&#1091;&#1097;&#1080;&#1081; &#1073;&#1072;&#1083;&#1072;&#1085;&#1089;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"accounts.limit",/&#1054;&#1074;&#1077;&#1088;&#1076;&#1088;&#1072;&#1092;&#1090;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(a,
b,"accounts.date_start",/&#1044;&#1072;&#1090;&#1072; &#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1080;&#1103; &#1089;&#1095;&#1105;&#1090;&#1072;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"accounts.blocked",/&#1047;&#1072;&#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1086; &#1089;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),AnyBalance.isAvailable("accounts.transactions")&&
processAccountTransactions(a,b))}function createParams(a,c){for(var b={},e=0;e<a.length;++e)a[e]&&(b[a[e][0].replace(/%EVENT%/g,c)]=a[e][1].replace(/%EVENT%/g,c));return b}
function getMainPageOrModule2(a,c){var b={card:"pt1:menu:ATP2_r1:0:i1:1:cl2",acc:"pt1:menu:ATP2_r1:0:i1:0:cl2",dep:"pt1:menu:ATP2_r1:0:i1:3:cl2",crd:"pt1:menu:ATP2_r1:0:i1:2:cl2",providers:"pt1:menu:ATP2_r1:0:i1:6:cl2"};return getNextPage(a,b[c]?b[c]:c,[["oracle.adf.view.rich.RENDER","pt1:menu:ATP2_r1"],["oracle.adf.view.rich.DELTAS","{pt1:menu:ATP2_r1:0:i1:3:p1={_shown=}}"],["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PROCESS","pt1:menu:ATP2_r1"]])}
function parseScriptTag(a){var c=getParam(a,null,null,/^\s*<!\[CDATA\[([\s\S]*)?\]\]>\s*$/i);return c?c:html_entity_decode(a)}
function getNextPage(a,c,b,e){var g=getParam(a,null,null,/<form[^>]*name="f1"[^>]*>([\s\S]*?)<\/form>/i),d=getParam(a,null,null,/<form[^>]*name="f1"[^>]*action="(\/ALFAIBSR[^"]*)/i,replaceHtmlEntities);if(!d)throw new AnyBalance.Error("Не удаётся найти форму ввода команды. Сайт изменен?");e||(e={});g=createFormParams(g,function(a,b,c,d){if(!/::input$/.test(c))return e.paramsFunc&&(d=e.paramsFunc(a,b,c,d)),d},!0);c=createParams(joinArrays(g,b),c);d=AnyBalance.requestPost(g_baseurl+d,c,addHeaders(e.headers||
{"Adf-Ads-Page-Id":g_pageID,"Adf-Rich-Message":"true","Csrf-Token":g_csrfToken}),{options:e.requestOptions});if(!/<\?Adf-Rich-Response-Type\s*\?>/i.test(d))return d;var f;e.withScripts&&(f=create_aggregate_join("\n"),f=sumParam(d,null,null,/<script>([\s\S]*?)<\/script>/ig,null,parseScriptTag,f));c=sumParam(d,null,null,/<fragment>\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*<\/fragment>/ig);for(b=0;b<c.length;b++){var g=c[b],h=getParam(g,null,null,/^\s*<[^>]+[\s"]id="([^"]*)/i,replaceHtmlEntities);if("afr::DocWrapper"==
h){a=g;break}h=getElement(a,new RegExp('<\\w+[^>]*[\\s"]id="'+h+'"[^>]*>',"i"));a=a.replace(h,g)}/<div[^>]+id="pt1:menu:ATP2_r1"[^>]*>/i.test(a)&&(g_mainHtml=a);d=getParam(d,null,null,/AdfPage.PAGE._setPageId\('([^']*)/i,replaceSlashes);isset(d)&&(g_pageID=d);return e.withScripts?{html:a,scripts:f}:a}
function processCredits2(a,c){if(AnyBalance.isAvailable("credits")){AnyBalance.trace("Получаем информацию о кредитах");a=getMainPageOrModule2(a,"crd");var b=getElements(a,/<a[^>]+id="[^"]*::disAcr"[^>]*>/ig);if(b){AnyBalance.trace("Кредитов в системе: "+b.length);c.credits=[];for(var e=0;e<b.length;++e){var g=a;if(0<e){AnyBalance.trace("Запрос кредита №"+(e+1));var d=getParam(b[e],null,null,/<a[^>]+id="([^"]*)::disAcr"/i,replaceHtmlEntities),g=getNextPage(a,d,[["event","%EVENT%"],["event.%EVENT%",
'<m xmlns="http://oracle.com/richClient/comm"><k v="expand"><b>1</b></k><k v="type"><s>disclosure</s></k></m>'],["oracle.adf.view.rich.PROCESS","pt1:r12:0:pt2"]])}d=getParam(g,null,null,/<a[^>]+id="([^"]*)"[^>]*>&#1055;&#1086;&#1076;&#1088;&#1086;&#1073;&#1085;&#1072;&#1103; &#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;/i);if(!d)throw AnyBalance.trace(g),new AnyBalance.Error("Не удаётся найти ссылку на подробную информацию о кредите!",{investigate:!0});AnyBalance.trace("Запрос данных по кредиту №"+
(e+1));var g=getNextPage(g,d,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]),d=getParam(g,null,null,/\d{20}/i),f=getParam(b[e],null,null,null,replaceTagsAndSpaces),d={__id:d,__name:f};__shouldProcess("credits",d)&&processCredit2(g,d);c.credits.push(d)}}else AnyBalance.trace("Не удаётся найти ни одного кредита!")}}
function parseNDay(a){var c=getParam(a,null,null,/(\d+)[^<]*число/i,null,parseBalance);if(isset(c)){var b=new Date,c=new Date(b.getFullYear(),b.getMonth()+(b.getDate()>c?1:0),c);AnyBalance.trace("Parsed date "+c+" from "+a);return c.getTime()}}
function processCredit2(a,c){for(var b=getElements(a,/<table[^>]+pglCreditDetails(?:Label)?List[^>]*/ig),e=!1,g=0;g<b.length;g++){var d=b[g],f=getElements(d,/<td[^>]*>/ig);if(!(2>f.length)){var h=getParam(f[f.length-2],null,null,null,replaceTagsAndSpaces),f=getParam(f[f.length-1],null,null,null,replaceTagsAndSpaces);/Для полного погашения|Доступно для трат/i.test(h)?(getParam(f,c,"credits.balance",null,null,parseBalance),getParam(f,c,["credits.currency","credits.balance"],null,null,parseCurrency)):
/Собственных средств/i.test(h)?getParam(f,c,"credits.own",null,null,parseBalance):/Задолженность|Остаток задолженности|Для полного погашения/i.test(h)?getParam(f,c,"credits.debt",null,null,parseBalance):/сумма основного долга/i.test(h)&&!e?getParam(f,c,"credits.debt_main",null,null,parseBalance):/сумма начисленных процентов/i.test(h)&&!e?getParam(f,c,"credits.debt_pct",null,null,parseBalance):/Процентная ставка/i.test(h)?getParam(f,c,"credits.pct",null,null,parseBalance):/Установленный лимит|Начальная сумма кредита/i.test(h)?
getParam(f,c,"credits.limit",null,null,parseBalance):/Неподтверждённые операции/i.test(h)?getParam(f,c,"credits.blocked",null,null,parseBalance):/Льготный период/i.test(h)?getParam(f,c,"credits.gracepay",null,null,parseBalance):/Дата начала льготного периода/i.test(h)?getParam(f,c,"credits.grace_start",null,null,parseDateWord):/Дата окончания льготного периода/i.test(h)?getParam(f,c,"credits.gracepay_till",null,null,parseDateWord):/дата платежа|Оплатить до/i.test(h)?getParam(f,c,"credits.pay_till",
null,null,parseDateWord):/Ближайший плат[её]ж|Минимальный плат[её]ж|Ежемесячный плат[её]ж/i.test(h)?(e=!0,getParam(f,c,["credits.minpay","credits.minpay_left"],null,null,parseBalance)):"основной долг"==h&&e?getParam(f,c,"credits.minpay_main",null,null,parseBalance):"проценты"==h&&e?getParam(f,c,"credits.minpay_pct",null,null,parseBalance):/Дата выдачи/i.test(h)?getParam(f,c,"credits.date_start",null,null,parseDateWord):/Срок кредита/i.test(h)?getParam(f,c,"credits.period"):/День платежа/i.test(h)?
(getParam(f,c,"credits.payment_day"),getParam(f,c,"credits.minpay_till",null,null,parseNDay)):/Уже внесено/i.test(h)?getParam(f,c,["credits.minpay_paid","credits.minpay_left"],null,null,parseBalance):AnyBalance.trace("Неизвестный параметр: "+h+": "+f+"\n"+d)}}getParam(a,c,"credits.minpay_left",/<span[^>]+ACCreditsLargeHeaderFont[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);AnyBalance.isAvailable("credits.transactions")&&processCreditTransactions(a,c)}
function processInfo2(a,c){if(AnyBalance.isAvailable("info")){AnyBalance.trace("Получаем информацию о пользователе");c=c.info={};getParam(a,c,"info.mphone",/<div[^>]*>([^<]*)<div[^>]+id="[^"]*mymobilePopup/i,replaceTagsAndSpaces);a=clickFollowUrl("https://settings.alfabank.ru/settings/profile");var b=getJsonObject(a,/window.initialState\s*=\s*JSON.parse\s*\(\s*'/);if(!b)throw AnyBalance.trace("Не удалось получить json с именем: "+a),new AnyBalance.Error("Не удалось получить json с именем, сайт изменен?");
a=create_aggregate_join(" ");sumParam(jspath1(b,"$.profileInfo.customer.lastName"),c,"info.fio",null,null,null,a);sumParam(jspath1(b,"$.profileInfo.customer.firstName"),c,"info.fio",null,null,null,a);sumParam(jspath1(b,"$.profileInfo.customer.middleName"),c,"info.fio",null,null,null,a);getParam(jspath1(b,"$.profileInfo.customer.email"),c,"info.email");if(AnyBalance.isAvailable("info.mphone","info.rphone","info.wphone","info.hphone","info.login","info.login2","info.check","info.mobile")){a=AnyBalance.requestGet("https://settings.alfabank.ru/settings/api/load?_="+
(new Date).getTime(),g_headers);b=getJson(a);getParam(jspath1(b,"$[*].contacts.clickPhone"),c,"info.mphone");getParam(jspath1(b,"$[*].contacts.registrationPhone"),c,"info.rphone");getParam(jspath1(b,"$[*].contacts.workPhone"),c,"info.wphone");getParam(jspath1(b,"$[*].contacts.homePhone"),c,"info.hphone");getParam(jspath1(b,'$[*].channels[?(@.id=="C2")].login'),c,"info.login");getParam(jspath1(b,'$[*].channels[?(@.id=="C2")].alternativeLogin'),c,"info.login2");if((a=jspath(b,"$[*].cards[?(@.alfaCheck.enabled==true)]"))&&
AnyBalance.isAvailable("info.check")){for(var e=[],g=0;g<a.length;g++){var d=a[g],f={};getParam(jspath1(d,"$.maskedNumber"),f,"info.check.card");getParam(jspath1(d,"$.alfaCheck.phone"),f,"info.check.phone");e.push(f)}c.check=e}getParam(!jspath1(b,'$[*].channels[?(@.id=="M2")].isBlocked'),c,"info.mobile")}}}
function processDeposits2(a,c){if(AnyBalance.isAvailable("deposits")){AnyBalance.trace("Получаем информацию о депозитах");a=getMainPageOrModule2(a,"dep");var b=sumParam(a,null,null,/<table[^>]+(?:[\s\S](?!<\/?table))*?>\d{20}<[\s\S]*?<\/table>/ig);if(!b.length)if(/Депозиты в банке, как и накопительные/i.test(a))AnyBalance.trace("Нет ни одного депозита");else{AnyBalance.trace("Не удалось найти депозиты: "+a);return}AnyBalance.trace("Найдено депозитов: "+b.length);c.deposits=[];for(var e=0;e<b.length;e++){var g=
b[e],d=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency),d={__id:f,__name:d+" "+h+" ("+f.substr(-4)+")"};h||AnyBalance.trace("Не удалось получить баланс и валюту для депозита "+d.__name+": "+g);__shouldProcess("deposits",d)&&processDeposit2(a,g,d);c.deposits.push(d)}}}
function parseBool(a){return/Не предусмотрена/i.test(a)?!1:/Да/i.test(a)}
function processDeposit2(a,c,b){AnyBalance.trace("Получаем депозит "+b.__name);getParam(c,b,"deposits.acctype",/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,b,"deposits.accnum",/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,b,"deposits.balance",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"deposits.currency",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(c,
b,"deposits.till",/>\s*&#1044;&#1086; (\d+[^>]*<)/i,replaceTagsAndSpaces,parseDateWord);if(AnyBalance.isAvailable("deposits.expressnum","deposits.balance_start","deposits.pct_sum","deposits.date_start","deposits.period","deposits.pct","deposits.pct_cap","deposits.topup","deposits.topup_till","deposits.topup_min","deposits.withdraw","deposits.balance_min","deposits.pct_conditions","deposits.prolongate")){c=getParam(c,null,null,/<a[^>]+id="([^"]*)"[^>]*p_AFTextOnly/i,replaceHtmlEntities);a=getNextPage(a,
c,[["event","%EVENT%"],["event.%EVENT%",g_some_action],["oracle.adf.view.rich.PPR_FORCED","true"]]);c=getElements(a,/<tr[^>]+id="pt\d+:plam\d+[^>]*>/ig);for(var e=0;e<c.length;e++){var g=c[e],d=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);/Экспресс-счёт/i.test(d)?getParam(f,b,"deposits.expressnum"):/Сумма на дату открытия/i.test(d)?getParam(f,b,"deposits.balance_start",
null,null,parseBalance):/Сумма выплаченных процентов/i.test(d)?getParam(f,b,"deposits.pct_sum",null,null,parseBalance):/Дата открытия/i.test(d)?getParam(f,b,"deposits.date_start",null,null,parseDateWord):/Срок депозита/i.test(d)?getParam(f,b,"deposits.period",null,null,parseBalance):/Процентная ставка$/i.test(d)?getParam(f,b,"deposits.pct",null,null,parseBalance):/Процентная ставка с учетом капитализации/i.test(d)?getParam(f,b,"deposits.pct_cap",null,null,parseBalance):/Возможность пополнения/i.test(d)?
getParam(f,b,"deposits.topup",null,null,parseBool):/Крайний срок пополнения/i.test(d)?getParam(f,b,"deposits.topup_till",null,null,parseDateWord):/Минимальная сумма пополнения/i.test(d)?getParam(f,b,"deposits.topup_min",null,null,parseBalance):/Возможность частичного снятия/i.test(d)?getParam(f,b,"deposits.withdraw",null,null,parseBool):/Сумма неснижаемого остатка/i.test(d)?getParam(f,b,"deposits.balance_min",null,null,parseBalance):/Условие начисления процентов/i.test(d)?getParam(f,b,"deposits.pct_conditions"):
/Автоматическая пролонгация/i.test(d)?getParam(f,b,"deposits.prolongate",null,null,parseBool):/Текущий баланс|Депозитный счёт|Дата окончания/i.test(d)||AnyBalance.trace("Неизвестный параметр "+d+": "+f+"\n"+g)}}AnyBalance.isAvailable("deposits.transactions")&&processDepositTransactions(a,b)}
function turnOffLoginOtp(){try{for(var a=AnyBalance.requestGet("https://settings.alfabank.ru/settings/logins-passwords",g_headers),c=AnyBalance.getLastUrl(),a=AnyBalance.requestGet("https://settings.alfabank.ru/settings/api/load?_="+(new Date).getTime(),addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),b=getJson(a),e=0;e<b.length;++e)if(b[e].channels){b=b[e];break}for(var g=!1,e=0;b.channels&&e<b.channels.length;++e){var d=b.channels[e];if("C2"===d.id){g=!0;d.hasAdditionalLoginPassword?
(AnyBalance.trace("В настройках требуется подтверждение входа по SMS, отключаем..."),a=AnyBalance.requestPost("https://settings.alfabank.ru/settings/api/entry-method/save",{entryMethod:"WITHOUT_SMS"},addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),b=getJson(a),AnyBalance.requestPost("https://settings.alfabank.ru/settings/api/pipe-operation",{"authMethod[methodId]":b.authMethods[0].methodId,"authMethod[passwordSize]":b.authMethods[0].passwordSize||"",operationId:b.references[0],type:"GENERATE_PASSWORD"},
addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),AnyBalance.requestPost("https://settings.alfabank.ru/settings/api/pipe-operation",{operationId:b.references[0],isBundle:"false","references[]":b.references.join(","),password:"",type:"CONFIRM"},addHeaders({Referer:c,"X-Requested-With":"XMLHttpRequest"})),AnyBalance.trace("Может быть, отключили...")):AnyBalance.trace("Подтверждение входа по SMS не требуется...");break}}g||AnyBalance.trace("Не удалось найти настройку SMS при входе")}catch(f){AnyBalance.trace("Ошибка отключения OTP при входе: "+
f.message)}};
