var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.110 Safari/537.36"},baseurl="https://online.baitushum.kg/WWWCOR/";
function login(){var b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl+"Start.aspx",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");/act=login/i.test(a)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):(a=AnyBalance.requestGet(baseurl+
"StartPwdFiz.aspx?LNG=RU",g_headers),a=getParamByName(a,["__VIEWSTATE","__EVENTARGUMENT"]),a.__EVENTTARGET="Button1",a=AnyBalance.requestPost(baseurl+"StartPwdFiz.aspx?LNG=RU",a,g_headers),a=getElement(a,/<form[^>]+name="mainForm"[^>]*>/i),a=createFormParams(a,function(a,c,f,g){return"edUserLogin"==f?b.login:"edPassword"==f?b.password:g}),a=AnyBalance.requestPost(baseurl+"LoginNewFiz.aspx",a,addHeaders({Referer:baseurl+"LoginNewFiz.aspx"})));if(!/act=login/i.test(a)){var c=getParam(a,null,null,/<td[^>]+clserror[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces);if(c)throw new AnyBalance.Error(c,null,/Неправильно введено имя пользователя или пароль/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return a}
function processAccounts(b,a){if(AnyBalance.isAvailable("accounts")){var c=getElements(b,/<tr[^>]+accr[^>]*>/g);if(c.length){AnyBalance.trace("Найдено счетов: "+c.length);a.accounts=[];for(var d=0;d<c.length;++d){var e=getParam(c[d],null,null,/<a[^>]*>([^<]*)/i),f=getParam(c[d],null,null,/<a[^>]*>([^<]*)/i),g=getParam(c[d],null,null,/<td[^>]+accname[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("accounts",e)&&processAccount(c[d],e);a.accounts.push(e)}}else AnyBalance.trace(b),
AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(b,a){AnyBalance.trace("Обработка счета "+a.__id);getParam(b,a,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,null,parseBalance);getParam(b,a,"accounts.available",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,null,parseBalance);getParam(b,a,"accounts.last_movement",/(?:[\s\S]*?<td[^>]*>){9}([\s\S]*?)<\/td>/i,null,parseDate);getParam(b,a,"accounts.currency",/<td[^>]+AccBalance[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.status",/(?:[\s\S]*?<td[^>]*>){10}([\s\S]*?)<\/td>/i,
null);AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,a)}
function processCards(b,a){if(AnyBalance.isAvailable("cards")){b=findParams(b,["Задачи","Пластиковые карты"]);var c=getElement(b,/<table[^>]+tblValuesList[^>]*>/i),c=getElements(c,/<tr[^>]*>/ig);if(c.length){AnyBalance.trace("Найдено карт: "+(c.length-1));a.cards=[];for(var d=1;d<c.length;++d){var e=getParam(c[d],null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(c[d],null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),g=getParam(c[d],null,
null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("cards",e)&&processCard(c[d],e,b);a.cards.push(e)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти карты.")}}
function processCard(b,a,c){AnyBalance.trace("Обработка карты "+a.__name);getParam(b,a,"cards.status",/(?:[\s\S]*?<td[^>]*>){8}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.currency",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.accnum",/(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.name_on_card",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.till",/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseDate);var d=AnyBalance.requestGet(baseurl+"Reports/cardinfo.aspx?P1="+a.__id,addHeaders({Referer:baseurl+"Common/Reference/BaseListRefer.aspx"}));getParam(d,a,"cards.acc_owner",/Владелец счета(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(d,a,"cards.card_holder",/Держатель карты(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(d,a,"cards.card_product",/Карточный продукт(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);
getParam(d,a,"cards.date_start",/Дата выдачи(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(d,a,"cards.balance",/Доступная сумма с учетом кредитного лимита(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);isAvailable("cards.transactions")&&processCardTransactions(c,b,a)}function processDeposits(b,a){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processCredits(b,a){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processInfo(b,a){var c=a.info={};getParam(b,c,"info.fio",/<span[^>]+HLVC_lblUser[^>]*>([^<]*)/i,replaceTagsAndSpaces)}function getParamByName(b,a){a=isArray(a)?a:[a];for(var c={},d=0;d<a.length;d++)c[a[d]]=getParam(b,null,null,new RegExp("name=[\"']"+a[d]+'["\'][^>]*value=["\']([^"\']+)"',"i"))||"";return c}
function findParams(b,a){a=isArray(a)?a:[a];for(var c=0;c<a.length;c++){var d=new RegExp('<a[^>]+id="([^"]*)"[^>]*>'+a[c],"i"),e=getParamByName(b,["__VIEWSTATE","HVC:lP","HVC:srvurl"]);e.__EVENTTARGET=getParam(b,null,null,d);e.__EVENTARGUMENT="";e.edMessage="";b=AnyBalance.requestPost(baseurl+"Start.aspx",e,addHeaders({Referer:baseurl+"Start.aspx"}))}return b};
