var g_headers={Accept:"application/json","User-Agent":"OkHttp Headers.java","Content-Type":"text/xml;charset=UTF-8",Connection:"Keep-Alive"},baseurl="https://mobile.bps-sberbank.by:7001/",g_soapRequests={header:'<env:Header>\n    <n0:Security\n        xmlns:n0="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">\n        <n0:UsernameToken>\n            <n0:Username>%LOGIN%</n0:Username>\n            <n0:Password>%PASSWORD%</n0:Password>\n        </n0:UsernameToken>\n    </n0:Security>\n    <n1:DeviceUDID xmlns:n1="http://www.SoftClub.by/mobile">%DEVICEID%</n1:DeviceUDID>\n    <n2:ApplicID xmlns:n2="http://www.SoftClub.by/mobile">%VERSION%</n2:ApplicID>\n    <n3:lang xmlns:n3="http://www.SoftClub.by/mobile">ru</n3:lang>\n    <n4:clientKind xmlns:n4="http://www.SoftClub.by/mobile">0</n4:clientKind>\n</env:Header>',
accounts:{url:"by.softclub.services.mobile.sc.ifx.retail-1.0/AccountWS",body:'<env:Envelope xmlns:acc="http://www.softclub.by/neteller/account"\n    xmlns:env="http://schemas.xmlsoap.org/soap/envelope/">\n    %HEADER%\n    <env:Body>\n        <acc:getUserAccountsOverview>\n            <typeProductRequest>\n                <cardAccount />\n                <depoAccount />\n                <creditAccount />\n            </typeProductRequest>\n        </acc:getUserAccountsOverview>\n    </env:Body>\n</env:Envelope>',
action:"/by.softclub.services.mobile.sc.ifx.retail-1.0/AccountWS?wsdl"},login:{url:"ClientIdAndNameByLg-scws-context-root/GetClientIdAndNamePort",body:'<env:Envelope xmlns:cus="http://www.softclub.by/neteller/customer"\n    xmlns:env="http://schemas.xmlsoap.org/soap/envelope/">\n    %HEADER%\n    <env:Body>\n        <cus:User>\n            <cus:LOGIN_NAME>%LOGIN%</cus:LOGIN_NAME>\n            <cus:CLIENT_TYPE>0</cus:CLIENT_TYPE>\n        </cus:User>\n    </env:Body>\n</env:Envelope>',action:"GetClientIdAndNameBind/GetClientIdAndNameMethod"},
cardBalance:{url:"by.softclub.services.mobile.komplat.ex-1.0/KomplatWebServiceEx",body:'<?xml version="1.0" encoding="utf-8"?>\n<env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/">\n    %HEADER%\n    <env:Body>\n        <excuteRequestClobElement xmlns="http://komplat/KomplatWebService/srvs/types/">\n            <pRequest><![CDATA[<?xml version="1.0" encoding="Windows-1251" standalone="yes"?>\n                <BS_Request>\n                <Version>2070</Version>\n                <RequestType>Balance</RequestType>\n                <ClientId IdType="MS">%CARDHASH%</ClientId>\n                <AuthClientId IdType="MS">%CARDHASH%</AuthClientId>\n                <TerminalTime>%CURTIME%</TerminalTime>\n                <TerminalId>SCMOBILE</TerminalId>\n                <TerminalCapabilities>\n                <AnyAmount>Y</AnyAmount>\n\t\t <LongParameter>Y</LongParameter>\n                <ScreenWidth>99</ScreenWidth>\n                <CheckWidth DoubleHeightSymbol="Y" DoubleWidthSymbol="N" InverseSymbol="Y">40</CheckWidth>\n                </TerminalCapabilities>\n                <Balance Currency="%CURRENCY_NUM%">\n                \n\t\t<AuthorizationDetails Count="1">\n                <Parameter Idx="1" Name="Срок действия карточки"></Parameter>\n                </AuthorizationDetails>\n                </Balance>\n                </BS_Request>\n            ]]\x3e</pRequest>\n            <pSessionId />\n            <pSupplieroperid />\n            <pErrorCode_inout />\n            <pCardNumber />\n            <pCardExpDate />\n        </excuteRequestClobElement>\n    </env:Body>\n</env:Envelope>',
action:"http://SoftClub.by/DoIFX180"}};function makeRequest(a,b,c){c=c||g_soapRequests;a=c[a];c=a.body.replace(/%HEADER%/g,c.header);for(var d in b)c=c.replace(new RegExp("%"+d+"%","g"),(""+b[d]).replace("<","&lt;"));return AnyBalance.requestPost(baseurl+a.url,c,addHeaders({SOAPAction:a.action}))}var g_baseparams;
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");g_baseparams={LOGIN:a.login,PASSWORD:a.password,DEVICEID:hex_md5(a.login).substr(0,16),VERSION:"v2.35"};var a=makeRequest("login",g_baseparams),b=getElement(a,/<(?:faultcode|errorcode)>/i,replaceTagsAndSpaces);if("0"!=b){var c=getElement(a,/<(?:faultstring|errortext)>/i,replaceTagsAndSpaces);if(c)throw new AnyBalance.Error(c,null,/парол|не зарегистрирован/i.test(c));
AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк (ошибка "+b+"). Сайт изменен?");}__setLoginSuccessful();return a}function getProducts(){getProducts.products||(getProducts.products=makeRequest("accounts",g_baseparams));return getProducts.products}
function processAccounts(a,b){if(AnyBalance.isAvailable("accounts")){a=getProducts();var c=getElement(a,/<cardAccounts[^>]*>/i);if(c)for(c=getElements(c,/<cardAccount[^>]*>/ig),AnyBalance.trace("Найдено "+c.length+" счетов"),b.accounts=[],a=0;a<c.length;++a){var d=c[a],e=getElement(d,/<accountId[^>]*>/i,replaceTagsAndSpaces),g=getElement(d,/<additionalAccountId[^>]*>/i,replaceTagsAndSpaces),f=getElement(d,/<depoAccountInfo[^>]*>/i),f=getElement(f,/<name[^>]*>/i,replaceTagsAndSpaces),h=f+" "+g.substr(-4),
e={__id:e,__name:h,num:g,name:f};__shouldProcess("accounts",e)&&processAccount(d,e);b.accounts.push(e)}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти карточные счета")}}
function requestCardBalance(a,b){var c=requestCardBalance.hashes||{};if(c[a])return c[a];var d=new Date;b=joinObjects(g_baseparams,{CARDHASH:a,CURRENCY_NUM:b,CURTIME:""+d.getFullYear()+n2(d.getMonth()+1)+n2(d.getDate())+n2(d.getHours())+n2(d.getMinutes())+n2(d.getSeconds())});b=makeRequest("cardBalance",b);b=getElement(b,/<ns2:result[^>]*>/i,replaceTagsAndSpaces);AnyBalance.trace("Got card response: "+b);c[a]=b;requestCardBalance.hashes=c;return b}
function processAccount(a,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(a,b,"accounts.type",/<accountType[^>]*>([\s\S]*?)<\/accountType>/i,replaceTagsAndSpaces);getParam(a,b,"accounts.status",/<status[^>]*>([\s\S]*?)<\/status>/i,replaceTagsAndSpaces);getParam(a,b,["accounts.currency","accounts.balance"],/<currency[^>]*>([\s\S]*?)<\/currency>/i,replaceTagsAndSpaces,CurrencyISO.digitsToLetters);getParam(a,b,"accounts.date_start",/<openDate[^>]*>([\s\S]*?)<\/openDate>/i,replaceTagsAndSpaces,
parseDateISO);getParam(a,b,"accounts.pct",/<percentRate[^>]*>([\s\S]*?)<\/percentRate>/i,replaceTagsAndSpaces,parseBalance);if(AnyBalance.isAvailable("accounts.balance")){var c=getElement(a,/<cardHash[^>]*>/i,replaceTagsAndSpaces);c?(a=getElement(a,/<currency[^>]*>/i,replaceTagsAndSpaces),c=requestCardBalance(c,a),getParam(c,b,"accounts.balance",/<Amount[^>]*>([\s\S]*?)<\/Amount>/i,replaceTagsAndSpaces,parseBalance)):AnyBalance.trace("Счет не содержит карт, баланс недоступен")}}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){a=getProducts();var c=getElement(a,/<cardAccounts[^>]*>/i);if(c)for(c=getElements(c,/<cardAccount[^>]*>/ig),AnyBalance.trace("Найдено "+c.length+" карточных счетов"),b.cards=[],a=0;a<c.length;++a){var d=c[a],e=getElement(d,/<accountId[^>]*>/i,replaceTagsAndSpaces),g=getElement(d,/<additionalAccountId[^>]*>/i,replaceTagsAndSpaces),f=getElements(d,/<card\b[^>]*>/ig);AnyBalance.trace("Счет "+g+" содержит "+f.length+" карт");for(var h=0;h<
f.length;++h){var k=f[h],l=getElement(k,/<cardHash[^>]*>/i,replaceTagsAndSpaces),n=getElement(k,/<maskedCard[^>]*>/i,replaceTagsAndSpaces),m=getElement(k,/<personalizedName[^>]*>/i,replaceTagsAndSpaces);m||(m=getParam(k,null,null,/<cardType[^>]*name="([^"]*)/i,replaceHtmlEntities));var p=m+" "+n.substr(-4),l={__id:l,__name:p,num:n,accid:e,accnum:g,name:m};__shouldProcess("cards",l)&&processCard(k,l,d);b.cards.push(l)}}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти карточные счета")}}
function processCard(a,b,c){AnyBalance.trace("Обработка карты "+b.__name);getParam(a,b,"cards.type",/<cardType[^>]*name="([^"]*)/i,replaceHtmlEntities);getParam(a,b,"cards.type_code",/<cardType[^>]*>([\s\S]*?)<\/cardType>/i,replaceTagsAndSpaces);getParam(a,b,"cards.status",/<status[^>]*>([\s\S]*?)<\/status>/i,replaceTagsAndSpaces);getParam(a,b,"cards.till",/<exprireDate[^>]*>([\s\S]*?)<\/exprireDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(c,b,["cards.currency","cards.balance"],/<currency[^>]*>([\s\S]*?)<\/currency>/i,
replaceTagsAndSpaces,CurrencyISO.digitsToLetters);AnyBalance.isAvailable("cards.balance")&&(c=getElement(c,/<currency[^>]*>/i,replaceTagsAndSpaces),c=requestCardBalance(b.__id,c),getParam(c,b,"cards.balance",/<Amount[^>]*>([\s\S]*?)<\/Amount>/i,replaceTagsAndSpaces,parseBalance));isAvailable("cards.transactions")&&processCardTransactions(a,b)}function processDeposits(a,b){AnyBalance.isAvailable("deposits")}
function processDeposit(a,b,c){AnyBalance.trace("Обработка депозита "+b.__name);isAvailable("deposits.transactions")&&processDepositTransactions(a,b)}
function processCredits(a,b){if(AnyBalance.isAvailable("credits")){a=getProducts();var c=getElement(a,/<credits[^>]*>/i);if(c)for(c=getElements(c,/<credit[^>]*>/ig),AnyBalance.trace("Найдено "+c.length+" кредитов"),b.credits=[],a=0;a<c.length;++a){var d=c[a],e=getElement(d,/<contract_id[^>]*>/i,replaceTagsAndSpaces),g=getElement(d,/<contractNumber[^>]*>/i,replaceTagsAndSpaces),f=getElement(d,/<contract_name[^>]*>/i,replaceTagsAndSpaces),h=f+" "+g.substr(-4),e={__id:e,__name:h,num:g,name:f};__shouldProcess("credits",
e)&&processCredit(d,e);b.credits.push(e)}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти кредиты")}}
function processCredit(a,b){AnyBalance.trace("Обработка кредита "+b.__name);getParam(a,b,"credits.status",/<status[^>]*>([\s\S]*?)<\/status>/i,replaceTagsAndSpaces);getParam(a,b,"credits.date_start",/<contract_date[^>]*>([\s\S]*?)<\/contract_date>/i,replaceTagsAndSpaces,parseDateISO);getParam(a,b,"credits.till",/<contract_close_date[^>]*>([\s\S]*?)<\/contract_close_date>/i,replaceTagsAndSpaces,parseDateISO);getParam(a,b,["credits.currency","credits.balance"],/<currency[^>]*>([\s\S]*?)<\/currency>/i,
replaceTagsAndSpaces,CurrencyISO.digitsToLetters);getParam(a,b,"credits.balance",/<residualAmount[^>]*>([\s\S]*?)<\/residualAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.accid",/<relatedAccount[^>]*>([\s\S]*?)<\/relatedAccount>/i,replaceTagsAndSpaces);getParam(a,b,"credits.limit",/<overdraftLimit[^>]*>([\s\S]*?)<\/overdraftLimit>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.pct",/<percRate[^>]*>([\s\S]*?)<\/percRate>/i,replaceTagsAndSpaces,parseBalance);AnyBalance.isAvailable("credits.transactions")&&
processCreditTransactions(a,b)}function processInfo(a,b){b=b.info={};getParam(a,b,"info.fio",/<LAST_NAME[^>]*>([\s\S]*?)<\/LAST_NAME>/i,replaceTagsAndSpaces);getParam(a,b,"info.passport",/<PASSPORT_NUMBER[^>]*>([\s\S]*?)<\/PASSPORT_NUMBER>/i,replaceTagsAndSpaces);getParam(a,b,"info.paidup",/<PAID_UP[^>]*>([\s\S]*?)<\/PAID_UP>/i,replaceTagsAndSpaces,parseBalance)};
