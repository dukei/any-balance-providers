var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36"},baseurl="https://www.centrum24.pl/centrum24-web/";
function login(){var c=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(c.login,"Wpisz NIK!");checkEmpty(c.password,"Wpisz hasło (PIN)!");var b=AnyBalance.requestGet(baseurl+"portfolio",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Error connecting internet-bank! Try again later.");if(/logout/i.test(b))AnyBalance.trace("Already logged in. Reusing previous session.");else{var a=getElement(b,/<form[^>]+id="nikForm"[^>]*>/i);
if(!a)throw AnyBalance.trace(b),new AnyBalance.Error("Could not find NIK form. Is site changed?");b=createFormParams(a,function(a,b,e,d){return"nik"==e?c.login:d});a=getParam(a,null,null,/<form[^>]+action="([^"]*)/i,AB.replaceHtmlEntities);b=AnyBalance.requestPost(joinUrl(baseurl,a),b,addHeaders({Referer:baseurl+"login"}));a=getElement(b,/<form[^>]+id="pinForm"[^>]*>/i);if(!a){if(a=getElement(b,/<li[^>]+feedbackPanelERROR[^>]*>|<div[^>]+logErrorMessage[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error("NIK: "+
a,null,/incorrect|nieprawid|NIK|PIN/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Could not find PIN form. Is site changed?");}b=createFormParams(a,function(a,b,e,d){return"pinFragment:pin"==e?c.password:d});a=getParam(a,null,null,/<form[^>]+action="([^"]*)/i,AB.replaceHtmlEntities);b=AnyBalance.requestPost(joinUrl(baseurl,a),b,addHeaders({Referer:AnyBalance.getLastUrl()}))}if(!/logout/i.test(b)){if(a=getElement(b,/<li[^>]+feedbackPanelERROR[^>]*>|<div[^>]+logErrorMessage[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,
null,/incorrect|nieprawid|NIK|PIN/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Could not log into internet bank. Is the site changed?");}/<li[^>]+id="menu_portfel_24"[^>]+class="selected"/i.test(b)||(AnyBalance.trace("Portfel is not selected. Selecting it explicitly."),b=AnyBalance.requestGet(baseurl+"portfolio",g_headers));__setLoginSuccessful();return b}
function processAccounts(c,b){if(AnyBalance.isAvailable("accounts")){var a=getElement(c,/<div[^>]+avistaAccountsBoxContent[^>]*>/i);if(a)if(a=getElement(a,/<tbody[^>]*>/i),a=getElements(a,/<tr[^>]*>/ig),a.length){AnyBalance.trace("Найдено счетов: "+a.length);b.accounts=[];for(var f=0;f<a.length;++f){var g=a[f],e=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i),d=getElement(e,/<em[^>]*>/i,replaceTagsAndSpaces),e=getElement(e,/<a[^>]*>/i,replaceTagsAndSpaces),d={__id:d,__name:e+" "+
d.substr(-4),num:d,name:e};__shouldProcess("accounts",d)&&processAccount(g,d);b.accounts.push(d)}}else AnyBalance.trace("У вас нет счетов"),b.accounts=[];else AnyBalance.trace(c),AnyBalance.trace("You possibly do not have accounts")}}
function processAccount(c,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(c,b,"accounts.available",/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,["accounts.currency","accounts.balance","accounts.available"],/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);if(AnyBalance.isAvailable("accounts.limit","accounts.pct",
"accounts.last_transaction_date")){var a=getParam(getElements(c,[/<a[^>]+>/ig,/Szczegóły|Details|Detalles/i])[0],null,null,/<a[^>]+href="([^"]*)/i,replaceHtmlEntities),a=AnyBalance.requestGet(baseurl+"portfolio"+a,g_headers);getParam(a,b,"accounts.limit",/(?:Credit limit|Limit kredytowy|Límite de crédito)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"accounts.pct",/(?:Interest rate|Oprocentowanie|Tasa de interés)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,
parseBalance);getParam(a,b,"accounts.last_transaction_date",/(?:Last transaction date|Data ostatniej operacji|Fecha de última operación)[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDateISO)}AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(c,b)}
function processCards(c,b){if(AnyBalance.isAvailable("cards")){c=AnyBalance.requestGet(baseurl+"cards",g_headers);var a=getElement(c,/<div[^>]+debitCardsBoxContent[^>]*>/i);if(a)if(a=getElement(a,/<tbody[^>]*>/i),a=getElements(a,/<tr[^>]*>/ig),a.length){AnyBalance.trace("Найдено карт: "+a.length);b.cards=[];for(var f=0;f<a.length;++f){var g=a[f],e=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i),d=getElement(e,/<em[^>]*>/i,replaceTagsAndSpaces),e=getElement(e,/<a[^>]*>/i,replaceTagsAndSpaces),
h=getParam(g,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i),h=getParam(h,null,null,/<br[^>]*>([\s\S]*)/i,replaceTagsAndSpaces),d={__id:h,__name:e+" "+h.substr(-4),num:h,name:e,accnum:d};__shouldProcess("cards",d)&&processCard(g,d);b.cards.push(d)}}else AnyBalance.trace("У вас нет счетов"),b.accounts=[];else AnyBalance.trace(c),AnyBalance.trace("You possibly do not have debit cards")}}
function processCard(c,b){AnyBalance.trace("Обработка карты "+b.__name);getParam(c,b,["cards.currency","cards.balance","cards.available"],/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("cards.holder","cards.status")){var a=getParam(getElements(c,[/<a[^>]+>/ig,/Szczegóły|Details|Detalles/i])[0],null,null,/<a[^>]+href="([^"]*)/i,replaceHtmlEntities),a=AnyBalance.requestGet(baseurl+"portfolio"+a,g_headers);getParam(a,b,"cards.holder",/(?:Name and surname|Imię i nazwisko|Nombre y apellido):[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces);getParam(a,b,"cards.status",/(?:Status|Estado):[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)}AnyBalance.isAvailable("cards.transactions")&&processCardTransactions(c,b)}function processDeposits(c,b){AnyBalance.isAvailable("deposits")}function processDeposit(c,b,a){AnyBalance.trace("Обработка депозита "+b.__name)}function processCredits(c,b){AnyBalance.isAvailable("credits")}
function processCredit(c,b,a){AnyBalance.trace("Обработка кредита "+b.__name);AnyBalance.isAvailable("credits.transactions")&&processCreditTransactions(c,b);AnyBalance.isAvailable("credits.schedule")&&processCreditSchedule(c,b)}
function processInfo(c,b){c=AnyBalance.requestGet(baseurl+"yourData",g_headers);var a=b.info={},f=getElement(c,/<select[^>]+mobilePhoneNumberPanel:phoneNumberPrefix[^>]*>/i),f=getElement(f,/<option[^>]+selected[^>]*>/i,replaceTagsAndSpaces),g=create_aggregate_join("");sumParam(f,a,"info.mphone",/\(([^)]*)\)/,null,null,g);sumParam(c,a,"info.mphone",/<input[^>]*mobilePhoneNumberPanel:phoneNumber\b[^>]*value="([^"]*)/,replaceTagsAndSpaces,null,g);getParam(c,a,"info.email",/<input[^>]*emailMailInpBorder:emailMailInp\b[^>]*value="([^"]*)/,
replaceTagsAndSpaces);getParam(c,a,"info.fio",/<span[^>]+label[^>]*>\s*(?:Name|Nazwa|Nombre)[\s\S]*?<span[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(c,a,"info.address_street",/<span[^>]+label[^>]*>\s*(?:Street|Ulica|Calle)[\s\S]*?<span[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(c,a,"info.address_zip",/<span[^>]+label[^>]*>\s*(?:Postal code|Kod pocztowy|Código postal)[\s\S]*?<span[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(c,a,"info.address_city",/<span[^>]+label[^>]*>\s*(?:City|Miejscowość|Localidad)[\s\S]*?<span[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces);getParam(getElement(c,/<select[^>]+countryHomeChoiceBorder:countryHomeChoice[^>]*>/i),a,"info.address_country",/<option[^>]+selected[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(getElement(c,/<select[^>]+citizenshipChoiceBorder:citizenshipChoice[^>]*>/i),a,"info.nationality",/<option[^>]+selected[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(getElement(c,/<select[^>]+birthCountryChoiceBorder:birthCountryChoice[^>]*>/i),a,"info.birth_country",/<option[^>]+selected[^>]*value="([^"]*)/i,
replaceHtmlEntities)};
