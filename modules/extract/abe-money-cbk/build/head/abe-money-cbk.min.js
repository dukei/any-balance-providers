var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.110 Safari/537.36"},baseurl="https://ibank.cbk.kg/portal/";
function login(){var b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl+"consumer/home",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");/logoutLink/i.test(a)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):(a=getParam(a,
null,null,/<form[^>]+id1[^>]+action="([^"]*)/i),a=AnyBalance.requestPost(baseurl+"login"+a,{id5_hf_0:"",username:b.login,password:b.password},addHeaders({Referer:baseurl+"login"})));if(!/logoutLink/i.test(a)){if(b=getParam(a,null,null,/<span[^>]+feedbackPanelERROR[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/проверьте логин и пароль/i.test(b));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();
return a}
function processAccounts(b,a){if(AnyBalance.isAvailable("accounts")){b=AnyBalance.requestGet(baseurl+"consumer/accounts",g_headers);/Произошла непредвиденная ошибка/i.test(b)&&AnyBalance.trace("Не удалось загрузить данные с первого раза. В ЛК произошла непредвиденная ошибка. Попробуйте обновить данные провайдера, если баланс не отображается.");var c=getElement(b,/<h2[^>]*>\s*Счета[\s\S]*?(<table[^>]*>)/i),c=getElements(c,/<tr[^>]+(?:even|odd)[^>]*>/ig);if(c.length){AnyBalance.trace("Найдено счетов: "+c.length);
a.accounts=[];for(var d=0;d<c.length;++d){var e=getParam(c[d],null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParam(c[d],null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),g=getParam(c[d],null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("accounts",e)&&processAccount(c[d],e);a.accounts.push(e)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(b,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(b,a,"accounts.type",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.status",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){9}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.balance",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"accounts.balance_acc",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,
parseBalance);getParam(b,a,"accounts.limit",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){7}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"accounts.currency",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){5}([^\d]*)/i,replaceTagsAndSpaces)}
function processCards(b,a){if(AnyBalance.isAvailable("cards")){b=AnyBalance.requestGet(baseurl+"consumer/accounts",g_headers);var c=getElement(b,/<h2[^>]*>\s*Банковские карты[\s\S]*?(<tbody[^>]*>)/i),c=getElements(c,/<tr[^>]*>/ig);if(c.length){AnyBalance.trace("Найдено карт: "+c.length);a.cards=[];for(var d=0;d<c.length;++d){var e=c[d],f=getParam(c[d],null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),g=getParam(c[d],null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces),h=getParam(c[d],null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f={__id:f,__name:h,num:g};__shouldProcess("cards",f)&&processCard(e,f);a.cards.push(f)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти карты.")}}
function processCard(b,a){AnyBalance.trace("Обработка карты "+a.__name);getParam(b,a,"cards.status",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,a,"cards.type",/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)}function processDeposits(b,a){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processCredits(b,a){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processInfo(b,a){var c=a.info={};getParam(b,c,"info.fio",/<span[^>]+topmenulabel(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces)};
