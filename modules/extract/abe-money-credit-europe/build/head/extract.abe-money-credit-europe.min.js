var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru,en-US;q=0.8,en;q=0.6",Origin:"https://online.crediteurope.ru",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36"},baseurl="https://online.crediteurope.ru/FWFIB/";
function getSessionId(a){return getParam(a,null,null,/<input[^>]+name="session_id"[^>]*value\s*=\s*['"]?([^'">\s]*)/i,replaceHtmlEntities)}
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var c=AnyBalance.requestGet(baseurl+"allmenuitems.jsp?session_lang=ru",g_headers),b=getSessionId(c);if(b)AnyBalance.trace("Используем текущую сессию...");else{AnyBalance.trace("Сессия не установлена. Будем заходить заново");c=AnyBalance.requestGet(baseurl+"loginNewNV.jsp",g_headers);b=getElement(c,/<form[^>]+class="login"[^>]*>/i);if(!b)throw AnyBalance.trace(c),
new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");AnyBalance.setCookie(getParam(baseurl,null,null,/:\/\/([^\/]*)/),"see3","1");c=createFormParams(b,function(b,c,d,g){return"USERNAME"==d?a.login:"PASSWORD"==d?a.password:g});c=AnyBalance.requestPost(baseurl+"loginNewNV.jsp",c,addHeaders({Referer:AnyBalance.getLastUrl()}));b=getElement(c,/<form[^>]+loginSMS[^>]*>/i);if(!b){if(b=getElement(c,/<td[^>]*color:\s*red[^>]*>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/Пароль/i.test(b));
AnyBalance.trace(c);throw new AnyBalance.Error("Не удаётся войти в интернет банк. Сайт изменен?");}c=createFormParams(b,function(a,b,c,d){return"SMSPASS"==c?AnyBalance.retrieveCode("Пожалуйста, введите код из СМС, пришедшего вам не телефон, для входа в интернет-банк",null,{inputType:"number",time:12E4}):d});c=AnyBalance.requestPost(baseurl+"loginSMS.jsp",c,addHeaders({Referer:AnyBalance.getLastUrl()}));b=getElement(c,/<form[^>]+FWFServlet[^>]*>/i);if(!b){if(b=getElement(c,/<td[^>]*color:\s*red[^>]*>/i,
replaceTagsAndSpaces))throw new AnyBalance.Error(b);AnyBalance.trace(c);throw new AnyBalance.Error("Не удаётся войти в интернет банк после ввода СМС-кода. Сайт изменен?");}c=createFormParams(b,null,!0);c=AnyBalance.requestPost(baseurl+"FWFServlet",c,addHeaders({Referer:AnyBalance.getLastUrl()}));if(!getParam(c,null,null,/<frame[^>]+name="mainframe"[^>]*src="([^"]*)/i,replaceHtmlEntities))throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось войти в интернет банк на главную страницу. Сайт изменен?");
AnyBalance.trace("Загружаем фреймсет...");for(var b=sumParam(c,null,null,/<frame[^>]+src="([^"]*)/ig,replaceHtmlEntities),d=0;d<b.length;++d)c=AnyBalance.requestGet(joinUrl(baseurl,b[d]),addHeaders({Referer:baseurl+"FWFServlet"}));AnyBalance.trace("Получаем всё меню...");c=AnyBalance.requestGet(baseurl+"allmenuitems.jsp?session_lang=ru",g_headers);b=getSessionId(c);if(!b)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось получить меню после входа в интернет-банк. Сайт изменен?");if(/Срок действия Вашего пароля истек/i.test(c))throw new AnyBalance.Error("Банк сообщает, что срок действия Вашего пароля истек, Вам необходимо изменить пароль. Зайдите в интернет-банк через браузер, измените пароль и введите новый пароль в настройки провайдера.",
null,!0);}__setLoginSuccessful();return c}
function getMenuPage(a,c){var b=getParam(a,null,null,new RegExp("evaluate\\s*\\([^)]*"+c+"[^)]*"));if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Не удаётся найти ссылку на меню "+c+". Сайт изменен?");getSessionId(a);c=getParam(b,null,null,/\(\s*'([^']*)/);var d=getParam(b,null,null,/\((?:\s*[^,)]*,){2}\s*['"]?([^'",]*)/),b=getParam(b,null,null,/\((?:\s*[^,)]*,){3}\s*['"]?([^'",]*)/);a=getSessionId(a);a=AnyBalance.requestPost(baseurl+"FWFServlet",{callType:"mpageCall",page:c,rights:"",path:d,
menuID:b,allItems:"true",session_id:a,lang:"ru"},addHeaders({Referer:baseurl+"allmenuitems.jsp?session_lang=ru"}));if(/Срок действия Вашего пароля истек/i.test(a))throw new AnyBalance.Error("Банк требует сменить пароль. Пожалуйста, войдите в интернет-банк через браузер, смените пароль, затем введите новый пароль в настройки провайдера.",null,!0);return a}
function processInfo(a,c){AnyBalance.isAvailable("info")&&(a=getSessionId(a),a=AnyBalance.requestPost(baseurl+"FWFServlet",{callType:"mpageCall",session_id:a,lang:"ru",USERGROUP:"br",TOPFRAME_CALLING:"true",page:""},addHeaders({Referer:baseurl+"FWFServlet"})),c=c.info={},getParam(a,c,"info.fio",/Здравствуйте,([^!<]*)/i,replaceTagsAndSpaces))}
function processAccounts(a,c){if(AnyBalance.isAvailable("accounts")){a=getMenuPage(a,"Текущие счета");var b=getElement(a,/<tbody[^>]+scrollContent[^>]*>/i);b||(AnyBalance.trace(a),AnyBalance.trace("Не найдена таблица счетов"));c.accounts=[];b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено счетов: "+b.length);for(var d=0;d<b.length;++d){var e=b[d],f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces)+" "+f.substr(-4),f={__id:f,__name:h,num:f};__shouldProcess("accounts",f)&&(a=processAccount(a,e,f));c.accounts.push(f)}}else AnyBalance.trace(a),AnyBalance.trace("Счета не найдены")}}
function createPropTable(a){var c=getElements(a,/<span[^>]+class\s*=\s*["']?base\b[^>]*>/ig);a=[];for(var b=0;b<c.length;++b){var d=c[b],e=/font-weight:bold|left:10px|left:355px/i.test(d)?-1:0,f=getParam(d,null,null,/top:\s*(\d+)px/i,replaceHtmlEntities,parseBalanceSilent),h=getParam(d,null,null,/left:\s*(\d+)px/i,replaceHtmlEntities,parseBalanceSilent),d=getParam(d,null,null,null,replaceTagsAndSpaces);a.push({title:e,vert:f,hor:h,text:d})}a.sort(function(a,b){var c=a.vert-b.vert;if(c)return c;if(a=
a.hor-b.hor)return a});for(var c=[],g,b=0;b<a.length;++b)d=a[b],d.title?(g&&c.push(g),g={title:d.text,text:""}):g&&(g.text+=(g.text?" ":"")+d.text);g&&c.push(g);return c}function performAction(a,c,b){var d=getElements(b,[/<(?:a|button)[^>]*populateForm[^>]*>/ig,a])[0];if(!d)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось найти действие: "+a.source);return performActionByString(d,c,b)}
function performActionByString(a,c,b){var d=getParam(a,null,null,/populateForm\w*\s*\(\s*'?([^',]*)/,replaceHtmlEntities);"this"==d&&(d=getParam(a,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities));var e=getParam(a,null,null,/populateForm\w*\s*\([^,)]*\s*,\s*'?([^',]*)/,replaceHtmlEntities);if(Array.isArray(c)){a="";for(var f=0;f<c.length;++f)a+=c[f].join(":")+"|";c=a}else if("object"==typeof c){a="";for(f in c)a+=f+":"+c[f]+"|";c=a}b=getElement(b,/<form[^>]+name="generic"[^>]*>/i);b=
createFormParams(b,function(a,b,f,l){return"params"==f?c:"triggeredbean"==f?d:"event"==f?e:l});return b=AnyBalance.requestPost(baseurl+"FWFServlet",b,addHeaders({Referer:baseurl+"FWFServlet"}))}
function processAccount(a,c,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(c,b,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,["accounts.currency","accounts.balance"],/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(c,b,"accounts.name",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("accounts.owner","accounts.date_start","accounts.transactions")){var d=
getParam(c,null,null,/<input[^>]+type=\s*['"]?radio[^>]*/i);c=getParam(d,null,null,/value\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);c=getParam(d,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities)+":"+c+"|FRE$TabPage:0|0:true|";a=performActionByString(d,c,a);a=performAction(/Выписка по счету/i,c,a);for(var d=createPropTable(a),e=0;e<d.length;++e){var f=d[e];/Имя владельца/i.test(f.title)?getParam(f.text,b,"accounts.owner"):/Дата открытия счета/i.test(f.title)&&getParam(f.text,b,"accounts.date_start",
null,null,parseDate)}AnyBalance.isAvailable("accounts.transactions")&&(a=processAccountTransactions(a,b));a=performAction(/geri.gif/i,c,a)}return a}
function processCards(a,c){if(AnyBalance.isAvailable("cards")){a=getMenuPage(a,"Информация по Карте");var b=getElements(a,[/<div[^>]+class=['"]?base\b[^>]*>/ig,/Все карты, включая заблокированные/i])[0],d={FRE$TabPage:0};if(b){AnyBalance.trace("Включаем все карты.");var e=getParam(b,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);d[e]="true";a=performActionByString(b,d,a)}b=getElements(a,[/<select[^>]*>/ig,/\d{6}\*{6}\d{4}/i])[0];b||(AnyBalance.trace(a),AnyBalance.trace("Не найдена таблица карт"));
e=getParam(b,null,null,/<select[^>]+name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);c.cards=[];var f=sumParam(b,null,null,/<option[^>]*>[\s\S]*?(?:<\/option>|(?=<option)|(?=<\/select>))/ig);if(f.length){AnyBalance.trace("Найдено карт: "+(f.length-1));for(var h=0;h<f.length;++h){var g=f[h],k=getParam(g,null,null,/\bvalue="([^"]*)/i,replaceHtmlEntities);if(k){var l=getParam(g,null,null,/\d{6}\*{6}\d{4}/i,replaceTagsAndSpaces),g=getParam(g,null,null,null,replaceTagsAndSpaces),k={__id:k,__name:g,num:l};
__shouldProcess("cards",k)&&(d[e]=h,a=processCard(a,b,d,k));c.cards.push(k)}}}else AnyBalance.trace(a),AnyBalance.trace("Карты не найдены")}}
function processCard(a,c,b,d){AnyBalance.trace("Обработка карты "+d.__name);a=performActionByString(c,b,a);c=createPropTable(a);for(b=0;b<c.length;++b){var e=c[b];/Тип карты/i.test(e.title)&&getParam(e.text,d,"cards.type");/Тип продукта/i.test(e.title)?getParam(e.text,d,"cards.product_type"):/Имя владельца/i.test(e.title)?getParam(e.text,d,"cards.holder"):/Номер счета/i.test(e.title)?getParam(e.text,d,"cards.accnum"):/Валюта/i.test(e.title)?getParam(e.text,d,["cards.currency","cards.balance"]):/Статус Карты/i.test(e.title)?
getParam(e.text,d,"cards.status"):/действительна до/i.test(e.title)?getParam(e.text,d,"cards.till",null,null,parseDate):/Кредитный лимит/i.test(e.title)?getParam(e.text,d,"cards.limit",null,null,parseBalance):/Лимит для снятия наличными/i.test(e.title)?getParam(e.text,d,"cards.limit_cash",null,null,parseBalance):/Сумма доступных средств$/i.test(e.title)?(getParam(e.text,d,"cards.balance",null,null,parseBalance),getParam(e.text,d,"cards.available",null,null,parseBalance)):/Сумма доступных средств для снятия наличными/i.test(e.title)?
getParam(e.text,d,"cards.available_cash",null,null,parseBalance):/Собственные средства/i.test(e.title)?getParam(e.text,d,"cards.own",null,null,parseBalance):/Задолженность по выписке/i.test(e.title)?getParam(e.text,d,"cards.debt_previous",null,null,parseBalance):/Предварительный расчет задолженности на текущую дату/i.test(e.title)?getParam(e.text,d,"cards.debt",null,null,parseBalance):/Сумма накопленных баллов/i.test(e.title)&&getParam(e.text,d,"cards.bonus",null,null,parseBalance)}AnyBalance.isAvailable("cards.transactions")&&
(a=processCardTransactions(a,d));return a}function processDeposits(a,c){AnyBalance.isAvailable("deposits")}
function processCredits(a,c){if(AnyBalance.isAvailable("credits")){a=getMenuPage(a,"Кредиты");var b=getElement(a,/<tbody[^>]+scrollContent[^>]*>/i);b||(AnyBalance.trace(a),AnyBalance.trace("Не найдена таблица кредитов"));c.credits=[];b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено кредитов: "+b.length);for(var d=0;d<b.length;++d){var e=b[d],f=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),h=getParam(e,null,null,/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces)+" "+f.substr(-4),f={__id:f,__name:h,num:f};__shouldProcess("credits",f)&&(a=processCredit(a,e,f));c.credits.push(f)}}else AnyBalance.trace(a),AnyBalance.trace("Кредиты не найдены")}}function parseBool(a){return!/нет/i.test(a)}
function processCredit(a,c,b){AnyBalance.trace("Обработка кредита "+b.__name);getParam(c,b,"credits.balance",/(?:[\s\S]*?<td[^>]*>){14}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,["credits.currency","credits.balance"],/(?:[\s\S]*?<td[^>]*>){14}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency);getParam(c,b,"credits.limit",/(?:[\s\S]*?<td[^>]*>){12}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(c,b,"credits.till",/(?:[\s\S]*?<td[^>]*>){10}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseDate);getParam(c,b,"credits.date_start",/(?:[\s\S]*?<td[^>]*>){8}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(c,b,"credits.status",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(c,b,"credits.name",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(AnyBalance.isAvailable("credits.type","credits.accnum","credits.minpay_till","credits.shoud_pay_full","credits_pay_full","credits.schedule")){var d=getParam(c,null,null,
/<input[^>]+type=\s*['"]?radio[^>]*/i);c=getParam(d,null,null,/value\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities);c=getParam(d,null,null,/name\s*=\s*["']?([^"'\s>]*)/i,replaceHtmlEntities)+":"+c+"|FRE$TabPage:0|0:true|";a=performActionByString(d,c,a);a=performAction(/Информация по кредиту/i,c,a);for(var d=createPropTable(a),e=0;e<d.length;++e){var f=d[e];/Тип Кредита/i.test(f.title)?getParam(f.text,b,"credits.type"):/^Счет$/i.test(f.title)?getParam(f.text,b,"credits.accnum"):/Дата очередного платежа/i.test(f.title)?
getParam(f.text,b,"credits.minpay_till",null,null,parseDate):/К досрочному погашению/i.test(f.title)?getParam(f.text,b,"credits.should_pay_full",null,null,parseBool):/Сумма полного досрочного погашения/i.test(f.title)&&getParam(f.text,b,"credits.pay_full",null,null,parseBalance)}AnyBalance.isAvailable("credits.schedule")&&(a=processCreditSchedule(a,b));a=performAction(/Назад/i,c,a)}return a};
