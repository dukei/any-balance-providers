var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.109 Safari/537.36"},baseurl="https://ibank.economiks.ru:2443";
function login(d){AnyBalance.setDefaultCharset("windows-1251");checkEmpty(d.login,"Введите логин!");checkEmpty(d.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl+"/web_banking/protected/welcome.jsf",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(a))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{getElement(a,
/<form[^>]+name="form:loginForm"[^>]*>/i);var c=createFormParams(a,function(a,c,e,g){return"form:login"==e?d.login:g}),a=AnyBalance.requestPost(baseurl+"/web_banking/login.jsf",c,addHeaders({Referer:baseurl+"/web_banking/login.jsf"})),c=createFormParams(a,function(b,c,e,g){if("j_password"==e||"password_common"==e)return d.password;if("j_username"==e)return d.login;if("captcha"==e){b=getParam(a,null,null,/<img[^>]+id="jcaptcha"[^>]+src="([\s\S]*?)"/i);if(!b)throw new AnyBalance.Error("Не удалось найти капчу. Сайт изменён?");
b=AnyBalance.requestGet(baseurl+b,addHeaders({Referer:baseurl+"/web_banking/login.jsf"}));return AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",b,{time:18E4})}}),a=AnyBalance.requestPost(baseurl+"/web_banking/j_security_check",c,addHeaders({Referer:baseurl+"/web_banking/login.jsf"}))}if(!/logout/i.test(a)){if(c=getParam(a,null,null,[/<div[^>]+iconError"[^>]*>([\s\S]*?)<\/div>/i,/<span[^>]+id="captcha_msg"[^>]*>([\s\S]*?)<\/span>/i],replaceTagsAndSpaces))throw new AnyBalance.Error(c,
null,/(Неверно указаны данные|код с картинки введен неверно)/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return a}
function processAccounts(d,a){if(AnyBalance.isAvailable("accounts")){d=AnyBalance.requestGet(baseurl+"/web_banking/protected/accounts/index",g_headers);var c=getElements(d,/<div[^>]+productShort[^>]*>/ig,null,html_entity_decode);if(c.length){AnyBalance.trace("Найдено счетов: "+c.length);a.accounts=[];for(var b=0;b<c.length;++b){var f=c[b],e=getParam(f,null,null,/<td[^>]+lh20 w100Pc paddR10[^>]*>([^<]*)/i,[replaceTagsAndSpaces,/,\s*/g,""]),g=getParam(f,null,null,/<td[^>]+lh20 w100Pc paddR10[^>]*>([^<]*)/i,
[replaceTagsAndSpaces,/,\s*/g,""]),h=getParam(f,null,null,/<span[^>]+aliasText[^>]*>([^<]*)/i),e={__id:e,__name:h,num:g};__shouldProcess("accounts",e)&&processAccount(f,e);a.accounts.push(e)}}else AnyBalance.trace(d),AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(d,a){AnyBalance.trace("Обработка счета "+a.__name);var c=getParam(d,null,null,/<a[^>]+href="([^"]*)/i);c||(AnyBalance.trace(d),AnyBalance.trace("Не удалось найти ссылку на подробную информацию о счёте."));var b=AnyBalance.requestGet(baseurl+c,g_headers);getParam(d,a,"accounts.status",/<span[^>]+class="lowercase"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.agreement",/decorate-block(?:[\s\S]*?<span[^>]+infoLine[^>]*>){2}[^:]*:([^<]*)/i,replaceTagsAndSpaces);
getParam(b,a,"accounts.date_start",/amountbox[\s\S]*?<span[^>]+infoLine[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseDate);getParam(b,a,"accounts.balance",/<span[^>]+amountBox[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["accounts.currency","accounts.balance"],/<span[^>]+amountBox[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces,parseCurrency);AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,c,a)}
function processInfo(d,a){d=AnyBalance.requestGet(baseurl+"/web_banking/protected/service/info.jsf",g_headers);var c=a.info={},b=getElement(d,/<table[^>]+class="tbl"[^>]*>/i,null,html_entity_decode);b?(getParam(b,c,"info.name_last",/Фамилия(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.name",/Имя(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.name_patronymic",/Отчество(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.email",
/e-mail(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.mphone",/мобильный телефон(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.hphone",/Домашний телефон(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.wphone",/Рабочий телефон(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.inn",/инн(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.passport",/номер(?:[^>]*>){2}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces),getParam(b,c,"info.raddress",/адрес регистрации(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(b,c,"info.faddress",/адрес фактического(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)):AnyBalance.trace("Не смогли найти таблицу с пользовательскими данными.")}function processDeposits(d,a){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processCredits(d,a){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processCards(d,a){throw new AnyBalance.Error("Обработка карт пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function getParamByName(d,a){a=isArray(a)?a:[a];for(var c={},b=0;b<a.length;b++)c[a[b]]=getParam(d,null,null,new RegExp("name=[\"']"+a[b]+'["\'][^>]*value=["\']([^"\']+)"',"i"))||"";return c};
