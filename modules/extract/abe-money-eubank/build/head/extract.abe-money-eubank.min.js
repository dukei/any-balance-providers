var g_domain="my.smartbank.kz",g_baseurl="https://"+g_domain+"/",g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"};
function login(){var c=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");if(!AnyBalance.getCookie("JSESSIONID")){var b=AnyBalance.getData("JSESSIONID");b&&AnyBalance.setCookie("my.smartbank.kz","JSESSIONID",b)}b=AnyBalance.requestGet(g_baseurl,g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");
/logout/i.test(b)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):b=AnyBalance.requestPost(g_baseurl+"j_spring_security_check",{j_username:c.login,j_password:c.password},addHeaders({Referer:g_baseurl}));if(/Изменить пароль/i.test(b))throw new AnyBalance.Error("Вам требуется сменить пароль! Зайдите в кабинет через браузер и поменяйте ваш пароль.",null,!0);if(!/logout/i.test(b)){if((c=getParam(b,null,null,/<div[^>]+error[^>]*>([\s\S]*?)(?:<\/div>)/i,replaceTagsAndSpaces,html_entity_decode))&&
c)throw new AnyBalance.Error(c,null,/Неверный логин или пароль/i.test(c));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}AnyBalance.setData("JSESSIONID",AnyBalance.getCookie("JSESSIONID"));AnyBalance.saveData();__setLoginSuccessful();return b}
function processCards(c,b){if(AnyBalance.isAvailable("cards")){var a=getParam(c,null,null,/<div[^>]+accounts-cards[^>]*>[^]*?<\/script>\s*<\/div>\s*<\/div>/i);a||(c=AnyBalance.requestGet(g_baseurl+"accounts/cards",g_headers),a=getParam(c,null,null,/<div[^>]+accounts-cards[^>]*>[^]*?<\/script>\s*<\/div>\s*<\/div>/i));if(a)for(c=sumParam(a,null,null,/<li\s+accountId=[^>]+">[\s\S]*?<\/li>/ig),AnyBalance.trace("Найдено карт: "+c.length),b.cards=[],a=0;a<c.length;++a){var e=c[a],d=getParam(e,null,null,
/<li\s+accountId="([^"]+)"/i,replaceTagsAndSpaces),f=getParam(e,null,null,/<a\s+id="title-[^>]+">([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),g=getParam(e,null,null,/<div\s+class="card\s+[\S\s]*<div\s+class="number[^>]+>(.+)<\/div/i,replaceTagsAndSpaces),h=getParam(e,null,null,/<div\s+class="card\s+[\S\s]*<div\s+class="title[^>]+>(.+)<\/div/i,replaceTagsAndSpaces);f=f+" "+h+" "+g.substr(-4);d={__id:d,num:g,type:h,__name:f};__shouldProcess("cards",d)&&processCard(e,d);b.cards.push(d)}else/У вас нет карт/i.test(c)?
(AnyBalance.trace("У вас нет карт"),b.cards=[]):(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(c,b){AnyBalance.trace("Обработка карты "+b.__name);var a=AnyBalance.requestPost(g_baseurl+"accounts/card_details_ajax",{md5:b.__id,details:!0},addHeaders({Referer:g_baseurl+"accounts?locale=ru"}));try{a=a.replace(/[\x00-\x1F\x7F-\x9F]/g,""),a=JSON.parse(a),a=a[b.__id]}catch(e){throw new AnyBalance.Error("Не удалось получить информацию о карте. Сайт изменён?");}getParam(a.availBalance,b,"cards.balance",null,replaceTagsAndSpaces,parseBalance);getParam(a.blockedSum,b,"cards.blocked",
null,replaceTagsAndSpaces,parseBalance);getParam(a.overdraft,b,"cards.limit",/Кредитный лимит:(?:[^>]*>){4}([^<]+)/i,replaceTagsAndSpaces,parseBalance);getParam(a.currency,b,["cards.currency","cards.balance"],null,[AB.replaceTagsAndSpaces,/(.*?)/i,"0$1"],AB.parseCurrency);getParam(a.number,b,"cards.accnum",null,replaceTagsAndSpaces);getParam(a.status,b,"cards.status",null,replaceTagsAndSpaces);getParam(c,b,"cards.till",/<div\s+class="card\s+[\S\s]*<span\s+class="carddate[^>]+>([\s\S]+)<\/span>\s*<\/div/i,
replaceTagsAndSpaces,parseDateWord);getParam(c,b,"cards.holder",/<div\s+class="card\s+[\S\s]*<div\s+class="name[^>]+>(.+)<\/div/i,replaceTagsAndSpaces);isAvailable("cards.transactions")&&processCardTransactions(c,b)}function processAccounts(c,b){if(isAvailable("accounts"))throw new AnyBalance.Error("Текущие счета пока не поддерживаются. Обращайтесь к разработчикам.");}
function processCredits(c,b){if(isAvailable("credits"))throw new AnyBalance.Error("Кредиты пока не поддерживаются. Обращайтесь к разработчикам.");}
function processDeposits(c,b){if(isAvailable("deposits")){var a=getParam(c,null,null,/<div[^>]+accounts-deposit[^>]*>[^]*?<\/script>\s*<\/div>\s*<\/div>/i);a||(c=AnyBalance.requestGet(g_baseurl+"accounts/deposit",g_headers),a=getParam(c,null,null,/<div[^>]+accounts-deposit[^>]*>[^]*?<\/script>\s*<\/div>\s*<\/div>/i));if(a)for(c=sumParam(a,null,null,/<li\s+accountId=[^>]+">[\s\S]*?<\/li>/ig),AnyBalance.trace("Найдено депозитов: "+c.length),b.deposits=[],a=0;a<c.length;++a){var e=c[a],d=getParam(e,
null,null,/<li\s+accountId="([^"]+)"/i,replaceTagsAndSpaces),f=getParam(e,null,null,/<a\s+id="title-[^>]+">([\s\S]*?)<\/a>/i,replaceTagsAndSpaces);d={__id:d,__name:f};__shouldProcess("deposits",d)&&processDeposit(e,d);b.deposits.push(d)}else/У вас нет депозитов/i.test(c)?(AnyBalance.trace("У вас нет депозитов"),b.deposits=[]):(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти таблицу с депозитами."))}}
function processDeposit(c,b){AnyBalance.trace("Обработка депозита "+b.__name);var a=AnyBalance.requestPost(g_baseurl+"accounts/updateTotals",{deposit:"KZT"},addHeaders({Referer:g_baseurl+"accounts?locale=ru"}));try{a=JSON.parse(a);a=a.body.accountTypes[0];for(var e,d=0;d<a.accounts.length;++d){var f=a.accounts[d];f.md5===b.__id&&(e=f)}e.amount||(AnyBalance.trace(a),AnyBalance.trace("Не удалось получить баланс депозита."))}catch(g){AnyBalance.trace(a),AnyBalance.trace("Не удалось получить баланс депозита.")}a=
AnyBalance.requestPost(g_baseurl+"accounts/deposit_details_ajax",{md5:b.__id,details:!0},addHeaders({Referer:g_baseurl+"accounts?locale=ru"}));try{a=a.replace(/[\x00-\x1F\x7F-\x9F]/g,""),a=JSON.parse(a),a=a[b.__id]}catch(g){throw new AnyBalance.Error("Не удалось получить информацию о депозите. Сайт изменён?");}e.amount&&(getParam(e.amount.amount,b,"deposits.balance",null,null,parseBalance),getParam(e.amount.currency,b,["deposits.currency","deposits.balance"],null,[AB.replaceTagsAndSpaces,/(.*?)/i,
"0$1"],AB.parseCurrency));getParam(a.number,b,"deposits.accnum",replaceTagsAndSpaces);getParam(a.dateOpened,b,"deposits.date_start",null,replaceTagsAndSpaces,parseDateWord);getParam(a.type,b,"deposits.type",null,replaceTagsAndSpaces);getParam(a.arrestedSum,b,"deposits.blocked",null,replaceTagsAndSpaces,parseBalance);getParam(c,b,"deposits.pct",/<div[^>]+class="percent"(?:[^>]*>){1}([^<]*)/i,replaceTagsAndSpaces,AB.parseBalance);getParam(c,b,"deposits.deptill",/<div[^>]+class="date"(?:[^>]*>){1}([^<]*)/i,
["До ",""].concat(replaceTagsAndSpaces),parseDateWord);isAvailable("deposits.transactions")&&"undefined"!=typeof processDepositsTransactions&&processDepositsTransactions(deposit,b)}
function processBonuses(c,b){if(isAvailable("info.bonuses")){var a=getParam(c,null,null,/<div[^>]+accounts-bonus[^>]*>[^]*?<\/script>\s*<\/div>\s*<\/div>/i);a||(c=AnyBalance.requestGet(g_baseurl+"accounts/bonus",g_headers),a=getParam(c,null,null,/<div[^>]+accounts-bonus[^>]*>[^]*?<\/script>\s*<\/div>\s*<\/div>/i));if(a)for(c=sumParam(a,null,null,/<li\s+accountId=[^>]+">[\s\S]*?<\/li>/ig),AnyBalance.trace("Найдено бонусов: "+c.length),a=0;a<c.length;++a){var e=getParam(c[a],null,null,/<li\s+accountId="([^"]+)"/i,
replaceTagsAndSpaces),d=AnyBalance.requestPost(g_baseurl+"accounts/updateTotals",{bonus:"BNS"},addHeaders({Referer:g_baseurl+"accounts?locale=ru"}));try{d=JSON.parse(d);d=d.body.accountTypes[0];for(a=0;a<d.accounts.length;++a){var f=d.accounts[a];if(f.md5===e){var g=f;break}}g.amount||(AnyBalance.trace(d),AnyBalance.trace("Не удалось получить баланс бонусов."))}catch(h){AnyBalance.trace(d),AnyBalance.trace("Не удалось получить баланс бонусов.")}getParam(g.amount.amount,b.info,"info.bonuses",null,
null,parseBalance)}else/У вас нет бонусов/i.test(c)?AnyBalance.trace("У вас нет бонусов"):(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти таблицу с бонусами."))}}function processInfo(c,b){b=b.info={};getParam(c,b,"info.fio",/<div[^>]+class="account"(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces)};
