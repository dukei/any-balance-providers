var myReplaceTagsAndSpaces=[replaceTagsAndSpaces,/(\d)\-(\d)/g,"$1.$2"],g_baseurl="https://www.faktura.ru/lite/app";
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");var c=AnyBalance.requestGet(g_baseurl+"/pub/Login"),d=/"u":".\/([^"]+)[^}]*"f":"(id\w+)/i.exec(c);if(!d){if(getParam(c,null,null,/<title>(Профилактические работы)<\/title>/i))throw new AnyBalance.Error("В настоящее время в системе Интернет-банк проводятся профилактические работы. Пожалуйста, попробуйте ещё раз позже.");throw new AnyBalance.Error("Не удаётся найти форму входа в интернет-банк! Сайт недоступен или изменения на сайте.");
}var c=d[1],b={};b[d[2]+"_hf_0"]="";b.hasData="X";b.login=a.login;b.password=a.password;b["p::submit"]="1";c=AnyBalance.requestPost(g_baseurl+"/pub/"+c,b);if(a=getParam(c,null,null,/<span[^>]*class="feedbackPanelERROR"[^>]*>([\s\S]*?)(<script|<\/span>)/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Неверно указан логин/i.test(a));if(getParam(c,null,null,/(sms-message-panel|Введите SMS-код)/i))throw new AnyBalance.Error("Для работы этого провайдера требуется отключить в настройках интернет-банка подтверждение входа по СМС. Это безопасно, для совершения операций все равно будет требоваться подтверждение по СМС.");
AnyBalance.trace("We seem to enter the bank...");return c}
function getCards(a,c){var d=getElements(a,/<div[^>]+class="card"[^>]*>/ig);AnyBalance.trace("Найдено "+d.length+" карт");d.length&&(c.cards=[]);for(var b=getElement(a,/<div[^>]+grouped-amount[^>]*>/i),h=0;h<d.length;++h){var g={},e=d[h];getParam(e,g,"accounts.cards.__id",/<div[^>]+class="card-info"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(e,g,"accounts.cards.num",/<div[^>]+class="card-info"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(e,g,"accounts.cards.name",/<div[^>]+class="card-info"[^>]*>([\s\S]*?)<\/div>/i,
replaceTagsAndSpaces);getParam(e,g,"accounts.cards.balance",/<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseBalance);getParam(e,g,["accounts.cards.currency","accounts.cards.balance"],/<span[^>]+class="currency"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces);getParam(b,g,"accounts.cards.balance",null,myReplaceTagsAndSpaces,parseBalance);getParam(b,g,["accounts.cards.currency","accounts.cards.balance"],null,myReplaceTagsAndSpaces,parseCurrency);getParam(e,g,"accounts.cards.balance",
/<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseBalance);getParam(e,g,["accounts.cards.currency","accounts.cards.balance"],/<span[^>]+class="currency"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseCurrency);c.cards.push(g)}}function getAccountsPage(){return getAccountsPage.html?getAccountsPage.html:getAccountsPage.html=AnyBalance.requestGet(g_baseurl+"/priv/accounts")}
function processAccounts(a,c){a=getAccountsPage();getParam(a,c,"total",/<span[^>]+class="total-block"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseBalance);AnyBalance.isAvailable("total","currency")&&(c.currency=getElement(a,/<span[^>]+class="total-block"[^>]*>/i,myReplaceTagsAndSpaces,parseCurrency));if(AnyBalance.isAvailable("accounts","info.address")){var d=getElements(a,/<div[^>]+class="account-(?:block|history)"[^>]*>/ig);d.length&&(c.accounts=[]);for(var b=0;b<d.length;b+=2){var h=
d[b],g=d[b+1],e=getParam(g,null,null,/<div[^>]+id="acc_([^"_]*)/i,replaceHtmlEntities),f=getParam(g,null,null,/<span[^>]+class="editable-name-block"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),e={__id:e,__name:f+" ("+e+")"};getCards(g,e);if(__shouldProcess("accounts",e)&&(processAccount(g,e,a),AnyBalance.isAvailable("accounts.minpay","accounts.minpay_till","accounts.transactions","accounts.address","info.address")))try{processAccountTransactions(h,e,c)}catch(k){AnyBalance.trace("Выписка не получена: "+
k.message)}c.accounts.push(e)}}}function num2(a){return n2(a)}
function processAccountTransactions(a,c,d){var b=getParam(a,null,null,/div[^>]+class="more-operations[\s\S]*?href="([^"]*)/i,replaceHtmlEntities);if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти ссылку на выписку, сайт изменен?");a=AnyBalance.requestGet(g_baseurl+"/priv/"+b);getParam(a,c,"accounts.minpay",/<td[^>]*>Оплатить до[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,[replaceTagsAndSpaces,/-/,","],parseBalance);getParam(a,c,"accounts.minpay_till",/<td[^>]*>Оплатить до([^<]+)/i,replaceTagsAndSpaces,
parseDate);if(AnyBalance.isAvailable("accounts.transactions","accounts.address","info.address")){var h=getElements(a,[/<form[^>]*>/ig,/Период выписки/i])[0];if(!h)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму выписки, сайт изменен?");var b=getParam(h,null,null,/<form[^>]+action="([^"]*)/i,replaceHtmlEntities),g=new Date;a=createFormParams(h,function(a,b,c,d){if(/start/i.test(c))return num2(g.getDate())+"."+num2(g.getMonth()+1)+"."+(g.getFullYear()-3);if(/end/i.test(c))return num2(g.getDate())+
"."+num2(g.getMonth()+1)+"."+g.getFullYear();/id[^_]+_hf_/i.test(c)&&(a["p::submit"]="x",d=void 0);return d});a.periodType="radio53";a=AnyBalance.requestPost(joinUrl(AnyBalance.getLastUrl(),b),a);b=getParam(a,null,null,/<a[^>]+href="([^"]*)"[^>]*class="[^"]*print/i,replaceHtmlEntities);if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти ссылку на печать выписки, сайт изменен?");a=AnyBalance.requestGet(joinUrl(AnyBalance.getLastUrl(),b));b=getParam(a,null,null,/<iframe[^>]+src="([^"]*)"[^>]*id="iframeId"/i,
replaceHtmlEntities);if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти ссылку на iframe выписки, сайт изменен?");a=AnyBalance.requestGet(joinUrl(AnyBalance.getLastUrl(),b));h=getElements(a,[/<table[^>]*>/ig,/Дата операции/i])[0];if(!h)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти ссылку таблицу выписки, сайт изменен?");getParam(a,c,"accounts.address",/<td[^>]*>Адрес регистрации[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("info.address")&&
(d.info=d.info||{},getParam(a,d.info,"info.address",/<td[^>]*>Адрес регистрации[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces));c.transactions=[];d=getParam(h,null,null,/<thead[^>]*>([\s\S]*?)<\/thead>/i);d=getElements(d,/<th[^>]*>/ig,replaceTagsAndSpaces);b={};for(a=0;a<d.length;++a)/Документ/i.test(d[a])?b.doc=a:/Дата операции/i.test(d[a])?b.date=a:/Списание|Расходы/i.test(d[a])?b.off=a:/Зачисление|Расходы/i.test(d[a])?b.on=a:/Контрагент/i.test(d[a])?b.contra=a:/Назначение|Детали операции/i.test(d[a])&&
(b.descr=a);a=getParam(h,null,null,/<tbody[^>]*>([\s\S]*?)<\/tbody>/i);h=getElements(a,/<tr[^>]*>/ig);for(a=0;a<h.length;++a){var e=getElements(h[a],/<td[^>]*>/ig);if(!(e.length<d.length)){var f={};b.hasOwnProperty("doc")&&getParam(e[b.doc],f,"accounts.transactions.doc",null,replaceTagsAndSpaces);b.hasOwnProperty("date")&&getParam(e[b.date],f,"accounts.transactions.date",null,replaceTagsAndSpaces,parseDate);b.hasOwnProperty("off")&&getParam(e[b.off],f,"accounts.transactions.sum",null,replaceTagsAndSpaces,
function(a){a=parseBalance(a);return 0<a?-a:a});b.hasOwnProperty("on")&&getParam(e[b.on],f,"accounts.transactions.sum",null,replaceTagsAndSpaces,parseBalance);b.hasOwnProperty("contra")&&getParam(e[b.contra],f,"accounts.transactions.contra",null,replaceTagsAndSpaces);b.hasOwnProperty("descr")&&getParam(e[b.descr],f,"accounts.transactions.descr",null,replaceTagsAndSpaces);c.transactions.push(f)}}}}
function followAjaxUrl(a,c){var d=getParam(c,null,null,new RegExp('Wicket.Ajax.ajax\\(([^)]*"c":"'+a+'"[\\s\\S]*?\\})\\)'),null,getJsonEval),b=getParam(c,null,null,/Wicket.Ajax.baseUrl="([^"]*)/,replaceSlashes),d=AnyBalance.requestGet(g_baseurl+"/priv/"+d.u,{"Wicket-Ajax":"true","Wicket-Ajax-BaseURL":b||"priv/accounts?wicket-crypt=f6I5BkYr3fk","X-Requested-With":"XMLHttpRequest"});(b=getParam(d,null,null,/<redirect>\s*<!\[CDATA\[([\s\S]*?)\]\]>/i))&&(d=AnyBalance.requestGet(g_baseurl+"/priv/"+b));
return d}
function processAccount(a,c,d){var b=getElements(a,[/<div[^>]+class="closed"[^>]*>/ig,/Дополнительно/i])[0];b&&(b=getParam(b,null,null,/<div[^>]+id="([^"]*)/i,replaceHtmlEntities),b=followAjaxUrl(b,d),a+=b);getParam(a,c,"accounts.balance",[/Средств на счете[\s\S]*?<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,/<div[^>]+class="card-amounts"[^>]*>([\s\S]*?)<\/div>/i],myReplaceTagsAndSpaces,parseBalance);getParam(a,c,["accounts.currency","accounts.own","accounts.credit_used","accounts.debt","accounts.limit"],
/<span[^>]+class="currency"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,c,"accounts.own",/Остаток собственных средств[\s\S]*?<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseBalance);getParam(a,c,"accounts.credit_used",/Использованный кредит[\s\S]*?<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseBalance);getParam(a,c,"accounts.debt",/Начисленная задолженность[\s\S]*?<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,
parseBalance);getParam(a,c,"accounts.limit",/Кредитный лимит[\s\S]*?<span[^>]+class="amount"[^>]*>([\s\S]*?)<\/span>/i,myReplaceTagsAndSpaces,parseBalance);getParam(a,c,"accounts.name",/<span[^>]+class="editable-name-block"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,c,"accounts.num",/<td>Номер:[\s\S]*?<td[^>]*>([\s\S]*?)(?:\(|<\/td>)/i,replaceTagsAndSpaces);getParam(a,c,"accounts.currencyISO",/<td>Валюта:[\s\S]*?<td[^>]*>([\s\S]*?)(?:\(|<\/td>)/i,replaceTagsAndSpaces);getParam(a,c,
"accounts.fio",/<td>Владелец:[\s\S]*?<td[^>]*>([\s\S]*?)(?:\(|<\/td>)/i,replaceTagsAndSpaces);getParam(a,c,"accounts.opened",/<td>Открыт:[\s\S]*?<td[^>]*>([\s\S]*?)(?:\(|<\/td>)/i,replaceTagsAndSpaces,parseDate)}
function processInfo(a,c){if(AnyBalance.isAvailable("info")&&(c.info=c.info||{},AnyBalance.isAvailable("info.fio_if")&&(c.info.fio_if=getElement(a,/<span[^>]+class="name"[^>]*>/i,replaceTagsAndSpaces)),AnyBalance.isAvailable("info.fio"))){var d=getAccountsPage();getParam(d,c.info,"info.fio",/<td>Владелец:[\s\S]*?<td[^>]*>([\s\S]*?)(?:\(|<\/td>)/i,replaceTagsAndSpaces)}}
function processTemplates(a,c){var d=getElement(a,/<div[^>]+class="templates"[^>]*>/i);d&&(c.templates=[]);for(var d=getElements(d,/<li[^>]*>/ig),b=0;b<d.length;++b){var h=d[b];if(!/<li[^>]+class="create"/i.test(h)){var g=getParam(h,null,null,/<a[^>]+class="template-name[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),g={__id:g,__name:g};__shouldProcess("templates",g)&&processTemplate(h,g,a);c.templates.push(g)}}}
function processTemplate(a,c,d){if(AnyBalance.isAvailable("templates"))for(a=getParam(a,null,null,/<a[^>]+class="template-name"[^>]*id="([^"]*)/i,replaceHtmlEntities),a=followAjaxUrl(a,d),getParam(a,c,"type",/<h1[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces),d=getElements(a,/<fieldset[^>]*>/ig),d.length&&(c.fieldsets=[]),a=0;a<d.length;++a){var b=d[a];if(!/<fieldset[^>]+class="submit"/i.test(b)&&!/<span>Имя платежа<\/span>/i.test(b)){var h={};getParam(b,h,"templates.fieldsets.name",/<legend[^>]*>([\s\S]*?)<\/legend>/i,
replaceTagsAndSpaces);b=getElements(b,/<(?:label|div)[^>]*>/ig);if(b.length){h.fields=[];for(var g=0;g<b.length;g+=2){var e=b[g],f=b[g+1];/^<div/i.test(e)&&(g--,f=getElement(e,/<div[^>]+inside-div[^>]*>/i),e=getElement(e,/<label[^>]+inside-div[^>]*>/i));if(!/^<[^>]*display:none/i.test(f)||!/^<[^>]*display:none/i.test(e)){var k={};getParam(e,k,"templates.fieldsets.fields.name",null,replaceTagsAndSpaces);getParam(e,k,"templates.fieldsets.fields.required",/<label[^>]+required/i,null,function(a){return!!a});
if(/<input[^>]+type="radio"/i.test(f))for(getParam(f,k,"templates.fieldsets.fields.id",/<input[^>]+type="radio"[^>]*name="([^"]*)/i,replaceHtmlEntities),e=sumParam(f,null,null,/<(?:input|label)[\s\S]*?<\/(?:span|div)/ig),f=0;f<e.length;++f){var l={};getParam(e[f],l,"templates.fieldsets.fields.options.value",/<input[^>]+type="radio"[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(e[f],l,"templates.fieldsets.fields.options.name",/<label[^>]*>[\s\S]*?<\/label>/i,replaceTagsAndSpaces);getParam(e[f],
l,"templates.fieldsets.fields.extra_id",/<input[^>]+type="text"[^>]*name="([^"]*)/i,replaceHtmlEntities);getParam(e[f],l,"templates.fieldsets.fields.extra_value",/<input[^>]+type="text"[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(e[f],l,"templates.fieldsets.fields.extra_comment",/<input[^>]+type="text"[^>]*title="([^"]*)/i,replaceHtmlEntities);/checked/i.test(e[f])&&(getParam(e[f],l,"templates.fieldsets.fields.options.value",/<input[^>]+type="radio"[^>]*value="([^"]*)/i,replaceHtmlEntities),
getParam(e[f],l,"templates.fieldsets.fields.options.value_name",/<label[^>]*>[\s\S]*?<\/label>/i,replaceTagsAndSpaces),getParam(e[f],k,"templates.fieldsets.fields.extra_id",/<input[^>]+type="text"[^>]*name="([^"]*)/i,replaceHtmlEntities),getParam(e[f],k,"templates.fieldsets.fields.extra_value",/<input[^>]+type="text"[^>]*value="([^"]*)/i,replaceHtmlEntities),getParam(e[f],k,"templates.fieldsets.fields.extra_comment",/<input[^>]+type="text"[^>]*title="([^"]*)/i,replaceHtmlEntities));AnyBalance.isAvailable("templates.fieldsets.fields.options")&&
(k.options||(k.options=[]),k.options.push(l))}else if(/<select/i.test(f))for(getParam(f,k,"id",/<select[^>]+name="([^"]*)/i,replaceHtmlEntities),e=getElements(f,/<option[^>]*>/ig),f=0;f<e.length;++f)l={},getParam(e[f],l,"templates.fieldsets.fields.options.name",null,replaceTagsAndSpaces),getParam(e[f],l,"templates.fieldsets.fields.options.value",/<option[^>]+value="([^"]*)/i,replaceHtmlEntities),/selected/i.test(e[f])&&(getParam(e[f],k,"templates.fieldsets.fields.options.value_name",null,replaceTagsAndSpaces),
getParam(e[f],k,"templates.fieldsets.fields.options.value",/<option[^>]+value="([^"]*)/i,replaceHtmlEntities)),AnyBalance.isAvailable("templates.fieldsets.fields.options")&&(k.options||(k.options=[]),k.options.push(l));else/<input[^>]+type="text"/i.test(f)?(getParam(f,k,"templates.fieldsets.fields.id",/<input[^>]+name="([^"]*)/i,replaceHtmlEntities),getParam(f,k,"templates.fieldsets.fields.value",/<input[^>]+value="([^"]*)/i,replaceHtmlEntities),getParam(f,k,"templates.fieldsets.fields.comment",/<input[^>]+title="([^"]*)/i,
replaceHtmlEntities)):/<textarea/i.test(f)?(getParam(f,k,"templates.fieldsets.fields.id",/<textarea[^>]+name="([^"]*)/i,replaceHtmlEntities),getParam(f,k,"templates.fieldsets.fields.value",/<textarea[^>]*>([\s\S]*)<\/textarea>/i,replaceTagsAndSpaces),getParam(f,k,"templates.fieldsets.fields.comment",/<input[^>]+title="([^"]*)/i,replaceHtmlEntities)):getParam(f,k,"templates.fieldsets.fields.value",null,replaceTagsAndSpaces);h.fields.push(k)}}checkDescriptiveFieldSet(h,c)||c.fieldsets.push(h)}}}}
function checkDescriptiveFieldSet(a,c){var d=a.fields.length;if(d&&2>=d){for(var b={},h=0;h<d;++h){var g=a.fields[h];if(g.id||0>["Услуга","Поставщик"].indexOf(g.name))return!1;b[g.name]=g.value}getParam(b["Услуга"],c,"templates.service");getParam(b["Поставщик"],c,"templates.provider");return!0}return!1};
