var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},baseurl="https://www.homebank.kz/new/";
function login(b){AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl,g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(a))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{a=getParam(a,null,null,/\btoken_\s*=\s*'([^']*)/,replaceSlashes);
a=AnyBalance.requestPost(baseurl+"login/login_ajax.htm",{hbid:b.login,password:b.password},addHeaders({"X-Csrf-Token":a}));b=getJson(a);if(200!=b.rc){if(b.message)throw new AnyBalance.Error(b.message,null,/неверный идентификатор или пароль/i.test(b.message));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось войти в интернет-банк. Сайт изменен?");}a=AnyBalance.requestGet(baseurl+"main.htm",g_headers)}if(!/logout/i.test(a)){if(b=getParam(a,null,null,/<div[^>]+id="errMessage"[^>]*>([\s\S]*?)<\/div>/i,
replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/Проверьте правильность указания Логина и Пароля/i.test(b));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return a}
function processAccounts(b,a){if(AnyBalance.isAvailable("accounts")){var c=getElement(b,/<li[^>]+data-menu-value="current_accounts"[^>]*>/i);if(c){var f=getElements(c,/<div[^>]+class="item"[^>]*>/ig);AnyBalance.trace("Найдено счетов: "+f.length);a.accounts=[];(c=getElement(c,/<div[^>]+error_box[^>]*>/i,replaceTagsAndSpaces))&&AnyBalance.trace("!!!!!! "+c);for(var g=0;g<f.length;++g){var e=f[g],d=getElementsByClassName(e,"account_mask",replaceTagsAndSpaces)[0],h=getElementsByClassName(e,"account_name_long",
replaceTagsAndSpaces)[0],d={__id:d,__name:h+" "+d.substr(-4),num:d,error:c};__shouldProcess("accounts",d)&&!c&&(getParam(h,a,"accounts.name"),processAccount(e,d));a.accounts.push(d)}}else/<li[^>]+date_current_accounts/i.test(b)?(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти перечень счетов.")):(AnyBalance.trace("У вас нет текущих счетов"),a.accounts=[])}}
function processAccount(b,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(b,a,"accounts.balance",/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["accounts.currency","accounts.balance"],/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseCurrency);var c=getParam(b,null,null,/fid=([^&"'\s]+)/i,replaceHtmlEntities);AnyBalance.isAvailable("accounts.date_start","accounts.status","accounts.transactions")&&(b=
AnyBalance.requestGet(baseurl+"finance/accounts/overview.htm?fid="+c,g_headers),getParam(b,a,"accounts.date_start",/Счет открыт[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(b,a,"accounts.status",/Статус счета[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,[/[^\-]*-/,"",replaceTagsAndSpaces]),AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,a))}
function processCards(b,a){if(AnyBalance.isAvailable("cards")){var c=getElement(b,/<li[^>]+data-menu-value="payment_card_accounts"[^>]*>/i);if(c){c=getElements(c,/<div[^>]+class="item"[^>]*>/ig);AnyBalance.trace("Найдено карт: "+c.length);a.cards=[];for(var f=0;f<c.length;++f){var g=c[f],e=getElementsByClassName(g,"account_mask",replaceTagsAndSpaces)[0],d=getElementsByClassName(g,"account_name",replaceTagsAndSpaces)[0],e={__id:e,__name:d+" "+e.substr(-4),num:e};__shouldProcess("cards",e)&&processCard(g,
e);a.cards.push(e)}}else/У вас нет карт/i.test(b)?(AnyBalance.trace("У вас нет карт"),a.cards=[]):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти перечень карт."))}}
function processCard(b,a){AnyBalance.trace("Обработка карты "+a.__name);getParam(b,a,"cards.balance",/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["cards.currency","cards.balance"],/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseCurrency);var c=getParam(b,null,null,/fid=([^&"'\s]+)/i,replaceHtmlEntities);AnyBalance.isAvailable("cards.available","cards.accnum","cards.till","cards.status","cards.balance_kzt",
"cards.balance_usd","cards.balance_eur","cards.transactions")&&(c=AnyBalance.requestGet(baseurl+"finance/accounts/overview.htm?fid="+c,g_headers),getParam(c,a,"cards.available",/Доступно[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.minpay",/К погашению[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.accnum",/ИИК[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),
getParam(c,a,"cards.till",/Срок действия[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(c,a,"cards.status",/Срок действия[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,[/[^\-]*-/,"",replaceTagsAndSpaces]),getParam(c,a,"cards.balance_kzt",/KZT:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.balance_usd",/USD:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,
parseBalance),getParam(c,a,"cards.balance_eur",/EUR:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),isAvailable("cards.transactions")&&processCardTransactions(c,a))}function processDeposits(b,a){AnyBalance.isAvailable("deposits")}function processDeposit(b,a){AnyBalance.trace("Обработка депозита "+a.__name);isAvailable("deposits.transactions")&&processDepositTransactions(b,a)}
function processCredits(b,a){if(AnyBalance.isAvailable("credits")){var c=getElement(b,/<li[^>]+data-menu-value="loan_accounts"[^>]*>/i);if(c){var f=getElements(c,/<div[^>]+class="item"[^>]*>/ig);AnyBalance.trace("Найдено кредитов: "+f.length);a.credits=[];(c=getElement(c,/<div[^>]+error_box[^>]*>/i,replaceTagsAndSpaces))&&AnyBalance.trace("!!!!!! "+c);for(var g=0;g<f.length;++g){var e=f[g],d=getElementsByClassName(e,"account_mask",replaceTagsAndSpaces)[0],h=getElement(e,/<div[^>]+account_name[^>]*>/i,
replaceTagsAndSpaces),d={__id:d,__name:h+" "+d.substr(-4),num:d,error:c};__shouldProcess("credits",d)&&!c&&(getParam(h,a,"credits.name"),processCredit(e,d));a.credits.push(d)}}else/<li[^>]+loan_accounts/i.test(b)?(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти перечень кредитов.")):(AnyBalance.trace("У вас нет кредитов"),a.credits=[])}}
function processCredit(b,a){AnyBalance.trace("Обработка кредита "+a.__name);getParam(b,a,"credits.balance",/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["credits.currency","credits.balance"],/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseCurrency);var c=getParam(b,null,null,/fid=([^&"'\s]+)/i,replaceHtmlEntities);AnyBalance.isAvailable("credits.limit","credits.till","credits.date_start","credits.pct","credits.pct_kok",
"credits.status")&&(b=AnyBalance.requestGet(baseurl+"finance/accounts/overview.htm?fid="+c,g_headers),getParam(b,a,"credits.limit",/Общая сумма кредита[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),getParam(b,a,"credits.till",/Дата завершения договора[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(b,a,"credits.date_start",/Дата заключения договора[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,
parseDate),getParam(b,a,"credits.pct",/Процентная ставка(?:\s|<[^>]*>)*:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(b,a,"credits.pct_kok",/Процентная ставка КОК[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(b,a,"credits.status",/Статус счета(?:\s|<[^>]*>)*:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,[/<a[^>]*>[\s\S]*?<\/a>/i,"",replaceTagsAndSpaces]),isAvailable("credits.schedule")&&
processCreditSchedule(b,a))}
function processInfo(b,a){if(AnyBalance.isAvailable("info")){b=AnyBalance.requestGet(baseurl+"settings/index.htm",g_headers);var c=a.info={};getParam(b,c,"info.fio",/ФИО:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(b,c,"info.login",/Идентификатор:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(b,c,"info.birthday",/Дата рождения:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate);getParam(b,
c,"info.passport",/Номер документа[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(b,c,"info.inn",/ИИН:[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(b,c,"info.mphone",/Доверенный контакт:[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}}function processBonuses(b,a){getParam(b,a,"bonus",/<li[^>]+bonuses_accounts[^>]*>([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance)};
