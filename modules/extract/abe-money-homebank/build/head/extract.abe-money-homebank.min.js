var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},baseurl="https://www.homebank.kz/";
function login(a){AnyBalance.setDefaultCharset("utf-8");AnyBalance.setOptions({SSL_ENABLED_PROTOCOLS:["TLSv1.2"]});checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl,g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");
else{b=getParam(b,null,null,/\btoken_\s*=\s*'([^']*)/,replaceSlashes);b=AnyBalance.requestPost(baseurl+"login/login_ajax.htm",{hbid:a.login,password:a.password},addHeaders({"X-Csrf-Token":b}));a=getJson(b);if(200!=a.rc){if(a.message)throw new AnyBalance.Error(a.message,null,/неверный идентификатор или пароль/i.test(a.message));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось войти в интернет-банк. Сайт изменен?");}b=AnyBalance.requestGet(baseurl+"main.htm",g_headers)}if(!/logout/i.test(b)){if(a=
getParam(b,null,null,/<div[^>]+id="errMessage"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Проверьте правильность указания Логина и Пароля/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}/content_wrapper_campaign/i.test(b)&&(b=getParam(b,null,null,/id="offer_id"[^>]*value="(\d+)"/),AnyBalance.requestGet(baseurl+"campaign/check_ajax.htm?r=1&l=after-login&id="+b,g_headers),b=AnyBalance.requestGet(baseurl+
"main.htm",g_headers));__setLoginSuccessful();return b}
function processAccounts(a,b){if(AnyBalance.isAvailable("accounts")){var c=getElement(a,/<li[^>]+data-menu-value="current_accounts"[^>]*>/i);if(c){a=getElements(c,/<div[^>]+class="item"[^>]*>/ig);AnyBalance.trace("Найдено счетов: "+a.length);b.accounts=[];(c=getElement(c,/<div[^>]+error_box[^>]*>/i,replaceTagsAndSpaces))&&AnyBalance.trace("!!!!!! "+c);for(var f=0;f<a.length;++f){var e=a[f],d=getElementsByClassName(e,"account_mask",replaceTagsAndSpaces)[0],g=getElementsByClassName(e,"account_name_long",
replaceTagsAndSpaces)[0],d={__id:d,__name:g+" "+d.substr(-4),num:d,error:c};__shouldProcess("accounts",d)&&!c&&(getParam(g,b,"accounts.name"),processAccount(e,d));b.accounts.push(d)}}else/<li[^>]+date_current_accounts/i.test(a)?(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти перечень счетов.")):(AnyBalance.trace("У вас нет текущих счетов"),b.accounts=[])}}
function processAccount(a,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(a,b,"accounts.balance",/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["accounts.currency","accounts.balance"],/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseCurrency);a=getParam(a,null,null,/fid=([^&"'\s]+)/i,replaceHtmlEntities);AnyBalance.isAvailable("accounts.date_start","accounts.status","accounts.transactions")&&(a=AnyBalance.requestGet(baseurl+
"finance/accounts/overview.htm?fid="+a,g_headers),getParam(a,b,"accounts.date_start",/Счет открыт[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"accounts.status",/Статус счета[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,[/[^\-]*-/,"",replaceTagsAndSpaces]),AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(a,b))}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){var c=getElement(a,/<li[^>]+data-menu-value="payment_card_accounts"[^>]*>/i);if(c)for(a=getElements(c,/<div[^>]+class="item"[^>]*>/ig),AnyBalance.trace("Найдено карт: "+a.length),b.cards=[],c=0;c<a.length;++c){var f=a[c],e=getElementsByClassName(f,"account_mask",replaceTagsAndSpaces)[0],d=getElementsByClassName(f,"account_name",replaceTagsAndSpaces)[0],e={__id:e,__name:d+" "+e.substr(-4),num:e};__shouldProcess("cards",e)&&processCard(f,
e);b.cards.push(e)}else/У вас нет карт/i.test(a)?(AnyBalance.trace("У вас нет карт"),b.cards=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти перечень карт."))}}
function processCard(a,b){AnyBalance.trace("Обработка карты "+b.__name);getParam(a,b,"cards.balance",/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["cards.currency","cards.balance"],/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseCurrency);a=getParam(a,null,null,/fid=([^&"'\s]+)/i,replaceHtmlEntities);AnyBalance.isAvailable("cards.available","cards.minpay","cards.accnum","cards.till","cards.status","cards.balance_kzt",
"cards.balance_usd","cards.balance_eur","cards.transactions")&&(a=AnyBalance.requestGet(baseurl+"finance/accounts/overview.htm?fid="+a,g_headers),getParam(a,b,"cards.available",/Доступно[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.minpay",/К погашению[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.accnum",/ИИК[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),
getParam(a,b,"cards.till",/Срок действия[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"cards.status",/Срок действия[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,[/[^\-]*-/,"",replaceTagsAndSpaces]),getParam(a,b,"cards.balance_kzt",/KZT:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.balance_usd",/USD:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,
parseBalance),getParam(a,b,"cards.balance_eur",/EUR:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),isAvailable("cards.transactions")&&processCardTransactions(a,b))}function processDeposits(a,b){AnyBalance.isAvailable("deposits")}function processDeposit(a,b){AnyBalance.trace("Обработка депозита "+b.__name);isAvailable("deposits.transactions")&&processDepositTransactions(a,b)}
function processCredits(a,b){if(AnyBalance.isAvailable("credits")){var c=getElement(a,/<li[^>]+data-menu-value="loan_accounts"[^>]*>/i);if(c){a=getElements(c,/<div[^>]+class="item"[^>]*>/ig);AnyBalance.trace("Найдено кредитов: "+a.length);b.credits=[];(c=getElement(c,/<div[^>]+error_box[^>]*>/i,replaceTagsAndSpaces))&&AnyBalance.trace("!!!!!! "+c);for(var f=0;f<a.length;++f){var e=a[f],d=getElementsByClassName(e,"account_mask",replaceTagsAndSpaces)[0],g=getElement(e,/<div[^>]+account_name[^>]*>/i,
replaceTagsAndSpaces),d={__id:d,__name:g+" "+d.substr(-4),num:d,error:c};__shouldProcess("credits",d)&&!c&&(getParam(g,b,"credits.name"),processCredit(e,d));b.credits.push(d)}}else/<li[^>]+loan_accounts/i.test(a)?(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти перечень кредитов.")):(AnyBalance.trace("У вас нет кредитов"),b.credits=[])}}
function processCredit(a,b){AnyBalance.trace("Обработка кредита "+b.__name);getParam(a,b,"credits.balance",/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["credits.currency","credits.balance"],/<span[^>]+class="account_amount_val"[\s\S]*?<\/span>/i,replaceTagsAndSpaces,parseCurrency);a=getParam(a,null,null,/fid=([^&"'\s]+)/i,replaceHtmlEntities);AnyBalance.isAvailable("credits.limit","credits.till","credits.date_start","credits.pct","credits.pct_kok",
"credits.status")&&(a=AnyBalance.requestGet(baseurl+"finance/accounts/overview.htm?fid="+a,g_headers),getParam(a,b,"credits.limit",/Общая сумма кредита[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),getParam(a,b,"credits.till",/Дата завершения договора[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"credits.date_start",/Дата заключения договора[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,
parseDate),getParam(a,b,"credits.pct",/Процентная ставка(?:\s|<[^>]*>)*:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"credits.pct_kok",/Процентная ставка КОК[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"credits.status",/Статус счета(?:\s|<[^>]*>)*:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,[/<a[^>]*>[\s\S]*?<\/a>/i,"",replaceTagsAndSpaces]),isAvailable("credits.schedule")&&
processCreditSchedule(a,b))}
function processInfo(a,b){AnyBalance.isAvailable("info")&&(a=AnyBalance.requestGet(baseurl+"settings/index.htm",g_headers),b=b.info={},getParam(a,b,"info.fio",/ФИО:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),getParam(a,b,"info.login",/Идентификатор:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),getParam(a,b,"info.birthday",/Дата рождения:[\s\S]*?<div[^>]+class="cell"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseDate),getParam(a,
b,"info.passport",/Номер документа[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),getParam(a,b,"info.inn",/ИИН:[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),getParam(a,b,"info.mphone",/Доверенный контакт:[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))}function processBonuses(a,b){getParam(a,b,"bonus",/<li[^>]+bonuses_accounts[^>]*>([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance)};
