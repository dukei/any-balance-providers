var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36"},baseurl="https://ideabank24.by/";
function login(){var c=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl+"balanceOverviewPage.xhtml",addHeaders({Referer:baseurl}));if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");/logout/i.test(b)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):
(b=getElement(b,/<form[^>]+formLogin[^>]*>/i),b=createFormParams(b,function(a,b,e,g){return"formLogin:loginInput"==e?c.login:"formLogin:passwordInput"==e?c.password:g}),b["formLogin:loginBtn"]="",b=AnyBalance.requestPost(baseurl+"loginPage.xhtml",b,addHeaders({Referer:baseurl})));if(!/logout/i.test(b)){var a=getParam(b,null,null,/<span[^>]+error-summary[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);if(a)throw new AnyBalance.Error(a,null,/(Неверный пароль|не зарегистрирован)/i.test(a));AnyBalance.trace(b);
throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return b}
function processAccounts(c,b){if(AnyBalance.isAvailable("accounts")){var a=getElement(c,/<div[^>]+card-list/i),a=getElement(a,/<ul[^>]+mainForm:j_idt\d+_list[^>]*>/i),a=getElements(a,/<li[^>]+"ui-datalist-item[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено счетов: "+a.length);b.accounts=[];for(var d=0;d<a.length;d++){var f=a[d],e=getParam(f,/<a[^>]+ui-commandlink[^>]*>\s*№\s*(\d+)/i,replaceTagsAndSpaces),g=getParam(f,/<a[^>]+ui-commandlink[^>]*>\s*№\s*\d+[\s\S]*?<div[^>]+>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),
e={__id:e,__name:g,num:e};__shouldProcess("accounts",e)&&processAccount(f,e,c);b.accounts.push(e)}}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти аккаунты. Сайт изменён?")}}
function processAccount(c,b,a){AnyBalance.trace("Обработка счета "+b.__name);c=processParams(a,c,/<a[^>]+id="([\s\S]*?)"/i);c["javax.faces.source"]?(AnyBalance.requestPost(baseurl+"balanceOverviewPage.xhtml",c,addHeaders({Referer:baseurl+"balanceOverviewPage.xhtml","X-Requested-With":"XMLHttpRequest"})),a=AnyBalance.requestGet(baseurl+"cardAccountDetailsPage.xhtml",addHeaders({Referer:baseurl+"balanceOverviewPage.xhtml"})),getParam(a,b,"accounts.balance",/<span[^>]+balance-label[^>]*>([\s\S]*?)<\/div>/i,
replaceTagsAndSpaces,parseBalance),getParam(a,b,["accounts.currency","accounts.balance"],/<span[^>]+balance-label[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency),getParam(a,b,"accounts.date_start",/договор(?:[^>]*>){2}[\s\S]*?(\d+\.\d+\.\d+)/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"accounts.pct",/процентная ставка(?:[^>]*>){2}([^%]*)/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"accounts.cardnum",/<span[^>]+link-text[^>]*><span[^>]+link-text[^>]*>[\s\S]*?(\d{6}\*+\d{4})/i,
replaceTagsAndSpaces)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти параметры запроса по аккаунту "+b.__name))}
function processCards(c,b){if(AnyBalance.isAvailable("cards")){var a=getElement(c,/<div[^>]+card-list/i),a=getElement(a,/<ul[^>]+mainForm:j_idt\d+_list[^>]*>/i),a=getElements(a,/<li[^>]+"ui-datalist-item[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено счетов с картами:"+a.length);b.cards=[];for(var d=0;d<a.length;++d){var f=a[d],e=getElements(f,/<li[^>]+ui-datalist-item/ig),f=getParam(f,/<a[^>]+ui-commandlink[^>]*>\s*№\s*(\d+)/i,replaceTagsAndSpaces);AnyBalance.trace("Счет "+f+": "+e.length+" карт");
for(var g=0;g<e.length;++g){var k=e[g],h=getParam(k,/\d{6}\*{6}\d{4}/),l=getElement(k,/<h1/i,replaceTagsAndSpaces),h={__id:h,__name:l+" x"+h.substr(-4),num:h,acc:f};__shouldProcess("cards",h)&&processCard(k,h,c);b.cards.push(h)}}}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти карты. Сайт изменён?")}}
function processCard(c,b,a){AnyBalance.trace("Обработка карты "+b.__name);c=processParams(a,c,/<td[^>]+info-panel[^>]*>[\s\S]*?<a[^>]+id="([^"]*)"/i);c["javax.faces.source"]?(AnyBalance.requestPost(baseurl+"balanceOverviewPage.xhtml",c,addHeaders({Referer:baseurl+"balanceOverviewPage.xhtml","X-Requested-With":"XMLHttpRequest"})),a=AnyBalance.requestGet(baseurl+"cardDetailsPage.xhtml",addHeaders({Referer:baseurl+"balanceOverviewPage.xhtml"})),getParam(a,b,"cards.balance",/<span[^>]+balance-label[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces,parseBalance),getParam(a,b,["cards.currency","cards.balance"],/<span[^>]ratesLabelCurrencyCode[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"cards.type",/тип карты(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"cards.till",/Срок действия(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"cards.status",/<span[^>]+class=("[^"]*")[^>]*>[^<]*Карта/i,[replaceTagsAndSpaces,/"ui-state-disabled"/i,"Неактивна",
/""/i,"Активна"]),getParam(a,b,"cards.decure",/<span[^>]+class=("[^"]*")[^>]*>[^<]*3-D Secure/i,[replaceTagsAndSpaces,/"ui-state-disabled"/i,"Неактивна",/""/i,"Активна"]),getParam(a,b,"cards.SMS",/<span[^>]+class=("[^"]*")[^>]*>[^<]*SMS-информирование/i,[replaceTagsAndSpaces,/"ui-state-disabled"/i,"Неактивна",/""/i,"Активна"])):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти параметры запроса по карте "+b.__name))}
function processDeposits(c,b){if(AnyBalance.isAvailable("deposits")){var a=getElement(c,/<div[^>]+deposit-list/i),a=getElement(a,/<ul[^>]+mainForm:j_idt\d+_list[^>]*>/i),a=getElements(a,/<li[^>]+"ui-datalist-item[^>]*>/ig);if(a.length){AnyBalance.trace("Найдено депозитов: "+a.length);b.deposits=[];for(var d=0;d<a.length;++d){var f=a[d],e=getParam(f,/Договор[^\d]*(\d+)/i,replaceTagsAndSpaces),g=getParam(f,/Договор[^\d]*(\d+)/i,replaceTagsAndSpaces),k=getParam(f,/<h1[^>]*>([\s\S]*?)<\/h1>/i,replaceTagsAndSpaces),
e={__id:e,__name:k,num:g};__shouldProcess("deposits",e)&&processDeposit(f,e,c);b.deposits.push(e)}}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти депозиты.")}}
function processDeposit(c,b,a){AnyBalance.trace("Обработка депозита "+b.__name);c=processParams(a,c,/<li[^>]+datalist[^>]*>[\s\S]*?<a[^>]+id="([^"]*)"/i);c["javax.faces.source"]?(AnyBalance.requestPost(baseurl+"balanceOverviewPage.xhtml",c,addHeaders({Referer:baseurl+"balanceOverviewPage.xhtml","X-Requested-With":"XMLHttpRequest"})),a=AnyBalance.requestGet(baseurl+"depositDetailsPage.xhtml",addHeaders({Referer:baseurl+"balanceOverviewPage.xhtml"})),getParam(a,b,"deposits.balance",/<span[^>]+balance-label[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces,parseBalance),getParam(a,b,"deposits.profit",/доходность(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,["deposits.currency","deposits.balance","deposits.profit"],/доходность(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseCurrency),getParam(a,b,"deposits.date_start",/договор[\s\S]*?от\s*(\d+\.\d+\.\d+)\s*<\/td>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"deposits.pct",/процентная ставка(?:[^>]*>){4}([^%]*)/i,replaceTagsAndSpaces,parseBalance),
getParam(a,b,"deposits.pctClose",/Ставка расторжения(?:[^>]*>){4}([^%]*)/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"deposits.duration",/Продолжительность(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"deposits.pct_condition",/Выплата процентов(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"deposits.capitalization",/Капитализация(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"deposits.withdraw",/Частичное снятие(?:[^>]*>){2}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces),getParam(a,b,"deposits.topup",/Пополнение(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"deposits.prolong",/Автопролонгация(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"deposits.revocation",/Отзыв депозита(?:[^>]*>){2}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти параметры запроса по депозиту "+b.__name))}
function processCredits(c,b){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processInfo(c,b){b=b.info={};getParam(c,b,"info.fio",/<label[^>]+user-name[^>]*>([\s\S]*?)<\/label>/i,replaceTagsAndSpaces)}
function processParams(c,b,a){var d=getElement(c,/<form[^>]+mainform[^>]*>/i),d=createFormParams(d,function(a,b,c,d){return d});c=getParam(b||c,a);d["javax.faces.partial.ajax"]=!0;d["javax.faces.partial.execute"]="@all";d["javax.faces.source"]=c;d[c]=c;return d};
