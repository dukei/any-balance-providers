var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36"},baseurl="https://ideaonline.ua/",postKey;
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var c=AnyBalance.requestGet(baseurl+"Pages/Security/LogOn.aspx",g_headers);if(!c||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(c),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(c))AnyBalance.trace("Уже залогинены, используем существующую сессию");
else{var b=getElement(c,/<form[^>]+name="aspnetform"[^>]*>/i),d=createFormParams(b,function(b,c,d,h){return"ctl00$body$ContentBody$wzLogin$tbLogin"==d?a.login:"ctl00$body$ContentBody$wzLogin$tbPassword"==d?a.password:h});d.__EVENTTARGET=getParam(b,null,null,/<a[^>]+class="submit"[^>]+postbackoptions\(([\s\S]*?),/i,[/&quot;/g,""]);if(!d.__EVENTTARGET)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось найти параметр запроса. Сайт изменён?");c=AnyBalance.requestPost(baseurl+"Pages/Security/LogOn.aspx",
d,addHeaders({Referer:baseurl+"Pages/Security/LogOn.aspx?"}))}if(!/logout/i.test(c)){if(b=getParam(c,null,null,/<div[^>]+vlsummarylogin[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/Неверные логин или пароль/i.test(b));AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}postKey=getParam(c,null,null,/<input[^>]+responsetoken[^>]+value="([\s\S]*?)"/i);if(!postKey)throw AnyBalance.trace(c),new AnyBalance.Error("Не удалось найти параметр запроса. Сайт изменён?");
__setLoginSuccessful();return c}
function processAccounts(a,c){if(AnyBalance.isAvailable("accounts")){a=AnyBalance.requestGet(baseurl+"Pages/Account/MyAccounts.aspx?postkey="+postKey,g_headers);var b=getElement(a,/<table[^>]+gvAccounts[^>]*>/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length&&1!=b.length){AnyBalance.trace("Найдено счетов: "+(b.length-1));c.accounts=[];for(var d=1;d<b.length;++d){var e=getParam(b[d],null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<span/i,replaceTagsAndSpaces),f=getParam(b[d],null,null,/(?:[\s\S]*?<td[^>]*>){2}([\s\S]*?)<span/i,
replaceTagsAndSpaces),g=getParam(b[d],null,null,/<a[^>]+accountname[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("accounts",e)&&(processAccount(a,b[d],e),a=AnyBalance.requestGet(baseurl+"Pages/Account/MyAccounts.aspx?postkey="+postKey,addHeaders({Referer:baseurl+"Pages/Account/MyAccounts.aspx?postkey="+postKey})));c.accounts.push(e)}postKey=getParam(a,null,null,/<input[^>]+responsetoken[^>]+value="([\s\S]*?)"/i)}else/(Нет счетов|Немає рахункiв|No accounts)/i.test(a)?
(AnyBalance.trace("У вас нет счетов"),c.accounts=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти ни одного счета."))}}
function processAccount(a,c,b){AnyBalance.trace("Обработка счета "+b.__id);var d=getParamByName(a,["__EVENTARGUMENT","__EVENTVALIDATION","__VIEWSTATE","__VIEWSTATEENCRYPTED","__VIEWSTATEGENERATOR"]);d.__EVENTTARGET=getParam(c,null,null,/<a[^>]+dopostback\(([\s\S]*?),/i,[/(&#39;)/g,""]);d.__EVENTTARGET?(a=AnyBalance.requestPost(baseurl+"Pages/Account/MyAccounts.aspx?postkey="+postKey,d,addHeaders({Referer:baseurl+"Pages/Account/MyAccounts.aspx?postkey="+postKey})),getParam(a,b,"accounts.additionalAgreement",
/<span[^>]+rffAdditionalAgreement[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"accounts.agreement",/<span[^>]+rffagreement[^>]*>№\s*([^\s]*)/i,replaceTagsAndSpaces),getParam(a,b,"accounts.agreementDate",/<span[^>]+rffagreement[^>]*>[\s\S]*?(\d{2}\.\d{2}\.\d{4})<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"accounts.product",/<span[^>]+lffproductName[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"accounts.branch",/<span[^>]+rffBranch[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),
getParam(a,b,"accounts.balance",/<span[^>]+rffBalance[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"accounts.availableBalance",/<span[^>]+rffAvailableFunds[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,["accounts.currency","accounts.balance","accounts.AvailableBalance"],/<span[^>]+rffBalance[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseCurrency),AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(a,b)):(AnyBalance.trace(a),
AnyBalance.trace("Не удалось найти параметр запроса для обработки карты."))}
function processCards(a,c){if(AnyBalance.isAvailable("cards")){a=AnyBalance.requestGet(baseurl+"Pages/Card/MyCards.aspx?postkey="+postKey,g_headers);var b=getElements(a,/<table[^>]+gvcards[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено карт: "+b.length);c.cards=[];for(var d=0;d<b.length;++d){var e=b[d],f=getParam(e,null,null,/(?:[\s\S]*?<tr[^>]*>){2}(?:[^>]*>){6}([\s\S]*?)<\//i),g=getParam(e,null,null,/(?:[\s\S]*?<tr[^>]*>){2}(?:[^>]*>){6}([\s\S]*?)<\//i,replaceTagsAndSpaces),h=getParam(e,null,
null,/(?:[\s\S]*?<tr[^>]*>){2}(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces),f={__id:f,__name:h,num:g};__shouldProcess("cards",f)&&(processCard(a,e,f),a=AnyBalance.requestGet(baseurl+"Pages/Card/MyCards.aspx?postkey="+postKey,addHeaders({Referer:baseurl+"Pages/Card/MyCards.aspx?postkey="+postKey})));c.cards.push(f)}postKey=getParam(a,null,null,/<input[^>]+responsetoken[^>]+value="([\s\S]*?)"/i)}else/У вас нет карт/i.test(a)?(AnyBalance.trace("У вас нет карт"),c.cards=[]):(AnyBalance.trace(a),
AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(a,c,b){AnyBalance.trace("Обработка карты "+b.__name);getParam(c,b,"cards.status",/<td[^>]+columnstatus[^>]*>([\s\S]*?)</i,replaceTagsAndSpaces);getParam(c,b,"cards.till",/<td[^>]+columndate[^>]*>([\s\S]*?)</i,replaceTagsAndSpaces,parseDateWord);var d=getParamByName(a,["__VIEWSTATE","__VIEWSTATEGENERATOR","__VIEWSTATEENCRYPTED","__EVENTVALIDATION"]);d.__EVENTTARGET=getParam(c,null,null,/<a[^>]+dopostback\(([\s\S]*?),/i,[/(&#39;)/g,""]);d.__EVENTARGUMENT=getParam(c,null,null,/<a[^>]+,([\s\S]*?)\)/i,
[/(&#39;)/g,""]);d.__EVENTARGUMENT&&d.__EVENTTARGET?(a=AnyBalance.requestPost(baseurl+"Pages/Card/MyCards.aspx?postkey="+postKey,d,addHeaders({Referer:"Pages/Card/MyCards.aspx?postkey="+postKey})),getParam(a,b,"cards.sign",/<span[^>]+lffFeature[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"cards.type",/<span[^>]+lffCardType[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"cards.kind",/<span[^>]+lffCardKind[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"cards.toAcc",
/<a[^>]+rffAccount[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),getParam(a,b,"cards.accOwner",/<span[^>]+lffaccountowner[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),getParam(a,b,"cards.cardholder",/<span[^>]+lffCardholder[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),isAvailable("cards.transactions")&&processCardTransactions(a,b)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти параметр запроса подробной информации о карте."))}
function processDeposits(a,c){if(AnyBalance.isAvailable("deposits")){a=AnyBalance.requestGet(baseurl+"Pages/Deposit/MyDeposits.aspx?postkey="+postKey,g_headers);var b=getElement(a,/<table[^>]+gvdeposits[^>]*>/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length&&1!=b.length){AnyBalance.trace("Найдено депозитов: "+(b.length-1));c.deposits=[];for(var d=1;d<b.length;++d){var e=getParam(b[d],null,null,/<td[^>]+ltext[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),f=getParamByName(a,["__EVENTARGUMENT","__VIEWSTATE",
"__VIEWSTATEGENERATOR","__VIEWSTATEENCRYPTED","__EVENTVALIDATION"]);f.__EVENTTARGET=getParam(b[d],null,null,/<a[^>]+dopostback\(([\s\S]*?),/i,[/(&#39;)/g,""]);if(f.__EVENTTARGET){a=AnyBalance.requestPost(baseurl+"Pages/Deposit/MyDeposits.aspx?postkey="+postKey,f,addHeaders({Referer:baseurl+"Pages/Deposit/MyDeposits.aspx?postkey="+postKey}));var f=getParam(a,null,null,/<span[^>]+rffDepositAccountNumber[^>]*>([\s\S]*?)<\/span>/i),g=getParam(a,null,null,/<span[^>]+rffDepositAccountNumber[^>]*>([\s\S]*?)<\/span>/i),
e={__id:f,__name:e,num:g};__shouldProcess("deposits",e)&&(processDeposit(a,b[d],e),a=AnyBalance.requestGet(baseurl+"Pages/Deposit/MyDeposits.aspx?postkey="+postKey,addHeaders({Referer:baseurl+"Pages/Deposit/MyDeposits.aspx?postkey="+postKey})));c.deposits.push(e)}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти параметр запроса для обработки депозита.")}postKey=getParam(a,null,null,/<input[^>]+responsetoken[^>]+value="([\s\S]*?)"/i)}else/(Немає депозитiв|Нет депозитов|No deposit)/i.test(a)?
(AnyBalance.trace("У вас нет депозитов"),c.deposits=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу с депозитами."))}}
function processDeposit(a,c,b){AnyBalance.trace("Обработка депозита "+b.__name);getParam(c,b,"deposits.date_start",/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)</i,replaceTagsAndSpaces);getParam(c,b,"deposits.till",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)</i,replaceTagsAndSpaces);getParam(a,b,"deposits.pct",/<span[^>]+lffInterestRateActual[^>]*>[^\%]*\%/i,replaceTagsAndSpaces);getParam(a,b,"deposits.pctStart",/<span[^>]+rffInterestRate[^>]*>[^\%]*\%/i,replaceTagsAndSpaces);getParam(a,b,"deposits.pctClose",/<span[^>]+lffInterestRateTerminate[^>]*>[^\%]*\%/i,
replaceTagsAndSpaces);getParam(a,b,"deposits.pct_condition",/<span[^>]+rffInterestsPayment[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.prolong",/<span[^>]+rffProlongation[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.accPct",/<span[^>]+rffReturnAccount[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.topup",/<span[^>]+rffReplenishment[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.withdraw",/<span[^>]+rffWithdrawal[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces);getParam(a,b,"deposits.capitalization",/<span[^>]+rffCapitalization[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(a,b,"deposits.agreement",/<span[^>]+rffagreement[^>]*>№\s*([^\s]*)/i,replaceTagsAndSpaces);getParam(a,b,"deposits.balance",/<span[^>]+rffAmount[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalanceSilent);getParam(a,b,"deposits.balance_min",/<span[^>]+lffMinAmount[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalanceSilent);getParam(a,b,"deposits.balance_max",
/<span[^>]+lffMaxAmount[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalanceSilent);getParam(a,b,"deposits.profit",/<span[^>]+rffProfit[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalanceSilent);getParam(a,b,["deposits.currency","deposits.balance","deposits.balance_min","deposits.balance_max","deposits.profit"],/<span[^>]+rffAmount[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseCurrency);isAvailable("deposits.transactions")&&processDepositTransactions(a,b)}
function processCredits(a,c){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processInfo(a,c){var b=c.info={};getParam(a,b,"info.fio",/<div[^>]+barname[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);postKey=getParam(a,null,null,/<input[^>]+responsetoken[^>]+value="([\s\S]*?)"/i)}
function getParamByName(a,c){c=isArray(c)?c:[c];for(var b={},d=0;d<c.length;d++)b[c[d]]=getParam(a,null,null,new RegExp("name=[\"']"+c[d]+'["\'][^>]*value=["\']([^"\']+)"',"i"))||"";return b};
