var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive",Origin:"https://iclick.imoneybank.ru","User-Agent":"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.134 Safari/537.36"},g_baseurl="https://iclick.imoneybank.ru/";
function login(){AnyBalance.setOptions({cookiePolicy:"netscape"});var a=AnyBalance.getPreferences();checkEmpty(a.login,"Введите логин! Логин должен быть в формате 9001234567!");checkEmpty(a.password,"Введите пароль!");AnyBalance.setDefaultCharset("utf-8");try{var b=AnyBalance.requestGet(g_baseurl,addHeaders({Referer:g_baseurl}))}catch(c){if(!a.__debug)throw c;b=""}if(/logout/i.test(b))AnyBalance.trace("Уже внутри. Пользуемся предыдущей сессией");else{b=AnyBalance.requestGet(g_baseurl+"login",addHeaders({Referer:g_baseurl}));
if(/Личный кабинет временно недоступен/i.test(b))throw a=getParam(b,null,null,/<\/h1>[^]*?<table[^>]*>/i,replaceTagsAndSpaces),new AnyBalance.Error(a||"Личный кабинет временно недоступен");try{b=AnyBalance.requestPost(g_baseurl+"login_check",{_cellphone:a.login,_password:a.password,submit:""},addHeaders({Referer:AnyBalance.getLastUrl()}))}catch(c){if(!a.__debug)throw c;b=AnyBalance.requestGet(g_baseurl,addHeaders({Referer:AnyBalance.getLastUrl()}))}}if(!/logout/i.test(b)){if(a=getParam(b,null,null,
/window.msg\(["']([^"']+)["'],\s*["']error/i,replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Номер не зарегистрирован в системе|Неверная пара логин\/пароль|Поля формы заполнены некорректно/i.test(a));if(/Личный кабинет временно недоступен/i.test(b))throw a=getParam(b,null,null,/<\/h1>[^]*?<table[^>]*>/i,replaceTagsAndSpaces),new AnyBalance.Error(a||"Личный кабинет временно недоступен");AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");}__setLoginSuccessful();
return b}function parseCurrencyEx(a){if(/rouble/i.test(a))return"RUB";a=replaceAll(a,[replaceTagsAndSpaces,replaceHtmlEntities]);return parseCurrency(a)}function fetchAccounts(a){var b=AnyBalance.requestGet(g_baseurl+"account/list?_="+(new Date).getTime(),addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"})),b=getJson(b);a.accounts=[];for(var c=0;c<b.length;++c){var d=b[c],e={};e.__id=d.id;e.__name=d.name;__shouldProcess("accounts",e)&&fetchAccount(e,d);a.accounts.push(e)}}
function n2(a){return 10>a?"0"+a:""+a}function fetchInfo(a,b){AnyBalance.isAvailable("info")&&(a.info={},getParam(b,a,"info.fio",/<a[^>]+href="[^"]*\/profile[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),getParam(prefs.login,a,"info.mphone"),AnyBalance.isAvailable("info.email")&&(b=AnyBalance.requestGet(g_baseurl+"profile/alerts/email",addHeaders({Referer:g_baseurl})),getParam(b,a,"info.email",/<input[^>]+id="change_alert_data_email"[^>]*value="([^"]*)/i,replaceHtmlEntities)))}
function fetchAccount(a,b){getParam(b.rest,a,"accounts.balance",null,replaceTagsAndSpaces,parseBalance);getParam(b.rest,a,["accounts.currency","accounts.balance"],null,null,parseCurrencyEx);getParam(b.doc,a,"accounts.type");getParam(b.is_active,a,"accounts.active");if(AnyBalance.isAvailable("accounts.pct","accounts.agreement","accounts.date_start","accounts.owner")){var c=AnyBalance.requestGet(g_baseurl+"account/"+b.id+"/info",addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"}));getParam(c,
a,"accounts.pct",/<dt[^>]*>\s*Текущая процентная ставка в год[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"accounts.agreement",/<dt[^>]*>\s*Номер договора[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces);getParam(c,a,"accounts.date_start",/<dt[^>]*>\s*Дата открытия счета[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseDate);getParam(c,a,"accounts.owner",/<dt[^>]*>\s*Владелец[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces);getParam(c,
a,"accounts.status",/<dt[^>]*>\s*Статус счета[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces)}getParam(b.name,a,"accounts.num");if(AnyBalance.isAvailable("accounts.transactions")){var c=new Date,d=new Date(c.getFullYear()-3,c.getMonth(),c.getDate()),c=AnyBalance.requestGet(g_baseurl+"account/"+b.id+"/statement?from="+(n2(d.getDate())+"."+n2(d.getMonth()+1)+"."+d.getFullYear())+"&to="+(n2(c.getDate())+"."+n2(c.getMonth()+1)+"."+c.getFullYear()),addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"}));
/<div[^>]+class="items"[^>]*>/i.test(c)&&(a.transactions=[]);c=getElements(c,/<div[^>]+class="item"[^>]*>/ig);for(d=0;d<c.length;++d){var e={},f=getElements(c[d],/<span[^>]*>/ig);getParam(f[0],e,"accounts.transactions.date",null,replaceTagsAndSpaces,parseDateSilent);getParam(f[1],e,"accounts.transactions.sum",null,replaceTagsAndSpaces,parseBalanceSilent);getParam(f[2],e,"accounts.transactions.descr",null,replaceTagsAndSpaces);a.transactions.push(e)}}}
function fetchCards(a){var b=AnyBalance.requestGet(g_baseurl+"card/list?_="+(new Date).getTime(),addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"})),b=getJson(b);a.cards=[];for(var c=0;c<b.length;++c){var d=b[c],e={};e.__id=d.id;e.__name=d.name;__shouldProcess("cards",e)&&fetchCard(e,d);a.cards.push(e)}}
function fetchCard(a,b){getParam(b.rest,a,"cards.balance",null,replaceTagsAndSpaces,parseBalance);getParam(b.rest,a,["cards.currency","cards.balance"],null,null,parseCurrencyEx);getParam(b.doc,a,"cards.type");getParam(b.is_active,a,"cards.active");AnyBalance.isAvailable("cards.till","cards.accnum","cards.agreement","cards.date_start","cards.date_start_vip","cards.date_end_vip","cards.holder","cards.cardnum","cards.status")&&(html=AnyBalance.requestGet(g_baseurl+"card/"+b.id,addHeaders({Referer:g_baseurl,
"X-Requested-With":"XMLHttpRequest"})),getParam(html,a,"cards.till",/<dt[^>]*>\s*Действительна по[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseDate),getParam(html,a,"cards.accnum",/<dt[^>]*>\s*Счет карты[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"cards.agreement",/<dt[^>]*>\s*Номер договора[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"cards.date_start",/<dt[^>]*>\s*Дата активации карты[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,
parseDate),getParam(html,a,"cards.date_start_vip",/<dt[^>]*>\s*Дата подключения VIP-пакета услуг[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseDate),getParam(html,a,"cards.date_end_vip",/<dt[^>]*>\s*Дата окончания действия VIP-пакета услуг[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseDate),getParam(html,a,"cards.holder",/<dt[^>]*>\s*Держатель карты[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"cards.cardnum",/<dt[^>]*>\s*Номер карты[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,
replaceTagsAndSpaces),getParam(html,a,"cards.status",/<dt[^>]*>\s*Статус карты[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces));AnyBalance.isAvailable("cards.own","cards.pct_sum","cards.pct","cards.pct_period","cards.pct_credit","cards.pct_credit_period","cards.limit","cards.min_pay","cards.min_pay_till")&&(html=AnyBalance.requestGet(g_baseurl+"card/"+b.id+"/info",addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"})),getParam(html,a,"cards.own",/<dt[^>]*>\s*Собственные средства[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,
replaceTagsAndSpaces,parseBalance),getParam(html,a,"cards.pct_sum",/<dt[^>]*>\s*Сумма процентов начисленных[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance),getParam(html,a,"cards.pct",/<dt[^>]*>\s*Накопительная ставка в год[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance),getParam(html,a,"cards.pct_period",/<dt[^>]*>\s*Выплата процентов по карте[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"cards.pct_credit",/<dt[^>]*>\s*Кредитная процентная ставка[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,
replaceTagsAndSpaces,parseBalance),getParam(html,a,"cards.pct_credit_period",/<dt[^>]*>\s*Условия начисления процентов по карте[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"cards.credit_period",/<dt[^>]*>\s*Срок кредита[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"cards.limit",/<dt[^>]*>\s*Максимально разрешенный овердрафт[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance),getParam(html,a,"cards.min_pay",/<dt[^>]*>\s*Минимальный ежемесячный платеж по кредиту[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,
replaceTagsAndSpaces,parseBalance),getParam(html,a,"cards.min_pay_till",/<dt[^>]*>\s*Срок ближайшего платежа по кредиту[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance));if(AnyBalance.isAvailable("cards.transactions")){var c=new Date,d=new Date(c.getFullYear()-3,c.getMonth(),c.getDate());html=AnyBalance.requestGet(g_baseurl+"card/"+b.id+"/statement?from="+(n2(d.getDate())+"."+n2(d.getMonth()+1)+"."+d.getFullYear())+"&to="+(n2(c.getDate())+"."+n2(c.getMonth()+1)+"."+c.getFullYear()),
addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"}));/<div[^>]+class="items"[^>]*>/i.test(html)&&(a.transactions=[]);c=getElements(html,/<div[^>]+class="item"[^>]*>/ig);for(d=0;d<c.length;++d){var e={},f=getElements(c[d],/<span[^>]*>/ig);getParam(f[0],e,"cards.transactions.date",null,replaceTagsAndSpaces,parseDateSilent);getParam(f[1],e,"cards.transactions.sum",null,replaceTagsAndSpaces,parseBalanceSilent);getParam(f[2],e,"cards.transactions.descr",null,replaceTagsAndSpaces);a.transactions.push(e)}}}
function fetchDeposits(a){var b=AnyBalance.requestGet(g_baseurl+"deposit/list?_="+(new Date).getTime(),addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"})),b=getJson(b);a.deposits=[];for(var c=0;c<b.length;++c){var d=b[c],e={};e.__id=d.id;e.__name=d.name;__shouldProcess("deposits",e)&&fetchDeposit(e,d);a.deposits.push(e)}}
function fetchDeposit(a,b){getParam(b.rest,a,"deposits.balance",null,replaceTagsAndSpaces,parseBalance);getParam(b.rest,a,["deposits.currency","deposits.balance"],null,null,parseCurrencyEx);getParam(b.doc,a,"deposits.type");getParam(b.is_active,a,"deposits.active");AnyBalance.isAvailable("deposits.owner","deposits.period_days","deposits.pct","deposits.agreement","deposits.status","deposits.date_start","deposits.date_end","deposits.accnum","deposits.accnum_pct")&&(html=AnyBalance.requestGet(g_baseurl+
"deposit/"+b.id,addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"})),getParam(html,a,"deposits.period_days",/<dt[^>]*>\s*Срок вклада[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance),getParam(html,a,"deposits.pct",/<dt[^>]*>\s*Текущая процентная ставка в год[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance),getParam(html,a,"deposits.agreement",/<dt[^>]*>\s*Номер договора[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,
a,"deposits.status",/<dt[^>]*>\s*Статус вклада[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"deposits.date_start",/<dt[^>]*>\s*Дата открытия вклада[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseDate),getParam(html,a,"deposits.date_end",/<dt[^>]*>\s*Дата окончания вклада[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseDate),getParam(html,a,"deposits.accnum",/<dt[^>]*>\s*Счет вклада[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,
a,"deposits.accnum_pct",/<dt[^>]*>\s*Счет выплаты процентов по вкладу[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces));AnyBalance.isAvailable("deposits.owner","deposits.topup","deposits.pct_period","deposits.min_topup","deposits.max_topup_period_days")&&(html=AnyBalance.requestGet(g_baseurl+"deposit/"+b.id+"/info",addHeaders({Referer:g_baseurl,"X-Requested-With":"XMLHttpRequest"})),getParam(html,a,"deposits.owner",/<dt[^>]*>\s*Вкладчик[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),
getParam(html,a,"deposits.topup",/<dt[^>]*>\s*Условия пополнения вклада[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"deposits.pct_period",/<dt[^>]*>\s*Условия выплаты процентов по вкладу[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces),getParam(html,a,"deposits.min_topup",/<dt[^>]*>\s*Минимальная сумма пополнения[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,replaceTagsAndSpaces,parseBalance),getParam(html,a,"deposits.max_topup_period_days",/<dt[^>]*>\s*Максимальный срок пополнения[\s\S]*?<dd[^>]*>([\s\S]*?)<\/dd>/i,
replaceTagsAndSpaces,parseBalance))};
