var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.97 Safari/537.36"},baseurl="https://on-line.ipb.ru/";
function login(b){AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl+"start.aspx",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");/sExit/i.test(a)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):(a={__LASTFOCUS:"",_TSM_HiddenField_:getParamByName(a,
"_TSM_HiddenField_"),__EVENTTARGET:"",__EVENTARGUMENT:"",__VIEWSTATE:getParamByName(a,"__VIEWSTATE"),__VIEWSTATEGENERATOR:getParamByName(a,"__VIEWSTATEGENERATOR"),__EVENTVALIDATION:getParamByName(a,"__EVENTVALIDATION"),tbLogin:b.login,tbPassword:b.password,HiddenField1:"",HiddenField2:"",btnAccept:"Далее",hfCBW:"",HiddenField_GUID:"",tbxSMSPwd:"",tbxTokenPwd:"",hfewc:"false",ctl00_HiddenFieldIdAbonent:"",ctl00_HiddenFieldApletVer:"",ctl00_HiddenFieldApletPath:""},a=AnyBalance.requestPost(baseurl+
"Login/login.aspx",a,addHeaders({Referer:baseurl+"Login/login.aspx",Origin:baseurl})),__setLoginSuccessful());if(/<input[^>]+name="txtCode"/i.test(a)){AnyBalance.trace("Потребовался ввод кода.");var c=getElement(a,/<p[^>]*msgSMSCode[^>]*/i,replaceTagsAndSpaces);getElement(a,/<form[^>]+name="login"[^>]*>/i);a=createFormParams(a,function(a,b,d,g){return"txtCode"==d?AnyBalance.retrieveCode((c||"Пожалуйста, введите код из SMS для входа в интернет-банк.")+'\n\nЧтобы каждый раз не вводить код, вы можете отключить его в своём интернет банке: меню "Настройки системы"/"Настройки информирования"/"Информирование об операциях в системе", затем снять галочку "Запрашивать SMS-код подтверждения при входе". Это безопасно, код подтверждения всё равно будет требоваться для всех операций.',
null,{inputType:"number",time:18E4}):g});a=AnyBalance.requestPost(baseurl+"Login/login.aspx",a,addHeaders({Referer:baseurl+"secure/login.aspx"}))}if(!/sExit/i.test(a)){if(b=getParam(a,null,null,/<span[^>]+id="lerrortext"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(b,null,/(Пароль неверен|не зарегистрирован)/i.test(b));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}return a}
function getParamByName(b,a){return getParam(b,null,null,new RegExp("name=[\"']"+a+'["\'][^>]*value=["\']([^"\']+)"',"i"))}
function processCards(b,a){if(AnyBalance.isAvailable("cards")){b=AnyBalance.requestGet(baseurl+"cards.aspx",g_headers);var c=getParam(b,null,null,/<table[^>]+class="GridTable"[^>]*>[^]*?<\/div>/i);if(c){c=getElements(c,/<tr[^>]+class="normal[^>]+>/ig);AnyBalance.trace("Найдено карт: "+c.length);a.cards=[];for(var f=0;f<c.length;++f){var e=c[f],d=getParam(e,null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i),g=getParam(e,null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),
h=getParam(e,null,null,/<span[^>]+id="ctl00_ContentPlaceHolder1_listDocs_ctl02_lDescr"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,null),d={__id:d,__name:h,num:g};__shouldProcess("cards",d)&&processCard(e,d);a.cards.push(d)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с картами.")}}
function processCard(b,a){AnyBalance.trace("Обработка карты "+a.__name);getParam(b,a,"cards.balance",/(?:[\s\S]*?<\/table>){1}(?:[^]*?<td[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"cards.limit",/(?:[\s\S]*?<\/table>){2}(?:[^]*?<td[^>]*>){4}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"cards.available",/(?:[\s\S]*?<\/table>){2}(?:[^]*?<td[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["cards.currency","cards.balance","cards.limit",
"cards.available"],/<span[^>]+id="ctl00_ContentPlaceHolder1_listDocs_ctl02_lblCurrency"[^>]*>([\s\S]*?)<\/span>/i,[replaceTagsAndSpaces,/(.*?)/,"0$1"],parseCurrency);getParam(b,a,"cards.status",/(?:[\s\S]*?<\/table>){2}(?:[^]*?<td[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(b,a,"cards.till",/(?:[\s\S]*?<\/table>){2}(?:[^]*?<td[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate)}
function processDeposits(b,a){if(AnyBalance.isAvailable("cards")){b=AnyBalance.requestGet(baseurl+"deposits.aspx",g_headers);var c=getParam(b,null,null,/<table[^>]+class="GridTable"[^>]*>[^]*?<\/div>/i);if(c){c=getElements(c,/<tr[^>]+class="normal[^>]+>/ig);AnyBalance.trace("Найдено депозитов: "+c.length);a.deposits=[];for(var f=0;f<c.length;++f){var e=c[f],d=getParam(e,null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),g=getParam(e,null,null,/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces),h=getParam(e,null,null,/<span[^>]+id="ctl00_ContentPlaceHolder1_listDocs_ctl02_lDescr"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),d={__id:d,__name:h,num:g};__shouldProcess("deposits",d)&&processDeposit(e,d);a.deposits.push(d)}}else AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с депозитами.")}}
function processDeposit(b,a){getParam(b,a,"deposits.pct",/(?:[\s\S]*?<\/table>){1}(?:[^]*?<td[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"deposits.balance",/(?:[\s\S]*?<\/table>){1}(?:[^>]*>){5}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["deposit.currency","deposits.balance"],/<span[^>]+id="ctl00_ContentPlaceHolder1_listDocs_ctl02_lblCurrency"[^>]*>([\s\S]*?)<\/span>/i,[replaceTagsAndSpaces,/(.*?)/,"0$1"],parseCurrency);getParam(b,a,"deposits.till",
/<tr[^>]*>(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate)}
function processInfo(b,a){b=AnyBalance.requestGet(baseurl+"RbContract.aspx",g_headers);var c=a.info={};getParam(b,c,"info.fio",/<input[^>]+name="ctl00\$ContentPlaceHolder1\$TabContainer1\$TabPanel1\$tbClientName"[^>]+value="([\s\S]*?)"/i,replaceTagsAndSpaces);getParam(b,c,"info.INN",/<input[^>]+name="ctl00\$ContentPlaceHolder1\$TabContainer1\$TabPanel3\$tbINN"[^>]+value="([\s\S]*?)"/i,replaceHtmlEntities);getParam(b,c,"info.email",/<input[^>]+name="ctl00\$ContentPlaceHolder1\$TabContainer1\$TabPanel1\$tbEmail"[^>]+value="([\s\S]*?)"/i,
replaceHtmlEntities);getParam(b,c,"info.till",/<input[^>]+name="ctl00\$ContentPlaceHolder1\$TabContainer1\$TabPanel1\$tbPeriodEndDate"[^>]+value="([\s\S]*?)"/i,replaceHtmlEntities,parseDate);getParam(b,c,"info.agreement",/<input[^>]+name="ctl00\$ContentPlaceHolder1\$TabContainer1\$TabPanel1\$lContractNum"[^>]+value="([\s\S]*?)"/i,replaceHtmlEntities)};
