var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36"},baseurl="https://kaspi.kz";
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");if(AnyBalance.getData){var b=AnyBalance.getData("kaspi-tag");b&&AnyBalance.setCookie("kaspi.kz","kaspi-tag",b)}checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");b=AnyBalance.requestGet(baseurl+"/entrance",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");
if(/logout/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var c=getParam(a.login||"",null,null,/^\d{10}$/,[/^(\d{3})(\d{3})(\d{2})(\d{2})$/,"+7 ($1) $2-$3-$4"]);if(!c)throw new AnyBalance.Error("Не верный формат логина, необходимо вводить логин без +7 в начале и без пробелов.");var d=AB.getParam(b,null,null,/<input[^>]+name="authToken"[^>]+value="([^"]*)/i);if(!d)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось найти токен авторизации. Сайт изменён?");
b={submitId:"SignIn",webFormValues:[{name:"FormId",value:"SignInForm"},{name:"AuthToken",value:d},{name:"SignInLogin",value:c},{name:"Password",value:a.password}],requestTimestamp:(new Date).toISOString()};b=AnyBalance.requestPost(baseurl+"/api/auth/sign-in",JSON.stringify(b),addHeaders({Referer:baseurl+"/entrance","X-Requested-With":"XMLHttpRequest",Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":"application/json; charset=UTF-8"}));a=getJson(b);if(a.load&&/SmsAuth/i.test(a.load)){AnyBalance.trace("Затребован SMS-код");
b=AnyBalance.requestPost(baseurl+a.load,a.loadparams,addHeaders({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Referer:baseurl+"/entrance"}));a=getElement(b,/<form[^>]+SendMeSmsForm/i);if(!a)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось получить форму ввода кода из SMS. Сайт изменен?");var e=AB.createFormParams(a,function(a,b,c,d){return"SMSCode"==c?AnyBalance.retrieveCode("Вам отправлено SMS-сообщение с кодом для входа в личный кабинет Каспи банка. Введите код из SMS",
null,{inputType:"number",minLength:4,maxLength:4,time:3E5}):d}),b={submitId:"SendMeSms",webFormValues:Object.keys(e).map(function(a){var b={};b.name=a;b.value=e[a];return b}),requestTimestamp:(new Date).toISOString()},b=AnyBalance.requestPost(baseurl+"/api/auth/sign-in",JSON.stringify(b),addHeaders({Referer:baseurl+"/entrance","X-Requested-With":"XMLHttpRequest",Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":"application/json; charset=UTF-8"})),a=getJson(b)}if(!a.location){a=
a.errors;c="";a[0]&&(c=a[0].message);if(c)throw new AnyBalance.Error(c,null,/Мы не нашли такой пароль/i.test(c));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}AnyBalance.setData&&(AnyBalance.setData("kaspi-tag",AnyBalance.getCookie("kaspi-tag")),AnyBalance.saveData())}__setLoginSuccessful();return b}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){a=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=AB.getElement(a,/<div[^>]+id="(item_creditcards|item_kaspi_gold)"[^>]*>/i);if(c)for(a=AB.getElements(c,/<div[^>]+(credicardInfoWrapper|payrolCardInfoWrapper)[^>]*>/ig),a||(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти карты. Сайт изменён?")),AnyBalance.trace("Найдено карт: "+a.length),b.cards=[],c=0;c<a.length;++c){var d=a[c];if(AB.getElement(d,/<div[^>]+credicardInfoWrapper[^>]*>/i))var e=
AB.getParam(d,null,null,/<div[^>]+title--creditcard(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces),f=AB.getParam(d,null,null,/<div[^>]+title--creditcard(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces),g=AB.getParam(d,null,null,/<div[^>]+title--creditcard(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces);else if(AB.getElement(d,/<div[^>]+payrolCardInfoWrapper[^>]*>/i))e=AB.getParam(d,null,null,/<div[^>]+title--gold(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces),f=AB.getParam(d,
null,null,/<div[^>]+title--gold(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces),g=AB.getParam(d,null,null,/<div[^>]+title--gold(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces);else{AnyBalance.trace("Найден неизвестный тип карты.");continue}e={__id:e,__name:g,num:f};__shouldProcess("cards",e)&&processCard(d,e);b.cards.push(e)}else/У вас нет карт/i.test(a)?(AnyBalance.trace("У вас нет карт"),b.cards=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(a,b){AnyBalance.trace("Обработка карты "+b.__name);AB.getParam(a,b,"cards.balance",/<div[^>]+"e-limit__info__amount_inner"[^>]*>[\s\S]*?<span/i,AB.replaceTagsAndSpaces,AB.parseBalanceSilent);AB.getParam(a,b,["cards.currency","cards.balance"],/<div[^>]+"e-limit__info__amount_inner"[^>]*>([\s\S]*?)<\/div/i,AB.replaceTagsAndSpaces,AB.parseCurrency);AB.getParam(a,b,"cards.debt",/<span[^>]+"e-limit__subtitle e-debt__title"[^>]*>[\s\S]*?<div/i,AB.replaceTagsAndSpaces,AB.parseBalanceSilent);
AB.getParam(a,b,"cards.pay_till",/<span[^>]+"e-transfer__day"[^>]*>[\s\S]*?<div/i,AB.replaceTagsAndSpaces,AB.parseDateWord);var c=AB.getParam(a,null,null,/<a[^>]+href="([^"]*)"[^>]*>[\s\S]*?Информация о карте/i,[/#\d*/,""]);c?(c=AnyBalance.requestGet(baseurl+c,g_headers),AB.getParam(c,b,"cards.agreement",/Номер договора:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,b,"cards.limit",/Кредитный лимит:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseBalance),AB.getParam(c,b,"cards.status",
/Статус:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,b,"cards.num",/<div[^>]+class="card_number"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,b,"cards.type",/<div[^>]+class="card_holder"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,b,"cards.till",/<div[^>]+class="card_valid_thru"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseDateWord)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найты ссылку на страницу с информацией о карте. Сайт изменён?"));isAvailable("cards.transactions")&&
processCardTransactions(a,b)}
function processDeposits(a,b){if(AnyBalance.isAvailable("deposits")){a=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=getElement(a,/<div[^>]+id="item_deposits"[^>]*>/i);if(c){var d=AB.getElements(c,/<div[^>]+depositInfoWrapper[^>]*>/ig);d||(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти депозиты. Сайт изменён?"));AnyBalance.trace("Найдено депозитов: "+d.length);b.deposits=[];for(c=0;c<d.length;c++)if(a=AB.getParam(d[c],null,null,/<div[^>]+class="e-deposit__upper_info"[^>]*>[\s\S]*?<a[^>]+href="([^"]*)"[^>]*>[\s\S]*?Информация о депозите<\/a>/i,[/#\d*/,
""])){a=AnyBalance.requestGet(baseurl+a,g_headers);var e=AB.getParam(a,null,null,/Номер счета Депозита:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),f=AB.getParam(a,null,null,/Номер счета Депозита:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),g=AB.getParam(d[c],null,null,/<div[^>]+depositinfo(?:[^>]*>){4}([^<]*)/i,AB.replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("deposits",e)&&processDeposit(d[c],e,a);b.deposits.push(e)}else AnyBalance.trace("Не удалось найти ссылку на страницу с информацией о депозите. Сайт изменён?")}else AnyBalance.trace(a),
AnyBalance.trace("Не удалось найти таблицу с депозитами.")}}
function processDeposit(a,b,c){AB.getParam(a,b,"deposits.balance",/Накоплено(?:[^>]*>){2}([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(c,b,"deposits.agreement",/номер договора:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces);AB.getParam(c,b,"deposits.date_start",/Вы открыли вклад:(?:[^>]*>){3}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseDate);AB.getParam(c,b,"deposits.pct",/Эффективная ставка:(?:[^>]*>){3}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(c,b,"deposits.withdraw",
/Доступно для снятия без комиссии:(?:[\s\S]*?<span[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(c,b,"deposits.currency",/Валюта депозита:(?:[^>]*>){2}([^<]*)/i,[AB.replaceTagsAndSpaces,/(.*?)/i,"0$1"],AB.parseCurrency);AB.getParam(c,b,"deposits.dvk_status",/<div[^>]+class="text dvk_status"(?:[^>]*>){4}([^<]*)/i,AB.replaceTagsAndSpaces);AB.getParam(c,b,"deposits.dvk_num",/<div[^>]+class="dvkcard_number"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces);AB.getParam(c,b,"deposits.dvk_till",
/<div[^>]+class="card_valid_thru"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseDate);isAvailable("deposits.transactions")&&processDepositTransactions(c,b)}
function processCredits(a,b){if(AnyBalance.isAvailable("credits")){a=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=AB.getElement(a,/<div[^>]+id="item_credits"[^>]*>/i);if(c)for(a=AB.getElements(c,/<div[^>]+creditInfoWrapper[^>]*>/ig),a||(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти кредиты. Сайт изменён?")),AnyBalance.trace("Найдено кредитов: "+a.length),b.credits=[],c=0;c<a.length;++c){var d=AB.getParam(a[c],null,null,/<span[^>]+"e-card__title__text"[^>]*>([^<]*)/i,
AB.replaceTagsAndSpaces),e=AB.getParam(a[c],null,null,/<span[^>]+"e-card__title__text"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),f=AB.getParam(a[c],null,null,/<span[^>]+"e-card__title__text"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),d={__id:d,__name:e,num:f};__shouldProcess("credits",d)&&processCredit(a[c],d);b.credits.push(d)}else/У вас нет кредитов/i.test(a)?(AnyBalance.trace("У вас нет кредитов"),b.cards=[]):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCredit(a,b){AnyBalance.trace("Обработка кредита "+b.__name);AB.getParam(a,b,"credits.balance",/<span[^>]+"e-limit__info__amount"[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(a,b,["credits.currency","credits.balance"],/<span[^>]+"e-limit__info__amount"[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseCurrency);AB.getParam(a,b,"credits.paid",/<span[^>]+"e-limit__subtext e-funds__amount"[^>]*>([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);
AB.getParam(a,b,"credits.next_pay",/<span[^>]+"e-plan__info__amount"[^>]*>([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(a,b,"credits.pay_till",/<span[^>]+"e-transfer__day"[^>]*>([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseDateWord);AB.getParam(a,b,"credits.date_start",/Вы взяли кредит([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseDate);AB.getParam(a,b,"credits.period",/На срок([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(a,b,"credits.period_left",
/Осталось выплачивать([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AnyBalance.isAvailable("credits.schedule")&&processCreditSchedule(a,b)}
function processInfo(a,b){a=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);b=b.info={};getParam(a,b,"info.wallet",/Можно потратить[\s\S]*?<span[^>]+limit__info__amount[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseBalance);getParam(a,b,["info.currency","info.wallet"],/Можно потратить[\s\S]*?<span[^>]+limit__info__amount[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseCurrency);getParam(a,b,"info.bonus",/<div[^>]+bonusMenuContainer[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces,
AB.parseBalance);getParam(a,b,"info.mphone",/<div[^>]+headerSettings__phone(?:[^>]*>){3}([^<]*)/i,AB.replaceTagsAndSpaces);getParam(a,b,"info.fio",/<span[^>]+headerAuth__user[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces)};
