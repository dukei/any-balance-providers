var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36"},baseurl="https://www.kaspi.kz";
function login(){var b=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl+"/entrance",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(a))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var c=getParam(b.login||
"",null,null,/^\d{10}$/,[/^(\d{3})(\d{3})(\d{2})(\d{2})$/,"+7 ($1) $2-$3-$4"]);if(!c)throw new AnyBalance.Error("Не верный формат логина, необходимо вводить логин без +7 в начале и без пробелов.");var d=AB.getParam(a,null,null,/<input[^>]+name="authToken"[^>]+value="([^"]*)/i);if(!d)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти токен авторизации. Сайт изменён?");a={submitId:"SignIn",webFormValues:[{name:"FormId",value:"SignInForm"},{name:"AuthToken",value:d},{name:"SignInLogin",
value:c},{name:"Password",value:b.password}],requesTimestamp:"/Date("+(new Date).getTime()+"-14400000)/"};a=AnyBalance.requestPost(baseurl+"/api/auth/sign-in",JSON.stringify(a),addHeaders({Referer:baseurl+"/entrance","X-Requested-With":"XMLHttpRequest",Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":"application/json; charset=UTF-8"}))}b=getJson(a);if(!b.location){b=isArray(b.error)?b.error:[b.error];if(b[0])throw new AnyBalance.Error(b,null,/Мы не нашли такой пароль/i.test(b));
AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}a=AnyBalance.requestGet(baseurl+b.location,g_headers);__setLoginSuccessful();return a}
function processCards(b,a){if(AnyBalance.isAvailable("cards")){b=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=AB.getElement(b,/<div[^>]+id="item_creditcards"[^>]*>/i);if(c){var d=AB.getElements(c,/<div[^>]+credicardInfoWrapper[^>]*>/ig);d||(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти карты. Сайт изменён?"));AnyBalance.trace("Найдено карт: "+d.length);a.cards=[];for(c=0;c<d.length;++c){var e=d[c],f=AB.getParam(e,null,null,/<div[^>]+title--creditcard(?:[^>]*>){3}([\s\S]*?)<span/i,
AB.replaceTagsAndSpaces),g=AB.getParam(e,null,null,/<div[^>]+title--creditcard(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces),h=AB.getParam(e,null,null,/<div[^>]+title--creditcard(?:[^>]*>){3}([\s\S]*?)<span/i,AB.replaceTagsAndSpaces),f={__id:f,__name:h,num:g};__shouldProcess("cards",f)&&processCard(e,f);a.cards.push(f)}}else/У вас нет карт/i.test(b)?(AnyBalance.trace("У вас нет карт"),a.cards=[]):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(b,a){AnyBalance.trace("Обработка карты "+a.__name);AB.getParam(b,a,"cards.balance",/<span[^>]+"e-limit__info__amount"[^>]*>[\s\S]*?<div/i,AB.replaceTagsAndSpaces,AB.parseBalanceSilent);AB.getParam(b,a,["cards.currency","cards.balance"],/<span[^>]+"e-limit__info__amount"[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseCurrency);AB.getParam(b,a,"cards.debt",/<span[^>]+"e-limit__subtitle e-debt__title"[^>]*>[\s\S]*?<div/i,AB.replaceTagsAndSpaces,AB.parseBalanceSilent);AB.getParam(b,
a,"cards.pay_till",/<span[^>]+"e-transfer__day"[^>]*>[\s\S]*?<div/i,AB.replaceTagsAndSpaces,AB.parseDateWord);var c=AB.getParam(b,null,null,/<a[^>]+href="([^"]*)"[^>]*>[\s\S]*?Информация о карте/i,[/#\d*/,""]);c?(c=AnyBalance.requestGet(baseurl+c,g_headers),AB.getParam(c,a,"cards.agreement",/Номер договора:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,a,"cards.limit",/Кредитный лимит:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseBalance),AB.getParam(c,a,"cards.status",/Статус:(?:[^>]*>){2}([^<]*)/i,
AB.replaceTagsAndSpaces),AB.getParam(c,a,"cards.num",/<div[^>]+class="card_number"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,a,"cards.type",/<div[^>]+class="card_holder"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),AB.getParam(c,a,"cards.till",/<div[^>]+class="card_valid_thru"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseDateWord)):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найты ссылку на страницу с информацией о карте. Сайт изменён?"));isAvailable("cards.transactions")&&processCardTransactions(b,
a)}
function processDeposits(b,a){if(AnyBalance.isAvailable("deposits")){b=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=getElement(b,/<div[^>]+id="item_deposits"[^>]*>/i);if(c){var d=AB.getElements(c,/<div[^>]+depositInfoWrapper[^>]*>/ig);d||(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти депозиты. Сайт изменён?"));AnyBalance.trace("Найдено депозитов: "+d.length);a.deposits=[];for(c=0;c<d.length;c++){var e=AB.getParam(d[c],null,null,/<div[^>]+class="e-deposit__upper_info"[^>]*>[\s\S]*?<a[^>]+href="([^"]*)"[^>]*>[\s\S]*?Информация о депозите<\/a>/i,[/#\d*/,
""]);if(e){b=AnyBalance.requestGet(baseurl+e,g_headers);var e=AB.getParam(b,null,null,/Номер счета Депозита:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),f=AB.getParam(b,null,null,/Номер счета Депозита:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces),g=AB.getParam(d[c],null,null,/<div[^>]+depositinfo(?:[^>]*>){4}([^<]*)/i,AB.replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("deposits",e)&&processDeposit(d[c],e,b);a.deposits.push(e)}else AnyBalance.trace("Не удалось найти ссылку на страницу с информацией о депозите. Сайт изменён?")}}else AnyBalance.trace(b),
AnyBalance.trace("Не удалось найти таблицу с депозитами.")}}
function processDeposit(b,a,c){AB.getParam(b,a,"deposits.balance",/Накоплено(?:[^>]*>){2}([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(c,a,"deposits.agreement",/номер договора:(?:[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces);AB.getParam(c,a,"deposits.date_start",/Вы открыли вклад:(?:[^>]*>){3}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseDate);AB.getParam(c,a,"deposits.pct",/Эффективная ставка:(?:[^>]*>){3}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(c,a,"deposits.withdraw",
/Доступно для снятия без комиссии:(?:[\s\S]*?<span[^>]*>){2}([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(c,a,"deposits.currency",/Валюта депозита:(?:[^>]*>){2}([^<]*)/i,[AB.replaceTagsAndSpaces,/(.*?)/i,"0$1"],AB.parseCurrency);AB.getParam(c,a,"deposits.dvk_status",/<div[^>]+class="text dvk_status"(?:[^>]*>){4}([^<]*)/i,AB.replaceTagsAndSpaces);AB.getParam(c,a,"deposits.dvk_num",/<div[^>]+class="dvkcard_number"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces);AB.getParam(c,a,"deposits.dvk_till",
/<div[^>]+class="card_valid_thru"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces,AB.parseDate);isAvailable("deposits.transactions")&&processDepositTransactions(c,a)}
function processCredits(b,a){if(AnyBalance.isAvailable("credits")){b=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=AB.getElement(b,/<div[^>]+id="item_credits"[^>]*>/i);if(c){var d=AB.getElements(c,/<div[^>]+creditInfoWrapper[^>]*>/ig);d||(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти кредиты. Сайт изменён?"));AnyBalance.trace("Найдено кредитов: "+d.length);a.credits=[];for(c=0;c<d.length;++c){var e=AB.getParam(d[c],null,null,/<span[^>]+"e-card__title__text"[^>]*>([^<]*)/i,
AB.replaceTagsAndSpaces),f=AB.getParam(d[c],null,null,/<span[^>]+"e-card__title__text"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),g=AB.getParam(d[c],null,null,/<span[^>]+"e-card__title__text"[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces),e={__id:e,__name:f,num:g};__shouldProcess("credits",e)&&processCredit(d[c],e);a.credits.push(e)}}else/У вас нет кредитов/i.test(b)?(AnyBalance.trace("У вас нет кредитов"),a.cards=[]):(AnyBalance.trace(b),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCredit(b,a){AnyBalance.trace("Обработка кредита "+a.__name);AB.getParam(b,a,"credits.balance",/<span[^>]+"e-limit__info__amount"[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(b,a,["credits.currency","credits.balance"],/<span[^>]+"e-limit__info__amount"[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseCurrency);AB.getParam(b,a,"credits.paid",/<span[^>]+"e-limit__subtext e-funds__amount"[^>]*>([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);
AB.getParam(b,a,"credits.next_pay",/<span[^>]+"e-plan__info__amount"[^>]*>([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(b,a,"credits.pay_till",/<span[^>]+"e-transfer__day"[^>]*>([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseDateWord);AB.getParam(b,a,"credits.date_start",/Вы взяли кредит([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseDate);AB.getParam(b,a,"credits.period",/На срок([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AB.getParam(b,a,"credits.period_left",
/Осталось выплачивать([\s\S]*?)<\/div>/i,AB.replaceTagsAndSpaces,AB.parseBalance);AnyBalance.isAvailable("credits.schedule")&&processCreditSchedule(b,a)}
function processInfo(b,a){b=AnyBalance.requestGet(baseurl+"/index.aspx?action=bank",g_headers);var c=a.info={};getParam(b,c,"info.wallet",/Можно потратить[\s\S]*?<span[^>]+limit__info__amount[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseBalance);getParam(b,c,["info.currency","info.wallet"],/Можно потратить[\s\S]*?<span[^>]+limit__info__amount[^>]*>([\s\S]*?)<div/i,AB.replaceTagsAndSpaces,AB.parseCurrency);getParam(b,c,"info.bonus",/<div[^>]+bonusMenuContainer[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces,
AB.parseBalance);getParam(b,c,"info.mphone",/<div[^>]+headerSettings__phone(?:[^>]*>){3}([^<]*)/i,AB.replaceTagsAndSpaces);getParam(b,c,"info.fio",/<span[^>]+headerAuth__user[^>]*>([^<]*)/i,AB.replaceTagsAndSpaces)};
