var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36"},baseurl="https://ibank.kicb.net/";
function login(){var c=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");AnyBalance.setCookie("ibank.kicb.net","ibank_kicb_lang","RUS");checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");var a=AnyBalance.requestGet(baseurl+"main.aspx",g_headers);if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");/exit/i.test(a)?AnyBalance.trace("Уже залогинены, используем существующую сессию"):
(a=getElement(a,/<form[^>]+name="form1"[^>]*>/i),a=createFormParams(a,function(a,b,f,g){return"txtLogin"==f?c.login:"txtPass"==f?c.password:g}),a=AnyBalance.requestPost(baseurl+"Login.aspx",a,addHeaders({Referer:baseurl})));if(!/exit/i.test(a)){var b=getParam(a,null,null,/<span[^>]+msg[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);if(b)throw new AnyBalance.Error(b,null,/Неверно указан логин или пароль/i.test(b));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");
}__setLoginSuccessful();return a}
function processAccounts(c,a){if(AnyBalance.isAvailable("accounts")){c=AnyBalance.requestGet(baseurl+"cards_and_accounts.aspx",g_headers);var b=getElement(c,/<a[^>]*>Мои счета<\/a>[\s\S]*?(<table[^>]*>)/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено счетов: "+(b.length-1));a.accounts=[];for(var e=1;e<b.length;++e){var d=getParam(b[e],null,null,/<tr(?:[^>]*>){6}([^<]*)/i),f=getParam(b[e],null,null,/<tr(?:[^>]*>){6}([^<]*)/i),g=getParam(b[e],null,null,/<tr(?:[^>]*>){3}([^<]*)/i)+
" "+f,d={__id:d,__name:g,num:f};__shouldProcess("accounts",d)&&processAccount(b[e],d);a.accounts.push(d)}}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(c,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(c,a,"accounts.balance",/<tr(?:[^>]*>){8}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"accounts.available",/<tr(?:[^>]*>){10}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["accounts.currency","accounts.balance","accounts.available"],/<tr(?:[^>]*>){8}([^<]*)/i,replaceTagsAndSpaces,parseCurrency);getParam(c,a,"accounts.last_operation_date",/<tr(?:[^>]*>){12}([^<]*)/i,replaceTagsAndSpaces,parseDate);
AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(a)}
function processCards(c,a){if(AnyBalance.isAvailable("cards")){c=AnyBalance.requestGet(baseurl+"cards_and_accounts.aspx",g_headers);var b=getElement(c,/<a[^>]*>Мои карты<\/a>[\s\S]*?(<table[^>]*>)/i),b=getElements(b,/<tr[^>]*>/ig);if(b.length){AnyBalance.trace("Найдено карт: "+(b.length-1));a.cards=[];for(var e=1;e<b.length;++e){var d=getParam(b[e],null,null,/<tr(?:[^>]*>){6}([^<]*)/i,replaceTagsAndSpaces),f=getParam(b[e],null,null,/<tr(?:[^>]*>){6}([^<]*)/i,replaceTagsAndSpaces),g=getParam(b[e],
null,null,/<tr(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces),d={__id:d,__name:g,num:f};__shouldProcess("cards",d)&&processCard(b[e],d);a.cards.push(d)}}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти карты.")}}
function processCard(c,a){AnyBalance.trace("Обработка карты "+a.__name);var b=getParam(c,null,null,/getavailablebalance(?:[^']*'){3}([^']*)/i),e=getParam(c,null,null,/getavailablebalance(?:[^']*'){5}([^']*)/i),d=getParam(c,null,null,/getavailablebalance(?:[^']*'){7}([^']*)/i),f=getParam(c,null,null,/getavailablebalance(?:[^']*'){9}([^']*)/i),d=AnyBalance.requestGet(baseurl+"CommonHandler.ashx?request=CardBalance&account="+b+"&currency="+e+"&credit_limit="+f+"&culture="+d,g_headers),d=getJson(d);getParam(d.value+
"",a,"cards.balance",null,null,parseBalance);getParam(b,a,"cards.accnum");getParam(e,a,"cards.currency");isAvailable("cards.transactions")&&processCardTransactions(a)}function processDeposits(c,a){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processCredits(c,a){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processInfo(c,a){var b=a.info={};getParam(c,b,"info.fio",/<span[^>]+ClientName[^>]*>([^<]*)/i,replaceTagsAndSpaces)};
