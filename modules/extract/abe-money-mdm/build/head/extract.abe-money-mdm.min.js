var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11"},g_baseurl="https://i.binbank.ru/";
function callApi(b,a,d,c,e){b=AnyBalance.requestPost(g_baseurl+"api/"+b+(a?"?"+createUrlEncodedParams(a):""),d?JSON.stringify(d):"",addHeaders({Referer:g_baseurl,"X-Application-Code":"INTERNET","Content-Type":d?"application/json;charset=UTF-8":void 0}),{HTTP_METHOD:d||c?c||"POST":"GET"});a=getJson(b);if(a.code&&!e){if(e=a.message)throw new AnyBalance.Error(e,null,/invalid_login/i.test(a.code));AnyBalance.trace(b);throw new AnyBalance.Error("Неизвестная ошибка: "+a.code);}return a}
function login(){var b=AnyBalance.getPreferences();AnyBalance.setOptions({SSL_ENABLED_PROTOCOLS:["TLSv1.1","TLSv1.2"]});checkEmpty(b.login,"Введите логин!");checkEmpty(b.password,"Введите пароль!");var a=AnyBalance.requestGet(g_baseurl+"login",addHeaders({Referer:g_baseurl+"/index.asp"}));if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка интернет-банка. Попробуйте обновить данные позже.");getClientInfo()?AnyBalance.trace("Уже залогинены, отлично."):callApi("v1/auth/login",
null,{login:b.login,password:b.password,channel:"internet",gsm:!0,device_id:"test"});__setLoginSuccessful();return a}function getClientInfo(){if(!getClientInfo.json){var b=callApi("v1/client",null,null,null,!0);if(b.code)return AnyBalance.trace(JSON.stringify(b)),!1;getClientInfo.json=b}return getClientInfo.json}function getProductsInfo(){getProductsInfo.json||(getProductsInfo.json=callApi("v1_1/products"));return getProductsInfo.json}
function processCards(b){if(AnyBalance.isAvailable("cards")){for(var a=getProductsInfo(),d=[],c=0;c<a.length;++c){var e=a[c];"card"==e.product_type&&d.push(e)}AnyBalance.trace("Найдено "+d.length+" карт");b.cards=[];for(c=0;c<d.length;c++){var a=d[c],e=a.id,f=a.name+" "+a.number.substr(-4),e={__id:e,__name:f,num:a.number,visibility:a.visibility};__shouldProcess("cards",e)&&processCard(a,e);b.cards.push(e)}}}
function processCard(b,a){AnyBalance.trace("Обрабатываем карту "+a.__name);getParam(b.balance.currency,a,"cards.currency cards.balance cards.limit cards.blocked cards.available cards.debt_main cards.debt_due cards.debt_pct cards.debt_peni cards.debt_comission cards.minpay cards.debt cards.transactions.sum_account".split(" "));getParam(b.balance.amount,a,"cards.balance");getParam(b.blocked_amount.amount,a,"cards.blocked");getParam(b.available_amount.amount,a,"cards.available");getParam(b.expire_date,
a,"cards.till",null,null,parseDateISO);getParam(b.open_date,a,"cards.date_start",null,null,parseDateISO);getParam(b.embossed_name,a,"cards.holder");getParam(b.requisites.account_number,a,"cards.accnum");getParam(b.state,a,"cards.status_code");getParam(b.state_details,a,"cards.status");getParam(b.type.type,a,"cards.type");b.credit_card_loan&&(getParam(b.credit_card_loan.credit_limit.amount,a,"cards.limit"),getParam(b.credit_card_loan.interest_rate,a,"cards.pct"),getParam(b.credit_card_loan.due_payment.total.amount,
a,"cards.minpay"),getParam(b.credit_card_loan.due_payment.due_date,a,"cards.minpay_till",null,null,parseDateISO),getParam(b.credit_card_loan.full_payment.total.amount,a,"cards.debt"),getParam(b.credit_card_loan.full_payment.receivables.principal.amount,a,"cards.debt_main"),getParam(b.credit_card_loan.full_payment.receivables.interest.amount,a,"cards.debt_pct"),getParam(b.credit_card_loan.full_payment.receivables.charges.amount,a,"cards.debt_peni"),getParam(b.credit_card_loan.full_payment.receivables.fees.amount,
a,"cards.debt_comission"));AnyBalance.isAvailable("cards.transactions")&&processCardTransactions(b,a);return a}function processBonus(b){if(AnyBalance.isAvailable("bonus")){for(var a=getProductsInfo(),d=[],c=0;c<a.length;++c){var e=a[c];"loyalty"==e.product_type&&d.push(e)}d.length?getParam(d[0].balance.amount,b,"bonus"):AnyBalance.trace("Бонус не найден")}}
function processInfo(b){if(AnyBalance.isAvailable("info")){b.info={};var a=getClientInfo(),d=create_aggregate_join(" ");getParam(a.first_name,b.info,"info.name");getParam(a.middle_name,b.info,"info.name_patronymic");getParam(a.last_name,b.info,"info.name_last");sumParam(a.last_name,b.info,"info.fio",null,null,null,d);sumParam(a.first_name,b.info,"info.fio",null,null,null,d);sumParam(a.middle_name,b.info,"info.fio",null,null,null,d);getParam(a.is_resident,b.info,"info.resident");getParam(a.unc,b.info,
"info.unc");for(d=0;d<a.id_cards.length;++d){var c=a.id_cards[d];/Паспорт гражданина РФ/i.test(c.type)?(AnyBalance.trace("Найден паспорт"),getParam(c.reg_number,b.info,"info.passport"),getParam(c.reg_details,b.info,"info.passport_issued_by"),getParam(c.reg_date,b.info,"info.passport_issued",null,null,parseDateISO)):AnyBalance.trace("Неизвестный документ: "+JSON.stringify(c))}getParam(a.birth_date,b.info,"info.birthday",null,null,parseDateISO);getParam(a.birth_place,b.info,"info.birth_place");for(d=
0;d<a.addresses.length;++d)c=a.addresses[d],"registration"==c.type?(AnyBalance.trace("Найден адрес регистрации"),getParam(c.full_address,b.info,"info.address")):"residence"==c.type?(AnyBalance.trace("Найден адрес проживания"),getParam(c.full_address,b.info,"info.address_residence")):AnyBalance.trace("Неизвестный адрес: "+JSON.stringify(c));if(AnyBalance.isAvailable("info.contacts"))for(a=callApi("v1/client/contacts"),b.info.contacts=[],d=0;d<a.length;++d)c={},getParam(a[d].type.replace("onmt","mobile"),
c,"info.contacts.type"),getParam(a[d].value,c,"info.contacts.contact"),b.info.contacts.push(c)}}
function processAccounts(b){if(AnyBalance.isAvailable("accounts")){for(var a=getProductsInfo(),d=[],c=0;c<a.length;++c){var e=a[c];"account"==e.product_type&&d.push(e)}AnyBalance.trace("Найдено "+d.length+" счетов");b.accounts=[];for(c=0;c<d.length;c++){var a=d[c],e=a.id,f=a.name+" "+a.number.substr(-4),e={__id:e,__name:f,num:a.number,visibility:a.visibility};__shouldProcess("accounts",e)&&processAccount(a,e);b.accounts.push(e)}}}
function processAccount(b,a){AnyBalance.trace("Обрабатываем счет "+a.__name);getParam(b.balance.currency,a,["accounts.currency","accounts.balance"]);getParam(b.balance.amount,a,"accounts.balance");getParam(b.open_date,a,"accounts.date_start",null,null,parseDateISO);getParam(b.state,a,"accounts.status_code");getParam(b.state_details,a,"accounts.status");getParam(b.name,a,"accounts.name");AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,a);return a}
function processDeposits(b){if(AnyBalance.isAvailable("deposits")){for(var a=getProductsInfo(),d=[],c=0;c<a.length;++c){var e=a[c];"deposit"==e.product_type&&d.push(e)}AnyBalance.trace("Найдено "+d.length+" депозитов");b.deposits=[];for(c=0;c<d.length;c++){var a=d[c],e=a.id,f=a.name+" "+a.number.substr(-4),e={__id:e,__name:f,num:a.number,visibility:a.visibility};__shouldProcess("deposits",e)&&processDeposit(a,e);b.deposits.push(e)}}}
function processDeposit(b,a){AnyBalance.trace("Обрабатываем депозит "+a.__name);getParam(b.name,a,"deposits.name");getParam(b.balance.currency,a,["deposits.currency","deposits.balance"]);getParam(b.balance.amount,a,"deposits.balance");getParam(b.start_money_amount.amount,a,"deposits.balance_start");getParam(b.open_date,a,"deposits.date_start",null,null,parseDateISO);getParam(b.expire_date,a,"deposits.date_end",null,null,parseDateISO);getParam(b.state,a,"deposits.status_code");getParam(b.state_details,
a,"deposits.status");getParam(b.rate,a,"deposits.pct");AnyBalance.isAvailable("deposits.transactions")&&processDepositTransactions(b,a);return a}
function processCredits(b){if(AnyBalance.isAvailable("credits")){for(var a=getProductsInfo(),d=[],c=0;c<a.length;++c){var e=a[c];"credit"==e.product_type&&d.push(e)}AnyBalance.trace("Найдено "+d.length+" кредитов");b.credits=[];for(c=0;c<d.length;c++){var a=d[c],e=a.id,f=a.name+" "+a.requisites.account_number.substr(-4),e={__id:e,__name:f,num:a.requisites.account_number,visibility:a.visibility};__shouldProcess("credits",e)&&processCredit(a,e);b.credits.push(e)}}}
function processCredit(b,a){AnyBalance.trace("Обрабатываем кредит "+a.__name);getParam(b.currency,a,["credits.currency","credits.balance"]);getParam(b.instalment_loan.loan_amount.amount,a,"credits.limit");getParam(b.instalment_loan.interest_rate,a,"credits.pct");getParam(b.instalment_loan.full_payment.total.amount,a,"credits.balance");getParam(b.name,a,"credits.name");getParam(b.instalment_loan.due_payment.principal.amount+b.instalment_loan.due_payment.interest.amount,a,"credits.minpay");getParam(b.instalment_loan.due_payment.due_date,
a,"credits.minpay_till",null,null,parseDateISO);getParam(b.instalment_loan.repayment_balance.amount,a,"credits.balance_acc",null,null,parseDateISO);getParam(b.open_date,a,"credits.date_start",null,null,parseDateISO);getParam(b.expire_date,a,"credits.date_end",null,null,parseDateISO);getParam(b.requisites.account_number,a,"credits.accnum");getParam(b.state,a,"credits.status_code");getParam(b.state_details,a,"credits.status");AnyBalance.isAvailable("credits.schedule")&&processCreditSchedule(b,a);return a}
;
