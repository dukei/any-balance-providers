var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.360"},baseurl="https://online.open.ru/";function getToken(a){return getParam(a,null,null,/name="__RequestVerificationToken"[^>]+value="([^"]+)/i)}
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl,g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logOff/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var c=getElement(b,/<form[^>]+formAuth[^>]*>/i),
c=createFormParams(c,function(b,c,d,g){return"UserNameFromHidden"==d?a.login:"PasswordFromHidden"==d?a.password:g});if(/<input[^>]+id="captcha"[^>]*>/i.test(b)){var d=getParam(b,null,null,/<img[^>]+src="([^"]*)"[^>]+captcha[^>]*>/i);if(!d)throw new AnyBalance.Error("Не удалось найти ссылку на капчу. Сайт изменён?");d=AnyBalance.requestGet(baseurl+d,g_headers);c.captcha=AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",d);c["captcha-guid"]=getParam(b,null,null,/<input[^>]+captcha-guid[^>]+value="([^"]*)/i)}b=
AnyBalance.requestPost(baseurl+"LogOn",c,addHeaders({Referer:baseurl+"logon"}))}if(!/logOff/i.test(b)){if(c=getParam(b,null,null,/<div[^>]+validator error[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/(пароль неправильный|cимволы введены неверно)/i.test(c));if(/smsAuthFormId/i.test(b))throw AnyBalance.trace(b),new AnyBalance.Error("Вход с использованием одноразового пароля по СМС пока не поддерживается. Отключите одноразовый пароль на вход в настройках интернет-банка.");
AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}b=AnyBalance.requestGet(baseurl+"Finances/index",g_headers);__setLoginSuccessful();return b}
function processAccounts(a,b){if(AnyBalance.isAvailable("accounts")){var c=getParam(a,null,null,/<a[^>]*>Счета[\s\S]*?(<table[^>]+"info"[^>]*>[\s\S]*?<\/table>)/i),c=getElements(c,/<tr[^>]*>/ig);if(c.length)for(AnyBalance.trace("Найдено счетов: "+c.length),b.accounts=[],a=0;a<c.length;a++){var d=getParam(c[a],null,null,/номер счета\s*([^<]*)/i),e=getParam(c[a],null,null,/номер счета\s*([^<]*)/i),f=getParam(c[a],null,null,/<span[^>]+name_card[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),d={__id:d,
__name:f,num:e};__shouldProcess("accounts",d)&&processAccount(c[a],d);b.accounts.push(d)}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(a,b){AnyBalance.trace("Обработка счета "+b.__id);var c=getParam(a,null,null,/location\.href\s*=\s*['"]\/?([^'"]*)/i);c?(a=AnyBalance.requestGet(baseurl+c,g_headers),getParam(a,b,"accounts.incomingBalance",/Входящий остаток(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"accounts.blocked",/Заблокировано(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"accounts.balance",/<td[^>]*>\s*остаток(?:[^>]*>){2}([\s\S]*?)<\//i,
replaceTagsAndSpaces,parseBalance),getParam(a,b,"accounts.available",/доступно на(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,["accounts.currency","accounts.available","accounts.balance","accounts.incomingBalance","accounts.blocked"],/Входящий остаток(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseCurrency),AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(c,b)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти ссылку на выписку по счету"+
b.__id))}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){var c=getElement(a,/<table[^>]+info cards-grid[^>]*>/i),c=getElements(c,/<tr[^>]*>/ig);if(c.length)for(AnyBalance.trace("Найдено карт: "+c.length),b.cards=[],a=0;a<c.length;++a){var d=getParam(c[a],null,null,/<span[^>]+nomber_card[^>]*>[^]*(\d{4}[*\s]+\d{4})/i),e=getParam(c[a],null,null,/<span[^>]+nomber_card[^>]*>[^]*(\d{4}[*\s]+\d{4})/i,replaceTagsAndSpaces),f=getParam(c[a],null,null,/<a[^*>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),d=
{__id:d,__name:f,num:e};__shouldProcess("cards",d)&&processCard(c[a],d);b.cards.push(d)}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти карты.")}}
function processCard(a,b){AnyBalance.trace("Обработка карты "+b.__name);var c=getParam(a,null,null,/location\.href\s*=\s*['"]\/?([^'"]*)/i);c?(a=AnyBalance.requestGet(baseurl+c,g_headers),getParam(a,b,"cards.accnum",/Номер счета:(?:[^>]*>){4}([\s\S]*?)<\//i,replaceTagsAndSpaces),getParam(a,b,"cards.till",/Карта действительна до:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate),getParam(a,b,"cards.status",/Статус карты:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces),getParam(a,b,"cards.balance",
/Доступно на(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.limit",/Кредитный лимит:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.debt",/Размер задолженности:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.accuredPct",/Начисленные проценты(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.paySum",/Сумма очередного платежа(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,
parseBalance),getParam(a,b,"cards.blocked",/Заблокировано:(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.overduePct",/штрафы(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.currency cards.balance cards.limit cards.debt cards.oPCT cards.accuredPct cards.overduePct cards.paySum cards.blocked".split(" "),/Доступно на(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseCurrency),getParam(a,b,"cards.__tariff",/Карточный тариф(?:[^>]*>){2}([\s\S]*?)<\//i,
replaceTagsAndSpaces),getParam(a,b,"cards.payDate",/Дата следующего платежа(?:[^>]*>){2}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate),isAvailable("cards.transactions")&&processCardTransactions(c,b)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти ссылку на выписку по карте "+b.__id))}
function processDeposits(a,b){if(AnyBalance.isAvailable("deposits")){var c=getParam(a,null,null,/Вклады[\s\S]*?(<table[^>]+"info"[^>]*>[\s\S]*?<\/table>)/i),c=getElements(c,/<tr[^>]*>/ig);if(c.length)for(AnyBalance.trace("Найдено депозитов: "+c.length),b.deposits=[],a=0;a<c.length;++a){var d=getParam(c[a],null,null,/<span[^>]+nomber_card[^>]*>[^\d]*(\d*)/i,replaceTagsAndSpaces),e=getParam(c[a],null,null,/<span[^>]+nomber_card[^>]*>[^\d]*(\d*)/i,replaceTagsAndSpaces),f=getParam(c[a],null,null,/<span[^>]+name_card[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces),d={__id:d,__name:f,num:e};__shouldProcess("deposits",d)&&processDeposit(c[a],d);b.deposits.push(d)}else AnyBalance.trace(a),AnyBalance.trace("Не удалось найти вклады.")}}
function processDeposit(a,b){AnyBalance.trace("Обработка депозита "+b.__name);var c=getElement(a,/<span[^>]+class="data"/i,replaceTagsAndSpaces);getParam(c,b,"deposits.balance",null,null,parseBalance);getParam(c,b,["deposits.currency","deposits.balance"],null,null,parseCurrency);getParam(a,b,"deposits.accnum",/Номер счета([^<]*)/i,replaceTagsAndSpaces);AnyBalance.isAvailable("deposits.pct","deposits.agreement","deposits.status","deposits.till","deposits.date_start","deposits.transactions")&&((c=getParam(a,
null,null,/location\.href\s*=\s*['"]\/?([^'"]*)/i))?(a=AnyBalance.requestGet(baseurl+c,g_headers),getParam(a,b,"deposits.pct",/Ставка:(?:[^>]*>){1}([^%]*)/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"deposits.agreement",/Договор(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces),getParam(a,b,"deposits.status",/Статус(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces),getParam(a,b,"deposits.till",/остаток на(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate),getParam(a,b,"deposits.date_start",
/Дата открытия(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate),isAvailable("deposits.transactions")&&processDepositTransactions(c,b)):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти ссылку на выписку по депозиту"+b.__name)))}function processCredits(a,b){throw new AnyBalance.Error("Обработка кредитов на данный момент не поддерживается. Пожалуйста, обратитесь к разработчику.");}
function processInfo(a,b){b=b.info={};getParam(a,b,"info.fio",/<div[^>]+hello([^>]*>){5}/i,replaceTagsAndSpaces)};
