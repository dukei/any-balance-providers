var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36"},baseurl="https://www.optima24.kg/";
function login(){var c=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl+"Default.aspx",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else var a=
createFormParams(b,function(a,e,f,g){return"ctl00$cphMain$tbLogin"==f?c.login:"ctl00$cphMain$tbPassword"==f?c.password:"ctl00$cphMain$tbCaptcha"==f?(a=getParam(b,null,null,/<img[^>]+cphMain_imgCaptcha[^>]+src="([^"]*)/i),a=AnyBalance.requestGet(baseurl+a,addHeaders({Referer:baseurl})),AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",a,{time:18E4})):g}),b=AnyBalance.requestPost(baseurl+"Login.aspx",a,addHeaders({Referer:baseurl+"Login.aspx","X-Requested-With":"XMLHttpRequest"}));if(!/logout/i.test(b)){if(a=
getParam(b,null,null,[/<div[^>]+cphMain_plLoginAlert[^>]*>([\s\S]*?)<\/div>/i,/<span[^>]+cphMain_rfvCaptcha[^>]*>([\s\S]*?)<\/span>/i],replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/(Неверный ID код или пароль|Неверно указан код с картинки)/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return b}
function processAccounts(c,b){if(AnyBalance.isAvailable("accounts")){c=AnyBalance.requestGet(baseurl+"Default.aspx?action=ShowAccounts",g_headers);var a=createFormParams(c,function(a,b,c,d){return d}),d=getParam(c,null,null,/uniqueID(?:[^"]*"){2}([^"]*)/i);a.__EVENTTARGET=d;c=AnyBalance.requestPost(baseurl+"Default.aspx?action=ShowAccounts",a,addHeaders({"X-Requested-With":"XMLHttpRequest",Referer:baseurl+"Default.aspx?action=ShowAccounts"}));a=getElement(c,/<div[^>]+ctl16_ctl02_upCheckList[^>]*>/i);
a=getElements(a,/<div[^>]+"block"[^>]*>/ig);if(a.length)for(AnyBalance.trace("Найдено счетов: "+a.length),b.accounts=[],d=0;d<a.length;++d){var e=getParam(a[d],null,null,/<a[^>]+accountname(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces),f=getParam(a[d],null,null,/<a[^>]+accountname(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces),g=getParam(a[d],null,null,/<a[^>]+accountname[^>]*>([^<]*)/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("accounts",e)&&processAccount(a[d],e);b.accounts.push(e)}else AnyBalance.trace(c),
AnyBalance.trace("Не удалось найти счета.")}}
function processAccount(c,b){AnyBalance.trace("Обработка счета "+b.__id);var a=getParam(c,null,null,/<a[^>]+GetStatement[^>]+href="([^"]*)/i,replaceHtmlEntities);if(a){var d=AnyBalance.requestGet(baseurl+a,g_headers);getParam(d,b,"accounts.balance",/<span[^>]+lbBalanceValue[^>]*>([^<]*)/i,null,parseBalance);getParam(d,b,["accounts.currency","accounts.balance"],/<span[^>]+lbBalanceValue[^>]*>([^<]*)/i,null,parseCurrency);AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(d,
a,b)}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти ссылку на информацию по счёту. Сайт изменён?")}
function processCards(c,b){if(AnyBalance.isAvailable("cards")){c=AnyBalance.requestGet(baseurl+"Default.aspx?action=ShowAccounts",g_headers);var a=createFormParams(c,function(a,b,c,d){return d}),d=getParam(c,null,null,/uniqueID(?:[^"]*"){2}([^"]*)/i);a.__EVENTTARGET=d;c=AnyBalance.requestPost(baseurl+"Default.aspx?action=ShowAccounts",a,addHeaders({"X-Requested-With":"XMLHttpRequest",Referer:baseurl+"Default.aspx?action=ShowAccounts"}));a=getElement(c,/container\s*index[\s\S]*?(<div[^>]+"row"[^>]*>)/i);
a=getElements(a,/<div[^>]+"block"[^>]*>/ig);if(a.length)for(AnyBalance.trace("Найдено карт: "+a.length),b.cards=[],d=0;d<a.length;++d){var e=getParam(a[d],null,null,/<a[^>]+cardname[^>]*>([\s\S]*?)<\/a>/i),f=getParam(a[d],null,null,/<a[^>]+cardname[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),g=getParam(a[d],null,null,/<a[^>]+cardname[^>]*>([\s\S]*?)<\/a>/i,replaceTagsAndSpaces),e={__id:e,__name:g,num:f};__shouldProcess("cards",e)&&processCard(a[d],e);b.cards.push(e)}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти карты.")}}
function processCard(c,b){AnyBalance.trace("Обработка карты "+b.__name);getParam(c,b,"cards.acc_num",/Карт-счет([^<]*)/i,replaceTagsAndSpaces);getParam(c,b,"cards.type",/<img[^>]+rptAccounts[^>]+card_([^\.]*)/i,replaceTagsAndSpaces);var a=getParam(c,null,null,/<a[^>]+cardname[^>]+href="([^"]*)/i,replaceHtmlEntities);if(a){var d=AnyBalance.requestGet(baseurl+a,g_headers);getParam(d,b,"cards.till",/действительна до([^<]*)/i,replaceTagsAndSpaces,parseDate);getParam(d,b,"cards.balance",/<button[^>]+btnBalance[^>]*>([\s\S]*?)<\/button>/i,
replaceTagsAndSpaces,parseBalance);getParam(d,b,"cards.blocked",/<button[^>]+btnBalance(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(d,b,["cards.currency","cards.balance","cards.blocked"],/<button[^>]+btnBalance[^>]*>([\s\S]*?)<\/button>/i,replaceTagsAndSpaces,parseCurrency);isAvailable("cards.transactions")&&processCardTransactions(d,a,b)}else AnyBalance.trace(c),AnyBalance.trace("Не удалось найти ссылку на подробную информацию по карте.")}
function processDeposits(c,b){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам");}function processCredits(c,b){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}function processInfo(c,b){var a=b.info={};getParam(c,a,"info.fio",/<span[^>]+lbUserName[^>]*>([^<]*)/i,[replaceTagsAndSpaces,/!/g,""])};
