var g_headers={Accept:"text/xml","Content-Type":"text/xml",Connection:"keep-alive","User-Agent":"Dalvik/1.6.0 (Linux; U; Android 4.4.2; sdk Build/KK) Android/3.0.2(302)"},baseurl="https://connect.raiffeisen.ru/Mobile-WS/services/",g_xml_login='<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsd="http://entry.rconnect/xsd" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.rconnect" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Header /><soapenv:Body><ser:login><login>%LOGIN%</login><password>%PASSWORD%</password></ser:login></soapenv:Body></soapenv:Envelope>',
g_xml_accounts='<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsd="http://entry.rconnect/xsd" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.rconnect" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Header /><soapenv:Body><ser:GetAccounts /></soapenv:Body></soapenv:Envelope>',g_xml_cards='<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsd="http://entry.rconnect/xsd" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.rconnect" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Header /><soapenv:Body><ser:GetCards /></soapenv:Body></soapenv:Envelope>',
g_xml_loans='<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsd="http://entry.rconnect/xsd" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.rconnect" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Header /><soapenv:Body><ser:GetLoans /></soapenv:Body></soapenv:Envelope>',g_xml_deposits='<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsd="http://entry.rconnect/xsd" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.rconnect" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Header /><soapenv:Body><ser:GetDeposits /></soapenv:Body></soapenv:Envelope>',
g_xml_UITAccounts='<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsd="http://entry.rconnect/xsd" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ser="http://service.rconnect" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Header /><soapenv:Body><ser:GetUITAccounts /></soapenv:Body></soapenv:Envelope>';
function login(b,a){function e(a){var b={"logins.password.incorrect":"Неправильный логин или пароль","profile.login.first_entry":"Это ваш первый вход в Райффайзен.Connect. Пожалуйста, зайдите в https://connect.raiffeisen.ru через браузер и установите постоянный пароль","profile.login.expired":"Уважаемый клиент, срок действия Вашего пароля истёк, так как Вы не меняли Ваше имя пользователя и/или пароль в течение последних 180 дней. Для доступа к системе требуется изменить ваше имя пользователя и/или пароль на новые значения."};
if(b[a])return b[a];AnyBalance.trace("Неизвестная ошибка: "+a);return a}function d(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}checkEmpty(b.login,"Введите логин в интернет-банк!");checkEmpty(b.password,"Введите пароль в интернет-банк!");AnyBalance.setDefaultCharset("utf-8");var c=AnyBalance.requestPost(baseurl+"RCAuthorizationService",g_xml_login.replace(/%LOGIN%/g,d(b.login)).replace(/%PASSWORD%/g,d(b.password)),addHeaders({SOAPAction:""}));
if(!/loginResponse/i.test(c)){var f=getParam(c,null,null,/<faultstring>([\s\S]*?)<\/faultstring>/i,replaceTagsAndSpaces);if(f&&(f=e(f)))throw new AnyBalance.Error(f,null,/Неправильный логин или пароль|срок действия Вашего пароля истёк/i.test(f));AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в интернет банк. Обратитесь к разработчикам.");}a.profile={};getParam(c,a.profile,"profile.fio",/<name>([\s\S]*?)<\/name>/i,replaceTagsAndSpaces,capitalFirstLetters);getParam(c,a.profile,"profile.passportnumber",
/<passportnumber>([\s\S]*?)<\/passportnumber>/i,replaceTagsAndSpaces);getParam(c,a.profile,"profile.passportissuer",/<passportissuer>([\s\S]*?)<\/passportissuer>/i,replaceTagsAndSpaces);getParam(c,a.profile,"profile.passportissuedate",/<passportissuedate>([\s\S]*?)<\/passportissuedate>/i,replaceTagsAndSpaces,parseDateISO);getParam(c,a.profile,"profile.login",/<login>([\s\S]*?)<\/login>/i,replaceTagsAndSpaces);return c}
function processCards(b,a){if(isAvailable("cards")){b=AnyBalance.requestPost(baseurl+"RCCardService",g_xml_cards,addHeaders({SOAPAction:""}));var e=getElements(b,/<return>/ig);AnyBalance.trace("Найдено карт: "+e.length);a.cards=[];for(var d=0;d<e.length;++d){var c=getParam(e[d],null,null,/<id>([\s\S]*?)<\/id>/i,replaceTagsAndSpaces),f=getParam(e[d],null,null,/<number>([\s\S]*?)<\/number>/i,replaceTagsAndSpaces),c={__id:c,__name:f};__shouldProcess("cards",c)&&processCard(e[d],c);a.cards.push(c)}}}
function processCard(b,a){function e(b){return isAvailable(b)&&!isset(a[b])}var d=getParam(b,null,null,/<balance>([\s\S]*?)<\/balance>/i,replaceTagsAndSpaces,parseBalance);getParam(d,a,"cards.balance");getParam(b,a,"cards.currency cards.balance cards.minpay cards.limit cards.totalCreditDebtAmount cards.holdedFunds".split(" "),/<currency>([\s\S]*?)<\/currency>/i,replaceTagsAndSpaces,toUpperCaseMy);getParam(b,a,"cards.minpay",/<minimalCreditPayment>([\s\S]*?)<\/minimalCreditPayment>/i,replaceTagsAndSpaces,
parseBalance);getParam(b,a,"cards.limit",/<creditLimit>([\s\S]*?)<\/creditLimit>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"cards.holdedFunds",/<holdedFunds>([\s\S]*?)<\/holdedFunds>/i,replaceTagsAndSpaces,parseBalance);var c=getParam(b,null,null,/<accountType>([\s\S]*?)<\/accountType>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,"cards.type_code");getParam(b,a,"cards.type",/<type>([\s\S]*?)<\/type>/i,replaceTagsAndSpaces);getParam(b,a,"cards.cardnum",/<number>([\s\S]*?)<\/number>/i,
replaceTagsAndSpaces);getParam(b,a,"cards.accnum",/<accountNumber>([\s\S]*?)<\/accountNumber>/i,replaceTagsAndSpaces);getParam(b,a,"cards.minpaytill",/<nextCreditPaymentDate>([\s\S]*?)<\/nextCreditPaymentDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"cards.till",/<expirationDate>([\s\S]*?)<\/expirationDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"cards.state",/<state>([\s\S]*?)<\/state>/i,replaceTagsAndSpaces);getParam(b,a,"cards.cardName",/<cardName>([\s\S]*?)<\/cardName>/i,
replaceTagsAndSpaces,function(a){return html_entity_decode(a)+" ("+getParam(b,null,null,/<number>([\s\S]*?)<\/number>/i,[replaceTagsAndSpaces,/^[\s\S]*?(\d{4})$/,"$1"])+")"});getParam(b,a,"cards.holderName",/<holderName>([\s\S]*?)<\/holderName>/i,replaceTagsAndSpaces);getParam(b,a,"cards.isCorporate",/<isCorporate>([\s\S]*?)<\/isCorporate>/i,replaceTagsAndSpaces,parseBoolean);getParam(b,a,"cards.isMain",/<main>([\s\S]*?)<\/main>/i,replaceTagsAndSpaces,parseBoolean);getParam(b,a,"cards.openDate",/<openDate>([\s\S]*?)<\/openDate>/i,
replaceTagsAndSpaces,parseDateISO);getParam(b,a,"cards.shortType",/<shortType>([\s\S]*?)<\/shortType>/i,replaceTagsAndSpaces);if("3"==c&&(isAvailable(["cards.totalCreditDebtAmount","cards.clearBalance","cards.ownFunds"])||e("cards.limit")||e("cards.minpay"))){var c=AnyBalance.requestPost(baseurl+"RCCardService",'<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://entry.rconnect/xsd" xmlns:ser="http://service.rconnect" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/"><soapenv:Header /><soapenv:Body><ser:getCreditStatementPeriods2><cardId>'+
a.__id+"</cardId></ser:getCreditStatementPeriods2></soapenv:Body></soapenv:Envelope>",addHeaders({SOAPAction:""})),f=getParam(c,null,null,/<id>([\s\S]*?)<\/id>/i,replaceTagsAndSpaces),g=getParam(c,null,null,/<prime>([\s\S]*?)<\/prime>/i,replaceTagsAndSpaces);g&&f?(c=AnyBalance.requestPost(baseurl+"RCCardService",'<?xml version=\'1.0\' encoding=\'UTF-8\' standalone=\'yes\' ?><soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://entry.rconnect/xsd" xmlns:ser="http://service.rconnect" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/"><soapenv:Header /><soapenv:Body><ser:getCurrentCreditStatement><cardId>'+
a.__id+"</cardId><id>"+f+"</id><isPrime>"+g+"</isPrime></ser:getCurrentCreditStatement></soapenv:Body></soapenv:Envelope>",addHeaders({SOAPAction:""})),f=getParam(c,null,null,/<availableCreditLimit>([\s\S]*?)<\/availableCreditLimit>/i,replaceTagsAndSpaces,parseBalance),g=getParam(c,null,null,/<ownFunds>([\s\S]*?)<\/ownFunds>/i,replaceTagsAndSpaces,parseBalance),getParam(f,a,"cards.limit"),getParam(g,a,"cards.ownFunds"),getParam(d-f,a,"cards.clearBalance"),getParam(c,a,"cards.totalCreditDebtAmount",
/<totalDebtAmount>([\s\S]*?)<\/totalDebtAmount>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.minpay",/<minAmount>([\s\S]*?)<\/minAmount>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.gracePeriodOutstanding",/<gracePeriodOutstanding>([\s\S]*?)<\/gracePeriodOutstanding>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.unpaidGracePeriodDue",/<unpaidGracePeriodDue>([\s\S]*?)<\/unpaidGracePeriodDue>/i,replaceTagsAndSpaces,parseBalance),getParam(c,a,"cards.gracePeriodEnd",
/<gracePeriodEnd>([\s\S]*?)<\/gracePeriodEnd>/i,replaceTagsAndSpaces,parseDateISO)):(AnyBalance.trace("Не удалось найти доп информацию по карте "+a.__name),AnyBalance.trace(c))}"undefined"!=typeof processCardTransactions&&processCardTransactions(b,a)}
function processAccounts(b,a){if(isAvailable("accounts")){b=AnyBalance.requestPost(baseurl+"RCAccountService",g_xml_accounts,addHeaders({SOAPAction:""}));var e=getElements(b,/<return>/ig);AnyBalance.trace("Найдено счетов: "+e.length);a.accounts=[];for(var d=0;d<e.length;++d){var c=getParam(e[d],null,null,/<id>([\s\S]*?)<\/id>/i,replaceTagsAndSpaces),f=getParam(e[d],null,null,/<number>([\s\S]*?)<\/number>/i,replaceTagsAndSpaces),c={__id:c,__name:f};__shouldProcess("accounts",c)&&processAccount(e[d],
c);a.accounts.push(c)}}}
function processAccount(b,a){getParam(b,a,"accounts.balance",/<balance>([\s\S]*?)<\/balance>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"accounts.heldFunds",/<heldFunds>([\s\S]*?)<\/heldFunds>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["accounts.currency","accounts.minpay","accounts.limit","accounts.balance"],/<currency>([\s\S]*?)<\/currency>/i,replaceTagsAndSpaces,toUpperCaseMy);getParam(b,a,"accounts.accnum",/<number>([\s\S]*?)<\/number>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.minpaytill",
/<nextCreditPaymentDate>([\s\S]*?)<\/nextCreditPaymentDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"accounts.minpay",/<minimalCreditPayment>([\s\S]*?)<\/minimalCreditPayment>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"accounts.limit",/<creditLimit>([\s\S]*?)<\/creditLimit>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"accounts.till",/<closeDate>([\s\S]*?)<\/closeDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"accounts.openDate",/<openDate>([\s\S]*?)<\/openDate>/i,
replaceTagsAndSpaces,parseDateISO);getParam(b,a,"accounts.accountSubtypeName",/<accountSubtypeName>([\s\S]*?)<\/accountSubtypeName>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.type",/<type>([\s\S]*?)<\/type>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.region",/<region>([\s\S]*?)<\/region>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.owner_id",/<owner_id>([\s\S]*?)<\/owner_id>/i,replaceTagsAndSpaces);getParam(b,a,"accounts.branchId",/<branchId>([\s\S]*?)<\/branchId>/i,replaceTagsAndSpaces);
"undefined"!=typeof processAccountTransactions&&processAccountTransactions(b,a)}
function processDeposits(b,a){if(isAvailable("deposits")){b=AnyBalance.requestPost(baseurl+"RCDepositService",g_xml_deposits,addHeaders({SOAPAction:""}));var e=getElements(b,/<return>/ig);AnyBalance.trace("Найдено депозитов: "+e.length);a.deposits=[];for(var d=0;d<e.length;++d){var c=getParam(e[d],null,null,/<id>([\s\S]*?)<\/id>/i,replaceTagsAndSpaces),f=getParam(e[d],null,null,/<accountNumber>([\s\S]*?)<\/accountNumber>/i,replaceTagsAndSpaces),c={__id:c,__name:f};__shouldProcess("deposits",c)&&processDeposit(e[d],
c);a.deposits.push(c)}}}
function processDeposit(b,a){getParam(b,a,"deposits.accnum",/<accountNumber>([\s\S]*?)<\/accountNumber>/i,replaceTagsAndSpaces);getParam(b,a,"deposits.balance",/<initialAmount>([\s\S]*?)<\/initialAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"deposits.currentAmount",/<currentAmount>([\s\S]*?)<\/currentAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,["deposits.currency","deposits.balance","deposits.currentAmount"],/<currency>[^<]*?([^<\.]*?)<\/currency>/i,replaceTagsAndSpaces,
toUpperCaseMy);getParam(b,a,"deposits.rate",/<interestRate>([\s\S]*?)<\/interestRate>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"deposits.daysQuantity",/<daysQuantity>([\s\S]*?)<\/daysQuantity>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"deposits.pcts",/<totalInterest>([\s\S]*?)<\/totalInterest>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"deposits.till",/<closeDate>([\s\S]*?)<\/closeDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"deposits.openDate",/<openDate>([\s\S]*?)<\/openDate>/i,
replaceTagsAndSpaces,parseDateISO);getParam(b,a,"deposits.capitalization",/<capitalization>([\s\S]*?)<\/capitalization>/i,replaceTagsAndSpaces,parseBoolean);getParam(b,a,"deposits.name",/<names>([\s\S]*?)<\/names>/i,replaceTagsAndSpaces)}
function processLoans(b,a){if(isAvailable("loans")){b=AnyBalance.requestPost(baseurl+"RCLoanService",g_xml_loans,addHeaders({SOAPAction:""}));var e=getElements(b,/<return>/ig);AnyBalance.trace("Найдено кредитов: "+e.length);a.loans=[];for(var d=0;d<e.length;++d){var c=getParam(e[d],null,null,/<id>([\s\S]*?)<\/id>/i,replaceTagsAndSpaces),c={__id:c,__name:"Кредит "+c};__shouldProcess("loans",c)&&processLoan(e[d],c);a.loans.push(c)}}}
function processLoan(b,a){getParam(b,a,"loans.rate",/<intrestRate>([\s\S]*?)<\/intrestRate>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"loans.cred_ammount",/<loanAmount>([\s\S]*?)<\/loanAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"loans.balance",/<paymentRest>([\s\S]*?)<\/paymentRest>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"loans.minpay",/<nextPaymentAmount>([\s\S]*?)<\/nextPaymentAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"loans.paid",/<paidLoanAmount>([\s\S]*?)<\/paidLoanAmount>/i,
replaceTagsAndSpaces,parseBalance);getParam(b,a,"loans.paidLoanIntrest",/<paidLoanIntrest>([\s\S]*?)<\/paidLoanIntrest>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"loans.currency loans.cred_ammount loans.balance loans.paid loans.paidLoanIntrest loans.minpay".split(" "),/<currency>[^<]*?([^<\.]*?)<\/currency>/i,replaceTagsAndSpaces,toUpperCaseMy);getParam(b,a,"loans.minpaytill",/<nextPaymentDate>([\s\S]*?)<\/nextPaymentDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"loans.till",/<closeDate>([\s\S]*?)<\/closeDate>/i,
replaceTagsAndSpaces,parseDateISO);getParam(b,a,"loans.openDate",/<openDate>([\s\S]*?)<\/openDate>/i,replaceTagsAndSpaces,parseDateISO);"undefined"!=typeof processLoanTransactions&&processLoanTransactions(b,a)}function sortByKey(b,a){return b.sort(function(b,d){var c=b[a],f=d[a];return c>f?-1:c<f?1:0})}
function getFormattedDate(b){var a=new Date,e=10>a.getDate()?"0"+a.getDate():a.getDate(),d=10>a.getMonth()+1?"0"+(a.getMonth()+1):a.getMonth()+1;return(isset(b)?a.getFullYear()-b:a.getFullYear())+"-"+d+"-"+e}function parseBoolean(b){return"true"===b}function toUpperCaseMy(b){return(b+"").toUpperCase()};
