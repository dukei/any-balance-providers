var g_headers={"User-Agent":"Dalvik/2.1.0 (Linux; U; Android 8.0.0; ONEPLUS A3010 Build/OPR6.170623.013)",Accept:"application/json","RC-Device":"android",Connection:"close","Accept-Language":"ru"},g_baseurl="https://online.raiffeisen.ru/",g_token,g_loginInfo;
function callApi(b,a){if(!g_token&&"oauth/token"!=b)throw new AnyBalance.Error("Внутренняя ошибка, сайт изменен?");var d;d=g_token?addHeaders({Authorization:"Bearer "+g_token}):addHeaders({Authorization:"Basic b2F1dGhVc2VyOm9hdXRoUGFzc3dvcmQhQA=="});a&&(d["Content-Type"]="application/json");a=AnyBalance.requestPost(g_baseurl+b,a&&JSON.stringify(a),d,{HTTP_METHOD:a?"POST":"GET"});if(401==AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Отказ в доступе. Неправильный логин или пароль?",
null,!0);if(400<=AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка вызова API "+b+": "+AnyBalance.getLastStatusCode());return getJson(a)}function login(b){b=AnyBalance.getPreferences();AB.checkEmpty(b.login,"Введите логин!");AB.checkEmpty(b.password,"Введите пароль!");g_token||(b=callApi("oauth/token",{grant_type:"password",password:b.password,platform:"android",username:b.login,version:"497"}),g_token=b.access_token,g_loginInfo=b)}
function processInfo(b){if(AnyBalance.isAvailable("info")){b.info={};var a=g_loginInfo;if(!a)throw new AnyBalance.Error("Не удаётся получить общую информацию");getParam(a.resource_owner.fullName,b.info,"info.fio");getParam(a.resource_owner.birthDate,b.info,"info.birthday",null,null,parseDateISO);getParam(a.resource_owner.address,b.info,"info.address");getParam(a.resource_owner.mobilePhone,b.info,"info.mphone");getParam(a.resource_owner.email,b.info,"info.email");getParam(a.resource_owner.passportNumber,
b.info,"info.passport");getParam(a.resource_owner.passportIssuer,b.info,"info.passportissuer");getParam(a.resource_owner.passportDate,b.info,"info.passportissuedate",null,null,parseDateISO);getParam(a.username,b.info,"info.login")}}
function processCards(b){if(isAvailable("cards")){var a=callApi("rest/card?alien=false");AnyBalance.trace("Найдено карт: "+a.length);b.cards=[];for(var d=0;d<a.length;++d){var c=a[d],e=c.id,c=c.paymentSystem.name+" "+c.pan.substr(-4),e={__id:e,__name:c};__shouldProcess("cards",e)&&processCard(a[d],e);b.cards.push(e)}}}
function processCard(b,a){getParam(b.balance,a,"cards.balance");getParam(b.currencyId,a,"cards.currency cards.balance cards.minpay cards.limit cards.totalCreditDebtAmount cards.blocked".split(" "));getParam(b.hold,a,"cards.blocked");getParam(b.type.id,a,"cards.type_code");getParam(b.type.name,a,"cards.type");getParam(b.pan,a,"cards.num");getParam(b.account.cba,a,"cards.accnum");getParam(b.status.name,a,"cards.status");getParam(b.product,a,"cards.name");getParam(b.cardholder,a,"cards.holder");getParam(1==
b.main.id,a,"cards.isMain");getParam(b.open,a,"cards.dateStart",null,null,parseDateISO);getParam(b.paymentSystem.name,a,"cards.shortType");"undefined"!=typeof processCardTransactions&&processCardTransactions(b,a)}
function processAccounts(b){if(isAvailable("accounts")){var a=callApi("rest/account?alien=false");AnyBalance.trace("Найдено счетов: "+a.length);b.accounts=[];for(var d=0;d<a.length;++d){var c=a[d],c={__id:c.id,__name:c.type.name+" "+c.currencyId+" "+c.cba};__shouldProcess("accounts",c)&&processAccount(a[d],c);b.accounts.push(c)}}}
function processAccount(b,a){getParam(b.balance,a,"accounts.balance");getParam(b.hold,a,"accounts.blocked");getParam(b.currencyId,a,["accounts.currency","accounts.minpay","accounts.limit","accounts.balance"]);getParam(b.cba,a,"accounts.num");getParam(b.open,a,"accounts.date_start",null,null,parseDateISO);getParam(b.type.name,a,"accounts.type");"undefined"!=typeof processAccountTransactions&&processAccountTransactions(b,a)}
function processDeposits(b){if(isAvailable("deposits")){var a=callApi("rest/deposit?alien=false");AnyBalance.trace("Найдено депозитов: "+a.length);b.deposits=[];for(var d=0;d<a.length;++d){var c=a[d],c={__id:c.id,__name:c.product.name.name+" "+c.deals[0].currencyId+" "+c.number};__shouldProcess("deposits",c)&&processDeposit(a[d],c);b.deposits.push(c)}}}
function processDeposit(b,a){getParam(b.deals[0].cba,a,"deposits.num");getParam(b.deals[0].currentAmount,a,"deposits.balance");getParam(b.deals[0].startAmount,a,"deposits.balance_start");getParam(b.deals[0].currencyId,a,["deposits.currency","deposits.balance","deposits.currentAmount"]);getParam(b.deals[0].rate,a,"deposits.pct");getParam(b.deals[0].duration,a,"deposits.period");getParam(b.deals[0].paidInterest,a,"deposits.pcts");getParam(b.deals[0].close,a,"deposits.till",null,null,parseDateISO);getParam(b.deals[0].open,
a,"deposits.date_start",null,null,parseDateISO);getParam(b.product.name.name,a,"deposits.name")}function processLoans(b){if(isAvailable("credits"))throw new AnyBalance.Error("Не удалось получить кредиты. Сайт изменен?");}
function processLoan(b,a){getParam(b,a,"credits.pct",/<intrestRate>([\s\S]*?)<\/intrestRate>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.limit",/<loanAmount>([\s\S]*?)<\/loanAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.balance",/<paymentRest>([\s\S]*?)<\/paymentRest>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.minpay",/<nextPaymentAmount>([\s\S]*?)<\/nextPaymentAmount>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.paid",/<paidLoanAmount>([\s\S]*?)<\/paidLoanAmount>/i,
replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.paidLoanIntrest",/<paidLoanIntrest>([\s\S]*?)<\/paidLoanIntrest>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,"credits.currency credits.limit credits.balance credits.paid credits.paidLoanIntrest credits.minpay".split(" "),/<currency>[^<]*?([^<\.]*?)<\/currency>/i,replaceTagsAndSpaces,toUpperCaseMy);getParam(b,a,"credits.minpay_till",/<nextPaymentDate>([\s\S]*?)<\/nextPaymentDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"credits.till",
/<closeDate>([\s\S]*?)<\/closeDate>/i,replaceTagsAndSpaces,parseDateISO);getParam(b,a,"credits.date_start",/<openDate>([\s\S]*?)<\/openDate>/i,replaceTagsAndSpaces,parseDateISO);"undefined"!=typeof processLoanTransactions&&processLoanTransactions(b,a)};
