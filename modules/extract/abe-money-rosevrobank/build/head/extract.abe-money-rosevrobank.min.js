var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"},baseurl="https://vb.rosevrobank.ru/",g_Xml_Headers=addHeaders({"X-Requested-With":"XMLHttpRequest","Wicket-Ajax":"true","Wicket-Ajax-BaseURL":"/",Referer:baseurl});
function redirectAsRequested(a,b){var c=getElement(a,/<redirect/i);if(!c){if(c=getElement(a,/<[^>]+feedbackPanel/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/парол/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error(b||"Не удалось зайти в интернет-банк. Сайт изменен?");}a=getParam(c,/<!\[CDATA\[([\s\S]*?)\]\]>/i);AnyBalance.trace("Редирект на "+a);return a=AnyBalance.requestGet(a,addHeaders({Referer:baseurl}))}
function login(a){AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var b=AnyBalance.requestGet(baseurl+"office",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var c=getElement(b,/<div[^>]+loginPopupContent/i);
if(!c)throw AnyBalance.trace(b),new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");var b=createFormParams(c,function(b,c,d,g){return/username/i.test(d)?a.login:/password/i.test(d)?a.password:g}),d=getParam(c,/<form[^>]+action="([^"]*)/i,replaceHtmlEntities),b=AnyBalance.requestPost(joinUrl(baseurl,d),b,g_Xml_Headers),b=redirectAsRequested(b,"Не удалось зайти в интернет-банк. Сайт изменен?");if(c=getElements(b,[/<form/ig,/:smsCode/i])[0]){AnyBalance.trace("Потребовался ввод смс-кода");
d=getParam(c,/<form[^>]+action="([^"]*)/i,replaceHtmlEntities);b=createFormParams(c,function(a,b,c,d){return/:smsCode:smsCode/i.test(c)?AnyBalance.retrieveCode("Пожалуйста, введите код подтверждения в интернет-банк, отправленный вам в SMS",null,{inputType:"number",time:18E4}):d});b=AnyBalance.requestPost(joinUrl(baseurl,d),b,g_Xml_Headers);if(!b)throw new AnyBalance.Error("Неверно введен код");b=redirectAsRequested(b,"Не удалось зайти в интернет-банк после ввода кода. Сайт изменен?")}}if(!/logout/i.test(b)){if(c=
getElement(b,/<[^>]+feedbackPanel/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/парол/i.test(c));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}__setLoginSuccessful();return b}
function processAccounts(a,b){if(AnyBalance.isAvailable("accounts")){a=AnyBalance.requestGet(baseurl+"office/accounts",g_headers);var c=getElements(a,/<div[^>]+productShortInfo[^>]+\baccount\b/ig);if(c.length)throw AnyBalance.trace("Найдено счетов: "+c.length),new AnyBalance.Error("Получение счетов пока не поддерживается. Пожалуйста, обратитесь к разработчикам");/Действующих счетов нет/i.test(a)?(b.accounts=[],AnyBalance.trace("Нет ни одного счета.")):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу со счетами."))}}
function processAccount(a,b){AnyBalance.trace("Обработка счета "+b.__name);getParam(a,b,"accounts.balance",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["accounts.currency","accounts.balance"],/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(a,b,"accounts.blocked",/(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"accounts.available",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,
parseBalance);var c=getParam(a,null,null,/<a[^>]+href="\/ib\/site\/([^"]*account\/info[^"]*)"/i,replaceHtmlEntities);getParam(c,b,"accounts.type",/accountType=([^"&]*)/i,replaceHtmlEntities);c&&AnyBalance.isAvailable("accounts.pct","accounts.comment","accounts.date_start","accounts.balance_national")&&(a=AnyBalance.requestGet(baseurl+c,g_headers),getParam(a,b,"account.pct",/Годовая процентная ставка:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"account.comment",
/Примечание:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"account.date_start",/Дата открытия счета:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"account.balance_national",/Остаток в национальной валюте:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance));isAvailable("accounts.transactions")&&processAccountTransactions(a,b)}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){a=AnyBalance.requestGet(baseurl+"office/cards",g_headers);var c=getElements(a,/<div[^>]+productShortInfo[^>]+\bcard\b/ig);if(c.length){AnyBalance.trace("Найдено карт: "+c.length);b.cards=[];a=findWicketActions(a);for(var d=0;d<c.length;++d){var e=c[d],f=getParam(e,/office\/cards\/(\d+)\/statement/i),h=getElement(e,/<label/i,replaceTagsAndSpaces),g=getElement(e,/<h\d/i,replaceTagsAndSpaces),f={__id:f,__name:g+" (*"+h.substr(-4)+")",num:h};
__shouldProcess("cards",f)&&processCard(e,f,a);b.cards.push(f)}}else/Действующих карт нет/i.test(a)?(b.cards=[],AnyBalance.trace("Нет ни одной карты.")):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(a,b,c){getParam(a,b,"cards.balance",/<div[^>]+formControl[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.currency",/<div[^>]+formControl[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"cards.name",/<h\d[^>]*>([\s\S]*?)<\/h\d>/i,replaceTagsAndSpaces);AnyBalance.isAvailable("cards.available","cards.kind","cards.type","cards.status","cards.accnum","cards.holder","cards.pct","cards.till","cards.debt","cards.transactions")&&
(a=AnyBalance.requestGet(baseurl+"office/cards/"+b.__id,g_headers),getParam(a,b,"cards.type",/Тип карты(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"cards.kind",/Вид карты(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"cards.available",/Доступный лимит(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.accnum",/Счет карты(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,
b,"cards.status",/Статус(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"cards.holder",/Имя на карте(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces),getParam(a,b,"cards.pct",/Проценты на остаток(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance),getParam(a,b,"cards.till",/Действует до(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate),getParam(a,b,"cards.debt",/Общая сумма задолженности(?:[\s\S]*?<td[^>]*>){1}([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseBalance),AnyBalance.isAvailable("cards.transactions")&&(a=AnyBalance.getLastUrl(),processCardTransactions(a,b)))}
function processDeposits(a,b){a=AnyBalance.requestGet(baseurl+"office/deposits",g_headers);var c=getElements(a,/<div[^>]+productShortInfo[^>]+\bdeposit\b/ig);if(c.length)throw AnyBalance.trace("Найдено вкладов: "+c.length),new AnyBalance.Error("Получение вкладов пока не поддерживается. Пожалуйста, обратитесь к разработчикам");/Действующих вкладов нет/i.test(a)?(b.deposits=[],AnyBalance.trace("Нет ни одного вклада.")):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу со вкладами."))}
function processDeposit(a,b,c){}
function processCredits(a,b){if(AnyBalance.isAvailable("credits")){a=AnyBalance.requestGet(baseurl+"office/loans",g_headers);var c=getElements(a,/<div[^>]+productShortInfo[^>]+\bloan\b/ig);if(c.length)throw AnyBalance.trace("Найдено кредитов: "+c.length),new AnyBalance.Error("Получение кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам");/Действующих кредитов нет/i.test(a)?(b.credits=[],AnyBalance.trace("Нет ни одного кредита.")):(AnyBalance.trace(a),AnyBalance.trace("Не удалось найти таблицу со кредитами."))}}
function processCredit(a,b,c){AnyBalance.trace("Обработка кредита "+c.__id);getParam(b,c,"credits.limit",/(?:[\s\S]*?<td[^>]*>){5}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"credits.date_start",/(?:[\s\S]*?<td[^>]*>){3}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(b,c,"credits.date_end",/(?:[\s\S]*?<td[^>]*>){4}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseDate);getParam(b,c,"credits.currency",/(?:[\s\S]*?<td[^>]*>){6}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);getParam(b,
c,"credits.pct",/(?:[\s\S]*?<td[^>]*>){7}([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);if(AnyBalance.isAvailable("credits.period","credits.penalty","credits.minpaytill","credits.accnum")){var d=getElement(a,/<form[^>]+id="custContractsList"[^>]*>/i);a=createFormParams(d);a.action="showContractDetailedInfo";b=getParam(b,null,null,/setParams\((\{[\s\S]*?\})\)/i,null,getJsonEval);a=joinObjects(b,a);b=getParam(d,null,null,/<form[^>]+action="\/ib\/site\/([^"]*)/i,replaceHtmlEntities);b=AnyBalance.requestPost(baseurl+
b,a,addHeaders({Referer:baseurl}));getParam(b,c,"credits.period",/Срок кредитования в месяцах:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"credits.penalty",/Сумма просроченной задолженности:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"credits.accnum",/Текущий счет по кредитному договору:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,replaceTagsAndSpaces);if(d=getParam(b,null,null,/Дата ежемесячного платежа:[\s\S]*?<td[^>]*>([\s\S]*?)<\/td>/i,
replaceTagsAndSpaces,parseBalance))a=new Date,b=new Date(a.getFullYear(),a.getMonth(),d,12,59,59),d=new Date(a.getFullYear(),a.getMonth()+1,d,12,59,59),b.getTime()>a.getTime()?getParam(b.getTime(),c,"credits.minpaytill"):getParam(d.getTime(),c,"credits.minpaytill")}}
function processInfo(a,b){if(AnyBalance.isAvailable("info")){b=b.info={};a=AnyBalance.requestGet(baseurl+"office/profile",g_headers);var c=[/<label[^>]*>([\s\S]*?)<\/label>/ig,"",/<a[^>]+actionEdit[^>]*>([\s\S]*?)<\/a>/ig,"",replaceTagsAndSpaces];getParam(getElement(a,/<div[^>]+fullName/i,c),b,"info.fio");getParam(getElement(a,/<div[^>]+mobilePhone/i,c),b,"info.mphone");getParam(getElement(a,/<div[^>]+additionalPhone/i,c),b,"info.aphone");getParam(getElement(a,/<div[^>]+eMail/i,c),b,"info.email");
getParam(a,b,"info.passport",/<label[^>]*>\s*Паспорт[\s\S]*?<div[^>]+editInPlaceField[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(a,b,"info.inn",/<label[^>]*>\s*ИНН[\s\S]*?<div[^>]+editInPlaceField[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces);getParam(a,b,"info.snils",/<label[^>]*>\s*СНИЛС[\s\S]*?<div[^>]+editInPlaceField[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces)}}
function findWicketActions(a){a=sumParam(a,null,null,/Wicket.Ajax.ajax\((\{[\s\S]*?\})\);/ig)||[];AnyBalance.trace("Found "+a.length+" Wicket-ajax actions");return a}function findExactWickeAction(a,b){if(a)for(var c=0;c<a.length;c++){var d=getJsonEval(a[c]),e=(d.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");if(d.c===b)return e}}
function requestGetWicketAction(a,b,c,d){var e=getParam(a,null,null,b);if(!e)throw AnyBalance.trace(a),new AnyBalance.Error("Не нашли wicketId "+b.source);a=d?Array.isArray(d)?d:findWicketActions(d):findWicketActions(a);a=findExactWickeAction(a,e);if(!a)throw new AnyBalance.Error("Не удалось найти action: "+e);return executeWicketUrl(a,c)}
function executeWicketUrl(a,b){return b?AnyBalance.requestPost(joinUrl(baseurl,a),b,g_Xml_Headers):AnyBalance.requestGet(joinUrl(baseurl,a)+"&_="+(new Date).getTime(),g_Xml_Headers)};
