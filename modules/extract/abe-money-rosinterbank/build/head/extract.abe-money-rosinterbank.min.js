var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36"},g_Xml_Headers={Accept:"application/xml, text/xml, */*; q=0.01","X-Requested-With":"XMLHttpRequest","Wicket-Ajax":"true","Wicket-Ajax-BaseURL":"main","Wicket-FocusedElementId":"id14",Origin:"https://b2c.rosinterbank.ru"},
baseurl="https://b2c.rosinterbank.ru/app/";
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");var c=AnyBalance.requestGet(baseurl,g_headers);if(!c||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(c),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/logout/i.test(c))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var b=findWicketActions(c),
d=[],e=getParam(c,null,null,/<input[^>]*name="password"[^>]*id="([^"]+)/i),f=getParam(c,null,null,/<input[^>]*name="login"[^>]*id="([^"]+)/i),g=getParam(c,null,null,/<a[^>]*class="button[^>]*id="([^"]+)/i);b.forEach(function(a,b,c){a=getJson(a);b=(a.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");switch(a.c){case f:d[0]=b;break;case e:d[1]=b;break;case g:d[2]=b}});a=[{login:a.login},{password:a.password}];a[2]=joinObjects(a[0],a[1]);for(b=0;b<d.length;b++)c=AnyBalance.requestPost(baseurl+
d[b],a[b],addHeaders(g_Xml_Headers))}if(!/logout/i.test(c)){if(a=AB.getParam(c,null,null,/"feedbackPanelERROR"[^>]*>([\s\S]*?)<\//i,AB.replaceTagsAndSpaces))throw new AnyBalance.Error(a,null,/Неверно указан/i.test(a));AnyBalance.trace(c);throw new AnyBalance.Error("Не удалось зайти в личный кабинет. Сайт изменен?");}__setLoginSuccessful();return c}
function findWicketActions(a){a=sumParam(a,null,null,/Wicket.Ajax.ajax\((\{[\s\S]*?\})\);/ig)||[];AnyBalance.trace("Found "+a.length+" Wicket-ajax actions");return a}function requestGetWicketAction(a,c){var b=getParam(a,null,null,c);if(!b)throw AnyBalance.trace("Error stack: "+Error().stack),new AnyBalance.Error("Не нашли wicketId "+c.source);var d=findWicketActions(a),b=findExactWicketAction(d,b);return AnyBalance.requestGet(baseurl+b+"&_="+(new Date).getTime(),addHeaders(g_Xml_Headers))}
function findExactWicketAction(a,c){if(a)for(var b=0;b<a.length;b++){var d=getJson(a[b]),e=(d.u||"").replace(/^.\/main/,"main").replace(/;jsessionid[^?]+/i,"");if(d.c===c)return e}}
function processAccounts(a,c){if(AnyBalance.isAvailable("accounts")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/wicket.event.add\([^"]*?"load"[\s\S]*?"c":"([^"]*)/i);a=requestGetWicketAction(a,/<div[^>]+class="inner[^>]+id="(id[^"]+)"/i);var b=getElements(a,/<div[^>]+class=['"]account inner single-account['"][^>]*>/ig);AnyBalance.trace("Найдено счетов: "+b.length);c.accounts=[];for(var d=0;d<b.length;++d){var e=requestGetWicketAction(b[d]+a,/id="(id[^"]+)"/i),
f={__id:getParam(e,null,null,/№(?:[^>]*>)?(\d{20})/i,replaceTagsAndSpaces),__name:getParam(e,null,null,/class="dashed active"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces),num:getParam(e,null,null,/№(?:[^>]*>)?(\d{20})/i,replaceTagsAndSpaces)};__shouldProcess("accounts",f)&&processAccount(e,f);c.accounts.push(f)}}}
function processAccount(a,c){AnyBalance.trace("Обработка счета "+c.__name);getParam(a,c,"accounts.balance",/class="[^"]*amounts"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,["accounts.currency","accounts"],/class="[^"]*amounts"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);isAvailable("accounts.transactions")&&processAccountTransactions(a,c)}
function processCards(a,c){if(AnyBalance.isAvailable("cards")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/wicket.event.add\([^"]*?"load"[\s\S]*?"c":"([^"]*)/i);a=requestGetWicketAction(a,/<div[^>]+class="inner[^>]+id="(id[^"]+)"/i);var b=getElements(a,/<div[^>]+class=['"]card inner['"][^>]*>/ig);AnyBalance.trace("Найдено карт: "+b.length);c.cards=[];for(var d=0;d<b.length;++d){var e=getParam(b[d],null,null,/<small[^>]+class="gray"[^>]*>([\s\S]*?)<\//i,
replaceTagsAndSpaces),f=getParam(b[d],null,null,/<small[^>]+class="gray"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces),g=getParam(b[d],null,null,/"card-name"[^>]*>([\s\S]*?)<\//i,replaceTagsAndSpaces),e={__id:e,num:f,__name:g+" "+e};__shouldProcess("cards",e)&&processCard(b[d],e,a);c.cards.push(e)}}}
function processCard(a,c,b){AnyBalance.trace("Обработка карты "+c.__name);getParam(a,c,"cards.balance",/class="amount"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,["cards.currency","cards.balance"],/class="amount"[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);b=requestGetWicketAction(b,/<div[^>]+class="card inner[^>]+id="(id[^"]+)"/i);getParam(b,c,"cards.till",/Срок действия((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces,parseDate);getParam(b,c,"cards.holderName",
/Имя владельца((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(b,c,"cards.status",/Статус карты((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);isAvailable("cards.transactions")&&processCardTransactions(b,c)}
function processDeposits(a,c){if(AnyBalance.isAvailable("deposits")){a=AnyBalance.requestGet(baseurl+"main?main=priv",g_headers);a=requestGetWicketAction(a,/wicket.event.add\([^"]*?"load"[\s\S]*?"c":"([^"]*)/i);a=requestGetWicketAction(a,/<div[^>]+class="inner[^>]+id="(id[^"]+)"(?:[^>]*>){3,7}\s*Вклады/i);var b=getElements(a,/<div[^>]+class=['"]account inner[^>]*>/ig);AnyBalance.trace("Найдено депозитов: "+b.length);c.deposits=[];for(var d=0;d<b.length;++d){var e=requestGetWicketAction(b[d]+a,/id="(id[^"]+)"/i),
f=getParam(b[d],null,null,/<span[^>]*class=['"]index['"](?:[^>]*>){2}([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),g=getParam(e,null,null,/<small[^>]+light(?:[^>]*>){2}([^<]*)/i,replaceTagsAndSpaces),h=getParam(e,null,null,/<small[^>]+light(?:[^>]*>){2}([^<]*)/i,replaceTagsAndSpaces),f={__id:g,__name:f,num:h};__shouldProcess("deposits",f)&&processDeposit(b[d],f,e);c.deposits.push(f)}}}
function processDeposit(a,c,b){AnyBalance.trace("Обработка депозита "+c.__name);getParam(a,c,"deposits.balance",/<div[^>]+amount[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(a,c,["deposits.currency","cards"],/<div[^>]+amount[^>]*>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);getParam(b,c,"deposits.pct",/Процентная ставка(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"deposits.pct_charged",/Сумма выплаченных процентов(?:[^>]*>){4}([^<]*)/i,
replaceTagsAndSpaces,parseBalance);getParam(b,c,"deposits.start_balance",/Сумма вклада на начало действия договора(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"deposits.max_balance",/Максимальная сумма вклада(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"deposits.topup",/Возможность пополнения(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces);getParam(b,c,"deposits.topup_sum",/Сумма пополнения(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(b,
c,"deposits.withdraw_sum",/Возможная сумма снятия(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(b,c,"deposits.topup_till",/Пополнение вклада возможно до(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces,parseDate);getParam(b,c,"deposits.acc_pct_transf",/Счет для перечисления процентов(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces);getParam(b,c,"deposits.acc_pct_refund",/Счет для возврата по вкладу(?:[^>]*>){4}([^<]*)/i,replaceTagsAndSpaces);getParam(b,c,"deposits.income_tax",/Налог на доход(?:[^>]*>){4}([^<]*)/i,
replaceTagsAndSpaces,parseBalance);isAvailable("deposits.transactions")&&processDepositTransactions(b,c)}function processCredits(a,c){throw new AnyBalance.Error("Обработка кредитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processInfo(a,c){var b=getParam(a,null,null,/<small[^>]+id="([^"]*)[^>]*>Профиль/i),d=findWicketActions(a),b=findExactWicketAction(d,b);a=AnyBalance.requestGet(baseurl+b,g_headers);b=c.info={};getParam(a,b,"profile.fio",/ФИО((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(a,b,"profile.birthday",/Дата рождения((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(a,b,"profile.phone",/Телефон((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(a,b,"profile.address",
/Адрес регистрации((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces);getParam(a,b,"profile.addressHome",/Домашний адрес((?:[\s\S]*?<\/div[^>]*>){2})/i,replaceTagsAndSpaces)};
