var g_headers={Accept:"text/html, */*; q=0.01","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Linux; Android 5.1.1; D6503 Build/23.4.A.1.232; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/46.0.2490.76 Mobile Safari/537.36","X-Requested-With":"XMLHttpRequest",mobile:"app"},baseurl="https://i.ubrr.ru",g_lastoverview="";
function login(c){AnyBalance.setDefaultCharset("utf-8");checkEmpty(c.login,"Введите логин!");checkEmpty(c.password,"Введите пароль!");var a=g_lastoverview;if(!/overview-menu/i.test(a)){var a=AnyBalance.requestGet(baseurl+"/ubrrmobile/loginsecuritytoken?username="+encodeURIComponent(c.login),g_headers),b=AnyBalance.getData("simplehash","u9Mo8FUrzf+0qCH1ibzD/s44lZ0nPaqeOalE4x0t3OI=");if(!a||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(a),new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");
a=AnyBalance.requestPost(baseurl+"/login",{securityToken:a,username:c.login,password:c.password,simplehash:b,authType:b?void 0:"EXTERNAL"},addHeaders({Origin:"file://"}));/<input[^>]+name="otpCode"/i.test(a)&&(AnyBalance.trace("Необходимо ввести одноразовый код"),c=getElement(a,/<span[^>]+otp-code-text[^>]*>/i,replaceTagsAndSpaces),c=AnyBalance.retrieveCode(c||"Введите одноразовый код, отправленный вам на телефон",null,{time:18E4,inputType:"number"}),a=AnyBalance.requestPost(baseurl+"/security/authenticateotp",
{otpCode:c,simpleLogin:"on"},g_headers));if(/overview-menu/i.test(a)){g_lastoverview=a;if(b=getParam(a,null,null,/setSimplehash\s*\(\s*'([^']*)/,replaceSlashes))AnyBalance.trace("Записываем hash: "+b),AnyBalance.setData("simplehash",b),AnyBalance.saveData();__setLoginSuccessful()}}if(!/overview-menu/i.test(a)){if(c=getParam(a,null,null,/<div[^>]+id="alert-error"[^>]*>([\s\S]*?)(?:<\/div>|<script)/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/Проверьте правильность указания Логина и Пароля/i.test(c));
AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}return a}
function processAccounts(c,a){if(AnyBalance.isAvailable("accounts")){c=AnyBalance.requestGet(baseurl+"/mobile/accounts",g_headers);var b=getElement(c,/<ul[^>]+id="accounts"[^>]*>/ig);if(b){b=getElements(b,/<li[^>]*>/ig);AnyBalance.trace("Найдено счетов: "+b.length);a.accounts=[];for(var f=0;f<b.length;++f){var e=b[f],d=getParam(e,null,null,/accountId=([^"&]*)/i,replaceHtmlEntities),g=getElement(e,/<h3[^>]*>/i,replaceTagsAndSpaces),d={__id:d,__name:g,num:g};__shouldProcess("accounts",d)&&processAccount(e,
d);a.accounts.push(d)}}else/У вас нет счетов/i.test(c)?(AnyBalance.trace("У вас нет счетов"),a.accounts=[]):AnyBalance.trace("Счета не найдены: "+c)}}
function processAccount(c,a){AnyBalance.trace("Обработка счета "+a.__name);getParam(c,a,"accounts.balance",/<\/h3>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["accounts.currency","accounts.balance"],/<\/h3>([\s\S]*?)<\/div>/i,replaceTagsAndSpaces,parseCurrency);var b=AnyBalance.requestGet(baseurl+"/mobile/statement?accountId="+encodeURIComponent(a.__id),g_headers);getParam(b,a,"accounts.available",/Доступно([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);getParam(b,a,
"accounts.blocked",/Зарезервировано([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBalance);AnyBalance.isAvailable("accounts.transactions")&&processAccountTransactions(b,a)}
function processCards(c,a){if(AnyBalance.isAvailable("cards")){c=AnyBalance.requestGet(baseurl+"/mobile/cards",g_headers);var b=getElement(c,/<ul[^>]+data-role="listview"[^>]*>/i);if(b){b=getElements(b,/<li[^>]*>/ig);AnyBalance.trace("Найдено карт: "+b.length);a.cards=[];for(var f=0;f<b.length;++f){var e=b[f],d=getParam(e,null,null,/cardId=([^"&]*)/i,replaceHtmlEntities),g=getElement(e,/<h3[^>]*>/i,replaceTagsAndSpaces),h=getParam(g,null,null,/\*?\d+$/,replaceTagsAndSpaces),d={__id:d,__name:g,num:h};
__shouldProcess("cards",d)&&processCard(e,d);a.cards.push(d)}}else/У вас нет карт/i.test(c)?(AnyBalance.trace("У вас нет карт"),a.cards=[]):(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти таблицу с картами."))}}
function processCard(c,a){getParam(c,a,"cards.accnum",/<div[^>]+list-item-content[^>]*>\s*((?:[\d\s]|&nbsp;?){20,})/i,replaceTagsAndSpaces);getParam(c,a,"cards.balance",/\d{20}\s*<br[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["cards.currency","cards.balance"],/\d{20}\s*<br[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseCurrency);getParam(c,a,"cards.type",/(?:<td[^>]*>[^]*?<\/td>\s*){2}(<td[^>]*>[^]*?<\/td>)/i,replaceTagsAndSpaces);getParam(c,a,"cards.status",/(?:<td[^>]*>[^]*?<\/td>\s*){3}(<td[^>]*>[^]*?<\/td>)/i,
replaceTagsAndSpaces);if(AnyBalance.isAvailable("cards.type","cards.num","cards.till","cards.status")){var b=AnyBalance.requestGet(baseurl+"/mobile/cardwithdetails?cardId="+encodeURIComponent(a.__id),g_headers);getParam(b,a,"cards.type",/Тип([\s\S]*?)<\/li>/i,replaceTagsAndSpaces);getParam(b,a,"cards.num",/Номер([\s\S]*?)<\/li>/i,replaceTagsAndSpaces);getParam(b,a,"cards.till",/Номер([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseDate);getParam(b,a,"cards.status",/<li[^>]+id="card-state"[^>]*>([\s\S]*?)<\/li>/i,
replaceTagsAndSpaces);isAvailable("cards.contacts")&&processCardContacts(b,a)}}
function processDeposits(c,a){if(AnyBalance.isAvailable("deposits")){c=AnyBalance.requestGet(baseurl+"/deposits",g_headers);var b=getElement(c,/<ul[^>]+data-role="listview"[^>]*>/i);if(b){b=getElements(b,/<li[^>]*>/ig);AnyBalance.trace("Найдено депозитов: "+b.length);a.deposits=[];for(var f=0;f<b.length;++f){var e=b[f],d=getParam(e,null,null,/depositId=([^"&]*)/i,replaceHtmlEntities),g=getParam(e,null,null,/<\/h3[^>]*>([\s\S]*?)<br[^>]*>/i,replaceTagsAndSpaces),h=getElement(e,/<h3[^>]*>/i,[replaceTagsAndSpaces,
/\s+/g,""]),d={__id:d,__name:g+" *"+h.substr(-4),num:h};__shouldProcess("deposits",d)&&processDeposit(e,d);a.deposits.push(d)}}else/У вас нет (?:депозитов|вкладов)/i.test(c)?(AnyBalance.trace("У вас нет депозитов"),a.deposits=[]):(AnyBalance.trace(c),AnyBalance.trace("Не удалось найти таблицу с депозитами."))}}
function processDeposit(c,a){getParam(c,a,"deposits.name",/<\/h3[^>]*>([\s\S]*?)<br[^>]*>/i,replaceTagsAndSpaces);getParam(c,a,"deposits.balance",/<\/h3>[^<]*<br[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(c,a,["deposits.currency","deposits.balance"],/<\/h3>[^<]*<br[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseCurrency);if(AnyBalance.isAvailable("deposits.type","deposits.num","deposits.till","deposits.status")){var b=getParam(c,null,null,/<a[^>]+href="([^"]*depositId[^"]*)/i,replaceHtmlEntities),
b=AnyBalance.requestGet(joinUrl(baseurl,b),g_headers),f=getParam(b,null,null,/<span[^>]+id="deposit-start"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseDate);getParam(b,a,"deposits.agreement",/<span[^>]+id="agreement-number"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(b,a,"deposits.period",/<span[^>]+id="deposit-period"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(f,a,"deposits.date_start");getParam(b,a,"deposits.till",/<span[^>]+id="deposit-until"[^>]*>([\s\S]*?)<\/span>/i,
replaceTagsAndSpaces,parseDate);getParam(b,a,"deposits.pct",/<span[^>]+id="deposit-rate"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,function(a){return parsePcts(a,new Date(f))});getParam(b,a,"deposits.pct_name",/<span[^>]+id="deposit-rate"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(b,a,"deposits.prolong",/<span[^>]+id="prolongation"[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces);getParam(b,a,"deposits.pct_conditions",/Выплата процентов([\s\S]*?)<\/li>/i,replaceTagsAndSpaces);getParam(b,
a,"deposits.pct_period",/Период выплаты процентов([\s\S]*?)<\/li>/i,replaceTagsAndSpaces);getParam(b,a,"deposits.topup",/Возможность пополнения вклада([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBool);getParam(b,a,"deposits.withdraw",/Возможность частичного изъятия([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBool);getParam(b,a,"deposits.pct_withdraw",/Возможность снятия начисленных процентов([\s\S]*?)<\/li>/i,replaceTagsAndSpaces,parseBool)}}
function parsePcts(c,a){var b=sumParam(c,null,null,/с\s*\d+[^;\-]*-\s*[\d.,]+%/ig);if(b)for(var f=new Date,e=b.length-1;0<=e;e--){var d=getParam(b[e],null,null,/с\s*(\d+)/,null,parseBalance),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()+(d||0));if(f.getTime()>=d.getTime())return b=getParam(b[e],null,null,/[\d.,]+%/i,null,parseBalance)}else return b=getParam(c,null,null,/[\d.,]+%/i,null,parseBalance),isset(b)?b:parseBalance(c)}function parseBool(c){return/Да/i.test(c)}
function processInfo(c,a){if(AnyBalance.isAvailable("info")){c=AnyBalance.requestGet(baseurl+"/ubrrloans/loanapplicationform",g_headers);var b=a.info={};getParam(c,b,"fam",/<input[^>]+application.lastName[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(c,b,"name",/<input[^>]+application.firstName[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(c,b,"patronym",/<input[^>]+application.patronym[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(c,b,"birthday",/<input[^>]+application.birthDate[^>]*value="([^"]*)/i,
null,parseDate);getParam(c,b,"phone",/<input[^>]+application.mobilePhone[^>]*value="([^"]*)/i,replaceHtmlEntities);getParam(c,b,"email",/<input[^>]+application.email[^>]*value="([^"]*)/i,replaceHtmlEntities)}};
