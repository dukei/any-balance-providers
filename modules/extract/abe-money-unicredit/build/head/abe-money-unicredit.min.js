var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Charset":"windows-1251,utf-8;q=0.7,*;q=0.3","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4",Connection:"keep-alive","User-Agent":"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36"},baseurl;
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");AnyBalance.setOptions({PER_DOMAIN:{"enter.unicredit.ru":{SSL_ENABLED_CIPHER_SUITES_ADD:["SSL_RSA_WITH_3DES_EDE_CBC_SHA"]}}});baseurl="demo"!=a.login?"https://enter.unicredit.ru/v2/cgi/bsi.dll?":"http://demo.enter.unicredit.ru/v2/cgi/bsi.dll?";var b=AnyBalance.requestGet(baseurl+"T=RT_2Auth.BF",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),
new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/exit/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else var c=getParam(b,null,null,/<input[^>]*id="MapID"[^>]*value="([^"]*)"/i),b=getParam(b,null,null,/<input[^>]*id="Map"[^>]*value="([^"]*)"/i),b=encryptPass(a.password,b),b=AnyBalance.requestPost(baseurl,{tic:0,T:"RT_2Auth.CL",A:a.login,B:b,L:"RUSSIAN",IdCaptcha:"",C:"",MapID:c||"",BROWSER:"Crome",BROWSERVER:"21.0.1180.60"},
addHeaders({Referer:baseurl+"T=RT_2Auth.BF"}));if(!/ClientInfo/i.test(b)){if(a=getParam(b,null,null,/<BSS_ERROR>\d*\|?([\s\S]*?)<\/BSS_ERROR>/i,[replaceTagsAndSpaces,/\[br\]/ig,""]))throw new AnyBalance.Error(a,null,/Ошибка при вводе логина или пароля/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}a=getParam(b,null,null,/ClientInfo=(\{[\s\S]*?\})\s*(?:<\/div>|$)/i);if(!a)throw new AnyBalance.Error("Не удалось найти информацию о сессии в ответе банка.");
a=JSON.parse(a);__setLoginSuccessful();return a}
function processAccounts(a,b){if(AnyBalance.isAvailable("accounts")){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"ACCOUNTSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)ACCOUNTS'/i))AnyBalance.trace("У Вас нет ни одного счёта!");else{var d=getElements(c,/<div[^>]+div-corner div-accounts[^>]*>/ig);if(!d.length){var g=getParam(c,null,null,/<REDIRECT>[\s\S]*?AccID=(\d+)/i);if(!g){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти cчета!");
return}d[0]=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"ACCOUNT",XACTION:"",AccID:g},g_headers)}AnyBalance.trace("Найдено счетов: "+d.length);b.accounts=[];for(c=0;c<d.length;c++){var e=d[c],f=getParam(e,null,null,/Номер счета(?:[^>]*>){3}([\s\S]*?)<\//i),h=getParam(e,null,null,/Номер счета(?:[^>]*>){3}([\s\S]*?)<\//i),k=getParam(e,null,null,/<div[^>]+formheader(?:[^>]*>){8}([\s\S]*?)<\//i,replaceTagsAndSpaces),f={__id:f,__name:k,num:h};__shouldProcess("accounts",
f)&&processAccount(e,f,a,g);b.accounts.push(f)}}}}
function processAccount(a,b,c,d){AnyBalance.trace("Обработка счета "+b.__name);if(!d){d=getParam(card,null,null,/cardID=(\d+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID счёта для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"ACCOUNT",XACTION:"",AccID:d},g_headers)}getParam(a,b,"accounts.balance",/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["accounts.currency","accounts.balance"],
/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"accounts.date_start",/Дата открытия(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDateWord);getParam(a,b,"accounts.receiver",/Получатель(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"accounts.receiversINN",/ИНН получателя(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"accounts.type",/accRest(?:[^>]*>){7}([\s\S]*?)<\//i,replaceTagsAndSpaces);AnyBalance.isAvailable("accounts.transactions")&&
processAccountTransactions(d,c,b)}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CARDSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)CARDS'/i))AnyBalance.trace("У Вас нет ни одной карты!");else{var d=getElements(c,/<div[^>]+div-corner div-cards[^>]*>/ig);if(!d.length){var g=getParam(c,null,null,/<REDIRECT>[\s\S]*?CardID=(\d+)/i);if(!g){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти карты!");return}d[0]=
AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CARD",XACTION:"",CardID:g},g_headers)}AnyBalance.trace("Найдено карт: "+d.length);b.cards=[];for(c=0;c<d.length;++c){var e=d[c],f=getParam(e,null,null,[/Номер карты:\s*([\d\*]*)/i,/<span[^>]+verybig fat(?:[^>]*>){3}([\s\S]*?)<div/i]),h=getParam(e,null,null,[/Номер карты:\s*([\d\*]*)/i,/<span[^>]+verybig fat(?:[^>]*>){3}([\s\S]*?)<div/i],replaceTagsAndSpaces),k=getParam(e,null,null,[/<div[^>]+div-b[^>]*>([\s\S]*?)<\/div>/i,
/<span[^>]+verybig fat(?:[^>]*>){6}([\s\S]*?)<\/div>/i],replaceTagsAndSpaces),f={__id:f,__name:k,num:h};__shouldProcess("cards",f)&&processCard(e,f,a,g);b.cards.push(f)}}}}
function processCard(a,b,c,d){AnyBalance.trace("Обработка карты "+b.__name);if(!d){d=getParam(a,null,null,/cardID=(\d+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID карты для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CARD",XACTION:"",CardID:d},g_headers)}getParam(a,b,"cards.balance",/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.limit",/Кредитный лимит(?:[^>]*>){3}([\s\S]*?)<\//i,
replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.overdraftLimit",/овердрафтный лимит(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.own",/Собственные средства(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.minpay",/Минимальный платёж(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.sumInProgress",/Транзакции в обработке(?:[^>]*>){4}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);
getParam(a,b,"cards.pct",/процентная ставка(?:[^>]*>){3}([^%]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.currency cards.overdraftLimit cards.balance cards.limit cards.own cards.minpay cards.sumInProgress".split(" "),/Транзакции в обработке(?:[^>]*>){4}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"cards.accnum",/Номер счета карты(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"cards.type",/<div[^>]+inforow2[^>]*>([\s\S]*?),\sактивна/i,replaceTagsAndSpaces);
getParam(a,b,"cards.holder",/Держатель(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"cards.onCardName",/Имя на карте(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"cards.minpay_till",/Оплатить до(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(a,b,"cards.till",/Активна[^\d]*(\d+\.\d+\.\d+)/i,replaceTagsAndSpaces,parseDate);isAvailable("cards.transactions")&&processCardTransactions(d,c,b)}
function processDeposits(a,b){throw new AnyBalance.Error("Обработка депозитов пока не поддерживается. Пожалуйста, обратитесь к разработчикам.");}
function processCredits(a,b){if(AnyBalance.isAvailable("credits")){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CREDITSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)CREDITS'/i))AnyBalance.trace("У вас нет ни одного кредита.");else{var d=getElements(c,/<div[^>]+div-b[^>]*>/ig);if(!d.length){var g=getParam(c,null,null,/<REDIRECT>[\s\S]*?CrdID=([0-9A-Z]+)/i);if(!g){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти кредиты!");
return}d[0]=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CREDIT",XACTION:"",CrdID:g},g_headers)}AnyBalance.trace("Найдено кредитов: "+d.length);b.credits=[];for(c=0;c<d.length;c++){var e=d[c],f=getParam(e,null,null,[/crdid=([0-9A-Z]+)/i,/Номер сделки(?:[^>]*>){3}([^<]*)/i]),h=getParam(e,null,null,[/crdid=([0-9A-Z]+)/i,/Номер сделки(?:[^>]*>){3}([^<]*)/i]),k=getParam(e,null,null,[/<div[^>]+div-b(?:[^>]*>){2}([^<]*)/i,/<div[^>]+actual(?:[^>]*>){7}([\s\S]*?)<\//i],
replaceTagsAndSpaces),f={__id:f,__name:k,num:h};__shouldProcess("credits",f)&&processCredit(e,f,a,g);b.credits.push(f)}}}}
function processCredit(a,b,c,d){AnyBalance.trace("Обработка кредита "+b.__name);if(!d){d=getParam(a,null,null,/CrdID=([0-9A-Z]+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID кредита для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CREDIT",XACTION:"",CrdID:d},g_headers)}getParam(a,b,"credits.balance",/<span[^>]+verybig fat[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["credits.currency","credits.balance",
"credits.pay"],/<span[^>]+verybig fat[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"credits.limit",/Сумма кредита(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.till",/Срок кредита(?:[^>]*>){3}[^-]*-([^<\)]*)/i,replaceTagsAndSpaces,parseDateWord);getParam(a,b,"credits.period",/Срок кредита(?:[^>]*>){3}([^\(]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.date_start",/Срок кредита(?:[^>]*>){3}[^\(]*\(([^-]*)/i,replaceTagsAndSpaces,parseDateWord);
getParam(a,b,"credits.paymentsLeft",/<div[^>]*>Осталось выплат(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.pct",/Проценты(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.pay",/Ближайший платёж\s*([^,]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.paytill",/оплатить до\s*([^<]*)/i,replaceTagsAndSpaces,parseDateWord);AnyBalance.isAvailable("credits.schedule")&&processCreditSchedule(a,b)}
function processInfo(a,b){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"USERSETS",XACTION:""},g_headers),d=b.info={};getParam(c,d,"info.department",/Отделение(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.contract",/контракт(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.date_start",/контракт(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(c,d,"info.fullFIO",/ФИО полностью(?:[^>]*>){3}([\s\S]*?)<\//i,
replaceTagsAndSpaces);getParam(c,d,"info.latFIO",/ФИО, лат(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.b_day",/Дата и место рождения(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.doc_type",/Вид документа(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.date_issued",/Выдан(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.address",/Адрес:(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.hphone",
/Телефон домашний(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.mphone",/Мобильный(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.wphone",/Рабочий телефон(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.fax",/Факс(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.email",/E-mail(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(c,d,"info.CK",/Комплект СК(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces)}
function encryptPass(a,b){if(b){for(var c="",c=0,d="",g=b.split(","),e="",d=a;""!=d;)c=d.substr(0,1),c=c.charCodeAt(0),255<c&&(c-=848),7622==c&&(c=185),d=1<d.length?d.substr(1,d.length):"",""!=e&&(e+=";"),e+=g[c];return e}return a};
