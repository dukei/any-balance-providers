var g_headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru, en",Origin:"https://enter.unicredit.ru",Connection:"keep-alive",BSSHTTPRequest:"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36"},baseurl;function fnRnd(){var a=new Date;return"B"+(Date.parse(a.toGMTString())+a.getMilliseconds()).toString(32)}
function login(){var a=AnyBalance.getPreferences();AnyBalance.setDefaultCharset("utf-8");checkEmpty(a.login,"Введите логин!");checkEmpty(a.password,"Введите пароль!");AnyBalance.setOptions({PER_DOMAIN:{"enter.unicredit.ru":{SSL_ENABLED_CIPHER_SUITES_ADD:["SSL_RSA_WITH_3DES_EDE_CBC_SHA"]}}});baseurl="demo"!=a.login?"https://enter.unicredit.ru/v2/cgi/bsi.dll?":"http://demo.enter.unicredit.ru/v2/cgi/bsi.dll?";var b=AnyBalance.requestGet(baseurl+"T=RT_2Auth.BF",g_headers);if(!b||400<AnyBalance.getLastStatusCode())throw AnyBalance.trace(b),
new AnyBalance.Error("Ошибка при подключении к сайту интернет-банка! Попробуйте обновить данные позже.");if(/exit/i.test(b))AnyBalance.trace("Уже залогинены, используем существующую сессию");else{var c=getParam(b,/<input[^>]*id="MapID"[^>]*value="([^"]*)"/i,replaceHtmlEntities),d=getParam(b,/<input[^>]*id="Map"[^>]*value="([^"]*)"/i,replaceHtmlEntities);c&&d||(b=AnyBalance.requestPost(baseurl,{tic:0,T:"RT_2Auth.getLoginMap"},addHeaders({BSSHTTPRequest:1,Referer:baseurl+"T=RT_2Auth.BF"})),c=getElement(b,
/<i[^>]*N="MapID"/i,replaceTagsAndSpaces),d=getElement(b,/<i[^>]*N="Map"/i,replaceTagsAndSpaces));d=encryptPass(a.password,d);b=AnyBalance.requestPost(baseurl,{tic:0,T:"RT_2Auth.CL",A:a.login,B:d,L:"RUSSIAN",IdCaptcha:"",C:"",MapID:c||"",BROWSER:"Chrome",BROWSERVER:"69.0.3497.100"},addHeaders({Referer:baseurl+"T=RT_2Auth.BF"}))}if(!/ClientInfo/i.test(b)){var f=getElement(b,/<i[^>]+n="idCaptcha"/i,replaceTagsAndSpaces);f&&(AnyBalance.trace("Требуется ввод капчи"),b=AnyBalance.requestGet(baseurl+"T=laCaptcha.getCaptchaImage&ID="+
encodeURIComponent(f)+"&tms="+fnRnd(),{Referer:baseurl+"T=RT_2Auth.BF"}),b=AnyBalance.retrieveCode("Пожалуйста, введите код с картинки",b,{time:12E4}),b=AnyBalance.requestPost(baseurl,{tic:0,T:"RT_2Auth.CL",A:a.login,B:d,L:"RUSSIAN",IdCaptcha:f,C:b,MapID:c||"",BROWSER:"Chrome",BROWSERVER:"69.0.3497.100"},addHeaders({Referer:baseurl+"T=RT_2Auth.BF"})))}if(!/ClientInfo/i.test(b)){if(a=getParam(b,null,null,/<BSS_ERROR>\d*\|?([\s\S]*?)<\/BSS_ERROR>/i,[replaceTagsAndSpaces,/\[br\]/ig,""]))throw new AnyBalance.Error(a,
null,/Ошибка при вводе логина или пароля/i.test(a));AnyBalance.trace(b);throw new AnyBalance.Error("Не удалось зайти в интернет-банк. Сайт изменен?");}a=getParam(b,null,null,/ClientInfo=(\{[\s\S]*?\})\s*(?:<\/div>|$)/i);if(!a)throw new AnyBalance.Error("Не удалось найти информацию о сессии в ответе банка.");a=JSON.parse(a);__setLoginSuccessful();return a}
function processAccounts(a,b){if(AnyBalance.isAvailable("accounts")){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"ACCOUNTSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)ACCOUNTS'/i))AnyBalance.trace("У Вас нет ни одного счёта!");else{var d=getElements(c,/<div[^>]+div-corner div-cards[^>]*>/ig);if(!d.length){var f=getParam(c,null,null,/<REDIRECT>[\s\S]*?AccID=(\d+)/i);if(!f){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти cчета!");
return}d[0]=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"ACCOUNT",XACTION:"",AccID:f},g_headers)}AnyBalance.trace("Найдено счетов: "+d.length);b.accounts=[];for(c=0;c<d.length;c++){var e=d[c],g=getParam(e,null,null,[/Номер счета[\s\S]*?<span[^>]+fat[^>]*>([^<]*)/i,/Номер счета:\s*([^<]*)/i]),h=getParam(e,null,null,[/Номер счета[\s\S]*?<span[^>]+fat[^>]*>([^<]*)/i,/Номер счета:\s*([^<]*)/i]),k=getParam(e,null,null,[/<div[^>]+formheader(?:[^>]*>){8}([\s\S]*?)<\//i,
/<span[^>]+div-b-span point[^>]*>([^<]*)/i],[replaceTagsAndSpaces,/"/ig,""]),g={__id:g,__name:k,num:h};__shouldProcess("accounts",g)&&processAccount(e,g,a,f);b.accounts.push(g)}}}}
function processAccount(a,b,c,d){AnyBalance.trace("Обработка счета "+b.__name);if(!d){d=getParam(a,null,null,/AccID=(\d+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID счёта для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"ACCOUNT",XACTION:"",AccID:d},g_headers)}getParam(a,b,"accounts.balance",/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["accounts.currency","accounts.balance"],
/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"accounts.date_start",/Дата открытия(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDateWord);getParam(a,b,"accounts.receiver",/Получатель(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"accounts.receiversINN",/ИНН получателя(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"accounts.type",/accRest(?:[^>]*>){7}([\s\S]*?)<\//i,replaceTagsAndSpaces);AnyBalance.isAvailable("accounts.transactions")&&
processAccountTransactions(d,c,b)}
function processCards(a,b){if(AnyBalance.isAvailable("cards")){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CARDSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)CARDS'/i))AnyBalance.trace("У Вас нет ни одной карты!");else{var d=getElements(c,/<div[^>]+div-corner div-cards[^>]*>/ig);if(!d.length){var f=getParam(c,null,null,/<REDIRECT>[\s\S]*?CardID=(\d+)/i);if(!f){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти карты!");return}d[0]=
AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CARD",XACTION:"",CardID:f},g_headers)}AnyBalance.trace("Найдено карт: "+d.length);b.cards=[];for(c=0;c<d.length;++c){var e=d[c],g=getParam(e,null,null,[/Номер карты:\s*([\d\*]*)/i,/<span[^>]+verybig fat(?:[^>]*>){3}([\s\S]*?)<div/i]),h=getParam(e,null,null,[/Номер карты:\s*([\d\*]*)/i,/<span[^>]+verybig fat(?:[^>]*>){3}([\s\S]*?)<div/i],replaceTagsAndSpaces),k=getParam(e,null,null,[/<div[^>]+div-b[^>]*>([\s\S]*?)<\/div>/i,
/<span[^>]+verybig fat(?:[^>]*>){6}([\s\S]*?)<\/div>/i],replaceTagsAndSpaces),g={__id:g,__name:k,num:h};__shouldProcess("cards",g)&&processCard(e,g,a,f);b.cards.push(g)}}}}
function processCard(a,b,c,d){AnyBalance.trace("Обработка карты "+b.__name);if(!d){d=getParam(a,null,null,/cardID=(\d+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID карты для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CARD",XACTION:"",CardID:d},g_headers)}getParam(a,b,"cards.balance",/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.limit",/Кредитный лимит(?:[^>]*>){3}([\s\S]*?)<\//i,
replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.overdraftLimit",/овердрафтный лимит(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.own",/Собственные средства(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.minpay",/Минимальный платёж(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.sumInProgress",/Транзакции в обработке(?:[^>]*>){4}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);
getParam(a,b,"cards.pct",/процентная ставка(?:[^>]*>){3}([^%]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"cards.currency cards.overdraftLimit cards.balance cards.limit cards.own cards.minpay cards.sumInProgress".split(" "),/Транзакции в обработке(?:[^>]*>){4}([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"cards.accnum",/Номер счета карты(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"cards.type",/<div[^>]+inforow2[^>]*>([\s\S]*?),\sактивна/i,replaceTagsAndSpaces);
getParam(a,b,"cards.holder",/Держатель(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"cards.onCardName",/Имя на карте(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"cards.minpay_till",/Оплатить до(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(a,b,"cards.till",/Активна[^\d]*(\d+\.\d+\.\d+)/i,replaceTagsAndSpaces,parseDate);isAvailable("cards.transactions")&&processCardTransactions(d,c,b)}
function processDeposits(a,b){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"DEPOSITSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)DEPOSITS'/i))AnyBalance.trace("У вас нет ни одного вклада");else{var d=getElements(c,/<div[^>]+div-corner div-cards[^>]*>/ig);if(!d.length){var f=getParam(c,null,null,/<REDIRECT>[\s\S]*?DepID=([0-9A-Z]+)/i);if(!f){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти депозиты!");return}d[0]=AnyBalance.requestPost(baseurl,
{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"DEPOSIT",XACTION:"",DepID:f},g_headers)}AnyBalance.trace("Найдено депозитов: "+d.length);b.deposits=[];for(c=0;c<d.length;c++){var e=getParam(d[c],null,null,/Номер сделки[\s\S]*?<span[^>]+fat[^>]*>([^<]*)/i),g=getParam(d[c],null,null,/Номер сделки[\s\S]*?<span[^>]+fat[^>]*>([^<]*)/i,replaceTagsAndSpaces),h=getParam(d[c],null,null,/<span[^>]+span-actual(?:[^>]*>){4}([\s\S]*?)<\/div>/i,replaceTagsAndSpaces),e={__id:e,__name:h,num:g};__shouldProcess("deposits",
e)&&processDeposit(d[c],e,a,f);b.deposits.push(e)}}}
function processDeposit(a,b,c,d){AnyBalance.trace("Обработка депозита "+b.__name);if(!d){d=getParam(a,null,null,/AccID=(\d+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID депозита для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"DEPOSIT",XACTION:"",DepID:d},g_headers)}getParam(a,b,"deposits.balance",/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.pct",/<span[^>]+fat toLowerCase[^>]*>([^%]*)/i,
replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.pct_condition",/<span[^>]+fat toLowerCase[^>]*>[^]*?\(([^\)]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.start_sum",/Начальная сумма(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"deposits.period",/Срок вклада(?:[^>]*>){3}([^\(]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["deposits.currency","deposits.balance","deposits.start_sum"],/<span[^>]+veryBig fat[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,
parseCurrency);getParam(a,b,"deposits.status",/Статус(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces);getParam(a,b,"deposits.till",/Срок вклада(?:[^>]*>){3}[^-]*-([^<\)]*)/i,replaceTagsAndSpaces,parseDateWord);getParam(a,b,"deposits.topup",/Доступные действия в системе(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces);getParam(a,b,"deposits.withdraw",/Доступные действия в системе(?:[^>]*>){5}([^<]*)/i,replaceTagsAndSpaces);getParam(a,b,"deposits.e_withdraw",/Доступные действия в системе(?:[^>]*>){7}([^<]*)/i,
replaceTagsAndSpaces);getParam(a,b,"deposits.prolong",/Доступные действия в системе(?:[^>]*>){9}([^<]*)/i,replaceTagsAndSpaces)}
function processCredits(a,b){if(AnyBalance.isAvailable("credits")){var c=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CREDITSLIST",XACTION:""},g_headers);if(getParam(c,null,null,/<REDIRECT>[\s\S]*?'(NO)CREDITS'/i))AnyBalance.trace("У вас нет ни одного кредита.");else{var d=getElements(c,/<div[^>]+div-b[^>]*>/ig);if(!d.length){var f=getParam(c,null,null,/<REDIRECT>[\s\S]*?CrdID=([0-9A-Z]+)/i);if(!f){AnyBalance.trace(c);AnyBalance.trace("Не удалось найти кредиты!");
return}d[0]=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CREDIT",XACTION:"",CrdID:f},g_headers)}AnyBalance.trace("Найдено кредитов: "+d.length);b.credits=[];for(c=0;c<d.length;c++){var e=d[c],g=getParam(e,null,null,[/crdid=([0-9A-Z]+)/i,/Номер сделки(?:[^>]*>){3}([^<]*)/i]),h=getParam(e,null,null,[/crdid=([0-9A-Z]+)/i,/Номер сделки(?:[^>]*>){3}([^<]*)/i]),k=getParam(e,null,null,[/<div[^>]+div-b(?:[^>]*>){2}([^<]*)/i,/<div[^>]+actual(?:[^>]*>){7}([\s\S]*?)<\//i],
replaceTagsAndSpaces),g={__id:g,__name:k,num:h};__shouldProcess("credits",g)&&processCredit(e,g,a,f);b.credits.push(g)}}}}
function processCredit(a,b,c,d){AnyBalance.trace("Обработка кредита "+b.__name);if(!d){d=getParam(a,null,null,/CrdID=([0-9A-Z]+)/i);if(!d){AnyBalance.trace(a);AnyBalance.trace("Не удалось найти ID кредита для запроса!");return}a=AnyBalance.requestPost(baseurl,{SID:c.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"CREDIT",XACTION:"",CrdID:d},g_headers)}getParam(a,b,"credits.balance",/<span[^>]+verybig fat[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,["credits.currency","credits.balance",
"credits.pay"],/<span[^>]+verybig fat[^>]*>([^<]*)/i,replaceTagsAndSpaces,parseCurrency);getParam(a,b,"credits.limit",/Сумма кредита(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.till",/Срок кредита(?:[^>]*>){3}[^-]*-([^<\)]*)/i,replaceTagsAndSpaces,parseDateWord);getParam(a,b,"credits.period",/Срок кредита(?:[^>]*>){3}([^\(]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.date_start",/Срок кредита(?:[^>]*>){3}[^\(]*\(([^-]*)/i,replaceTagsAndSpaces,parseDateWord);
getParam(a,b,"credits.paymentsLeft",/<div[^>]*>Осталось выплат(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.pct",/Проценты(?:[^>]*>){3}([^<]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.pay",/Ближайший платёж\s*([^,]*)/i,replaceTagsAndSpaces,parseBalance);getParam(a,b,"credits.paytill",/оплатить до\s*([^<]*)/i,replaceTagsAndSpaces,parseDateWord);AnyBalance.isAvailable("credits.schedule")&&processCreditSchedule(a,b)}
function processInfo(a,b){a=AnyBalance.requestPost(baseurl,{SID:a.SID,tic:1,T:"RT_2IC.form",nvgt:1,SCHEMENAME:"USERSETS",XACTION:""},g_headers);b=b.info={};getParam(a,b,"info.department",/Отделение(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.contract",/контракт(?:[^>]*>){1}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.date_start",/контракт(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces,parseDate);getParam(a,b,"info.fullFIO",/ФИО полностью(?:[^>]*>){3}([\s\S]*?)<\//i,
replaceTagsAndSpaces);getParam(a,b,"info.latFIO",/ФИО, лат(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.b_day",/Дата и место рождения(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.doc_type",/Вид документа(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.date_issued",/Выдан(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.address",/Адрес:(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.hphone",
/Телефон домашний(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.mphone",/Мобильный(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.wphone",/Рабочий телефон(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.fax",/Факс(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.email",/E-mail(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces);getParam(a,b,"info.CK",/Комплект СК(?:[^>]*>){3}([\s\S]*?)<\//i,replaceTagsAndSpaces)}
function encryptPass(a,b){if(b){var c;b=b.split(",");for(var d="";""!=a;)c=a.substr(0,1),c=c.charCodeAt(0),255<c&&(c-=848),7622==c&&(c=185),a=1<a.length?a.substr(1,a.length):"",""!=d&&(d+=";"),d+=b[c];return d}return a};
