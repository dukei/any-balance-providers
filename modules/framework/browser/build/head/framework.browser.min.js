var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,a){c.raw=a;return c};$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};
$jscomp.makeIterator=function(c){var a="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];if(a)return a.call(c);if("number"==typeof c.length)return $jscomp.arrayIterator(c);throw Error(String(c)+" is not an iterable or ArrayLike");};
var BrowserAPI=function(){var c=function(a){this.options=a;this.headerMatchCounts=[]};c.prototype.requestAPI=function(a,d){var f=this.options.debug?"http://localhost:4024":this.options.win?"https://browin.anybalance.ru":"http://browser.anybalance.ru:4024";d=d?AnyBalance.requestPost(f+"/"+a,JSON.stringify(d),{Referer:this.options.provider+"","Content-Type":"application/json"},{options:{DEFAULT_CHARSET:"utf-8"}}):AnyBalance.requestGet(f+"/"+a+(0<=a.indexOf("?")?"&":"?")+"_="+ +new Date,{Referer:this.options.provider+
""});f=JSON.parse(d);if("ok"!==f.status)throw AnyBalance.trace(d),new AnyBalance.Error("Ошибка browser api ("+a+"): "+f.message);return f};c.prototype.open=function(a){var d=this.requestAPI("base/open",{userAgent:this.options.userAgent,singlePage:this.options.singlePage,headful:this.options.headful,noInterception:this.options.noInterception,userInteraction:this.options.userInteraction,incognito:this.options.incognito,url:a,rules:this.options.rules});AnyBalance.trace("Opening page "+a+": "+d.page);
return d};c.prototype.waitForLoad=function(a){var d=this,f=0,r=this.options.binaryResponses?"base64":void 0;do{++f;AnyBalance.sleep(3E3);var k=this.requestAPI("base/status?page="+a);AnyBalance.trace("Loading status of page "+a+": "+k.loadStatus+" (попытка "+f+")");if(k.pendingRequests&&0<k.pendingRequests.length)for(var b={},g=0;g<k.pendingRequests.length;b={$jscomp$loop$prop$ret$5:b.$jscomp$loop$prop$ret$5,$jscomp$loop$prop$pr$6:b.$jscomp$loop$prop$pr$6,$jscomp$loop$prop$prDone$7:b.$jscomp$loop$prop$prDone$7},
++g){b.$jscomp$loop$prop$pr$6=k.pendingRequests[g];var n=[],t;for(t in b.$jscomp$loop$prop$pr$6.headers){var h=b.$jscomp$loop$prop$pr$6.headers[t];if(""!==h.trim()){h=h.split("\n");for(var e=0;e<h.length;++e)"content-length"!==t.toLowerCase()&&n.push([t,h[e]])}}h={};if(this.options.additionalRequestHeaders)for(e=0;e<this.options.additionalRequestHeaders.length;++e){var l=this.options.additionalRequestHeaders[e];if(!l.url||l.url.test(b.$jscomp$loop$prop$pr$6.url)){var p=this.headerMatchCounts;if(!l.maxCount||
(p[e]||0)<l.maxCount){h=l.headers||{};l.maxCount&&(p[e]=(p[e]||0)+1);break}}}n=AnyBalance.requestPost(b.$jscomp$loop$prop$pr$6.url,b.$jscomp$loop$prop$pr$6.body,addHeaders(h,n),{HTTP_METHOD:b.$jscomp$loop$prop$pr$6.method,options:{FORCE_CHARSET:r,MANUAL_REDIRECTS:!0}});h=AnyBalance.getLastResponseParameters();e={};l=void 0;for(p=0;p<h.headers.length;++p){var q=h.headers[p],m=q[0].toLowerCase();0<=["transfer-encoding","content-encoding"].indexOf(m)||("content-length"===m&&(q[1]=""+unescape(encodeURIComponent(n||
"")).length),void 0===e[m]?e[m]=q[1]:Array.isArray(e[m])?e[m].push(q[1]):e[m]=[e[m],q[1]],"content-type"===m&&(l=q[1]))}b.$jscomp$loop$prop$prDone$7={id:b.$jscomp$loop$prop$pr$6.id,page:a,r:{status:AnyBalance.getLastStatusCode(),headers:e,charset:r,contentType:l,body:n}};n=this.applyClientRules(b.$jscomp$loop$prop$pr$6,b.$jscomp$loop$prop$prDone$7);b.$jscomp$loop$prop$ret$5=this.requestAPI("base/response",b.$jscomp$loop$prop$prDone$7);n.forEach(function(u){return function(v){return v(u.$jscomp$loop$prop$ret$5,
d,u.$jscomp$loop$prop$pr$6,u.$jscomp$loop$prop$prDone$7)}}(b))}else if("load"===k.loadStatus)break}while(15>f);if("load"!==k.loadStatus)throw new AnyBalance.Error("Waiting for page "+a+" loading timeout!");};c.prototype.tasks=function(a,d){a=this.requestAPI("base/tasks",{page:a,tasks:d});AnyBalance.trace("Sending "+d.length+" tasks to page "+a.page);return a};c.prototype.applyClientRules=function(a,d){var f=a.url,r=[],k=$jscomp.makeIterator(this.options.clientRules||[]),b=k.next();a:for(;!b.done;b=
k.next())if(b=b.value,b.url.test(f)){b=b.action(this,a,d);Array.isArray(b)||(b=[b]);b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;g=b.next())if(g=g.value,"function"===typeof g&&r.push(g),"boolean"===typeof g&&g)break a}return r};c.prototype.content=function(a){return this.requestAPI("base/content?page="+a)};c.prototype.cookies=function(a,d){d&&(Array.isArray(d)||(d=[d]));return this.requestAPI("base/cookies",{page:a,urls:d}).cookies};c.prototype.close=function(a){return this.requestAPI("base/close",
{page:a})};c.useCookies=function(a){for(var d=0;d<a.length;++d){var f=a[d];AnyBalance.setCookie(f.domain,f.name,f.value,f)}};return c}();
