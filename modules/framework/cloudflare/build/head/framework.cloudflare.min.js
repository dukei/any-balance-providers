function Cloudflare(h){function q(a){a=sumParam(a,/(\w+\s*=\s*(["'])[^'"]*\2)/g);for(var d={},b=0;b<a.length;++b){var c=/(\w+)\s*=\s*["']([^'"]*)/.exec(a[b]);d[c[1]]=html_entity_decode(c[2])}return d}function m(a,d,b){function g(a,b){if(!/^https?:/i.test(b)){var c=h;/^\//.test(b)&&(c=n(a));b=(c+"/"+b).replace(/([^:])\/{2,}/g,"$1/")}return b}var e=b||[],f;b={set src(b){/img/i.test(a)?t.push(n()+b):c.trace("Can not set src of "+a+" to "+b)},set innerHTML(b){var d=/^<(\w+)\s*([^>]*)>([^<]*)<\/\1>$/.exec(b);
if(!d)throw new c.Error("Creation of too complex innerHTML is not implemented: "+b);b=q(d[2]);e.push(new m(a,b))},get firstChild(){return e[0]},set href(a){f=g(h,a)},get href(){return f},submit:function(){for(var a=[],b=0;b<e.length;++b)a.push([e[b].name,e[b].value]);/get/i.test(this.method||"get")?l._lastHtml=c.requestGet(g(h,this.action)+"?"+createUrlEncodedParams(a),r):l._lastHtml=c.requestPost(g(h,this.action),a,r)}};for(var k in d)b[k]=d[k];return b}function k(){return getParam(h,/^https?:\/\/([^\/]*)/i)}
function n(a){return getParam(a||h,/^(https?:\/\/[^\/]*)/i)}var c=AnyBalance,r=addHeaders(g_headers,{Referer:h}),t=[],p={},f={location:function(){return{href:h,reload:function(){if(f.onunload)f.onunload()}}}(),document:l},l={get cookie(){var a=c.getCookies(),d=k();return a.reduce(function(a,c){endsWith(c.domain,d)&&(a&&(a+=";"),a+=c.name+"="+c.value);return a},"")},set cookie(a){var d=getParam(a,null,null,/\bpath=([^;]*)/i);a=getParam(a,null,null,/^[^;]*/).match(/([^=]*)=(.*)/);c.setCookie(k(),a[1],
a[2],{path:d})},createElement:function(a){return m(a)},getElementById:function(a){return p[a]},window:f};f.parent=f;9<=c.getLevel()&&(c.setCookie(k(),"__cfduid",c.getData("__cfduid")),c.setCookie(k(),"cf_clearance",c.getData("cf_clearance")));return{document:l,window:f,isCloudflared:function(a){return/<input[^>]+name="jschl_vc"[^>]*value="([^"]*)/i.test(a)||/<form[^>]+chk_captcha/i.test(a)},executeScript:function(a){if(/<form[^>]+chk_captcha/i.test(a)){var d=a;AnyBalance.trace("Cloudflare потребовало reCaptcha");
a=getParam(d,/data-ray="([^"]*)/i,replaceHtmlEntities);var b=getParam(d,/data-sitekey="([^"]*)/i,replaceHtmlEntities);if(!a||!b)throw AnyBalance.trace(d),new AnyBalance.Error("Не удалось найти параметры Cloudflare для ввода капчи");d=solveRecaptcha("Вы заходите из небезопасного расположения. Cloudflare требует доказать, что вы не робот.","https://cloudflare.com/",b);b=n();a=d=AnyBalance.requestGet(b+"/cdn-cgi/l/chk_captcha?"+createUrlEncodedParams({id:a,"g-recaptcha-response":d}),addHeaders({Referer:h}))}else{d=
a;AnyBalance.trace("Пытаемся пройти автоматизированную проверку браузера Cloudflare");a=[f,l,f.location,f];for(var b=sumParam(getElement(d,/<form[^>]+challenge-form/i),/<input[^>]*>/ig),g=[],e=0;e<b.length;++e)g.push(new m("input",q(b[e])));p={"challenge-form":new m("form",{action:"/cdn-cgi/l/chk_jschl"},g)};for(e=0;e<g.length;++e)g[e].id&&(p[g[e].id]=g[e]);b=/setTimeout\(function\(\)\{([\s\S]*?)\},\s*(\d+)\)/.exec(d);if(!b)throw c.trace(d),new c.Error("Не удалось найти скрипт Cloudflare для выполнения");
d=b[1];c.sleep(+b[2]);safeEval(d,"window,document,location,parent",a);a=l._lastHtml}9<=c.getLevel()&&(c.setData("__cfduid",c.getCookie("__cfduid")),c.setData("cf_clearance",c.getCookie("cf_clearance")),c.saveData());return a}}};
