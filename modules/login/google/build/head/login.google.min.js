function googleLogin(e){function g(a){if(!/logout/i.test(a)){var b=getParam(a,null,null,/<span[^>]+id="errormsg[^>]*>([\s\S]*?)<\/span>/i,replaceTagsAndSpaces,html_entity_decode);if(b)throw new AnyBalance.Error(b);if(b=getParam(a,null,null,/<form[^>]+id="challenge"/i,replaceTagsAndSpaces,html_entity_decode))throw new AnyBalance.Error("This account requires 2-step authorization. Turn off 2-step authorization to use this provider.");AnyBalance.trace(a);throw new AnyBalance.Error("Can`t log in, is the site changed?");
}return!0}try{AnyBalance.restoreCookies()}catch(l){}var a=AnyBalance.requestGet("https://accounts.google.com/",g_headers);if(!/logout/i.test(a)){var b=getElement(a,/<form[^>]+gaia_loginform/i);if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Can`t find find login form, is site changed?");a=createFormParams(a,function(a,b,c,d){return"Email"==c?e.login:d});a=AnyBalance.requestPost("https://accounts.google.com/AccountLoginInfo",a,addHeaders({Referer:AnyBalance.getLastUrl()}));b=getElement(a,/<form[^>]+gaia_loginform/i);
if(!b)throw AnyBalance.trace(a),new AnyBalance.Error("Can`t find find password form, is site changed?");a=createFormParams(a,function(a,b,c,d){return"Passwd"==c?e.password:d});a=AnyBalance.requestPost("https://accounts.google.com/signin/challenge/sl/password",a,addHeaders({Referer:AnyBalance.getLastUrl()}));b=getElement(a,/<ol[^>]+challengePickerList/i);!b&&e.__dbg_test_list&&(AnyBalance.trace("Moving to a list of available challenges"),a=getElement(a,/<form[^>]+challenge\/skip/i),a=createFormParams(a),
a=AnyBalance.requestPost("https://accounts.google.com/signin/challenge/skip",a,addHeaders({Referer:AnyBalance.getLastUrl()})),b=getElement(a,/<ol[^>]+challengePickerList/i));if(b){AnyBalance.trace("Google presented challenges list...");b=getElements(b,/<form[^>]+challenge/ig);AnyBalance.trace("Found "+b.length+" possible challenges");for(var d=0;d<b.length;++d){var f=b[d],h=getElement(f,/<button[^>]+submit/i,replaceTagsAndSpaces),k=getParam(f,null,null,/accounts\/marc\/(\w+)\.png/i);if(0<=["idv_sms",
"idv_call","backup_code","authenticator"].indexOf(k)){AnyBalance.trace("Use challenge of type "+k+": "+h);a=createFormParams(f);f=getParam(f,null,null,/action="([^"]*)/i,replaceHtmlEntities);a=AnyBalance.requestPost(joinUrl("https://accounts.google.com/",f),a,addHeaders({Referer:AnyBalance.getLastUrl()}));break}AnyBalance.trace("Challenge of type "+k+" is not supported, skipping: "+h)}if(d>=b.length)throw AnyBalance.trace(a),new AnyBalance.Error("Could not find supported two-factor authentication challenge. Is the site changed?");
}if(b=getElement(a,/<form[^>]+id="challenge"/i)){if(!/<input[^>]+name="Pin"/i.test(b))throw AnyBalance.trace(b),new AnyBalance.Error("Google requested confirmation code, but you have not setup confirmation parameters yet. Enter your google account via browser and attach your phone to send confirmation to.");var d=getParam(b,null,null,/accounts\/marc\/\w+\.png[^>]*>([\s\S]*?)<input[^>]+name="Pin"/i),c;d&&(c=getElements(d,/<div/ig,replaceTagsAndSpaces)[1]);a=getParam(a,null,null,/<input[^>]+name="Pin"[^>]*placeholder="([^"]*)/i,
replaceHtmlEntities);c=c?c+". "+a:a;a=getParam(b,null,null,/accounts\/marc\/(\w+)\.png/i);AnyBalance.trace("Trying to get code for challenge of type "+a+": "+c);a=AnyBalance.retrieveCode(c||"Please, enter confirmation code");AnyBalance.trace("Got code: "+a);if(!isset(a))throw new AnyBalance.Error("Two-factor authorization is enabled. Just now we can`t deal with this. Login attempt has failed.");c=createFormParams(b);c.Pin=a;a=getParam(b,null,null,/action="([^"]*)/i,replaceHtmlEntities);a=AnyBalance.requestPost(joinUrl("https://accounts.google.com/",
a),c,addHeaders({Referer:AnyBalance.getLastUrl()}))}g(a);if(b=getElement(a,/<form[^>]+action="SmsAuthInterstitial"[^>]*>/i))AnyBalance.trace("Needs 2-factor parameters review, skipping it to view later"),c=createFormParams(a,function(a,b,c,d){if(!/type="submit"/i.test(b)||"remind"==c)return d}),a=AnyBalance.requestPost("https://accounts.google.com/SmsAuthInterstitial",c,addHeaders({Referer:AnyBalance.getLastUrl()}));g(a)}AnyBalance.saveCookies();AnyBalance.saveData();return a}
function reenterPasswordIfGoogleNeeds(e,g){var a=getElement(e,/<form[^>]+id="gaia_loginform"[^>]*>/i);a&&(e=AB.createFormParams(e,function(a,d,e,h){return"Passwd"==e?g.password:h}),a=getParam(a,null,null,/<form[^>]+action="([^"]*)/i,replaceHtmlEntities),e=AnyBalance.requestPost(joinUrl(AnyBalance.getLastUrl(),a),e,addHeaders({Referer:AnyBalance.getLastUrl()})));return e};
