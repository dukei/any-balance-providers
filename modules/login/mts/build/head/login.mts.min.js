var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(a,b,f){if(null==a)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,f){if(a==Array.prototype||a==Object.prototype)return a;a[b]=f.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var f=a[b];if(f&&f.Math==Math)return f}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b,f){if(!f||null!=a){f=$jscomp.propertyToPolyfillSymbol[b];if(null==f)return a[b];f=a[f];return void 0!==f?f:a[b]}};$jscomp.polyfill=function(a,b,f,c){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,f,c):$jscomp.polyfillUnisolated(a,b,f,c))};
$jscomp.polyfillUnisolated=function(a,b,f,c){f=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];if(!(e in f))return;f=f[e]}a=a[a.length-1];c=f[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,f,c){var e=a.split(".");a=1===e.length;c=e[0];c=!a&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<e.length-1;h++){var g=e[h];if(!(g in c))return;c=c[g]}e=e[e.length-1];f=$jscomp.IS_SYMBOL_NATIVE&&"es6"===f?c[e]:null;b=b(f);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==f&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(f=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+f+"$"+e),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,f){var c=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=c.length,h=b.length;f=Math.max(0,Math.min(f|0,c.length));for(var g=0;g<h&&f<e;)if(c[f++]!=b[g++])return!1;return g>=h}},"es6","es3");var g_baseurlLogin="https://login.mts.ru",g_savedData;
function checkLoginError(a,b){function f(l){var k=sumParam(l,/var\s+(?:passwordErr|loginErr)\s*=\s*'([^']*)/g,replaceSlashes,null,aggregate_join);k||(k=getElement(l,/<[^>]+errorText/i,replaceTagsAndSpaces));if(k)throw new AnyBalance.Error(k,null,/логин|парол/i.test(k));if(k=getElement(l,/<div[^>]+b-page_error__msg[^>]*>/,replaceTagsAndSpaces))throw new AnyBalance.Error(k);}var c=AnyBalance.getPreferences(),e=b.url;f(a);var h=getElement(a,/<[^>]+captcha-wrapper/i);h&&(h=getParam(h,/data:image\/\w+;base64,([^'"]+)/i,
replaceHtmlEntities));h&&0<=h.indexOf("iVBORw0KGgoAAAANSUhEUgAAANMAAAA6CAIAAAClLvvEAAAeQElEQVR42u3de7yVVZkH8NTQSi3N7uUltQuaoGFp")&&(AnyBalance.trace("Капча спрятана. Ищем её в другом месте"),h=null);h||(h=getParam(a,/"(ZGF0YTppbWFnZS[^"]*)/))&&(h=Base64.decode(h));h||(h=getParam(a,/<img id="captchaImage"\s*?src="([^"]+)/));h&&(h=getParam(h,/data:image\/\w+?(?:png)?;base64,([^'"]+)/i));if(h){AnyBalance.trace("МТС решило показать капчу :( Жаль");var g=AnyBalance.retrieveCode("МТС требует ввести капчу для входа в личный кабинет, чтобы подтвердить, что вы не робот. Введите символы, которые вы видите на картинке.",
h);(h=getElement(a,/<form[^>]+name="Login"/i))||(h=getElementById(a,"captchaForm"));h=createFormParams(h,function(l,k,m,n){"IDToken1"==m&&(n=c.login);"IDToken2"==m&&(n=g);return n});AnyBalance.trace("Логинимся с заданным номером и капчей");a=AnyBalance.requestPost(e,h,addHeaders({Origin:g_baseurlLogin,Referer:e}));var d=getParam(a,/data-error="([^"]*)/);if(d)throw new AnyBalance.Error(d,!0);fixCookies();500<=AnyBalance.getLastStatusCode()&&(AnyBalance.trace("МТС вернул 500 при попытке логина. Пробуем ещё разок..."),
a=AnyBalance.requestPost(e,h,addHeaders({Origin:g_baseurlLogin,Referer:e})),fixCookies());if(500<=AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Ошибка на сервере МТС при попытке зайти, сервер не смог обработать запрос! Можно попытаться позже...",allowRetry);isOnLogin()&&getOrdinaryLoginForm(a)&&(a=loginOrdinaryForm(a,b));0==AnyBalance.getLastUrl().indexOf(g_baseurlLogin)&&f(a)}else if(/МТС\s*-\s*Установка пароля/i.test(a)){AnyBalance.trace("МТС потребовало установить пароль. Установим старый");
h=getElement(a,/<form[^>]+name="Login"/i);h=createFormParams(h,function(l,k,m,n){"IDToken2"==m&&(n=g);return n});a=AnyBalance.requestPost(e,h,addHeaders({Origin:g_baseurlLogin,Referer:e}));fixCookies();if(/Ваш пароль успешно/i.test(a))throw AnyBalance.trace(a),new AnyBalance.Error("МТС потребовала установить новый пароль, автоматическая установка старого не удалась. Сайт изменен?");h=getElement(a,/<form[^>]+name="Login"/i);h=createFormParams(h);a=AnyBalance.requestPost(e,h,addHeaders({Origin:g_baseurlLogin,
Referer:e}));fixCookies()}else throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти капчу. Сайт изменен?");return a}
function redirectIfNeeded(a){if(/<body[^>]+onload[^>]+submit/i.test(a)){AnyBalance.trace("Потребовался редирект формой...");var b=createFormParams(a),f=getParam(a,/<form[^>]+action=['"]([^'"]*)/,replaceHtmlEntities);f=f.replace(/^https:\/\/login\.mts\.ru(?::443)?/,"http://login.mts.ru");a=AnyBalance.getLastUrl();a=AnyBalance.requestPost(joinUrl(a,f),b,addHeaders({Refefer:a}));fixCookies()}if(b=getParam(a,/<meta[^>]+http-equiv="REFRESH"[^>]*content="0;url=([^";]*)/i,replaceHtmlEntities))AnyBalance.trace("Потребовался get редирект..."),
b=b.replace(/^https:\/\/login\.mts\.ru/,"http://login.mts.ru"),a=AnyBalance.getLastUrl(),a=AnyBalance.requestGet(joinUrl(a,b),addHeaders({Refefer:a})),fixCookies();return a}function isOnLogin(){return 0==AnyBalance.getLastUrl().indexOf(g_baseurlLogin)}function isLoginAfresh(a){return 0==AnyBalance.getLastUrl().indexOf(a)}function getOrdinaryLoginForm(a){return getElement(a,/<form[^>]+name="Login"/i)}
function loadProtectedPage(a,b){var f=AnyBalance.requestGet(a,b);if(/__qrator/.test(f)){AnyBalance.trace("Требуется обойти QRATOR");if(!AnyBalance.getCapabilities().clientOkHttp&&!AnyBalance.getCapabilities().clientDebugger)throw new AnyBalance.Error("Для работы провайдера требуется обновить приложение. Новая версия AnyBalance доступна на RuStore");AnyBalance.setOptions({CLIENT:"okhttp"});var c=new BrowserAPI({provider:"mts-login-q5",userAgent:b["User-Agent"],headful:!0,userInteraction:!0,singlePage:!0,
rules:[{resType:/^(image|stylesheet|font)$/.toString(),action:"abort"},{url:/_qrator\/qauth(?:_\w+)*\.js/.toString(),action:"cache",valid:36E4},{url:/_qrator/.toString(),action:"request"},{resType:/^(image|stylesheet|font|script)$/i.toString(),action:"abort"},{url:/\.(png|jpg|ico|svg)/.toString(),action:"abort"},{url:/\.mts\.ru/.toString(),action:"request"},{url:/.*/.toString(),action:"abort"}],clientRules:[{url:/__qrator\/captcha\/gen/,action:solveQratorCaptcha}],additionalRequestHeaders:[{headers:{"User-Agent":b["User-Agent"]}}],
debug:AnyBalance.getPreferences().debug}),e=c.open(a);try{c.waitForLoad(e.page);f=c.content(e.page).content;var h=c.cookies(e.page,a);BrowserAPI.useCookies(h)}finally{c.close(e.page)}if(/__qrator|Access to [^<]* is forbidden|Доступ к сайту [^<]* запрещен/.test(f))throw new AnyBalance.Error("Не удалось обойти защиту. Сайт изменен?");AnyBalance.trace("Защита QRATOR успешно пройдена");g_savedData||(c=AnyBalance.getPreferences(),g_savedData=new SavedData("mts",c.login));g_savedData.setCookies();g_savedData.save()}a.startsWith(g_baseurlLogin)||
(f=AnyBalance.requestGet(a,b));return f}
function solveQratorCaptcha(a,b,f){f.tasks||(f.tasks=[]);var c=f.tasks.length;f.tasks.push({type:"wait",delay:7E4});return function(e){e=e.tasks[c];var h=JSON.parse(f.r.body);h=getParam(h.image,/base64,(.*)/);h=AnyBalance.retrieveCode("МТС требует ввести капчу, чтобы подтвердить, что вы не робот. Пожалуйста, введите символы с картинки",h,{time:6E4});a.tasks(f.page,[{type:"input",selector:"#captcha-input",value:h,options:{delay:211}},{type:"click",selector:".check-btn"},{type:"cancel_wait",taskId:e,
delayAfter:5E3}])}}
function enterMtsLK(a){var b=a.baseurl||g_baseurl,f=a.url||g_baseurlLogin,c=AnyBalance.requestGet(f,g_headers);fixCookies()&&(AnyBalance.trace("Куки исправлены на входе..."),c=AnyBalance.requestGet(f,g_headers),fixCookies());if(/__qrator|Access to [^<]* is forbidden|Доступ к сайту [^<]* запрещен/.test(c)){if(isLoginAfresh(b))return AnyBalance.trace("Сессия успешно возобновлена"),c;c=loadProtectedPage("https://lk.mts.ru/",g_headers);c=AnyBalance.requestGet(f,g_headers)}if(500<=AnyBalance.getLastStatusCode()){if(isLoginAfresh(b))return AnyBalance.trace("Сессия успешно возобновлена"),c;
AnyBalance.trace("МТС вернул 500. Пробуем ещё разок...");c=AnyBalance.requestGet(f,g_headers);fixCookies()}if(500<=AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Ошибка на сервере МТС, сервер не смог обработать запрос. Можно попытаться позже...");/Произошла ошибка при попытке авторизации/i.test(c)&&(AnyBalance.trace("Куки протухли :( Придется авторизоваться заново"),clearAllCookiesExceptProtection(),c=AnyBalance.requestGet(f,g_headers),fixCookies());fixCookies()&&(AnyBalance.trace("Куки исправлены, перезагружаем страницу. Пробуем ещё разок..."),
c=AnyBalance.requestGet(AnyBalance.getLastUrl(),g_headers),fixCookies());c=redirectIfNeeded(c);if(b=getParam(c,/Продолжить вход с номером([\s\S]*?)<\/[bp]/i,replaceTagsAndSpaces)){AnyBalance.trace("Предлагает автоматически залогиниться на "+b);c=getElement(c,/<form[^>]+name="Login"/i);if(endsWith(b.replace(/\D+/g,""),a.login)){AnyBalance.trace("А нам этот номер и нужен. Соглашаемся...");var e="Login"}else AnyBalance.trace("А нам нужен номер "+a.login+". Отказываемся..."),e="Ignore";c=createFormParams(c,
function(h,g,d,l){"IDButton"==d&&(l=e);return l});c=AnyBalance.requestPost(AnyBalance.getLastUrl(),c,addHeaders({Referer:AnyBalance.getLastUrl()}));fixCookies()}isOnLogin()?(a.html=c,a.url||(a.url=AnyBalance.getLastUrl()),/\/amserver\/NUI\//i.test(AnyBalance.getLastUrl())?(AnyBalance.trace("МТС направил на новый вход NUI"),a.ref=AnyBalance.getLastUrl(),a.statetrace=getParam(AnyBalance.getLastUrl(),/statetrace(?:=|%3D)([\s\S]*?)(?:&|%26|$)/i,replaceHtmlEntities),a.nonce=getParam(AnyBalance.getLastUrl(),
/nonce(?:=|%3D)([\s\S]*?)(?:&|%26|$)/i,replaceHtmlEntities),a.xtraceid=getParam(AnyBalance.getLastUrl(),/x-trace-id(?:=|%3D)([\s\S]*?)(?:&|%26|$)/i,replaceHtmlEntities),a.url=a.statetrace&&a.nonce&&a.xtraceid?"https://login.mts.ru/amserver/wsso/authenticate?client_id=LK&scope=profile%20account%20phone%20slaves:all%20slaves:profile%20sub%20email%20user_address%20identity_doc%20lbsv%20sso%20openid%20offline%20offline_access&redirect_uri=https%3A%2F%2Funited-auth.ssl.mts.ru%2Faccount%2Fcallback%2Flogin&authIndexType=service&authIndexValue=login-spa&goto=https%3A%2F%2Flogin.mts.ru%2Famserver%2Foauth2%2Frealms%2Froot%2Frealms%2Fusers%2Fauthorize%3Fclient_id%3DLK%26nonce%3D"+
a.nonce+"%26redirect_uri%3Dhttps%253A%252F%252Funited-auth.ssl.mts.ru%252Faccount%252Fcallback%252Flogin%26response_type%3Dcode%26scope%3Dprofile%2Baccount%2Bphone%2Bslaves%253Aall%2Bslaves%253Aprofile%2Bsub%2Bemail%2Buser_address%2Bidentity_doc%2Blbsv%2Bsso%2Bopenid%2Boffline%2Boffline_access%26state%3D"+a.statetrace+"%26x-trace-id%"+a.xtraceid+"&response_type=code&statetrace="+a.statetrace:"https://login.mts.ru/amserver/wsso/authenticate?authIndexType=service&authIndexValue=login-spa",c=enterLKNUI(a)):
(AnyBalance.trace("МТС направил на старый вход UI"),c=enterMTS(a))):AnyBalance.trace("Мы не на странице логина. Внутри уже?");if(isOnLogin())throw AnyBalance.trace(c),new AnyBalance.Error("Не удаётся зайти в личный кабинет");return c}
function fixCookies(){for(var a=AnyBalance.getCookies(),b=!1,f=0;f<a.length;++f){var c=a[f];/^login|REDIRECT_BACK_SERVER_URL$/i.test(c.name)&&!/^"/.test(c.value)&&(b='"'+c.value+'"',AnyBalance.trace("Исправляем куки "+c.name+" на "+b),AnyBalance.setCookie(c.domain,c.name,b,c),b=!0)}AnyBalance.getCookie("login")||AnyBalance.setCookie("login.mts.ru","login",'"https://login.mts.ru:443/amserver/UI/Login?service=lk&goto=http%3A%2F%2Flk.mts.ru%2F"',{path:"/amserver/UI/Login"});return b}
function saveLoginCookies(){var a=AnyBalance.getPreferences();AnyBalance.setData("login",a.login+"-v1");AnyBalance.saveCookies();AnyBalance.saveData()}function restoreLoginCookies(){var a=AnyBalance.getPreferences();AnyBalance.getData("login")===a.login+"-v1"&&AnyBalance.restoreCookies()}
function loginOrdinaryForm(a,b){AnyBalance.getPreferences();AnyBalance.trace("Найдена обычная форма входа");var f=getOrdinaryLoginForm(a);a=createFormParams(f,function(c,e,h,g){"IDToken1"==h?g=b.login:"IDToken2"==h?g=b.password:"noscript"==h?g=void 0:"IDButton"==h&&(g="Submit");return g});if(f=getParam(f,/data-sitekey="([^"]*)/i,replaceHtmlEntities))AnyBalance.trace("МТС требует рекапчу :("),f=solveRecaptcha("МТС требует ввода рекапчи, как и при входе через браузер. Пожалуйста, докажите, что вы не робот.",
loginUrl,f),a.IDToken3=f;AnyBalance.trace("Логинимся с заданным номером");a=AnyBalance.requestPost(b.url,a,addHeaders({Origin:g_baseurlLogin,Referer:b.url}));f=AnyBalance.getCookie("MTSWebSSO");AnyBalance.setCookie(".mts.ru","MTSWebSSO",f);fixCookies();return a}
function enterMTS(a){var b=a.baseurl||g_baseurl,f=a.url=a.url||g_baseurlLogin+"/amserver/UI/Login?goto="+b,c=a.allowRetry,e=a.html;fixCookies();if(!e||!getOrdinaryLoginForm(e)){e=AnyBalance.requestGet(f,g_headers);fixCookies();if(/__qrator|Access to [^<]* is forbidden|Доступ к сайту [^<]* запрещен/.test(e)){if(isLoginAfresh(b))return AnyBalance.trace("Сессия успешно возобновлена"),e;e=loadProtectedPage("https://lk.mts.ru/",g_headers);e=AnyBalance.requestGet(f,g_headers)}if(500<=AnyBalance.getLastStatusCode()){if(isLoginAfresh(b))return AnyBalance.trace("Сессия успешно возобновлена"),
e;AnyBalance.trace("МТС вернул 500. Пробуем ещё разок...");e=AnyBalance.requestGet(f,g_headers);fixCookies()}if(500<=AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Ошибка на сервере МТС, сервер не смог обработать запрос. Можно попытаться позже...",c);}if(isLoginAfresh(b))return AnyBalance.trace("Сессия успешно возобновлена"),e;e=redirectIfNeeded(e);var h=a.login.replace(/.*(\d{3})(\d{3})(\d{2})(\d{2})$/i,"$1 $2-$3-$4");if(b=getOrdinaryLoginForm(e))e=loginOrdinaryForm(e,a);else if(b=getElement(e,
/<form[^>]+class="section__form form -loginForm"/i)||getElement(e,/<form[^>]+class="section__passwordForm passwordForm "/i)){AnyBalance.trace("Найдена корп. форма входа");f=AnyBalance.getLastUrl();if(b=getElement(e,/<form[^>]+class="section__form form -loginForm"/i)){var g=createFormParams(b,function(d,l,k,m){"login"==k?m=h:"IDToken1"==k&&(m=a.login);return m});e=AnyBalance.requestPost(f,g,addHeaders({Origin:g_baseurlLogin,Referer:f}));fixCookies()}b=getElement(e,/<form[^>]+class="section__passwordForm passwordForm "/i);
if(!b){if(f=getElement(e,/<[^>]+errorText/i,replaceTagsAndSpaces))throw new AnyBalance.Error(f,null,/пользователь|не существует/i.test(f));if(/codeCheckForm/i.test(e))throw new AnyBalance.Error("Личный кабинет для указанного номера телефона не зарегистрирован!",null,!0);AnyBalance.trace(e);throw new AnyBalance.Error("Не удалось найти форму ввода пароля. Сайт изменен?");}g=createFormParams(b,function(d,l,k,m){"IDToken1"==k&&(m=a.password);return m});e=AnyBalance.requestPost(f,g,addHeaders({Origin:g_baseurlLogin,
Referer:f}));b=AnyBalance.getCookie("MTSWebSSO");AnyBalance.setCookie(".mts.ru","MTSWebSSO",b);fixCookies()}else{if(/bobcmn/i.test(e))throw new AnyBalance.Error("МТС ввел защиту от автоматического входа. Пожалуйста, обратитесь в поддержку МТС, составьте обращение о невозможности использования третьесторонних программ слежения за балансом. Напомните им, что вы можете перейти к другому оператору, который не противодействует отслеживанию баланса.");if(!e)throw new AnyBalance.Error("Личный кабинет МТС временно недоступен. Попробуйте ещё раз позже");
if(/<h1[^>]*>\s*Request Error/i.test(e))throw new AnyBalance.Error("Личный кабинет МТС временно не работает. Попробуйте ещё раз позже");AnyBalance.trace(e);throw new AnyBalance.Error("Не удаётся найти форму входа! Сайт изменен?",c);}500<=AnyBalance.getLastStatusCode()&&(AnyBalance.trace("МТС вернул 500 при попытке логина. Пробуем ещё разок..."),e=AnyBalance.requestPost(f,g,addHeaders({Origin:g_baseurlLogin,Referer:f})),fixCookies());if(500<=AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Ошибка на сервере МТС при попытке зайти, сервер не смог обработать запрос! Можно попытаться позже...",
c);isOnLogin()&&(e=checkLoginError(e,a));if(isOnLogin())throw AnyBalance.trace(e),new AnyBalance.Error("Не удаётся зайти в личный кабинет. Он изменился или проблемы на сайте.",c);return e}
function enterLKUI(a,b){AnyBalance.getPreferences();var f=b.login.replace(/.*(\d{3})(\d{3})(\d{2})(\d{2})$/i,"$1 $2-$3-$4");if(/captchaForm/i.test(a)){AnyBalance.trace("МТС затребовал капчу");var c=getElement(a,/<form[^>]+captchaForm[^>]*>/i);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму для ввода капчи. Сайт изменен?");a=getParam(c,/data:image\/\w+?(?:png)?;base64,([^"]+)/i);var e=AnyBalance.retrieveCode("МТС требует ввести капчу для входа в личный кабинет, чтобы подтвердить, что вы не робот. Пожалуйста, введите символы с картинки",
a);a=createFormParams(c,function(g,d,l,k){"IDToken2"==l?k=e:"noscript"==l&&(k=void 0);return k});a=AnyBalance.requestPost("https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession",a,addHeaders({Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession"}));if(!a||400<AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Личный кабинет МТС временно недоступен. Попробуйте ещё раз позже");if(/captchaForm/i.test(a)){c=getElement(a,/<form[^>]+captchaForm[^>]*>/i);
if(c=getParam(c,null,null,/class="errorText"[\s\S]*?data-error="*>?([\s\S]*?)[">]*?<\/p>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/код/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось войти в личный кабинет. Сайт изменен?");}}if(/loginForm/i.test(a)){c=getElement(a,/<form[^>]+loginForm[^>]*>/i);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму для ввода номера. Сайт изменен?");a=createFormParams(c,function(g,d,l,k){"login"==l?k=f:"IDToken1"==
l?k=b.login:"IDToken2"==l?k=b.password:"noscript"==l&&(k=void 0);return k});a=AnyBalance.requestPost("https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession",a,addHeaders({Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession"}))}c=getElement(a,/<form[^>]*>/i);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму для ввода devicePrint. Сайт изменен?");a=createFormParams(c,function(g,d,l,k){"login"==l?k=f:"IDToken1"==
l?k=b.login:"IDToken2"==l?k='{"screen":{"screenWidth":1600,"screenHeight":900,"screenColourDepth":24},"userAgent":"Mozilla/5.0+(Windows+NT+10.0;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/126.0.0.0+Safari/537.36","platform":"Win32","language":"ru","timezone":{"timezone":-180},"plugins":{"installedPlugins":"internal-pdf-viewer;internal-pdf-viewer;internal-pdf-viewer;internal-pdf-viewer;internal-pdf-viewer;"},"fonts":{"installedFonts":"cursive;monospace;serif;sans-serif;fantasy;default;Arial;Arial+Black;Arial+Narrow;Bookman+Old+Style;Bradley+Hand+ITC;Century;Century+Gothic;Comic+Sans+MS;Courier;Courier+New;Georgia;Impact;Lucida+Console;Monotype+Corsiva;Papyrus;Tahoma;Times;Times+New+Roman;Trebuchet+MS;Verdana;"},"appName":"Netscape","appCodeName":"Mozilla","appVersion":"5.0+(Windows+NT+10.0;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/126.0.0.0+Safari/537.36","product":"Gecko","productSub":"20030107","vendor":"Google+Inc."}':
"noscript"==l&&(k=void 0);return k});a=AnyBalance.requestPost("https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession",a,addHeaders({Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession"}));if(/новый пользователь|Разблокировать/i.test(a))throw AnyBalance.trace(a),new AnyBalance.Error("Ваш номер не зарегистрирован в МТС или доступ к нему заблокирован. Пожалуйста, перейдите на страницу авторизации https://login.mts.ru/amserver/UI/Login через браузер и выполните действия по регистрации или восстановлению доступа",
null,!0);if(/passwordForm/i.test(a)){c=getElement(a,/<form[^>]+passwordForm[^>]*>/i);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму для ввода пароля. Сайт изменен?");a=createFormParams(c,function(g,d,l,k){"login"==l?k=f:"IDToken1"==l?k=b.login:"IDToken2"==l?k=b.password:"noscript"==l&&(k=void 0);return k});a=AnyBalance.requestPost("https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession",a,addHeaders({Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession"}));
if(/passwordForm/i.test(a)){c=getElement(a,/<form[^>]+passwordForm[^>]*>/i);if(c=getParam(c,null,null,/class="errorText"[\s\S]*?data-error="*>?([\s\S]*?)[">]*?<\/p>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/парол/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось войти в личный кабинет. Сайт изменен?");}}if(/codeCheckForm/i.test(a)){AnyBalance.trace("МТС запросил проверку с помощью кода из SMS");var h=AnyBalance.retrieveCode("Пожалуйста, введите код подтверждения, высланный на номер +7 "+
f+'.\n\nЕсли вы не хотите постоянно вводить SMS-пароли при входе, выберите способ входа "Пароль" в настройках безопасности вашего личного кабинета МТС',null,{inputType:"number",time:3E5});c=getElement(a,/<form[^>]+codeCheckForm[^>]*>/i);if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму для ввода кода из SMS. Сайт изменен?");a=createFormParams(c,function(g,d,l,k){"IDToken1"==l?k=h:"noscript"==l&&(k=void 0);return k});a=AnyBalance.requestPost("https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession",
a,addHeaders({Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession"}));if(/codeCheckForm/i.test(a)){c=getElement(a,/<form[^>]+codeCheckForm[^>]*>/i);if(c=getParam(c,null,null,/class[^>]+errorText"[\s\S]*?oneLine"*>?([\s\S]*?)[">]*?<\/span>/i,replaceTagsAndSpaces))throw new AnyBalance.Error(c,null,/код/i.test(c));AnyBalance.trace(a);throw new AnyBalance.Error("Не удалось войти в личный кабинет. Сайт изменен?");}}c=getElement(a,/<form[^>]+gaForm[^>]*>/i);
if(!c)throw AnyBalance.trace(a),new AnyBalance.Error("Не удалось найти форму входа. Сайт изменен?");a=createFormParams(c,function(g,d,l,k){"login"==l?k=f:"IDToken1"==l?k=b.login:"IDToken2"==l?k=b.password:"noscript"==l&&(k=void 0);return k});return a=AnyBalance.requestPost("https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession",a,addHeaders({Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/UI/Login?no-config&arg=newsession"}))}
function enterLKNUI(a){var b=a.url||g_baseurlLogin+"/amserver/wsso/authenticate?authIndexType=service&authIndexValue=login-spa",f=a.ref||g_baseurlLogin+"/amserver/wsso/authenticate?authIndexType=service&authIndexValue=login-spa",c=a.allowRetry,e=getParam(a.login,null,null,null,[/.*(\d{3})(\d{3})(\d{2})(\d{2})$/,"+7 ($1) $2-$3-$4"]),h=addHeaders({Accept:"*/*","Accept-Api-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json;charset=UTF-8",Origin:"https://login.mts.ru",Referer:f}),
g=AnyBalance.requestPost(b,null,addHeaders(h));if(!g||500<=AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Личный кабинет МТС временно недоступен. Попробуйте ещё раз позже.",c);var d=getJson(g);if(!d.header&&!d.successUrl)throw AnyBalance.trace(g),new AnyBalance.Error("Не удаётся зайти в личный кабинет. Он изменился или проблемы на сайте.",c);d.header&&AnyBalance.trace("Progress header: "+d.header);d.header&&"device-match-hold"==d.header&&(d.callbacks[0].input[0].value='{"screen":{"screenWidth":1600,"screenHeight":900,"screenColourDepth":24},"userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","platform":"Win32","language":"ru","timezone":{"timezone":-180},"plugins":{"installedPlugins":"internal-pdf-viewer;internal-pdf-viewer;internal-pdf-viewer;internal-pdf-viewer;internal-pdf-viewer;"},"fonts":{"installedFonts":"cursive;monospace;serif;sans-serif;fantasy;default;Arial;Arial Black;Arial Narrow;Bookman Old Style;Bradley Hand ITC;Century;Century Gothic;Comic Sans MS;Courier;Courier New;Georgia;Impact;Lucida Console;Monotype Corsiva;Papyrus;Tahoma;Times;Times New Roman;Trebuchet MS;Verdana;"},"appName":"Netscape","appCodeName":"Mozilla","appVersion":"5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","product":"Gecko","productSub":"20030107","vendor":"Google Inc."}',
d.callbacks[2].input[0].value="true",d.callbacks[3].input[0].value="windows",d.callbacks[4].input[0].value="Ключ на Windows в Chrome",d.callbacks[5].input[0].value=generateUUID(),d.callbacks[10].input[0].value="mts-w-payment",g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h)),d=getJson(g),d.header&&AnyBalance.trace("Progress header: "+d.header));if(d.header&&"verify-captcha"==d.header){AnyBalance.trace("МТС затребовал капчу");g=d.callbacks[0].output[0].value;var l=getParam(g,/data:image\/\w+?(?:png)?;base64,([^"]+)/i);
l=AnyBalance.retrieveCode("МТС требует ввести капчу для входа в личный кабинет, чтобы подтвердить, что вы не робот. Пожалуйста, введите символы с картинки",l);d.callbacks[0].output[0].value=g;d.callbacks[1].input[0].value=l;d.callbacks[2].input[0].value="1";g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h));d=getJson(g);d.header&&AnyBalance.trace("Progress header: "+d.header);if("verify-captcha"==d.header)throw AnyBalance.trace(g),new AnyBalance.Error("Неверный код! Попробуйте еще раз",c);
}d.header&&"radius-frontend-request"==d.header&&(d.callbacks[0].input[0].value="0",d.callbacks[3].input[0].value="mts-w-payment",g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h)),d=getJson(g),d.header&&AnyBalance.trace("Progress header: "+d.header));d.header&&"confirm-network-phone"==d.header&&(d.callbacks[0].input[0].value="1",d.callbacks[1].input[0].value="mts-w-payment",g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h)),d=getJson(g),d.header&&AnyBalance.trace("Progress header: "+
d.header));if(d.header&&"network-header-resource"==d.header||"network-header-resource-v1"==d.header)d.callbacks[0].input[0].value="1",d.callbacks[1].input[0].value="mts-w-payment",g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h)),d=getJson(g),d.header&&AnyBalance.trace("Progress header: "+d.header);if(d.header&&"network-header"==d.header||"network-header-v1"==d.header)d.callbacks[2].input[0].value="mts-w-payment",g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h)),d=getJson(g),d.header&&
AnyBalance.trace("Progress header: "+d.header);if(d.header&&"enter-phone"==d.header){d.callbacks[0].input[0].value="7"+a.login;d.callbacks[1].input[0].value="1";d.callbacks[2].input[0].value="mts-w-payment";g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h));d=getJson(g);d.header&&AnyBalance.trace("Progress header: "+d.header);if("enter-phone"==d.header)throw AnyBalance.trace(g),new AnyBalance.Error("Неверный номер телефона!",c);if("lock-change-owner"==d.header)throw AnyBalance.trace(g),new AnyBalance.Error("Номер заблокирован!",
c);d=checkPasskeyOffer(d,b,h)}if(d.header&&"verify-password"==d.header){d.callbacks[0].input[0].value=a.password;d.callbacks[1].input[0].value="true";d.callbacks[2].input[0].value="1";d.callbacks[3].input[0].value="mts-w-payment";g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h));d=getJson(g);d.header&&AnyBalance.trace("Progress header: "+d.header);if("verify-password"==d.header)throw b=d.callbacks[3].output[0].value.lockoutCount,f=d.callbacks[3].output[0].value.invalidCount,b-=f,AnyBalance.trace(g),
new AnyBalance.Error("Неверный пароль! Осталось попыток: "+b,c);d=checkPasskeyOffer(d,b,h)}if(d.header&&"verify-otp"==d.header){AnyBalance.trace("МТС запросил проверку с помощью кода из SMS");a=AnyBalance.retrieveCode("Пожалуйста, введите код подтверждения, высланный на номер "+e+'\n\nЕсли вы не хотите постоянно вводить SMS-пароли при входе, выберите способ входа "Пароль" в настройках безопасности вашего личного кабинета МТС',null,{inputType:"number",time:3E5});d.callbacks[0].input[0].value=a;d.callbacks[1].input[0].value=
"true";d.callbacks[2].input[0].value="1";d.callbacks[3].input[0].value="mts-w-payment";g=AnyBalance.requestPost(b,JSON.stringify(d),addHeaders(h));d=getJson(g);d.header&&AnyBalance.trace("Progress header: "+d.header);if("verify-otp"==d.header)throw b=d.callbacks[3].output[0].value.retryCount,f=d.callbacks[3].output[0].value.invalidCount,b-=f,AnyBalance.trace(g),new AnyBalance.Error("Неверный код! Осталось попыток: "+b,c);d=checkPasskeyOffer(d,b,h)}if(d.tokenId&&d.successUrl)AnyBalance.trace("Успешно вошли через NUI: "+
JSON.stringify(d)),g=AnyBalance.requestGet(d.successUrl,addHeaders({Referer:f}));else throw AnyBalance.trace(g),new AnyBalance.Error("Не удалось войти в личный кабинет. Сайт изменен?",c);return g}
function checkPasskeyOffer(a,b,f){a.header&&"passkey-start-registration"==a.header&&(AnyBalance.trace("МТС предложил установить ключ доступа. Отказываемся..."),a.callbacks[0].input[0].value="0",a.callbacks[1].input[0].value="mts-w-payment",b=AnyBalance.requestPost(b,JSON.stringify(a),addHeaders(f)),a=getJson(b),a.header&&AnyBalance.trace("Progress header: "+a.header));return a}
function clearAllCookiesExceptProtection(){clearAllCookies(function(a){return!/qrator|StickyID/i.test(a.name)&&!/^TS0/i.test(a.name)})};g_baseurlLogin="https://login.mts.ru";
function enterLKNew(a){var b=a.url=a.url||g_baseurlLogin+"/amserver/json/authenticate?authIndexType=service&authIndexValue=login-spa",f=a.allowRetry,c=getParam(a.login,null,null,null,[/.*(\d{3})(\d{3})(\d{2})(\d{2})$/,"+7 ($1) $2-$3-$4"]);html=AnyBalance.requestPost(b,null,addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"}));if(!html||500<=AnyBalance.getLastStatusCode())throw new AnyBalance.Error("Личный кабинет МТС временно недоступен. Попробуйте ещё раз позже.",
f);var e=getJson(html);if(!e.header)throw AnyBalance.trace(html),new AnyBalance.Error("Не удаётся зайти в личный кабинет. Он изменился или проблемы на сайте.",f);var h=e.authId,g=e.header;g&&AnyBalance.trace("Progress header: "+g);if("verify-captcha"==e.header&&(AnyBalance.trace("МТС затребовал капчу"),e=e.callbacks[0].output[0].value,g=getParam(e,/data:image\/\w+?(?:png)?;base64,([^"]+)/i),g=AnyBalance.retrieveCode("МТС требует ввести капчу для входа в личный кабинет, чтобы подтвердить, что вы не робот. Пожалуйста, введите символы с картинки",
g),html=AnyBalance.requestPost(b,JSON.stringify({authId:h,template:"VerifyCaptcha.jsp",stage:"login-nodes-dslnull",header:"verify-captcha",infoText:null,callbacks:[{type:"TextOutputCallback",output:[{name:"message",value:e},{name:"messageType",value:"0"}]},{type:"PasswordCallback",output:[{name:"prompt",value:"Verify captcha"}],input:[{name:"IDToken2",value:g}]},{type:"ConfirmationCallback",output:[{name:"prompt",value:"Confirm"},{name:"messageType",value:0},{name:"options",value:["IGNORE","OK","RESTART",
"REFRESH"]},{name:"optionType",value:-1},{name:"defaultOption",value:0}],input:[{name:"IDToken3",value:1}]},{type:"MetadataCallback",output:[{name:"data",value:{acceptableOperators:["MTS","OTHER"],hiddenLogo:!1,restrictXTethered:!0,acceptableOperatorsErrorMessage:"Введен неверный номер телефона.",accessConditions:"https://static.ssl.mts.ru/mts_rf/images/usloviya-edinogo-dostupa-k-servisam-MTS.html",correlationID:"a03a3a91-4af7-44ef-975b-7a7cd53a964c",label:"Введите номер телефона",turnOffFeedbackService:!0,
feedbackServiceUrl:"feedback-prod.stage2.websso.msk.mts.ru"}}]}]}),addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"})),e=getJson(html),(g=e.header)&&AnyBalance.trace("Progress header: "+g),"verify-captcha"==e.header))throw AnyBalance.trace(html),new AnyBalance.Error("Неверный код! Попробуйте еще раз",f);"trusted-network"==e.header&&(html=AnyBalance.requestPost(b,JSON.stringify({authId:h,
template:"NetworkHeaderRedirect.jsp",stage:"login-nodes-dslnull",header:"trusted-network",infoText:null,callbacks:[{type:"ConfirmationCallback",output:[{name:"prompt",value:"Confirm"},{name:"messageType",value:0},{name:"options",value:["IGNORE","OK"]},{name:"optionType",value:-1},{name:"defaultOption",value:1}],input:[{name:"IDToken1",value:1}]},{type:"MetadataCallback",output:[{name:"data",value:{acceptableOperators:["MTS","OTHER"],hiddenLogo:!1,restrictXTethered:!0,acceptableOperatorsErrorMessage:"Введен неверный номер телефона.",
accessConditions:"https://static.ssl.mts.ru/mts_rf/images/usloviya-edinogo-dostupa-k-servisam-MTS.html",correlationID:"7cef4c35-5349-4fe6-8f0f-7db3237b8fad",label:"Введите номер телефона",turnOffFeedbackService:!0,feedbackServiceUrl:"feedback-prod.stage2.websso.msk.mts.ru"}}]}]}),addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"})),e=getJson(html),(g=e.header)&&AnyBalance.trace("Progress header: "+
g));"network-header"==e.header&&(html=AnyBalance.requestPost(b,JSON.stringify({authId:h,template:"NetworkHeader.jsp",stage:"login-nodes-dslnull",header:"network-header",infoText:null,callbacks:[{type:"TextInputCallback",output:[{name:"prompt",value:"UUID"},{name:"defaultText",value:""}],input:[{name:"IDToken1",value:""}]},{type:"ConfirmationCallback",output:[{name:"prompt",value:"Confirm"},{name:"messageType",value:0},{name:"options",value:["IGNORE","OK"]},{name:"optionType",value:-1},{name:"defaultOption",
value:0}],input:[{name:"IDToken2",value:1}]},{type:"MetadataCallback",output:[{name:"data",value:{acceptableOperators:["MTS","OTHER"],hiddenLogo:!1,restrictXTethered:!0,acceptableOperatorsErrorMessage:"Введен неверный номер телефона.",accessConditions:"https://static.ssl.mts.ru/mts_rf/images/usloviya-edinogo-dostupa-k-servisam-MTS.html",correlationID:"866453b2-21c9-4e6b-a112-b20aff8b695e",label:"Введите номер телефона",turnOffFeedbackService:!0,feedbackServiceUrl:"feedback-prod.stage2.websso.msk.mts.ru"}}]}]}),
addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"})),e=getJson(html),(g=e.header)&&AnyBalance.trace("Progress header: "+g));if("enter-phone"==e.header){html=AnyBalance.requestPost(b,JSON.stringify({authId:h,template:"EnterPhone.jsp",stage:"login-nodes-dslnull",header:"enter-phone",infoText:null,callbacks:[{type:"NameCallback",output:[{name:"prompt",value:"Введите номер телефона"}],
input:[{name:"IDToken1",value:"7"+a.login}]},{type:"ConfirmationCallback",output:[{name:"prompt",value:"Confirm"},{name:"messageType",value:0},{name:"options",value:["IGNORE","OK"]},{name:"optionType",value:-1},{name:"defaultOption",value:0}],input:[{name:"IDToken2",value:1}]},{type:"MetadataCallback",output:[{name:"data",value:{acceptableOperators:["MTS","OTHER"],hiddenLogo:!1,restrictXTethered:!0,acceptableOperatorsErrorMessage:"Введен неверный номер телефона.",accessConditions:"https://static.ssl.mts.ru/mts_rf/images/usloviya-edinogo-dostupa-k-servisam-MTS.html",
correlationID:"7cef4c35-5349-4fe6-8f0f-7db3237b8fad",label:"Введите номер телефона",turnOffFeedbackService:!0,feedbackServiceUrl:"feedback-prod.stage2.websso.msk.mts.ru"}}]}]}),addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"}));e=getJson(html);(g=e.header)&&AnyBalance.trace("Progress header: "+g);if("enter-phone"==e.header)throw AnyBalance.trace(html),new AnyBalance.Error("Неверный номер телефона!",
f);if("lock-change-owner"==e.header)throw AnyBalance.trace(html),new AnyBalance.Error("Номер заблокирован!",f);}if("verify-password"==e.header&&(html=AnyBalance.requestPost(b,JSON.stringify({authId:h,template:"VerifyPassword.jsp",stage:"login-nodes-dslnull",header:"verify-password",infoText:null,callbacks:[{type:"PasswordCallback",output:[{name:"prompt",value:"Verify password"}],input:[{name:"IDToken1",value:a.password}]},{type:"ConfirmationCallback",output:[{name:"prompt",value:"Confirm"},{name:"messageType",
value:0},{name:"options",value:["IGNORE","OK","RESTART","RESTORE"]},{name:"optionType",value:-1},{name:"defaultOption",value:0}],input:[{name:"IDToken2",value:1}]},{type:"MetadataCallback",output:[{name:"data",value:{lockoutCount:3,hiddenLogo:!1,numberType:"MOBILE",restrictXTethered:!0,acceptableOperatorsErrorMessage:"Введен неверный номер телефона.",accessConditions:"https://static.ssl.mts.ru/mts_rf/images/usloviya-edinogo-dostupa-k-servisam-MTS.html",label:"Введите номер телефона",abonent:"mMTS",
userId:"c25f25f0-588d-11ea-98aa-b9cf018c481e",acceptableOperators:["MTS","OTHER"],invalidCount:0,recipient:c,authUserLevel:"1",correlationID:"7cef4c35-5349-4fe6-8f0f-7db3237b8fad",turnOffFeedbackService:!0,feedbackServiceUrl:"feedback-prod.stage2.websso.msk.mts.ru"}}]}]}),addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"})),e=getJson(html),(g=e.header)&&AnyBalance.trace("Progress header: "+
g),"verify-password"==e.header))throw AnyBalance.trace(html),new AnyBalance.Error("Неверный пароль!",f);if("verify-otp"==e.header&&(AnyBalance.trace("МТС запросил проверку с помощью кода из SMS"),a=AnyBalance.retrieveCode("Пожалуйста, введите код подтверждения, высланный на номер "+c+'\n\nЕсли вы не хотите постоянно вводить SMS-пароли при входе, выберите способ входа "Пароль" в настройках безопасности вашего личного кабинета МТС',null,{inputType:"number",time:3E5}),html=AnyBalance.requestPost(b,JSON.stringify({authId:h,
template:"VerifyOTP.jsp",stage:"login-nodes-dslnull",header:"verify-otp",infoText:null,callbacks:[{type:"PasswordCallback",output:[{name:"prompt",value:"Verify otp"}],input:[{name:"IDToken1",value:a}]},{type:"ConfirmationCallback",output:[{name:"prompt",value:"Confirm"},{name:"messageType",value:0},{name:"options",value:["IGNORE","OK","RESTART","REFRESH","CANTGET"]},{name:"optionType",value:-1},{name:"defaultOption",value:0}],input:[{name:"IDToken2",value:1}]},{type:"MetadataCallback",output:[{name:"data",
value:{hiddenLogo:!1,numberType:"MOBILE",restrictXTethered:!0,retryCount:3,isAux:!1,acceptableOperatorsErrorMessage:"Введен неверный номер телефона.",channel:"SMS",accessConditions:"https://static.ssl.mts.ru/mts_rf/images/usloviya-edinogo-dostupa-k-servisam-MTS.html",label:"Введите номер телефона",abonent:"mMTS",userId:"dfcc9720-019a-11ea-88ba-339a25f0d609",acceptableOperators:["MTS","OTHER"],invalidCount:0,recipient:c,authUserLevel:"0",correlationID:"01a59697-d872-4a42-a3b3-c86877ad4bc8",isRestoreMode:!1,
turnOffFeedbackService:!0,feedbackServiceUrl:"feedback-prod.stage2.websso.msk.mts.ru"}}]}]}),addHeaders({Accept:"*/*","Accept-API-Version":"resource=4.0, protocol=1.0","Content-Type":"application/json",Origin:"https://login.mts.ru",Referer:"https://login.mts.ru/amserver/NUI/"})),e=getJson(html),(g=e.header)&&AnyBalance.trace("Progress header: "+g),"verify-otp"==e.header))throw b=e.callbacks[2].output[0].value.retryCount-e.callbacks[2].output[0].value.invalidCount,AnyBalance.trace(html),new AnyBalance.Error("Неверный код! Осталось попыток: "+
b,f);if(e.tokenId&&e.successUrl)AnyBalance.trace("Успешно вошли: "+JSON.stringify(e)),html=AnyBalance.requestGet(e.successUrl,addHeaders({Referer:"https://login.mts.ru/"}));else throw AnyBalance.trace(html),new AnyBalance.Error("Не удалось войти в личный кабинет. Сайт изменен?",f);return html};
