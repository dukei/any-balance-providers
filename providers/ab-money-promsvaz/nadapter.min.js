function NAdapter(m,x,h){function y(a){isArray(a)||(a=[a]);for(var b=0;b<a.length;++b){if(n[a[b]])return!0;if(h.autoSimpleCounters&&0>a[b].indexOf("."))return t.call(AnyBalance,a[b])}return!1}function z(a){for(var b=0;b<arguments.length;++b)if(y(arguments[b]))return!0;return!1}function u(a,b){return a.reduce(function(a,c){return a||c.__id!=b?a:c},null)}function v(a,b){for(var d=b.split(/\./g),c,f=0;f<d.length;++f){c=a[d[f]];b=d.slice(0,f+1).join(".");var e=c;c=b;p[c]?c=p[c](e,c):(isArray(e)&&(e=g[c]&&
e[0]&&e[0].__id?u(e,g[c]):e[0]),c=e);if(!isset(c)||null===c)break;a=c}return c}function w(a,b){AnyBalance.isAvailable=z;try{return a.apply(null,b)}finally{AnyBalance.isAvailable=t}}var n={},t=AnyBalance.isAvailable;h||(h={});var p={},q;for(q in m)if(isAvailable(q)){var k=m[q];isArray(k)||(k=[k]);for(var r=0;r<k.length;++r){var l=k[r];do n[l]=!0,l=0<=l.indexOf(".")?l.replace(/\.[^.]*$/,""):null;while(null!==l)}}var g={};AnyBalance.shouldProcess=function(a,b){var d=h.shouldProcessMultipleCalls,d="object"==
typeof d?d[a]:d;if(!d&&g[a])return b.__id==g[a];if(d=x(a,b))g[a]=b.__id;return d};return{exec:w,convert:function(a){if(!a.success)return a;var b={success:!0};if(h.autoSimpleCounters)for(var d in a)n[d]||isArray(a[d])||(b[d]=a[d]);for(d in m)if(isAvailable(d)&&"__forceAvailable"!=d){var c=m[d];isArray(c)||(c=[c]);for(var f=0;f<c.length;++f){var e=v(a,c[f]);if(isset(e)){b[d]=e;break}}}return b},envelope:function(a){return function(){return w(a,arguments)}},traverse:v,wasProcessed:function(a){return g[a]},
setTraverseCallbacks:function(a){for(var b in a)p[b]=a[b]},findEntityById:u}};
